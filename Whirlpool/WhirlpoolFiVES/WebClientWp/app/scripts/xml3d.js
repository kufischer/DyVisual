(function e$$0(m,l,d){function b(c,k){if(!l[c]){if(!m[c]){var h="function"==typeof require&&require;if(!k&&h)return h(c,!0);if(a)return a(c,!0);h=Error("Cannot find module '"+c+"'");throw h.code="MODULE_NOT_FOUND",h;}h=l[c]={exports:{}};m[c][0].call(h.exports,function(a){var k=m[c][1][a];return b(k?k:a)},h,h.exports,e$$0,m,l,d)}return l[c].exports}for(var a="function"==typeof require&&require,c=0;c<d.length;c++)b(d[c]);return b})({1:[function(e,m,l){l.glMatrix=e("./gl-matrix/common.js");l.mat2=e("./gl-matrix/mat2.js");
l.mat2d=e("./gl-matrix/mat2d.js");l.mat3=e("./gl-matrix/mat3.js");l.mat4=e("./gl-matrix/mat4.js");l.quat=e("./gl-matrix/quat.js");l.vec2=e("./gl-matrix/vec2.js");l.vec3=e("./gl-matrix/vec3.js");l.vec4=e("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":2,"./gl-matrix/mat2.js":3,"./gl-matrix/mat2d.js":4,"./gl-matrix/mat3.js":5,"./gl-matrix/mat4.js":6,"./gl-matrix/quat.js":7,"./gl-matrix/vec2.js":8,"./gl-matrix/vec3.js":9,"./gl-matrix/vec4.js":10}],2:[function(e,m,l){e={EPSILON:1E-6};e.ARRAY_TYPE="undefined"!==
typeof Float32Array?Float32Array:Array;e.RANDOM=Math.random;e.setMatrixArrayType=function(b){GLMAT_ARRAY_TYPE=b};var d=Math.PI/180;e.toRadian=function(b){return b*d};m.exports=e},{}],3:[function(e,m,l){var d=e("./common.js");e={create:function(){var b=new d.ARRAY_TYPE(4);b[0]=1;b[1]=0;b[2]=0;b[3]=1;return b},clone:function(b){var a=new d.ARRAY_TYPE(4);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(b){b[0]=1;
b[1]=0;b[2]=0;b[3]=1;return b},transpose:function(b,a){if(b===a){var c=a[1];b[1]=a[2];b[2]=c}else b[0]=a[0],b[1]=a[2],b[2]=a[1],b[3]=a[3];return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=c*h-k*f;if(!g)return null;g=1/g;b[0]=h*g;b[1]=-f*g;b[2]=-k*g;b[3]=c*g;return b},adjoint:function(b,a){var c=a[0];b[0]=a[3];b[1]=-a[1];b[2]=-a[2];b[3]=c;return b},determinant:function(b){return b[0]*b[3]-b[2]*b[1]},multiply:function(b,a,c){var f=a[0],k=a[1],h=a[2];a=a[3];var g=c[0],d=c[1],e=c[2];c=
c[3];b[0]=f*g+h*d;b[1]=k*g+a*d;b[2]=f*e+h*c;b[3]=k*e+a*c;return b}};e.mul=e.multiply;e.rotate=function(b,a,c){var f=a[0],k=a[1],h=a[2];a=a[3];var g=Math.sin(c);c=Math.cos(c);b[0]=f*c+h*g;b[1]=k*c+a*g;b[2]=f*-g+h*c;b[3]=k*-g+a*c;return b};e.scale=function(b,a,c){var f=a[1],k=a[2],h=a[3],g=c[0];c=c[1];b[0]=a[0]*g;b[1]=f*g;b[2]=k*c;b[3]=h*c;return b};e.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=-c;b[3]=f;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;
b[3]=a[1];return b};e.str=function(b){return"mat2("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2))};e.LDU=function(b,a,c,f){b[2]=f[2]/f[0];c[0]=f[0];c[1]=f[1];c[3]=f[3]-b[2]*c[1];return[b,a,c]};m.exports=e},{"./common.js":2}],4:[function(e,m,l){var d=e("./common.js");e={create:function(){var b=new d.ARRAY_TYPE(6);b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},clone:function(b){var a=new d.ARRAY_TYPE(6);
a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=a[4],d=a[5],e=c*h-f*k;if(!e)return null;e=1/e;b[0]=h*e;b[1]=-f*e;b[2]=-k*e;b[3]=c*e;b[4]=(k*d-h*g)*e;b[5]=(f*g-c*d)*e;return b},determinant:function(b){return b[0]*b[3]-b[1]*b[2]},multiply:function(b,a,c){var f=a[0],
k=a[1],h=a[2],g=a[3],d=a[4];a=a[5];var e=c[0],n=c[1],p=c[2],t=c[3],x=c[4];c=c[5];b[0]=f*e+h*n;b[1]=k*e+g*n;b[2]=f*p+h*t;b[3]=k*p+g*t;b[4]=f*x+h*c+d;b[5]=k*x+g*c+a;return b}};e.mul=e.multiply;e.rotate=function(b,a,c){var f=a[0],k=a[1],h=a[2],g=a[3],d=a[4];a=a[5];var e=Math.sin(c);c=Math.cos(c);b[0]=f*c+h*e;b[1]=k*c+g*e;b[2]=f*-e+h*c;b[3]=k*-e+g*c;b[4]=d;b[5]=a;return b};e.scale=function(b,a,c){var f=a[1],k=a[2],h=a[3],g=a[4],d=a[5],e=c[0];c=c[1];b[0]=a[0]*e;b[1]=f*e;b[2]=k*c;b[3]=h*c;b[4]=g;b[5]=d;
return b};e.translate=function(b,a,c){var f=a[0],k=a[1],h=a[2],g=a[3],d=a[4];a=a[5];var e=c[0];c=c[1];b[0]=f;b[1]=k;b[2]=h;b[3]=g;b[4]=f*e+h*c+d;b[5]=k*e+g*c+a;return b};e.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=-c;b[3]=f;b[4]=0;b[5]=0;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=a[1];b[4]=0;b[5]=0;return b};e.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=a[0];b[5]=a[1];return b};e.str=function(b){return"mat2d("+b[0]+", "+
b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};m.exports=e},{"./common.js":2}],5:[function(e,m,l){var d=e("./common.js");e={create:function(){var b=new d.ARRAY_TYPE(9);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},fromMat4:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},
clone:function(b){var a=new d.ARRAY_TYPE(9);a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b},transpose:function(b,a){if(b===a){var c=a[1],f=a[2],k=a[5];b[1]=a[3];b[2]=a[6];b[3]=c;b[5]=a[7];b[6]=f;b[7]=k}else b[0]=a[0],b[1]=a[3],b[2]=a[6],
b[3]=a[1],b[4]=a[4],b[5]=a[7],b[6]=a[2],b[7]=a[5],b[8]=a[8];return b},invert:function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=a[4],d=a[5],e=a[6],n=a[7],p=a[8],t=p*g-d*n,x=-p*h+d*e,u=n*h-g*e,v=c*t+f*x+k*u;if(!v)return null;v=1/v;b[0]=t*v;b[1]=(-p*f+k*n)*v;b[2]=(d*f-k*g)*v;b[3]=x*v;b[4]=(p*c-k*e)*v;b[5]=(-d*c+k*h)*v;b[6]=u*v;b[7]=(-n*c+f*e)*v;b[8]=(g*c-f*h)*v;return b},adjoint:function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=a[4],d=a[5],e=a[6],n=a[7],p=a[8];b[0]=g*p-d*n;b[1]=k*n-f*p;b[2]=f*d-k*g;b[3]=
d*e-h*p;b[4]=c*p-k*e;b[5]=k*h-c*d;b[6]=h*n-g*e;b[7]=f*e-c*n;b[8]=c*g-f*h;return b},determinant:function(b){var a=b[3],c=b[4],f=b[5],k=b[6],h=b[7],g=b[8];return b[0]*(g*c-f*h)+b[1]*(-g*a+f*k)+b[2]*(h*a-c*k)},multiply:function(b,a,c){var f=a[0],k=a[1],h=a[2],g=a[3],d=a[4],e=a[5],n=a[6],p=a[7];a=a[8];var t=c[0],x=c[1],u=c[2],v=c[3],w=c[4],z=c[5],y=c[6],l=c[7];c=c[8];b[0]=t*f+x*g+u*n;b[1]=t*k+x*d+u*p;b[2]=t*h+x*e+u*a;b[3]=v*f+w*g+z*n;b[4]=v*k+w*d+z*p;b[5]=v*h+w*e+z*a;b[6]=y*f+l*g+c*n;b[7]=y*k+l*d+c*p;
b[8]=y*h+l*e+c*a;return b}};e.mul=e.multiply;e.translate=function(b,a,c){var f=a[0],k=a[1],h=a[2],g=a[3],d=a[4],e=a[5],n=a[6],p=a[7];a=a[8];var t=c[0];c=c[1];b[0]=f;b[1]=k;b[2]=h;b[3]=g;b[4]=d;b[5]=e;b[6]=t*f+c*g+n;b[7]=t*k+c*d+p;b[8]=t*h+c*e+a;return b};e.rotate=function(b,a,c){var f=a[0],k=a[1],h=a[2],g=a[3],d=a[4],e=a[5],n=a[6],p=a[7];a=a[8];var t=Math.sin(c);c=Math.cos(c);b[0]=c*f+t*g;b[1]=c*k+t*d;b[2]=c*h+t*e;b[3]=c*g-t*f;b[4]=c*d-t*k;b[5]=c*e-t*h;b[6]=n;b[7]=p;b[8]=a;return b};e.scale=function(b,
a,c){var f=c[0];c=c[1];b[0]=f*a[0];b[1]=f*a[1];b[2]=f*a[2];b[3]=c*a[3];b[4]=c*a[4];b[5]=c*a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};e.fromTranslation=function(b,a){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=1;b[5]=0;b[6]=a[0];b[7]=a[1];b[8]=1;return b};e.fromRotation=function(b,a){var c=Math.sin(a),f=Math.cos(a);b[0]=f;b[1]=c;b[2]=0;b[3]=-c;b[4]=f;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};e.fromScaling=function(b,a){b[0]=a[0];b[1]=0;b[2]=0;b[3]=0;b[4]=a[1];b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};e.fromMat2d=function(b,
a){b[0]=a[0];b[1]=a[1];b[2]=0;b[3]=a[2];b[4]=a[3];b[5]=0;b[6]=a[4];b[7]=a[5];b[8]=1;return b};e.fromQuat=function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=c+c,d=f+f,e=k+k,c=c*g,n=f*g,f=f*d,p=k*g,t=k*d,k=k*e,g=h*g,d=h*d,h=h*e;b[0]=1-f-k;b[3]=n-h;b[6]=p+d;b[1]=n+h;b[4]=1-c-k;b[7]=t-g;b[2]=p-d;b[5]=t+g;b[8]=1-c-f;return b};e.normalFromMat4=function(b,a){var c=a[0],f=a[1],k=a[2],h=a[3],g=a[4],d=a[5],e=a[6],n=a[7],p=a[8],t=a[9],x=a[10],u=a[11],v=a[12],w=a[13],z=a[14],y=a[15],l=c*d-f*g,m=c*e-k*g,A=c*n-h*
g,B=f*e-k*d,D=f*n-h*d,H=k*n-h*e,F=p*w-t*v,G=p*z-x*v,p=p*y-u*v,I=t*z-x*w,t=t*y-u*w,x=x*y-u*z,u=l*x-m*t+A*I+B*p-D*G+H*F;if(!u)return null;u=1/u;b[0]=(d*x-e*t+n*I)*u;b[1]=(e*p-g*x-n*G)*u;b[2]=(g*t-d*p+n*F)*u;b[3]=(k*t-f*x-h*I)*u;b[4]=(c*x-k*p+h*G)*u;b[5]=(f*p-c*t-h*F)*u;b[6]=(w*H-z*D+y*B)*u;b[7]=(z*A-v*H-y*m)*u;b[8]=(v*D-w*A+y*l)*u;return b};e.str=function(b){return"mat3("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+", "+b[6]+", "+b[7]+", "+b[8]+")"};e.frob=function(b){return Math.sqrt(Math.pow(b[0],
2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+Math.pow(b[6],2)+Math.pow(b[7],2)+Math.pow(b[8],2))};m.exports=e},{"./common.js":2}],6:[function(e,m,l){var d=e("./common.js"),b={create:function(){var a=new d.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var c=new d.ARRAY_TYPE(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=
a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,c){if(a===c){var f=
c[1],b=c[2],h=c[3],g=c[6],d=c[7],e=c[11];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=f;a[6]=c[9];a[7]=c[13];a[8]=b;a[9]=g;a[11]=c[14];a[12]=h;a[13]=d;a[14]=e}else a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a},invert:function(a,c){var f=c[0],b=c[1],h=c[2],g=c[3],d=c[4],e=c[5],n=c[6],p=c[7],t=c[8],x=c[9],u=c[10],v=c[11],w=c[12],z=c[13],y=c[14],l=c[15],m=f*e-b*d,A=f*n-h*d,B=
f*p-g*d,D=b*n-h*e,H=b*p-g*e,F=h*p-g*n,G=t*z-x*w,I=t*y-u*w,K=t*l-v*w,L=x*y-u*z,M=x*l-v*z,N=u*l-v*y,J=m*N-A*M+B*L+D*K-H*I+F*G;if(!J)return null;J=1/J;a[0]=(e*N-n*M+p*L)*J;a[1]=(h*M-b*N-g*L)*J;a[2]=(z*F-y*H+l*D)*J;a[3]=(u*H-x*F-v*D)*J;a[4]=(n*K-d*N-p*I)*J;a[5]=(f*N-h*K+g*I)*J;a[6]=(y*B-w*F-l*A)*J;a[7]=(t*F-u*B+v*A)*J;a[8]=(d*M-e*K+p*G)*J;a[9]=(b*K-f*M-g*G)*J;a[10]=(w*H-z*B+l*m)*J;a[11]=(x*B-t*H-v*m)*J;a[12]=(e*I-d*L-n*G)*J;a[13]=(f*L-b*I+h*G)*J;a[14]=(z*A-w*D-y*m)*J;a[15]=(t*D-x*A+u*m)*J;return a},adjoint:function(a,
c){var f=c[0],b=c[1],h=c[2],g=c[3],d=c[4],e=c[5],n=c[6],p=c[7],t=c[8],x=c[9],u=c[10],v=c[11],w=c[12],z=c[13],y=c[14],l=c[15];a[0]=e*(u*l-v*y)-x*(n*l-p*y)+z*(n*v-p*u);a[1]=-(b*(u*l-v*y)-x*(h*l-g*y)+z*(h*v-g*u));a[2]=b*(n*l-p*y)-e*(h*l-g*y)+z*(h*p-g*n);a[3]=-(b*(n*v-p*u)-e*(h*v-g*u)+x*(h*p-g*n));a[4]=-(d*(u*l-v*y)-t*(n*l-p*y)+w*(n*v-p*u));a[5]=f*(u*l-v*y)-t*(h*l-g*y)+w*(h*v-g*u);a[6]=-(f*(n*l-p*y)-d*(h*l-g*y)+w*(h*p-g*n));a[7]=f*(n*v-p*u)-d*(h*v-g*u)+t*(h*p-g*n);a[8]=d*(x*l-v*z)-t*(e*l-p*z)+w*(e*v-
p*x);a[9]=-(f*(x*l-v*z)-t*(b*l-g*z)+w*(b*v-g*x));a[10]=f*(e*l-p*z)-d*(b*l-g*z)+w*(b*p-g*e);a[11]=-(f*(e*v-p*x)-d*(b*v-g*x)+t*(b*p-g*e));a[12]=-(d*(x*y-u*z)-t*(e*y-n*z)+w*(e*u-n*x));a[13]=f*(x*y-u*z)-t*(b*y-h*z)+w*(b*u-h*x);a[14]=-(f*(e*y-n*z)-d*(b*y-h*z)+w*(b*n-h*e));a[15]=f*(e*u-n*x)-d*(b*u-h*x)+t*(b*n-h*e);return a},determinant:function(a){var c=a[0],f=a[1],b=a[2],h=a[3],g=a[4],d=a[5],e=a[6],n=a[7],p=a[8],t=a[9],x=a[10],u=a[11],v=a[12],w=a[13],l=a[14];a=a[15];return(c*d-f*g)*(x*a-u*l)-(c*e-b*g)*
(t*a-u*w)+(c*n-h*g)*(t*l-x*w)+(f*e-b*d)*(p*a-u*v)-(f*n-h*d)*(p*l-x*v)+(b*n-h*e)*(p*w-t*v)},multiply:function(a,c,f){var b=c[0],h=c[1],g=c[2],d=c[3],e=c[4],n=c[5],p=c[6],t=c[7],x=c[8],u=c[9],v=c[10],w=c[11],l=c[12],y=c[13],m=c[14];c=c[15];var C=f[0],A=f[1],B=f[2],D=f[3];a[0]=C*b+A*e+B*x+D*l;a[1]=C*h+A*n+B*u+D*y;a[2]=C*g+A*p+B*v+D*m;a[3]=C*d+A*t+B*w+D*c;C=f[4];A=f[5];B=f[6];D=f[7];a[4]=C*b+A*e+B*x+D*l;a[5]=C*h+A*n+B*u+D*y;a[6]=C*g+A*p+B*v+D*m;a[7]=C*d+A*t+B*w+D*c;C=f[8];A=f[9];B=f[10];D=f[11];a[8]=
C*b+A*e+B*x+D*l;a[9]=C*h+A*n+B*u+D*y;a[10]=C*g+A*p+B*v+D*m;a[11]=C*d+A*t+B*w+D*c;C=f[12];A=f[13];B=f[14];D=f[15];a[12]=C*b+A*e+B*x+D*l;a[13]=C*h+A*n+B*u+D*y;a[14]=C*g+A*p+B*v+D*m;a[15]=C*d+A*t+B*w+D*c;return a}};b.mul=b.multiply;b.translate=function(a,c,f){var b=f[0],h=f[1];f=f[2];var g,d,e,n,p,t,x,u,v,w,l,y;c===a?(a[12]=c[0]*b+c[4]*h+c[8]*f+c[12],a[13]=c[1]*b+c[5]*h+c[9]*f+c[13],a[14]=c[2]*b+c[6]*h+c[10]*f+c[14],a[15]=c[3]*b+c[7]*h+c[11]*f+c[15]):(g=c[0],d=c[1],e=c[2],n=c[3],p=c[4],t=c[5],x=c[6],
u=c[7],v=c[8],w=c[9],l=c[10],y=c[11],a[0]=g,a[1]=d,a[2]=e,a[3]=n,a[4]=p,a[5]=t,a[6]=x,a[7]=u,a[8]=v,a[9]=w,a[10]=l,a[11]=y,a[12]=g*b+p*h+v*f+c[12],a[13]=d*b+t*h+w*f+c[13],a[14]=e*b+x*h+l*f+c[14],a[15]=n*b+u*h+y*f+c[15]);return a};b.scale=function(a,c,f){var b=f[0],h=f[1];f=f[2];a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;a[4]=c[4]*h;a[5]=c[5]*h;a[6]=c[6]*h;a[7]=c[7]*h;a[8]=c[8]*f;a[9]=c[9]*f;a[10]=c[10]*f;a[11]=c[11]*f;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.rotate=function(a,
c,f,b){var h=b[0],g=b[1];b=b[2];var e=Math.sqrt(h*h+g*g+b*b),r,n,p,t,x,u,v,w,l,y,m,C,A,B,D,H,F,G,I,K;if(Math.abs(e)<d.EPSILON)return null;e=1/e;h*=e;g*=e;b*=e;r=Math.sin(f);n=Math.cos(f);p=1-n;f=c[0];e=c[1];t=c[2];x=c[3];u=c[4];v=c[5];w=c[6];l=c[7];y=c[8];m=c[9];C=c[10];A=c[11];B=h*h*p+n;D=g*h*p+b*r;H=b*h*p-g*r;F=h*g*p-b*r;G=g*g*p+n;I=b*g*p+h*r;K=h*b*p+g*r;h=g*b*p-h*r;g=b*b*p+n;a[0]=f*B+u*D+y*H;a[1]=e*B+v*D+m*H;a[2]=t*B+w*D+C*H;a[3]=x*B+l*D+A*H;a[4]=f*F+u*G+y*I;a[5]=e*F+v*G+m*I;a[6]=t*F+w*G+C*I;a[7]=
x*F+l*G+A*I;a[8]=f*K+u*h+y*g;a[9]=e*K+v*h+m*g;a[10]=t*K+w*h+C*g;a[11]=x*K+l*h+A*g;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};b.rotateX=function(a,c,f){var b=Math.sin(f);f=Math.cos(f);var h=c[4],g=c[5],d=c[6],e=c[7],n=c[8],p=c[9],t=c[10],x=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=h*f+n*b;a[5]=g*f+p*b;a[6]=d*f+t*b;a[7]=e*f+x*b;a[8]=n*f-h*b;a[9]=p*f-g*b;a[10]=t*f-d*b;a[11]=x*f-e*b;return a};b.rotateY=function(a,
c,f){var b=Math.sin(f);f=Math.cos(f);var h=c[0],g=c[1],d=c[2],e=c[3],n=c[8],p=c[9],t=c[10],x=c[11];c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=h*f-n*b;a[1]=g*f-p*b;a[2]=d*f-t*b;a[3]=e*f-x*b;a[8]=h*b+n*f;a[9]=g*b+p*f;a[10]=d*b+t*f;a[11]=e*b+x*f;return a};b.rotateZ=function(a,c,f){var b=Math.sin(f);f=Math.cos(f);var h=c[0],g=c[1],d=c[2],e=c[3],n=c[4],p=c[5],t=c[6],x=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],
a[14]=c[14],a[15]=c[15]);a[0]=h*f+n*b;a[1]=g*f+p*b;a[2]=d*f+t*b;a[3]=e*f+x*b;a[4]=n*f-h*b;a[5]=p*f-g*b;a[6]=t*f-d*b;a[7]=x*f-e*b;return a};b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,
f){var b=f[0],h=f[1];f=f[2];var g=Math.sqrt(b*b+h*h+f*f),e;if(Math.abs(g)<d.EPSILON)return null;g=1/g;b*=g;h*=g;f*=g;g=Math.sin(c);c=Math.cos(c);e=1-c;a[0]=b*b*e+c;a[1]=h*b*e+f*g;a[2]=f*b*e-h*g;a[3]=0;a[4]=b*h*e-f*g;a[5]=h*h*e+c;a[6]=f*h*e+b*g;a[7]=0;a[8]=b*f*e+h*g;a[9]=h*f*e-b*g;a[10]=f*f*e+c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var f=Math.sin(c),b=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=f;a[7]=0;a[8]=0;a[9]=-f;a[10]=b;a[11]=0;a[12]=0;
a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,c){var f=Math.sin(c),b=Math.cos(c);a[0]=b;a[1]=0;a[2]=-f;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=f;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var f=Math.sin(c),b=Math.cos(c);a[0]=b;a[1]=f;a[2]=0;a[3]=0;a[4]=-f;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=function(a,c,f){var b=c[0],h=c[1],g=c[2],d=c[3],e=b+b,n=h+h,
p=g+g;c=b*e;var t=b*n,b=b*p,x=h*n,h=h*p,g=g*p,e=d*e,n=d*n,d=d*p;a[0]=1-(x+g);a[1]=t+d;a[2]=b-n;a[3]=0;a[4]=t-d;a[5]=1-(c+g);a[6]=h+e;a[7]=0;a[8]=b+n;a[9]=h-e;a[10]=1-(c+x);a[11]=0;a[12]=f[0];a[13]=f[1];a[14]=f[2];a[15]=1;return a};b.fromRotationTranslationScale=function(a,c,f,b){var h=c[0],g=c[1],d=c[2],e=c[3],n=h+h,p=g+g,t=d+d;c=h*n;var x=h*p,h=h*t,u=g*p,g=g*t,d=d*t,n=e*n,p=e*p,e=e*t,t=b[0],v=b[1];b=b[2];a[0]=(1-(u+d))*t;a[1]=(x+e)*t;a[2]=(h-p)*t;a[3]=0;a[4]=(x-e)*v;a[5]=(1-(c+d))*v;a[6]=(g+n)*v;
a[7]=0;a[8]=(h+p)*b;a[9]=(g-n)*b;a[10]=(1-(c+u))*b;a[11]=0;a[12]=f[0];a[13]=f[1];a[14]=f[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,f,b,h){var g=c[0],d=c[1],e=c[2],n=c[3],p=g+g,t=d+d,x=e+e;c=g*p;var u=g*t,g=g*x,v=d*t,d=d*x,e=e*x,p=n*p,t=n*t,n=n*x,x=b[0],w=b[1];b=b[2];var l=h[0],y=h[1];h=h[2];a[0]=(1-(v+e))*x;a[1]=(u+n)*x;a[2]=(g-t)*x;a[3]=0;a[4]=(u-n)*w;a[5]=(1-(c+e))*w;a[6]=(d+p)*w;a[7]=0;a[8]=(g+t)*b;a[9]=(d-p)*b;a[10]=(1-(c+v))*b;a[11]=0;a[12]=f[0]+l-(a[0]*l+a[4]*y+
a[8]*h);a[13]=f[1]+y-(a[1]*l+a[5]*y+a[9]*h);a[14]=f[2]+h-(a[2]*l+a[6]*y+a[10]*h);a[15]=1;return a};b.fromQuat=function(a,c){var f=c[0],b=c[1],h=c[2],g=c[3],d=f+f,e=b+b,n=h+h,f=f*d,p=b*d,b=b*e,t=h*d,x=h*e,h=h*n,d=g*d,e=g*e,g=g*n;a[0]=1-b-h;a[1]=p+g;a[2]=t-e;a[3]=0;a[4]=p-g;a[5]=1-f-h;a[6]=x+d;a[7]=0;a[8]=t+e;a[9]=x-d;a[10]=1-f-b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,f,b,h,g,d){var e=1/(f-c),n=1/(h-b),p=1/(g-d);a[0]=2*g*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*g*n;a[6]=
0;a[7]=0;a[8]=(f+c)*e;a[9]=(h+b)*n;a[10]=(d+g)*p;a[11]=-1;a[12]=0;a[13]=0;a[14]=d*g*2*p;a[15]=0;return a};b.perspective=function(a,c,f,b,h){c=1/Math.tan(c/2);var g=1/(b-h);a[0]=c/f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(h+b)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*h*b*g;a[15]=0;return a};b.perspectiveFromFieldOfView=function(a,c,f,b){var h=Math.tan(c.upDegrees*Math.PI/180),g=Math.tan(c.downDegrees*Math.PI/180),d=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*
Math.PI/180);var e=2/(d+c),n=2/(h+g);a[0]=e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=n;a[6]=0;a[7]=0;a[8]=-((d-c)*e*.5);a[9]=(h-g)*n*.5;a[10]=b/(f-b);a[11]=-1;a[12]=0;a[13]=0;a[14]=b*f/(f-b);a[15]=0;return a};b.ortho=function(a,c,f,b,h,g,d){var e=1/(c-f),n=1/(b-h),p=1/(g-d);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*n;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*p;a[11]=0;a[12]=(c+f)*e;a[13]=(h+b)*n;a[14]=(d+g)*p;a[15]=1;return a};b.lookAt=function(a,c,f,k){var h,g,e,r,n,p,t,x,u=c[0],v=c[1];c=c[2];e=k[0];r=k[1];
g=k[2];t=f[0];k=f[1];h=f[2];if(Math.abs(u-t)<d.EPSILON&&Math.abs(v-k)<d.EPSILON&&Math.abs(c-h)<d.EPSILON)return b.identity(a);f=u-t;k=v-k;t=c-h;x=1/Math.sqrt(f*f+k*k+t*t);f*=x;k*=x;t*=x;h=r*t-g*k;g=g*f-e*t;e=e*k-r*f;(x=Math.sqrt(h*h+g*g+e*e))?(x=1/x,h*=x,g*=x,e*=x):e=g=h=0;r=k*e-t*g;n=t*h-f*e;p=f*g-k*h;(x=Math.sqrt(r*r+n*n+p*p))?(x=1/x,r*=x,n*=x,p*=x):p=n=r=0;a[0]=h;a[1]=r;a[2]=f;a[3]=0;a[4]=g;a[5]=n;a[6]=k;a[7]=0;a[8]=e;a[9]=p;a[10]=t;a[11]=0;a[12]=-(h*u+g*v+e*c);a[13]=-(r*u+n*v+p*c);a[14]=-(f*u+
k*v+t*c);a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+
Math.pow(a[14],2)+Math.pow(a[15],2))};m.exports=b},{"./common.js":2}],7:[function(e,m,l){var d=e("./common.js"),b=e("./mat3.js"),a=e("./vec3.js");e=e("./vec4.js");var c={create:function(){var a=new d.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}};c.rotationTo=function(){var f=a.create(),b=a.fromValues(1,0,0),h=a.fromValues(0,1,0);return function(g,d,e){var n=a.dot(d,e);if(-.999999>n)return a.cross(f,b,d),1E-6>a.length(f)&&a.cross(f,h,d),a.normalize(f,f),c.setAxisAngle(g,f,Math.PI),g;if(.999999<
n)return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g;a.cross(f,d,e);g[0]=f[0];g[1]=f[1];g[2]=f[2];g[3]=1+n;return c.normalize(g,g)}}();c.setAxes=function(){var a=b.create();return function(b,h,g,d){a[0]=g[0];a[3]=g[1];a[6]=g[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=-h[0];a[5]=-h[1];a[8]=-h[2];return c.normalize(b,c.fromMat3(b,a))}}();c.clone=e.clone;c.fromValues=e.fromValues;c.copy=e.copy;c.set=e.set;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.setAxisAngle=function(a,c,b){b*=.5;var g=Math.sin(b);
a[0]=g*c[0];a[1]=g*c[1];a[2]=g*c[2];a[3]=Math.cos(b);return a};c.add=e.add;c.multiply=function(a,c,b){var g=c[0],d=c[1],e=c[2];c=c[3];var n=b[0],p=b[1],t=b[2];b=b[3];a[0]=g*b+c*n+d*t-e*p;a[1]=d*b+c*p+e*n-g*t;a[2]=e*b+c*t+g*p-d*n;a[3]=c*b-g*n-d*p-e*t;return a};c.mul=c.multiply;c.scale=e.scale;c.rotateX=function(a,c,b){b*=.5;var g=c[0],d=c[1],e=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=g*b+c*n;a[1]=d*b+e*n;a[2]=e*b-d*n;a[3]=c*b-g*n;return a};c.rotateY=function(a,c,b){b*=.5;var g=c[0],d=c[1],
e=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=g*b-e*n;a[1]=d*b+c*n;a[2]=e*b+g*n;a[3]=c*b-d*n;return a};c.rotateZ=function(a,c,b){b*=.5;var g=c[0],d=c[1],e=c[2];c=c[3];var n=Math.sin(b);b=Math.cos(b);a[0]=g*b+d*n;a[1]=d*b-g*n;a[2]=e*b+c*n;a[3]=c*b-e*n;return a};c.calculateW=function(a,c){var b=c[0],g=c[1],d=c[2];a[0]=b;a[1]=g;a[2]=d;a[3]=Math.sqrt(Math.abs(1-b*b-g*g-d*d));return a};c.dot=e.dot;c.lerp=e.lerp;c.slerp=function(a,c,b,g){var d=c[0],e=c[1],n=c[2];c=c[3];var p=b[0],t=b[1],x=b[2];b=b[3];
var u,v,w;v=d*p+e*t+n*x+c*b;0>v&&(v=-v,p=-p,t=-t,x=-x,b=-b);1E-6<1-v?(u=Math.acos(v),w=Math.sin(u),v=Math.sin((1-g)*u)/w,g=Math.sin(g*u)/w):v=1-g;a[0]=v*d+g*p;a[1]=v*e+g*t;a[2]=v*n+g*x;a[3]=v*c+g*b;return a};c.sqlerp=function(){var a=c.create(),b=c.create();return function(h,g,d,e,n,p){c.slerp(a,g,n,p);c.slerp(b,d,e,p);c.slerp(h,a,b,2*p*(1-p));return h}}();c.invert=function(a,c){var b=c[0],g=c[1],d=c[2],e=c[3],n=b*b+g*g+d*d+e*e,n=n?1/n:0;a[0]=-b*n;a[1]=-g*n;a[2]=-d*n;a[3]=e*n;return a};c.conjugate=
function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};c.length=e.length;c.len=c.length;c.squaredLength=e.squaredLength;c.sqrLen=c.squaredLength;c.normalize=e.normalize;c.fromMat3=function(a,c){var b=c[0]+c[4]+c[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(c[5]-c[7])*b,a[1]=(c[6]-c[2])*b,a[2]=(c[1]-c[3])*b;else{var g=0;c[4]>c[0]&&(g=1);c[8]>c[3*g+g]&&(g=2);var d=(g+1)%3,e=(g+2)%3,b=Math.sqrt(c[3*g+g]-c[3*d+d]-c[3*e+e]+1);a[g]=.5*b;b=.5/b;a[3]=(c[3*d+e]-c[3*e+d])*b;a[d]=(c[3*d+g]+
c[3*g+d])*b;a[e]=(c[3*e+g]+c[3*g+e])*b}return a};c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};m.exports=c},{"./common.js":2,"./mat3.js":5,"./vec3.js":9,"./vec4.js":10}],8:[function(e,m,l){var d=e("./common.js"),b={create:function(){var a=new d.ARRAY_TYPE(2);a[0]=0;a[1]=0;return a},clone:function(a){var c=new d.ARRAY_TYPE(2);c[0]=a[0];c[1]=a[1];return c},fromValues:function(a,c){var b=new d.ARRAY_TYPE(2);b[0]=a;b[1]=c;return b},copy:function(a,c){a[0]=c[0];a[1]=c[1];return a},
set:function(a,c,b){a[0]=c;a[1]=b;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];return a};b.div=b.divide;b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);
return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;return a};b.scaleAndAdd=function(a,c,b,k){a[0]=c[0]+b[0]*k;a[1]=c[1]+b[1]*k;return a};b.distance=function(a,c){var b=c[0]-a[0],k=c[1]-a[1];return Math.sqrt(b*b+k*k)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],k=c[1]-a[1];return b*b+k*k};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0];a=a[1];return c*c+a*a};b.sqrLen=b.squaredLength;
b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];return a};b.normalize=function(a,c){var b=c[0],k=c[1],b=b*b+k*k;0<b&&(b=1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]};b.cross=function(a,c,b){c=c[0]*b[1]-c[1]*b[0];a[0]=a[1]=0;a[2]=c;return a};b.lerp=function(a,c,b,k){var h=c[0];c=c[1];a[0]=h+k*(b[0]-h);a[1]=c+k*(b[1]-c);return a};b.random=function(a,c){c=c||1;var b=2*d.RANDOM()*Math.PI;a[0]=Math.cos(b)*
c;a[1]=Math.sin(b)*c;return a};b.transformMat2=function(a,c,b){var k=c[0];c=c[1];a[0]=b[0]*k+b[2]*c;a[1]=b[1]*k+b[3]*c;return a};b.transformMat2d=function(a,c,b){var k=c[0];c=c[1];a[0]=b[0]*k+b[2]*c+b[4];a[1]=b[1]*k+b[3]*c+b[5];return a};b.transformMat3=function(a,c,b){var k=c[0];c=c[1];a[0]=b[0]*k+b[3]*c+b[6];a[1]=b[1]*k+b[4]*c+b[7];return a};b.transformMat4=function(a,c,b){var k=c[0];c=c[1];a[0]=b[0]*k+b[4]*c+b[12];a[1]=b[1]*k+b[5]*c+b[13];return a};b.forEach=function(){var a=b.create();return function(c,
b,k,h,g,d){b||(b=2);k||(k=0);for(h=h?Math.min(h*b+k,c.length):c.length;k<h;k+=b)a[0]=c[k],a[1]=c[k+1],g(a,a,d),c[k]=a[0],c[k+1]=a[1];return c}}();b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};m.exports=b},{"./common.js":2}],9:[function(e,m,l){var d=e("./common.js"),b={create:function(){var a=new d.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var c=new d.ARRAY_TYPE(3);c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},fromValues:function(a,c,b){var k=new d.ARRAY_TYPE(3);k[0]=a;k[1]=c;
k[2]=b;return k},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},set:function(a,c,b,k){a[0]=c;a[1]=b;a[2]=k;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];return a};b.div=b.divide;b.min=
function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;return a};b.scaleAndAdd=function(a,c,b,k){a[0]=c[0]+b[0]*k;a[1]=c[1]+b[1]*k;a[2]=c[2]+b[2]*k;return a};b.distance=function(a,c){var b=c[0]-a[0],k=c[1]-a[1],h=c[2]-a[2];return Math.sqrt(b*b+k*k+h*h)};b.dist=b.distance;b.squaredDistance=
function(a,c){var b=c[0]-a[0],k=c[1]-a[1],h=c[2]-a[2];return b*b+k*k+h*h};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1];a=a[2];return Math.sqrt(c*c+b*b+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];return a};b.normalize=function(a,c){var b=c[0],k=c[1],h=c[2],b=b*b+k*k+h*h;0<b&&(b=
1/Math.sqrt(b),a[0]=c[0]*b,a[1]=c[1]*b,a[2]=c[2]*b);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]};b.cross=function(a,c,b){var k=c[0],h=c[1];c=c[2];var g=b[0],d=b[1];b=b[2];a[0]=h*b-c*d;a[1]=c*g-k*b;a[2]=k*d-h*g;return a};b.lerp=function(a,c,b,k){var h=c[0],g=c[1];c=c[2];a[0]=h+k*(b[0]-h);a[1]=g+k*(b[1]-g);a[2]=c+k*(b[2]-c);return a};b.hermite=function(a,c,b,k,h,g){var d=g*g,e=d*(2*g-3)+1,n=d*(g-2)+g,p=d*(g-1);g=d*(3-2*g);a[0]=c[0]*e+b[0]*n+k[0]*p+h[0]*g;a[1]=c[1]*e+b[1]*n+k[1]*
p+h[1]*g;a[2]=c[2]*e+b[2]*n+k[2]*p+h[2]*g;return a};b.bezier=function(a,c,b,k,h,g){var d=1-g,e=d*d,n=g*g,p=e*d,e=3*g*e,d=3*n*d;g*=n;a[0]=c[0]*p+b[0]*e+k[0]*d+h[0]*g;a[1]=c[1]*p+b[1]*e+k[1]*d+h[1]*g;a[2]=c[2]*p+b[2]*e+k[2]*d+h[2]*g;return a};b.random=function(a,c){c=c||1;var b=2*d.RANDOM()*Math.PI,k=2*d.RANDOM()-1,h=Math.sqrt(1-k*k)*c;a[0]=Math.cos(b)*h;a[1]=Math.sin(b)*h;a[2]=k*c;return a};b.transformMat4=function(a,c,b){var k=c[0],h=c[1];c=c[2];var g=b[3]*k+b[7]*h+b[11]*c+b[15],g=g||1;a[0]=(b[0]*
k+b[4]*h+b[8]*c+b[12])/g;a[1]=(b[1]*k+b[5]*h+b[9]*c+b[13])/g;a[2]=(b[2]*k+b[6]*h+b[10]*c+b[14])/g;return a};b.transformMat3=function(a,c,b){var k=c[0],h=c[1];c=c[2];a[0]=k*b[0]+h*b[3]+c*b[6];a[1]=k*b[1]+h*b[4]+c*b[7];a[2]=k*b[2]+h*b[5]+c*b[8];return a};b.transformQuat=function(a,c,b){var k=c[0],h=c[1],g=c[2];c=b[0];var d=b[1],e=b[2];b=b[3];var n=b*k+d*g-e*h,p=b*h+e*k-c*g,t=b*g+c*h-d*k,k=-c*k-d*h-e*g;a[0]=n*b+k*-c+p*-e-t*-d;a[1]=p*b+k*-d+t*-c-n*-e;a[2]=t*b+k*-e+n*-d-p*-c;return a};b.rotateX=function(a,
c,b,k){var h=[],g=[];h[0]=c[0]-b[0];h[1]=c[1]-b[1];h[2]=c[2]-b[2];g[0]=h[0];g[1]=h[1]*Math.cos(k)-h[2]*Math.sin(k);g[2]=h[1]*Math.sin(k)+h[2]*Math.cos(k);a[0]=g[0]+b[0];a[1]=g[1]+b[1];a[2]=g[2]+b[2];return a};b.rotateY=function(a,c,b,k){var h=[],g=[];h[0]=c[0]-b[0];h[1]=c[1]-b[1];h[2]=c[2]-b[2];g[0]=h[2]*Math.sin(k)+h[0]*Math.cos(k);g[1]=h[1];g[2]=h[2]*Math.cos(k)-h[0]*Math.sin(k);a[0]=g[0]+b[0];a[1]=g[1]+b[1];a[2]=g[2]+b[2];return a};b.rotateZ=function(a,c,b,k){var h=[],g=[];h[0]=c[0]-b[0];h[1]=
c[1]-b[1];h[2]=c[2]-b[2];g[0]=h[0]*Math.cos(k)-h[1]*Math.sin(k);g[1]=h[0]*Math.sin(k)+h[1]*Math.cos(k);g[2]=h[2];a[0]=g[0]+b[0];a[1]=g[1]+b[1];a[2]=g[2]+b[2];return a};b.forEach=function(){var a=b.create();return function(c,b,k,h,g,d){b||(b=3);k||(k=0);for(h=h?Math.min(h*b+k,c.length):c.length;k<h;k+=b)a[0]=c[k],a[1]=c[k+1],a[2]=c[k+2],g(a,a,d),c[k]=a[0],c[k+1]=a[1],c[k+2]=a[2];return c}}();b.angle=function(a,c){var f=b.fromValues(a[0],a[1],a[2]),k=b.fromValues(c[0],c[1],c[2]);b.normalize(f,f);b.normalize(k,
k);f=b.dot(f,k);return 1<f?0:Math.acos(f)};b.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};m.exports=b},{"./common.js":2}],10:[function(e,m,l){var d=e("./common.js"),b={create:function(){var a=new d.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var c=new d.ARRAY_TYPE(4);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];return c},fromValues:function(a,c,b,k){var h=new d.ARRAY_TYPE(4);h[0]=a;h[1]=c;h[2]=b;h[3]=k;return h},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];
a[3]=c[3];return a},set:function(a,c,b,k,h){a[0]=c;a[1]=b;a[2]=k;a[3]=h;return a},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2];a[3]=c[3]+b[3];return a},subtract:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];a[3]=c[3]-b[3];return a}};b.sub=b.subtract;b.multiply=function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2];a[3]=c[3]*b[3];return a};b.mul=b.multiply;b.divide=function(a,c,b){a[0]=c[0]/b[0];a[1]=c[1]/b[1];a[2]=c[2]/b[2];a[3]=c[3]/b[3];return a};b.div=b.divide;
b.min=function(a,c,b){a[0]=Math.min(c[0],b[0]);a[1]=Math.min(c[1],b[1]);a[2]=Math.min(c[2],b[2]);a[3]=Math.min(c[3],b[3]);return a};b.max=function(a,c,b){a[0]=Math.max(c[0],b[0]);a[1]=Math.max(c[1],b[1]);a[2]=Math.max(c[2],b[2]);a[3]=Math.max(c[3],b[3]);return a};b.scale=function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;a[3]=c[3]*b;return a};b.scaleAndAdd=function(a,c,b,k){a[0]=c[0]+b[0]*k;a[1]=c[1]+b[1]*k;a[2]=c[2]+b[2]*k;a[3]=c[3]+b[3]*k;return a};b.distance=function(a,c){var b=c[0]-a[0],k=c[1]-
a[1],h=c[2]-a[2],g=c[3]-a[3];return Math.sqrt(b*b+k*k+h*h+g*g)};b.dist=b.distance;b.squaredDistance=function(a,c){var b=c[0]-a[0],k=c[1]-a[1],h=c[2]-a[2],g=c[3]-a[3];return b*b+k*k+h*h+g*g};b.sqrDist=b.squaredDistance;b.length=function(a){var c=a[0],b=a[1],k=a[2];a=a[3];return Math.sqrt(c*c+b*b+k*k+a*a)};b.len=b.length;b.squaredLength=function(a){var c=a[0],b=a[1],k=a[2];a=a[3];return c*c+b*b+k*k+a*a};b.sqrLen=b.squaredLength;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};
b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var b=c[0],k=c[1],h=c[2],g=c[3],d=b*b+k*k+h*h+g*g;0<d&&(d=1/Math.sqrt(d),a[0]=b*d,a[1]=k*d,a[2]=h*d,a[3]=g*d);return a};b.dot=function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,b,k){var h=c[0],g=c[1],d=c[2];c=c[3];a[0]=h+k*(b[0]-h);a[1]=g+k*(b[1]-g);a[2]=d+k*(b[2]-d);a[3]=c+k*(b[3]-c);return a};b.random=function(a,c){c=c||1;a[0]=d.RANDOM();a[1]=d.RANDOM();a[2]=
d.RANDOM();a[3]=d.RANDOM();b.normalize(a,a);b.scale(a,a,c);return a};b.transformMat4=function(a,c,b){var k=c[0],h=c[1],g=c[2];c=c[3];a[0]=b[0]*k+b[4]*h+b[8]*g+b[12]*c;a[1]=b[1]*k+b[5]*h+b[9]*g+b[13]*c;a[2]=b[2]*k+b[6]*h+b[10]*g+b[14]*c;a[3]=b[3]*k+b[7]*h+b[11]*g+b[15]*c;return a};b.transformQuat=function(a,c,b){var k=c[0],h=c[1],g=c[2],d=b[0],e=b[1],n=b[2];b=b[3];var p=b*k+e*g-n*h,t=b*h+n*k-d*g,x=b*g+d*h-e*k,k=-d*k-e*h-n*g;a[0]=p*b+k*-d+t*-n-x*-e;a[1]=t*b+k*-e+x*-d-p*-n;a[2]=x*b+k*-n+p*-e-t*-d;a[3]=
c[3];return a};b.forEach=function(){var a=b.create();return function(c,b,k,h,d,e){b||(b=4);k||(k=0);for(h=h?Math.min(h*b+k,c.length):c.length;k<h;k+=b)a[0]=c[k],a[1]=c[k+1],a[2]=c[k+2],a[3]=c[k+3],d(a,a,e),c[k]=a[0],c[k+1]=a[1],c[k+2]=a[2],c[k+3]=a[3];return c}}();b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};m.exports=b},{"./common.js":2}],11:[function(e,m,l){function d(a,c){return r.isUndefined(c)?""+c:r.isNumber(c)&&!isFinite(c)||r.isFunction(c)||r.isRegExp(c)?c.toString():
c}function b(a,c){return r.isString(a)?a.length<c?a:a.slice(0,c):a}function a(a,c,b,f,h){throw new t.AssertionError({message:b,actual:a,expected:c,operator:f,stackStartFunction:h});}function c(c,b){c||a(c,!0,b,"==",t.ok)}function f(a,c){if(a===c)return!0;if(r.isBuffer(a)&&r.isBuffer(c)){if(a.length!=c.length)return!1;for(var b=0;b<a.length;b++)if(a[b]!==c[b])return!1;return!0}return r.isDate(a)&&r.isDate(c)?a.getTime()===c.getTime():r.isRegExp(a)&&r.isRegExp(c)?a.source===c.source&&a.global===c.global&&
a.multiline===c.multiline&&a.lastIndex===c.lastIndex&&a.ignoreCase===c.ignoreCase:r.isObject(a)||r.isObject(c)?h(a,c):a==c}function k(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function h(a,c){if(r.isNullOrUndefined(a)||r.isNullOrUndefined(c)||a.prototype!==c.prototype)return!1;if(r.isPrimitive(a)||r.isPrimitive(c))return a===c;var b=k(a),h=k(c);if(b&&!h||!b&&h)return!1;if(b)return a=n.call(a),c=n.call(c),f(a,c);var b=x(a),d=x(c);if(b.length!=d.length)return!1;b.sort();d.sort();
for(h=b.length-1;0<=h;h--)if(b[h]!=d[h])return!1;for(h=b.length-1;0<=h;h--)if(d=b[h],!f(a[d],c[d]))return!1;return!0}function g(a,c){return a&&c?"[object RegExp]"==Object.prototype.toString.call(c)?c.test(a):a instanceof c||!0===c.call({},a)?!0:!1:!1}function q(c,b,f,h){var d;r.isString(f)&&(h=f,f=null);try{b()}catch(k){d=k}h=(f&&f.name?" ("+f.name+").":".")+(h?" "+h:".");c&&!d&&a(d,f,"Missing expected exception"+h);!c&&g(d,f)&&a(d,f,"Got unwanted exception"+h);if(c&&d&&f&&!g(d,f)||!c&&d)throw d;
}var r=e("util/"),n=Array.prototype.slice,p=Object.prototype.hasOwnProperty,t=m.exports=c;t.AssertionError=function(c){this.name="AssertionError";this.actual=c.actual;this.expected=c.expected;this.operator=c.operator;c.message?(this.message=c.message,this.generatedMessage=!1):(this.message=b(JSON.stringify(this.actual,d),128)+" "+this.operator+" "+b(JSON.stringify(this.expected,d),128),this.generatedMessage=!0);var f=c.stackStartFunction||a;Error.captureStackTrace?Error.captureStackTrace(this,f):
(c=Error(),c.stack&&(c=c.stack,f=c.indexOf("\n"+f.name),0<=f&&(f=c.indexOf("\n",f+1),c=c.substring(f+1)),this.stack=c))};r.inherits(t.AssertionError,Error);t.fail=a;t.ok=c;t.equal=function(c,b,f){c!=b&&a(c,b,f,"==",t.equal)};t.notEqual=function(c,b,f){c==b&&a(c,b,f,"!=",t.notEqual)};t.deepEqual=function(c,b,h){f(c,b)||a(c,b,h,"deepEqual",t.deepEqual)};t.notDeepEqual=function(c,b,h){f(c,b)&&a(c,b,h,"notDeepEqual",t.notDeepEqual)};t.strictEqual=function(c,b,f){c!==b&&a(c,b,f,"===",t.strictEqual)};t.notStrictEqual=
function(c,b,f){c===b&&a(c,b,f,"!==",t.notStrictEqual)};t["throws"]=function(a,c,b){q.apply(this,[!0].concat(n.call(arguments)))};t.doesNotThrow=function(a,c){q.apply(this,[!1].concat(n.call(arguments)))};t.ifError=function(a){if(a)throw a;};var x=Object.keys||function(a){var c=[],b;for(b in a)p.call(a,b)&&c.push(b);return c}},{"util/":15}],12:[function(e,m,l){m.exports="function"===typeof Object.create?function(d,b){d.super_=b;d.prototype=Object.create(b.prototype,{constructor:{value:d,enumerable:!1,
writable:!0,configurable:!0}})}:function(d,b){d.super_=b;var a=function(){};a.prototype=b.prototype;d.prototype=new a;d.prototype.constructor=d}},{}],13:[function(e,m,l){function d(){k=!1;h.length?f=h.concat(f):g=-1;f.length&&b()}function b(){if(!k){var a=setTimeout(d);k=!0;for(var c=f.length;c;){h=f;for(f=[];++g<c;)h[g].run();g=-1;c=f.length}h=null;k=!1;clearTimeout(a)}}function a(a,c){this.fun=a;this.array=c}function c(){}e=m.exports={};var f=[],k=!1,h,g=-1;e.nextTick=function(c){var h=Array(arguments.length-
1);if(1<arguments.length)for(var d=1;d<arguments.length;d++)h[d-1]=arguments[d];f.push(new a(c,h));1!==f.length||k||setTimeout(b,0)};a.prototype.run=function(){this.fun.apply(null,this.array)};e.title="browser";e.browser=!0;e.env={};e.argv=[];e.version="";e.versions={};e.on=c;e.addListener=c;e.once=c;e.off=c;e.removeListener=c;e.removeAllListeners=c;e.emit=c;e.binding=function(a){throw Error("process.binding is not supported");};e.cwd=function(){return"/"};e.chdir=function(a){throw Error("process.chdir is not supported");
};e.umask=function(){return 0}},{}],14:[function(e,m,l){m.exports=function(d){return d&&"object"===typeof d&&"function"===typeof d.copy&&"function"===typeof d.fill&&"function"===typeof d.readUInt8}},{}],15:[function(e,m,l){(function(d,b){function a(a,b){var d={seen:[],stylize:f};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);x(b)?d.showHidden=b:b&&l._extend(d,b);w(d.showHidden)&&(d.showHidden=!1);w(d.depth)&&(d.depth=2);w(d.colors)&&(d.colors=!1);w(d.customInspect)&&
(d.customInspect=!0);d.colors&&(d.stylize=c);return h(d,a,d.depth)}function c(c,b){var f=a.styles[b];return f?"\u001b["+a.colors[f][0]+"m"+c+"\u001b["+a.colors[f][1]+"m":c}function f(a,c){return a}function k(a){var c={};a.forEach(function(a,b){c[a]=!0});return c}function h(a,c,b){if(a.customInspect&&c&&A(c.inspect)&&c.inspect!==l.inspect&&(!c.constructor||c.constructor.prototype!==c)){var f=c.inspect(b,a);v(f)||(f=h(a,f,b));return f}if(f=g(a,c))return f;var d=Object.keys(c),e=k(d);a.showHidden&&(d=
Object.getOwnPropertyNames(c));if(C(c)&&(0<=d.indexOf("message")||0<=d.indexOf("description")))return q(c);if(0===d.length){if(A(c))return a.stylize("[Function"+(c.name?": "+c.name:"")+"]","special");if(z(c))return a.stylize(RegExp.prototype.toString.call(c),"regexp");if(m(c))return a.stylize(Date.prototype.toString.call(c),"date");if(C(c))return q(c)}var f="",u=!1,w=["{","}"];t(c)&&(u=!0,w=["[","]"]);A(c)&&(f=" [Function"+(c.name?": "+c.name:"")+"]");z(c)&&(f=" "+RegExp.prototype.toString.call(c));
m(c)&&(f=" "+Date.prototype.toUTCString.call(c));C(c)&&(f=" "+q(c));if(0===d.length&&(!u||0==c.length))return w[0]+f+w[1];if(0>b)return z(c)?a.stylize(RegExp.prototype.toString.call(c),"regexp"):a.stylize("[Object]","special");a.seen.push(c);d=u?r(a,c,b,e,d):d.map(function(f){return n(a,c,b,e,f,u)});a.seen.pop();return p(d,f,w)}function g(a,c){if(w(c))return a.stylize("undefined","undefined");if(v(c)){var b="'"+JSON.stringify(c).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(b,
"string")}if(u(c))return a.stylize(""+c,"number");if(x(c))return a.stylize(""+c,"boolean");if(null===c)return a.stylize("null","null")}function q(a){return"["+Error.prototype.toString.call(a)+"]"}function r(a,c,b,f,d){for(var h=[],k=0,g=c.length;k<g;++k)Object.prototype.hasOwnProperty.call(c,String(k))?h.push(n(a,c,b,f,String(k),!0)):h.push("");d.forEach(function(d){d.match(/^\d+$/)||h.push(n(a,c,b,f,d,!0))});return h}function n(a,c,b,f,d,k){var g,e;c=Object.getOwnPropertyDescriptor(c,d)||{value:c[d]};
c.get?e=c.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):c.set&&(e=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(f,d)||(g="["+d+"]");e||(0>a.seen.indexOf(c.value)?(e=null===b?h(a,c.value,null):h(a,c.value,b-1),-1<e.indexOf("\n")&&(e=k?e.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+e.split("\n").map(function(a){return"   "+a}).join("\n"))):e=a.stylize("[Circular]","special"));if(w(g)){if(k&&d.match(/^\d+$/))return e;g=JSON.stringify(""+
d);g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+e}function p(a,c,b){var f=0;return 60<a.reduce(function(a,c){f++;0<=c.indexOf("\n")&&f++;return a+c.replace(/\u001b\[\d\d?m/g,"").length+1},0)?b[0]+(""===c?"":c+"\n ")+" "+a.join(",\n  ")+" "+b[1]:b[0]+c+" "+a.join(", ")+" "+b[1]}function t(a){return Array.isArray(a)}function x(a){return"boolean"===typeof a}
function u(a){return"number"===typeof a}function v(a){return"string"===typeof a}function w(a){return void 0===a}function z(a){return y(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function y(a){return"object"===typeof a&&null!==a}function m(a){return y(a)&&"[object Date]"===Object.prototype.toString.call(a)}function C(a){return y(a)&&("[object Error]"===Object.prototype.toString.call(a)||a instanceof Error)}function A(a){return"function"===typeof a}function B(a){return 10>a?"0"+a.toString(10):
a.toString(10)}function D(){var a=new Date,c=[B(a.getHours()),B(a.getMinutes()),B(a.getSeconds())].join(":");return[a.getDate(),I[a.getMonth()],c].join(" ")}var H=/%[sdj%]/g;l.format=function(c){if(!v(c)){for(var b=[],f=0;f<arguments.length;f++)b.push(a(arguments[f]));return b.join(" ")}for(var f=1,d=arguments,h=d.length,b=String(c).replace(H,function(a){if("%%"===a)return"%";if(f>=h)return a;switch(a){case "%s":return String(d[f++]);case "%d":return Number(d[f++]);case "%j":try{return JSON.stringify(d[f++])}catch(c){return"[Circular]"}default:return a}}),
g=d[f];f<h;g=d[++f])b=null!==g&&y(g)?b+(" "+a(g)):b+(" "+g);return b};l.deprecate=function(a,c){if(w(b.process))return function(){return l.deprecate(a,c).apply(this,arguments)};if(!0===d.noDeprecation)return a;var f=!1;return function(){if(!f){if(d.throwDeprecation)throw Error(c);d.traceDeprecation?console.trace(c):console.error(c);f=!0}return a.apply(this,arguments)}};var F={},G;l.debuglog=function(a){w(G)&&(G=d.env.NODE_DEBUG||"");a=a.toUpperCase();if(!F[a])if((new RegExp("\\b"+a+"\\b","i")).test(G)){var c=
d.pid;F[a]=function(){var b=l.format.apply(l,arguments);console.error("%s %d: %s",a,c,b)}}else F[a]=function(){};return F[a]};l.inspect=a;a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};a.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};l.isArray=t;l.isBoolean=x;l.isNull=
function(a){return null===a};l.isNullOrUndefined=function(a){return null==a};l.isNumber=u;l.isString=v;l.isSymbol=function(a){return"symbol"===typeof a};l.isUndefined=w;l.isRegExp=z;l.isObject=y;l.isDate=m;l.isError=C;l.isFunction=A;l.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===typeof a||"symbol"===typeof a||"undefined"===typeof a};l.isBuffer=e("./support/isBuffer");var I="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");l.log=function(){console.log("%s - %s",
D(),l.format.apply(l,arguments))};l.inherits=e("inherits");l._extend=function(a,c){if(!c||!y(c))return a;for(var b=Object.keys(c),f=b.length;f--;)a[b[f]]=c[b[f]];return a}}).call(this,e("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":14,_process:13,inherits:12}],16:[function(e,m,l){m.exports=e("./lib/")},{"./lib/":17}],17:[function(e,m,l){m.exports=function(){function d(a,b){if(null==a)throw new TypeError("Array.prototype.find called on null or undefined");
if("function"!==typeof b)throw new TypeError("predicate must be a function");for(var d=Object(a),h=d.length>>>0,g,e=0;e<h;e++)if(g=d[e],b.call(null,g,e,d))return g}var b=e("performance-now"),a=function(a){a=a||{};this._units=[];for(var b=0;b<(a.units||8);b++)this._units[b]={slot:b,use:0}};a.NOT_FOUND=-1;a.FULL=-2;a.prototype={_set:function(a,b){var d=this._units[a];d.dispose&&d.dispose(d,this);b?(this._units[a]=b,this._units[a].slot=a):this._units[a]={slot:a,use:0}},bind:function(c,f){f=f||{};var d=
!!f.fixed,h="function"==typeof f.dispose?f.dispose:null,g=this.get(c);if(g!==a.NOT_FOUND)return g;g=this._units.filter(function(a){return!a.fixed});if(!g.length)return a.FULL;g=g.reduce(function(a,c){return a?c.use<a.use?c:a:c},null).slot;this._set(g,{fixed:d,use:b(),id:c,dispose:h});return g},dispose:function(a){a=this.getEntry(a);this._set(a.slot,null)},has:function(a){return!!this.getEntry(a)},get:function(c){return(c=this.getEntry(c))?(c.use=b(),c.slot):a.NOT_FOUND},use:function(a){if(a=this.getEntry(a))a.use=
b()},getEntry:function(a){return d(this._units,function(b){return b.id===a})}};return{SimpleTextureManager:a}}()},{"performance-now":18}],18:[function(e,m,l){(function(d){(function(){var b,a,c;"undefined"!==typeof performance&&null!==performance&&performance.now?m.exports=function(){return performance.now()}:"undefined"!==typeof d&&null!==d&&d.hrtime?(m.exports=function(){return(b()-c)/1E6},a=d.hrtime,b=function(){var c;c=a();return 1E9*c[0]+c[1]},c=b()):Date.now?(m.exports=function(){return Date.now()-
c},c=Date.now()):(m.exports=function(){return(new Date).getTime()-c},c=(new Date).getTime())}).call(this)}).call(this,e("_process"))},{_process:13}],19:[function(e,m,l){function d(a,c){this.message=a;this.node=c}function b(a){a.srcAsset&&b(a.srcAsset);for(var c=[],f=0;f<a.children.length;++f){var h=a.children[f],g=h.name;if(g&&-1!=c.indexOf(g))throw new d("Two subdata elements with the same name: '"+g+"'",h.refNode);g&&c.push(g)}for(f=0;f<a.subAssets.length;++f)b(a.subAssets[f])}function a(c){c.assetResult&&
(c.assetResult=null);for(var b=c.listener,f=0;f<b.length;++f)b[f].onAssetChange&&b[f].onAssetChange(this);for(f=c.parents.length;f--;)a(c.parents[f])}function c(a){var b=a.loading?a.loadLevel:Infinity;b&&a.srcAsset&&(b=Math.min(b,Math.max(a.srcAsset.loadLevel,a.srcAsset.progressLevel)));for(var f=a.subAssets.length;b&&f--;)b=Math.min(b,Math.max(a.subAssets[f].loadLevel,a.subAssets[f].progressLevel));for(f=a.children.length;b&&f--;)b=Math.min(b,a.children[f].progressLevel);f=a.progressLevel;a.progressLevel=
b;if(f!=a.progressLevel)for(a._callLoadListeners(a.progressLevel,f),f=0;f<a.parents.length;++f)c(a.parents[f])}function f(c){c.assetParent&&a(c.assetParent)}function k(a,c){for(var b=0;b<c.length;++b)h(a,c[b])}function h(a,c){var b=c.subdata;b.isMesh()==a.isMesh()&&c.filter.check(a)&&a.pushPostEntry(b)}function g(a,c,b){if(0<c.matchEntries.length)for(var f=a.allEntries.length;f--;){var d=a.allEntries[f];d.name&&c.namedEntries[d.name]||k(d,c.matchEntries)}for(f=c.allEntries.length;f--;){var d=c.allEntries[f],
h,g=!1;d.name&&a.namedEntries[d.name]?h=a.namedEntries[d.name]:(h=new p,g=!0,a.allEntries.push(h));h.pushTableEntry(d);g&&k(h,a.matchEntries);h.name&&(a.namedEntries[h.name]=h)}a.matchEntries.push.apply(a.matchEntries,c.matchEntries);for(f=c.allSubResults.length;f--;)q(a,c.allSubResults[f]);b&&c.pickFilter?(a.pickFilter=new t,a.pickFilter.intersection(b,c.pickFilter)):a.pickFilter=b||c.pickFilter;c.shader&&(a.shader=c.shader);c.transform&&(a.transform=c.transform)}function q(a,c){var b;c.name&&a.namedSubResults[c.name]?
b=a.namedSubResults[c.name]:(b=new v,b.parentResult=a,b.name=c.name,a.allSubResults.push(b),b.name&&(a.namedSubResults[b.name]=b));g(b,c,b.pickFilter)}function r(a){for(var c={meshes:[],groups:[],transform:a.transform,shader:a.shader,postTransformXflowNode:null},b=0;b<a.allEntries.length;++b){var f=a.allEntries[b];!f.meshType||a.pickFilter&&!a.pickFilter.check(f)||(n(a,f),c.meshes.push({xflowNode:f.accumulatedXflowNode,type:f.meshType,shader:f.shader,transform:f.transform,refNode:f.refNode}))}if(b=
a.namedEntries._postTransform)n(a,b),c.postTransformXflowNode=b.accumulatedXflowNode;for(b=0;b<a.allSubResults.length;++b)f=r(a.allSubResults[b]),c.groups.push(f);return c}function n(a,c){if(c.outOfSync){c.accumulatedXflowNode?(c.accumulatedXflowNode.clearChildren(),c.accumulatedXflowNode.setCompute(""),c.accumulatedXflowNode.setFilter(""),c.accumulatedXflowNode.dataflowNode=null,c.accumulatedXflowNode.setLoading(!1)):c.accumulatedXflowNode=new u(!1);for(var b=1==c.postQueue.length?c.accumulatedXflowNode:
new u(!1),f=0;f<c.postQueue.length;++f){for(var d=c.postQueue[f].includes,h=0;h<d.length;++h){for(var g=a,k=d[h],e=k.split("."),q=0;q<e.length-1;++q){var r=e[q];if("parent"==r){if(!g.parentResult)throw Error("Includes entry '"+k+"' (token "+q+") accesses non existent parent.");g=g.parentResult}else{if(!g.namedSubResults[r])throw Error("Includes entry '"+k+"' (token "+q+") accesses non existent sub result '"+r+"'");g=g.namedSubResults[r]}}e=e[e.length-1];q=g.namedEntries[e];if(!q)throw Error("Includes entry '"+
k+"' accesses non existent asset entry '"+e+"'");z.push(k);if(-1!=w.indexOf(q))throw f=z.join(" > "),Error("Recursive include dependencies detected: "+f);w.push(q);n(g,q);w.pop();z.pop();b.appendChild(q.accumulatedXflowNode)}c.postQueue[f].xflowNode&&b.appendChild(c.postQueue[f].xflowNode)}d=null;for(f=0;f<c.postQueue.length;++f)h=c.postQueue[f],b||(b=f==c.postQueue.length-1?c.accumulatedXflowNode:new u(!1)),b.setCompute(h.compute),b.setFilter(h.filter),b.dataflowNode=h.dataflow,b.setLoading(h.dataflowLoading),
d&&b.appendChild(d),d=b,b=null;c.outOfSync=!1}}function p(a){this.name=null;this.classNames=[];this.meshType=null;this.postQueue=[];this.accumulatedXflowNode=this.transform=this.shader=null;this.outOfSync=!0;this.refNode=null;a&&(this.name=a.name,x.add(this.classNames,a.classNames))}function t(){this.all=!1;this.names=[];this.classNames=[]}var x=e("../xflow/utils/utils.js").set,u=e("../xflow/interface/graph.js").DataNode;e=function(a){this.srcAsset=this.name=null;this.children=[];this.subAssets=[];
this.pickFilter=null;this.parents=[];this.listener=[];this.loading=!1;this.refNode=a||null;this.assetResult=this.transform=this.shader=null;this.loadLevel=0;this.progressLevel=Infinity};e.prototype.checkValidity=function(){this.isSubtreeLoading()||b(this)};e.prototype.setLoading=function(b){b!=this.loading&&(this.loading=b,c(this),a(this))};e.prototype.isSubtreeLoading=function(){return 0==this.progressLevel};e.prototype.getProgressLevel=function(){return this.progressLevel};e.prototype.setName=function(c){this.name=
c;a(this)};e.prototype.setShader=function(c){this.shader=c;a(this)};e.prototype.setTransform=function(c){this.transform=c;"model"!==this.refNode.localName.toLowerCase()&&a(this)};e.prototype.appendChild=function(b){this.children.push(b);b.assetParent=this;c(this);a(this)};e.prototype.setPickFilter=function(c){"string"==typeof c?(this.pickFilter=new t,this.pickFilter.parse(c)):this.pickFilter=null;a(this)};e.prototype.appendSubAsset=function(b){b._addParent(this);this.subAssets.push(b);c(this);a(this)};
e.prototype.setSrcAsset=function(b){this.srcAsset&&this.srcAsset._removeParent(this);(this.srcAsset=b)&&this.srcAsset._addParent(this);c(this);a(this)};e.prototype.clearChildren=function(){for(var b=this.children.length;b--;)this.children[b].assetParent=null;this.children=[];c(this);a(this)};e.prototype.clearSubAssets=function(){for(var b=this.subAssets.length;b--;)this.subAssets[b]._removeParent(this);this.subAssets.length=0;c(this);a(this)};e.prototype._addParent=function(a){this.parents.push(a)};
e.prototype._removeParent=function(a){a=this.parents.indexOf(a);-1!=a&&this.parents.splice(a,1)};e.prototype._callLoadListeners=function(a,c){for(var b=this.listener,f=0;f<b.length;++f)b[f].onAssetLoadChange&&b[f].onAssetLoadChange(this,a,c)};e.prototype.addChangeListener=function(a){x.add(this.listener,a)};e.prototype.removeChangeListener=function(a){x.remove(this.listener,a)};e.prototype.getResult=function(){this.assetResult||(this.assetResult=new v,this.assetResult.construct(this));return this.assetResult};
l=function(a,c,b){this.xflowNodeOut=a;this.xflowNodeIn=c;this.refNode=b||null;this.matchFilter=this.name=null;this.classNames=[];this.postFilter=this.postCompute=this.postDataflow=null;this.includes=[];this.assetParent=this.meshType=this.transform=this.shader=null;this.loading=!1;this.loadLevel=0;this.progressLevel=Infinity;c.addLoadListener(this.onXflowLoadEvent.bind(this));this._updateLoadingState()};l.prototype.setLoading=function(a){a!=this.loading&&(this.loading=a,this._updateLoadingState(),
f(this))};l.prototype._updateLoadingState=function(){var a=this.loading?this.loadLevel:Infinity,a=Math.min(a,this.xflowNodeIn.getProgressLevel()),b=this.progressLevel;this.progressLevel=a;b!=this.progressLevel&&(this.assetParent&&c(this.assetParent),f(this))};l.prototype.onXflowLoadEvent=function(){this._updateLoadingState()};l.prototype.isSubtreeLoading=function(){return this.loading};l.prototype.isMesh=function(){return!!this.meshType};l.prototype.setName=function(a){this.name=a;f(this)};l.prototype.setMatchFilter=
function(a){"string"==typeof a?(this.matchFilter=new t,this.matchFilter.parse(a)):this.matchFilter=null;f(this)};l.prototype.setClassNames=function(a){this.classNames=a;f(this)};l.prototype.setClassNamesString=function(a){if(a){a=a.split(/\s+/);for(var c=a.length;c--;)a[c]=a[c].trim();this.setClassNames(a)}else this.setClassNames([])};l.prototype.setPostDataflow=function(a){this.postDataflow=a;f(this)};l.prototype.setPostCompute=function(a){this.postCompute=a;f(this)};l.prototype.setPostFilter=function(a){this.postFilter=
a;f(this)};l.prototype.setIncludes=function(a){this.includes=a;f(this)};l.prototype.setShader=function(a){this.shader=a;f(this)};l.prototype.setTransform=function(a){this.transform=a;f(this)};l.prototype.setMeshType=function(a){this.meshType=a;f(this)};var v=function(){this.name=this.parentResult=null;this.namedEntries={};this.allEntries=[];this.matchEntries=[];this.namedSubResults={};this.allSubResults=[];this.pickFilter=this.transform=this.shader=null};v.prototype.construct=function(a){this.name=
a.name;var c=a.srcAsset;c&&c.getResult()?g(this,c.getResult(),a.pickFilter):this.pickFilter=a.pickFilter;a.shader&&(this.shader=a.shader);a.transform&&(this.transform=a.transform);for(var b=a.subAssets,c=b.length;c--;){var f=b[c].getResult();q(this,f)}b=[];a=a.children;for(c=0;c<a.length;++c){var f=a[c],d=f.name,e;f.name&&f.matchFilter&&XML3D.debug.logWarning("Asset entry defines both name and match attribute. Match attribute will be ignored",f.refNode);if(d)this.namedEntries[d]?e=this.namedEntries[d]:
(e=new p(f),k(e,this.matchEntries),this.namedEntries[d]=e,this.allEntries.push(e));else if(f.matchFilter){b.push(f);continue}else e=new p(f),k(e,this.matchEntries),this.allEntries.push(e);e.pushPostEntry(f)}for(c=0;c<b.length;++c)for(f=b[c],a={filter:f.matchFilter,subdata:f},this.matchEntries.push(a),f=0;f<this.allEntries.length;++f)h(this.allEntries[f],a)};v.prototype.getDataTree=function(){return r(this)};var w=[],z=[];p.prototype.isMesh=function(){return!!this.meshType};p.prototype.pushTableEntry=
function(a){this.name=a.name;x.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);a.transform&&(this.transform=a.transform);a.shader&&(this.shader=a.shader);this.postQueue.push.apply(this.postQueue,a.postQueue)};p.prototype.pushPostEntry=function(a){this.name=a.name;this.postQueue.push({dataflow:a.postDataflow,dataflowLoading:a.loading,compute:a.postCompute,filter:a.postFilter,includes:a.includes,xflowNode:a.xflowNodeIn});this.refNode=a.refNode;this.accumulatedXflowNode=a.xflowNodeOut;
x.add(this.classNames,a.classNames);a.meshType&&(this.meshType=a.meshType);a.shader&&(this.shader=a.shader);a.transform&&(this.transform=a.transform)};t.prototype.parse=function(a){a=a.split(",");for(var c=a.length;c--;){var b=a[c].trim();if("*"==b)this.all=!0;else if(0==b.indexOf(".")){for(var b=b.split("."),f=b.length;f--;)b[f].trim()||b.splice(f,1);this.classNames.push(b)}else x.add(this.names,b)}};t.prototype.intersection=function(a,c){x.intersection(this.names,a.names,c.names);x.intersection(this.classNames,
a.classNames,c.classNames)};t.prototype.check=function(a){if(this.all)return!0;if(0<a.classNames.length)for(var c=this.classNames.length;c--;)if(x.isSubset(this.classNames[c],a.classNames))return!0;return a.name&&-1!=this.names.indexOf(a.name)};m.exports={Asset:e,SubData:l,AssetResult:v}},{"../xflow/interface/graph.js":151,"../xflow/utils/utils.js":200}],20:[function(e,m,l){function d(a){for(var b in this.connectedAdapterHandles)if(this.connectedAdapterHandles[b]==a.adapterHandle){var f=new c.ConnectedAdapterNotification(a,
b);this.notifyChanged(f)}}var b=e("./resourcemanager.js").registerFactory,a=e("./resourcemanager.js").Resource,c=e("../interface/notification.js"),f=e("../interface/elements.js").config;l=function(a){this.factory=a};l.prototype.connectAdapterHandle=function(a,c){this.connectedAdapterHandles||(this.connectedAdapterHandles={},this._bindedAdapterHandleCallback=d.bind(this));this.disconnectAdapterHandle(a);c?(this.connectedAdapterHandles[a]=c,this.connectedAdapterHandles[a].addListener(this._bindedAdapterHandleCallback)):
delete this.connectedAdapterHandles[a]};l.prototype.disconnectAdapterHandle=function(a){this.connectedAdapterHandles&&this.connectedAdapterHandles[a]&&(this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback),delete this.connectedAdapterHandles[a])};l.prototype.clearAdapterHandles=function(){for(var a in this.connectedAdapterHandles)this.connectedAdapterHandles[a].removeListener(this._bindedAdapterHandleCallback);this.connectedAdapterHandles=null};l.prototype.getConnectedAdapterHandle=
function(a){return this.connectedAdapterHandles&&this.connectedAdapterHandles[a]};l.prototype.getConnectedAdapter=function(a){return(a=this.getConnectedAdapterHandle(a))&&a.getAdapter()};l.prototype.onDispose=function(){};e=function(a,c){this.factory=a;this.node=c};XML3D.createClass(e,l);e.prototype.init=function(){};e.prototype.notifyChanged=function(a){};e.prototype.getAdapterHandle=function(c,b,f){f=void 0===f?this.factory.canvasId:f;return a.getAdapterHandle(this.node.ownerDocument._documentURL||
this.node.ownerDocument.URL,c,b||this.factory.aspect,f)};e.prototype.notifyOppositeAdapters=function(b){b=b||c.ADAPTER_HANDLE_CHANGED;return a.notifyNodeAdapterChange(this.node,this.factory.aspect,this.factory.canvasId,b)};e.prototype.traverse=function(a){a(this);for(var c=this.node.firstElementChild;c;){var b=this.factory.getAdapter(c);b&&b.traverse(a);c=c.nextElementSibling}};var k=function(a,c,f){this.aspect=a;this.canvasId=f||0;this.mimetypes="string"==typeof c?[c]:c;b(this)};k.prototype.createAdapter=
function(a){return null};k.prototype.supportsMimetype=function(a){return-1!=this.mimetypes.indexOf(a)};l=function(a,c){k.call(this,a,["text/xml","application/xml"],c)};XML3D.createClass(l,k);l.prototype.getAdapter=function(a){a&&void 0===a._configured&&f.element(a);if(!a||void 0===a._configured)return null;var c=a._configured,b=this.aspect+"_"+this.canvasId,d=c.adapters[b];if(void 0!==d)return d;if(d=this.createAdapter(a))c.adapters[b]=d,d.init();return d};XML3D.resource.AdapterFactory=k;m.exports=
{NodeAdapter:e,AdapterFactory:k,NodeAdapterFactory:l}},{"../interface/elements.js":47,"../interface/notification.js":49,"./resourcemanager.js":23}],21:[function(e,m,l){var d=e("../interface/notification.js");"use strict";e=function(b){this.url=b;this.adapter=null;this.listeners=[];this.status=0};e.STATUS={LOADING:0,NOT_FOUND:1,READY:2};e.prototype.hasAdapter=function(){return null!=this.adapter};e.prototype.getAdapter=function(){return this.adapter};e.prototype.setAdapter=function(b,a){this.adapter=
b;this.status=a;this.notifyListeners(d.ADAPTER_HANDLE_CHANGED)};e.prototype.notifyListeners=function(b){b=new d.AdapterHandleNotification(this,b);for(var a=this.listeners.length;a--;)this.listeners[a](b)};e.prototype.addListener=function(b){-1==this.listeners.indexOf(b)&&this.listeners.push(b)};e.prototype.removeListener=function(b){b=this.listeners.indexOf(b);-1!=b&&this.listeners.splice(b,1)};m.exports=e},{"../interface/notification.js":49}],22:[function(e,m,l){var d=e("./adapter.js").AdapterFactory;
l=e("./resourcemanager.js").registerFormat;var b=e("../interface/elements.js").config,a=function(){this.factoryClasses={};this.factoryCache={}};a.prototype.registerFactoryClass=function(a){if(!a.prototype.aspect||!XML3D.isSuperclassOf(d,a))throw Error("factoryClass must be a subclass of XML3D.base.AdapterFactory");this.factoryClasses[a.prototype.aspect]=a};a.prototype.getFactoryClassByAspect=function(a){return this.factoryClasses[a]};a.prototype.getFactory=function(a,c){c=c||0;var b=a+"_"+c,f=this.factoryCache[b];
if(!f){f=this.getFactoryClassByAspect(a);if(!f)return null;f=new f(c);this.factoryCache[b]=f}return f};a.prototype.isFormatSupported=function(a,c,b){return!1};a.prototype.getFormatData=function(a,c,b,f){f(!0,a)};a.prototype.getFragmentData=function(a,c){return c?null:a};e=function(){a.call(this)};XML3D.createClass(e,a);e.prototype.isFormatSupported=function(a,c,b){return a&&9===a.nodeType&&b.match(/xml/)};e.prototype.getFormatData=function(a,c,b,f){f(!0,a)};e.prototype.getFragmentData=function(a,
c){return a.querySelectorAll("*[id='"+c+"']")[0]};var c=function(){a.call(this)};XML3D.createClass(c,e);c.prototype.isFormatSupported=function(a,c,b){c=[];a instanceof XMLDocument&&(c=a.getElementsByTagName("xml3d"),c.length||(c=a.getElementsByTagNameNS(XML3D.xml3dNS,"xml3d")));return 0!==c.length};c.prototype.getFormatData=function(a,c,f,d){c=a.querySelectorAll("xml3d");for(f=0;f<c.length;++f)b.element(c[f]);d(!0,a)};var f=function(){a.call(this)};XML3D.createClass(f,a);f.prototype.isFormatSupported=
function(a,c,b){return"application/json"===b};var k=new c;l(k);XML3D.xml3dFormatHandler=k;XML3D.resource.FormatHandler=a;XML3D.resource.JSONFormatHandler=f;m.exports={JSONFormatHandler:f,XMLFormatHandler:e,XML3DFormatHandler:c,FormatHandler:a,xml3dFormatHandler:k}},{"../interface/elements.js":47,"./adapter.js":20,"./resourcemanager.js":23}],23:[function(e,m,l){function d(a){var c=E[a];c||(c={counter:0,listeners:[]},E[a]=c);return c}function b(a){a=a.listeners;for(var c=a.length;c--;)a[c](this)}function a(a){if(a=
E[a])XML3D.debug.assert(0<a.counter,"counter must be > 0"),a.counter--,0==a.counter&&b(a)}function c(a){for(var c in A)if(a==A[c])return!0;return!1}function f(a){for(var c in B){var b=B[c];if(-1!==a.indexOf(b,a.length-b.length))return!0}return!1}function k(a){var b=null;try{b=new XMLHttpRequest}catch(d){b=null}b&&(b._url=a,b._contentChecked=!1,b.open("GET",a,!0),f(a)&&(b.responseType="arraybuffer"),b.onreadystatechange=function(){if(!b._aborted){if(!b._contentChecked&&(2==b.readyState||3==b.readyState||
4==b.readyState)&&200==b.status){b._contentChecked=!0;var a=b.getResponseHeader("content-type");if(a&&(a=c(a),a!=("arraybuffer"==b.responseType))){b._aborted=!0;var f=b.onreadystatechange;b.onreadystatechange=null;var d=b._url;b.abort();b=new XMLHttpRequest;b._url=d;b._contentChecked=!0;b.open("GET",d,!0);a&&(b.responseType="arraybuffer");b.onreadystatechange=f;b.send(null);return}}4==b.readyState&&(200==b.status?(XML3D.debug.logDebug("Loaded: "+b._url),XML3D.xmlHttpCallback&&XML3D.xmlHttpCallback(b),
a=b,(f=a.getResponseHeader("content-type"))?h(a,a._url,f):(XML3D.debug.logError("Could not load external document because the server did not provide a content-type header: "+a._url),g(a._url))):(XML3D.debug.logError("Could not load external document '"+b._url+"': "+b.status+" - "+b.statusText),g(b._url)))}},b.send(null))}function h(a,c,b){var f=w[c],d=f.mimetype=b;0<b.indexOf(";")&&(d=b.substr(0,b.indexOf(";")));var k=null;if("arraybuffer"==a.responseType)k=a.response;else if("application/json"==
d)k=JSON.parse(a.responseText);else if(d.match(/xml/)){if(k=a.responseXML,k._documentURL=c,!k){XML3D.debug.logError("Invalid external XML document '"+a._url+"': XML Syntax error");return}}else"application/octet-stream"==d||"text/plain; charset=x-user-defined"==b?XML3D.debug.logError("Possibly wrong loading of resource "+c+". Mimetype is "+b+" but response is not an ArrayBuffer"):"application/javascript"!=d&&"text/javascript"!=b&&XML3D.debug.logError("Unidentified response type (response = '"+a.response+
"', responseType = '"+a.responseType+"')"),k=a.response;(b=D(k,a.responseType,d))?(f.format=b,b.getFormatData(k,a.responseType,d,function(a,b){if(a){f.response=b;var d=w[c],k=d.fragments;d.fragments=[];for(d=0;d<k.length;++d)q(c,k[d])}else g(c)})):(XML3D.debug.logError("No format handler for resource (response = '"+k+"', responseType = '"+a.responseType+"')"),g(c))}function g(a){var c=w[a],b=c.fragments;c.fragments=[];for(c=0;c<b.length;++c)n(a+(b[c]?"#"+b[c]:""))}function q(a,c){var b=w[a].response,
f=w[a].format,d=a+(c?"#"+c:"");b?(b=f.getFragmentData(b,c))?r(d,f,b):n(d):n(d)}function r(c,b,f,d){for(var k in y[c])for(var h in y[c][k]){var g=y[c][k][h];g.hasAdapter()||(p(g,k,+h,b,f),d||a(h))}}function n(c){for(var b in y[c])for(var f in y[c][b])y[c][b][f].setAdapter(null,t.STATUS.NOT_FOUND),a(f)}function p(a,c,b,f,d){(b=f.getFactory(c,b))?(c=b.getAdapter?b.getAdapter(d):b.createAdapter(d))&&a.setAdapter(c,t.STATUS.READY):XML3D.debug.logError("Format does not support adapterType "+c)}var t=e("./adapterhandle.js"),
x=e("../utils/uri.js").URIResolver,u=e("../utils/uri.js").URI,v=e("../utils/options.js");v.register("resource-crossorigin-attribute","anonymous");var w={},z={},y={},E={},C=[],A=["application/octet-stream","text/plain; charset=x-user-defined"],B=[".bin",".bson"],D=function(a,c,b){for(var f=0;f<C.length;++f){var d=C[f];if(C[f].isFormatSupported(a,c,b))return d}return null},H={isLoadComplete:function(a){a=E[a];return!a||0==a.counter},addLoadCompleteListener:function(a,c){var b=d(a);-1==b.listeners.indexOf(c)&&
b.listeners.push(c)},removeLoadCompleteListener:function(a,c){var b=E[a];if(b){var f=b.listeners.indexOf(c);-1!=f&&b.listeners.splice(f,1)}},addBinaryContentType:function(a){-1==A.indexOf(a)&&A.push(a)},removeBinaryContentType:function(a){a=A.indexOf(a);-1!=a&&A.splice(a,1)},addBinaryExtension:function(a){-1==B.indexOf(a)&&B.push(a)},removeBinaryExtension:function(a){a=B.indexOf(a);-1!=a&&B.splice(a,1)},getAbsoluteURI:function(a,c){if(!c)return null;"string"==typeof c&&(c=new u(c));a==document.URL&&
c.isLocal()||(c=c.getAbsoluteURI(a));return c},getAdapterHandle:function(a,c,b,f){f=f||0;c=H.getAbsoluteURI(a,c);if(!c)return null;y[c]||(y[c]={});y[c][b]||(y[c][b]={});if(a=y[c][b][f])return a;a=new t(c);y[c][b][f]=a;c.isLocal()?(c=x.resolveLocal(c))?p(a,b,f,XML3D.xml3dFormatHandler,c):a.setAdapter(null,t.STATUS.NOT_FOUND):(d(f).counter++,b=c.toStringWithoutFragment(),(f=w[b])&&f.response?q(b,c.fragment):(f||(k(b),w[b]=f={fragments:[]}),f.fragments.push(c.fragment)));return a},getAdapter:function(a,
c,b){return(c=XML3D.xml3dFormatHandler.getFactory(c,b))?c.getAdapter(a):null},notifyNodeIdChange:function(a,c,b){for(var f=a;f.parentNode;)f=f.parentNode;if(f==window.document){if(c){c="#"+c;for(var d in y[c])for(var k in y[c][d])f=y[c][d][k],f.hasAdapter()&&f.setAdapter(null,t.STATUS.NOT_FOUND)}b&&r("#"+b,XML3D.xml3dFormatHandler,a,!0)}},notifyNodeAdapterChange:function(a,c,b,f){b=b||0;a="#"+a.id;y[a]&&y[a][c]&&y[a][c][b]&&y[a][c][b].notifyListeners(f)},loadData:function(a,b,d){var k=null;try{k=
new XMLHttpRequest}catch(h){k=null}k&&(k._url=a,k._contentChecked=!1,k.open("GET",a,!0),f(a)&&(k.responseType="arraybuffer"),k.onreadystatechange=function(){if(!k._aborted){if(!k._contentChecked&&(2==k.readyState||3==k.readyState||4==k.readyState)&&200==k.status){k._contentChecked=!0;var a=k.getResponseHeader("content-type");if(a&&(a=c(a),a!=("arraybuffer"==k.responseType))){k._aborted=!0;var f=k.onreadystatechange;k.onreadystatechange=null;var h=k._url;k.abort();k=new XMLHttpRequest;k._url=h;k._contentChecked=
!0;k.open("GET",h,!0);a&&(k.responseType="arraybuffer");k.onreadystatechange=f;k.send(null);return}}if(4==k.readyState)if(200==k.status){XML3D.debug.logDebug("Loaded: "+k._url);a=k.getResponseHeader("content-type");f=null;if("arraybuffer"==k.responseType)f=k.response;else if("application/json"==a)f=JSON.parse(k.responseText);else if("application/xml"==a||"text/xml"==a)f=k.responseXML;else if("application/octet-stream"==a||"text/plain; charset=x-user-defined"==a)XML3D.debug.logError("Possibly wrong loading of resource "+
h+". Mimetype is "+a+" but response is not an ArrayBuffer"),f=k.responseText;b&&b(f)}else XML3D.debug.logError("Could not load external document '"+k._url+"': "+k.status+" - "+k.statusText),d&&d(k)}},k.send(null))},getImage:function(c,b,f){d(0).counter++;var k=new Image;k.onload=function(c){b(c,k);a(0)};k.onerror=function(c){f(c,k);a(0)};c.hasSameOrigin(document.location.href)||(k.crossOrigin=v.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin image as texture. This might cause troubles cause the canvas is 'tainted'."));
k.src=c.toString();return k},getVideo:function(c,b,f,k){function h(a){return function(c){a(c,g)}}d(0).counter++;var g=document.createElement("video"),e=function(c){a(0);g.removeEventListener("canplay",e,!0);g.removeEventListener("error",e,!0)};c.hasSameOrigin(document.location.href)||(g.crossOrigin=v.getValue("resource-crossorigin-attribute"),XML3D.debug.logWarning("You are using an cross-origin video as texture. This might cause troubles cause the canvas is 'tainted'.",c));g.autoplay=b;g.loop=f;
for(var q in k)g.addEventListener(q,h(k[q]),!0);g.addEventListener("canplay",e,!0);g.addEventListener("error",e,!0);g.src=c.toString();return g}};m.exports={registerFactory:function(a){var c=a.canvasId;z[c]||(z[c]=[]);z[c].push(a)},registerFormat:function(a){a&&C.push(a)},findFormat:D,Resource:H}},{"../utils/options.js":145,"../utils/uri.js":146,"./adapterhandle.js":21}],24:[function(e,m,l){e=function(){};e.prototype={constructor:e,addEventListener:function(d,b){void 0===this._listeners&&(this._listeners=
{});var a=this._listeners;void 0===a[d]&&(a[d]=[]);-1===a[d].indexOf(b)&&a[d].push(b)},hasEventListener:function(d,b){if(void 0===this._listeners)return!1;var a=this._listeners;return void 0!==a[d]&&-1!==a[d].indexOf(b)?!0:!1},removeEventListener:function(d,b){if(void 0!==this._listeners){var a=this._listeners,c=a[d].indexOf(b);-1!==c&&a[d].splice(c,1)}},dispatchEvent:function(d){if(void 0!==this._listeners){var b=this._listeners[d.type];if(void 0!==b){d.target=this;for(var a=0,c=b.length;a<c;a++)b[a].call(this,
d)}}}};m.exports=e},{}],25:[function(e,m,l){var d={unProject:function(b,a,c,f,k,h,g){b=[b,a,c,1];a=[];d.multMatrices(f,k,a);if(!d.invertMatrix(a,a))return!1;b[0]=(b[0]-h[0])/h[2];b[1]=(b[1]-h[1])/h[3];b[0]=2*b[0]-1;b[1]=2*b[1]-1;b[2]=2*b[2]-1;f=[];d.multMatrixVec(a,b,f);if(0===f[3])return!1;f[0]/=f[3];f[1]/=f[3];f[2]/=f[3];g[0]=f[0];g[1]=f[1];g[2]=f[2];return!0},multMatrixVec:function(b,a,c){for(var f=0;4>f;f+=1)c[f]=a[0]*b[0+f]+a[1]*b[4+f]+a[2]*b[8+f]+a[3]*b[12+f]},multMatrices:function(b,a,c){for(var f=
0;4>f;f+=1)for(var d=0;4>d;d+=1)c[4*f+d]=b[4*f+0]*a[0+d]+b[4*f+1]*a[4+d]+b[4*f+2]*a[8+d]+b[4*f+3]*a[12+d]},invertMatrix:function(b,a){var c=[];c[0]=b[5]*b[10]*b[15]-b[5]*b[11]*b[14]-b[9]*b[6]*b[15]+b[9]*b[7]*b[14]+b[13]*b[6]*b[11]-b[13]*b[7]*b[10];c[4]=-b[4]*b[10]*b[15]+b[4]*b[11]*b[14]+b[8]*b[6]*b[15]-b[8]*b[7]*b[14]-b[12]*b[6]*b[11]+b[12]*b[7]*b[10];c[8]=b[4]*b[9]*b[15]-b[4]*b[11]*b[13]-b[8]*b[5]*b[15]+b[8]*b[7]*b[13]+b[12]*b[5]*b[11]-b[12]*b[7]*b[9];c[12]=-b[4]*b[9]*b[14]+b[4]*b[10]*b[13]+b[8]*
b[5]*b[14]-b[8]*b[6]*b[13]-b[12]*b[5]*b[10]+b[12]*b[6]*b[9];c[1]=-b[1]*b[10]*b[15]+b[1]*b[11]*b[14]+b[9]*b[2]*b[15]-b[9]*b[3]*b[14]-b[13]*b[2]*b[11]+b[13]*b[3]*b[10];c[5]=b[0]*b[10]*b[15]-b[0]*b[11]*b[14]-b[8]*b[2]*b[15]+b[8]*b[3]*b[14]+b[12]*b[2]*b[11]-b[12]*b[3]*b[10];c[9]=-b[0]*b[9]*b[15]+b[0]*b[11]*b[13]+b[8]*b[1]*b[15]-b[8]*b[3]*b[13]-b[12]*b[1]*b[11]+b[12]*b[3]*b[9];c[13]=b[0]*b[9]*b[14]-b[0]*b[10]*b[13]-b[8]*b[1]*b[14]+b[8]*b[2]*b[13]+b[12]*b[1]*b[10]-b[12]*b[2]*b[9];c[2]=b[1]*b[6]*b[15]-b[1]*
b[7]*b[14]-b[5]*b[2]*b[15]+b[5]*b[3]*b[14]+b[13]*b[2]*b[7]-b[13]*b[3]*b[6];c[6]=-b[0]*b[6]*b[15]+b[0]*b[7]*b[14]+b[4]*b[2]*b[15]-b[4]*b[3]*b[14]-b[12]*b[2]*b[7]+b[12]*b[3]*b[6];c[10]=b[0]*b[5]*b[15]-b[0]*b[7]*b[13]-b[4]*b[1]*b[15]+b[4]*b[3]*b[13]+b[12]*b[1]*b[7]-b[12]*b[3]*b[5];c[14]=-b[0]*b[5]*b[14]+b[0]*b[6]*b[13]+b[4]*b[1]*b[14]-b[4]*b[2]*b[13]-b[12]*b[1]*b[6]+b[12]*b[2]*b[5];c[3]=-b[1]*b[6]*b[11]+b[1]*b[7]*b[10]+b[5]*b[2]*b[11]-b[5]*b[3]*b[10]-b[9]*b[2]*b[7]+b[9]*b[3]*b[6];c[7]=b[0]*b[6]*b[11]-
b[0]*b[7]*b[10]-b[4]*b[2]*b[11]+b[4]*b[3]*b[10]+b[8]*b[2]*b[7]-b[8]*b[3]*b[6];c[11]=-b[0]*b[5]*b[11]+b[0]*b[7]*b[9]+b[4]*b[1]*b[11]-b[4]*b[3]*b[9]-b[8]*b[1]*b[7]+b[8]*b[3]*b[5];c[15]=b[0]*b[5]*b[10]-b[0]*b[6]*b[9]-b[4]*b[1]*b[10]+b[4]*b[2]*b[9]+b[8]*b[1]*b[6]-b[8]*b[2]*b[5];var f=b[0]*c[0]+b[1]*c[4]+b[2]*c[8]+b[3]*c[12];if(0===f)return!1;for(var f=1/f,d=0;16>d;d+=1)a[d]=c[d]*f;return!0}};m.exports=d},{}],26:[function(e,m,l){var d=function(b){b=b||{guess:!0};var a=b.e||null;b=!!b.guess;var c=new d.implementation,
a=c.run(a);return b?c.guessAnonymousFunctions(a):a};d.implementation=function(){};d.implementation.prototype={run:function(b,a){b=b||this.createException();a=a||this.mode(b);return"other"===a?this.other(arguments.callee):this[a](b)},createException:function(){try{this.undef()}catch(b){return b}},mode:function(b){return b.arguments&&b.stack?"chrome":b.stack&&b.sourceURL?"safari":"string"===typeof b.message&&"undefined"!==typeof window&&window.opera?!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>
b.stacktrace.split("\n").length?"opera9":b.stack?0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11":"opera10a":b.stack?"firefox":"other"},instrumentFunction:function(b,a,c){b=b||window;var f=b[a];b[a]=function(){c.call(this,d().slice(4));return b[a]._instrumented.apply(this,arguments)};b[a]._instrumented=f},deinstrumentFunction:function(b,a){b[a].constructor===Function&&b[a]._instrumented&&b[a]._instrumented.constructor===Function&&(b[a]=b[a]._instrumented)},chrome:function(b){b=(b.stack+
"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");b.pop();return b},safari:function(b){return b.stack.replace(/\[native code\]\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},firefox:function(b){return b.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(b){var a=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;
b=b.stacktrace.split("\n");for(var c=[],f=0,d=b.length;f<d;f+=2){var h=a.exec(b[f]);if(h){var g=h[4]+":"+h[1]+":"+h[2],h=h[3]||"global code",h=h.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");c.push(h+"@"+g+" -- "+b[f+1].replace(/^\s+/,""))}}return c},opera10b:function(b){var a=/^(.*)@(.+):(\d+)$/;b=b.stacktrace.split("\n");for(var c=[],f=0,d=b.length;f<d;f++){var h=a.exec(b[f]);h&&c.push((h[1]?h[1]+"()":"global code")+"@"+h[2]+":"+h[3])}return c},opera10a:function(b){var a=
/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;b=b.stacktrace.split("\n");for(var c=[],f=0,d=b.length;f<d;f+=2){var h=a.exec(b[f]);h&&c.push((h[3]||"{anonymous}")+"()@"+h[2]+":"+h[1]+" -- "+b[f+1].replace(/^\s+/,""))}return c},opera9:function(b){var a=/Line (\d+).*script (?:in )?(\S+)/i;b=b.message.split("\n");for(var c=[],f=2,d=b.length;f<d;f+=2){var h=a.exec(b[f]);h&&c.push("{anonymous}()@"+h[2]+":"+h[1]+" -- "+b[f+1].replace(/^\s+/,""))}return c},other:function(b){for(var a=/function\s*([\w\-$]+)?\s*\(/i,
c=[],f,d;b&&b.arguments&&10>c.length;)f=a.test(b.toString())?RegExp.$1||"{anonymous}":"{anonymous}",d=Array.prototype.slice.call(b.arguments||[]),c[c.length]=f+"("+this.stringifyArguments(d)+")",b=b.caller;return c},stringifyArguments:function(b){for(var a=[],c=Array.prototype.slice,f=0;f<b.length;++f){var d=b[f];void 0===d?a[f]="undefined":null===d?a[f]="null":d.constructor&&(d.constructor===Array?a[f]=3>d.length?"["+this.stringifyArguments(d)+"]":"["+this.stringifyArguments(c.call(d,0,1))+"..."+
this.stringifyArguments(c.call(d,-1))+"]":d.constructor===Object?a[f]="#object":d.constructor===Function?a[f]="#function":d.constructor===String?a[f]='"'+d+'"':d.constructor===Number&&(a[f]=d))}return a.join(",")},sourceCache:{},ajax:function(b){var a=this.createXMLHTTPObject();if(a)try{return a.open("GET",b,!1),a.send(null),a.responseText}catch(c){}return""},createXMLHTTPObject:function(){for(var b,a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<a.length;c++)try{return b=a[c](),this.createXMLHTTPObject=a[c],b}catch(f){}},isSameDomain:function(b){return"undefined"!==typeof location&&-1!==b.indexOf(location.hostname)},getSource:function(b){b in this.sourceCache||(this.sourceCache[b]=this.ajax(b).split("\n"));return this.sourceCache[b]},guessAnonymousFunctions:function(b){for(var a=0;a<b.length;++a){var c=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,f=b[a],d=/\{anonymous\}\(.*\)@(.*)/.exec(f);
if(d){var h=c.exec(d[1]);h&&(c=h[1],d=h[2],h=h[3]||0,c&&this.isSameDomain(c)&&d&&(c=this.guessAnonymousFunction(c,d,h),b[a]=f.replace("{anonymous}",c)))}}return b},guessAnonymousFunction:function(b,a,c){var f;try{f=this.findFunctionName(this.getSource(b),a)}catch(d){f="getSource failed with url: "+b+", exception: "+d.toString()}return f},findFunctionName:function(b,a){for(var c=/function\s+([^(]*?)\s*\(([^)]*)\)/,f=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,
h="",g,e=Math.min(a,20),r,n=0;n<e;++n)if(g=b[a-n-1],r=g.indexOf("//"),0<=r&&(g=g.substr(0,r)),g)if(h=g+h,(g=f.exec(h))&&g[1]||(g=c.exec(h))&&g[1]||(g=d.exec(h))&&g[1])return g[1];return"(?)"}};m.exports=d},{}],27:[function(e,m,l){var d={VERSION:"2.2.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(b,a){var c="string"==typeof b.initial?{state:b.initial}:b.initial,f=a||b.target||
{},k=b.events||[],h=b.callbacks||{},g={},e=function(a){var c=a.from instanceof Array?a.from:a.from?[a.from]:[d.WILDCARD];g[a.name]=g[a.name]||{};for(var b=0;b<c.length;b++)g[a.name][c[b]]=a.to||c[b]};c&&(c.event=c.event||"startup",e({name:c.event,from:"none",to:c.state}));for(var r=0;r<k.length;r++)e(k[r]);for(var n in g)g.hasOwnProperty(n)&&(f[n]=d.buildEvent(n,g[n]));for(n in h)h.hasOwnProperty(n)&&(f[n]=h[n]);f.current="none";f.is=function(a){return this.current==a};f.can=function(a){return!this.transition&&
(g[a].hasOwnProperty(this.current)||g[a].hasOwnProperty(d.WILDCARD))};f.cannot=function(a){return!this.can(a)};f.error=b.error||function(a,c,b,f,d,k,h){throw h||k;};if(c&&!c.defer)f[c.event]();return f},doCallback:function(b,a,c,f,k,h){if(a)try{return a.apply(b,[c,f,k].concat(h))}catch(g){return b.error(c,f,k,h,d.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",g)}},beforeEvent:function(b,a,c,f,k){return d.doCallback(b,b["onbefore"+a],a,c,f,k)},afterEvent:function(b,
a,c,f,k){return d.doCallback(b,b["onafter"+a]||b["on"+a],a,c,f,k)},leaveState:function(b,a,c,f,k){return d.doCallback(b,b["onleave"+c],a,c,f,k)},enterState:function(b,a,c,f,k){return d.doCallback(b,b["onenter"+f]||b["on"+f],a,c,f,k)},changeState:function(b,a,c,f,k){return d.doCallback(b,b.onchangestate,a,c,f,k)},buildEvent:function(b,a){return function(){var c=this.current,f=a[c]||a[d.WILDCARD]||c,k=Array.prototype.slice.call(arguments);if(this.transition)return this.error(b,c,f,k,d.Error.PENDING_TRANSITION,
"event "+b+" inappropriate because previous transition did not complete");if(this.cannot(b))return this.error(b,c,f,k,d.Error.INVALID_TRANSITION,"event "+b+" inappropriate in current state "+this.current);if(!1===d.beforeEvent(this,b,c,f,k))return d.Result.CANCELLED;if(c===f)return d.afterEvent(this,b,c,f,k),d.Result.NOTRANSITION;var h=this;this.transition=function(){h.transition=null;h.current=f;d.enterState(h,b,c,f,k);d.changeState(h,b,c,f,k);d.afterEvent(h,b,c,f,k)};this.transition.cancel=function(){h.transition=
null;d.afterEvent(h,b,c,f,k)};var g=d.leaveState(this,b,c,f,k);if(!1===g)return this.transition=null,d.Result.CANCELLED;if("async"===g)return d.Result.ASYNC;this.transition&&this.transition();return d.Result.SUCCEEDED}}};window.StateMachine=d;m.exports=d},{}],28:[function(e,m,l){function d(a){a.asset.clearChildren();a.asset.clearSubAssets();for(var c=a.node.firstElementChild;null!==c;c=c.nextElementSibling){var b=a.factory.getAdapter(c);b&&b.getAsset&&a.asset.appendSubAsset(b.getAsset());b&&b.assetEntry&&
a.asset.appendChild(b.assetEntry)}}function b(a,c,b){var f=(b=a.getAdapterHandle(b))&&b.status;f===y.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+b.url+"' for "+c,a.node);a.connectAdapterHandle(c,b);a.connectedAdapterChanged(c,b?b.getAdapter():null,f)}function a(a){if(a.node.hasAttribute("pick")){var c=a.node.getAttribute("pick");a.asset.setPickFilter(c)}else a.asset.setPickFilter(null)}function c(a,c){c?a.setIncludes(c.trim().split(/\s*,\s*/)):a.setIncludes([])}function f(a){var c=
a.node.getAttribute("class");a.assetEntry.setClassNamesString(c)}function k(a){var c=a.node.getAttribute("compute"),f=p(c);f?b(a,"postDataflow",f):(a.disconnectAdapterHandle("postDataflow"),h(a));a.assetEntry.setPostCompute(c)}function h(a){var c=!1,b;(b=a.getConnectedAdapterHandle("postDataflow"))&&b.status===y.STATUS.LOADING&&(c=!0);a.assetEntry.setLoading(c)}function g(a,c){var b=a.node,f=b.getAttribute("shader");f?(b=w.getAbsoluteURI(b.ownerDocument._documentURL||b.ownerDocument.URL,f),c.setShader(b.toString())):
c.setShader(null)}var q=e("../transform-fetcher.js"),r=e("./data.js"),n=e("../../xflow/interface/graph.js").DataNode,p=e("../../xflow/interface/graph.js").getComputeDataflowUrl,t=e("../../asset/asset.js").Asset,x=e("../../asset/asset.js").SubData,u=e("../../interface/notification.js"),v=e("../../utils/misc.js").dispatchCustomEvent,w=e("../../base/resourcemanager.js").Resource,z=e("../../base/adapter.js").NodeAdapter;l=XML3D.createClass;var y=e("../../base/adapterhandle.js");e=function(a,c){z.call(this,
a,c);this.asset=null;"model"!==c.localName.toLowerCase()&&(this.transformFetcher=new q(this,"transform","transform"))};l(e,z);e.prototype.init=function(){this.asset=new t(this.node);this.asset.addChangeListener(this);this.asset.setName(this.node.getAttribute("name"));b(this,"src",this.node.getAttribute("src"));a(this);d(this);g(this,this.asset);this.transformFetcher&&this.transformFetcher.update()};e.prototype.onAssetLoadChange=function(a,c,b){Infinity==c?v(this.node,"load",!1,!0,null):c>b&&v(this.node,
"progress",!1,!0,null)};e.prototype.getAssetComplete=function(){return Infinity==this.asset.getProgressLevel()};e.prototype.getAssetProgressLevel=function(){return this.asset.getProgressLevel()};e.prototype.getAsset=function(){return this.asset};e.prototype.connectedAdapterChanged=function(a,c){"src"==a&&this.asset.setSrcAsset(c&&c.getAsset()||null);var b=!1,f;(f=this.getConnectedAdapterHandle("src"))&&f.status===y.STATUS.LOADING&&(b=!0);this.asset.setLoading(b)};e.prototype.onTransformChange=function(a,
c){this.asset.setTransform(c)};e.prototype.notifyChanged=function(c){if(c.type==u.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(c.key,c.adapter),c.handleStatus==y.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <asset> element of url '"+c.url+"' for "+c.key);else if(c.type==u.NODE_INSERTED)d(this);else if(c.type==u.NODE_REMOVED)d(this);else if(c.type==u.VALUE_MODIFIED)switch(c.mutation.attributeName){case "name":this.asset.setName(this.node.getAttribute("name"));break;case "shader":g(this,
this.asset);break;case "style":case "transform":this.transformFetcher&&this.transformFetcher.update();break;case "src":b(this,"src",this.node.getAttribute("src"));break;case "pick":a(this)}else c.type==u.THIS_REMOVED&&this.clearAdapterHandles()};var E=function(a,c){this.assetData=!0;r.call(this,a,c);this.outputXflowNode=this.assetEntry=null};l(E,r);E.prototype.init=function(){r.prototype.init.call(this);this.outputXflowNode=new n(!1);this.assetEntry=new x(this.outputXflowNode,this.getXflowNode(),
this.node);this.assetEntry.setName(this.node.getAttribute("name"));f(this);k(this);this.assetEntry.setPostFilter(this.node.getAttribute("filter"));c(this.assetEntry,this.node.getAttribute("includes"))};E.prototype.connectedAdapterChanged=function(a,c){"postDataflow"==a?(this.assetEntry.setPostDataflow(c&&c.getXflowNode()||null),h(this)):r.prototype.connectedAdapterChanged.call(this,a,c)};E.prototype.notifyChanged=function(a){r.prototype.notifyChanged.call(this,a);if(a.type==u.VALUE_MODIFIED)switch(a.mutation.attributeName){case "name":this.assetEntry.setName(this.node.getAttribute("name"));
break;case "compute":k(this);break;case "class":f(this);break;case "filter":this.assetEntry.setPostFilter(this.node.getAttribute("filter"));break;case "includes":c(this.node.getAttribute("includes"))}};E.prototype.onTransformChange=function(a,c){this.assetEntry.setTransform(c)};var C=function(a,c){E.call(this,a,c);this.transformFetcher=new q(this,"transform","transform")};l(C,E);C.prototype.init=function(){E.prototype.init.call(this);g(this,this.assetEntry);this.assetEntry.setMeshType(this.node.getAttribute("type")||
"triangles");this.assetEntry.setMatchFilter(this.node.getAttribute("match"));this.transformFetcher.update()};C.prototype.notifyChanged=function(a){E.prototype.notifyChanged.call(this,a);if(a.type==u.VALUE_MODIFIED)switch(a.mutation.attributeName){case "shader":g(this,this.assetEntry);break;case "match":this.assetEntry.setMatchFilter(this.node.getAttribute("match"));break;case "style":case "transform":this.transformFetcher.update();break;case "type":this.assetEntry.setMeshType(this.node.getAttribute("type")||
"triangles")}};m.exports={AssetAdapter:e,AssetMeshAdapter:C,AssetDataAdapter:E}},{"../../asset/asset.js":19,"../../base/adapter.js":20,"../../base/adapterhandle.js":21,"../../base/resourcemanager.js":23,"../../interface/notification.js":49,"../../utils/misc.js":144,"../../xflow/interface/graph.js":151,"../transform-fetcher.js":41,"./data.js":31}],29:[function(e,m,l){var d=e("../../xflow/interface/request.js").ComputeRequest;l=e("../../xflow/processing/vs-connect.js").setShaderConstant;var b=e("../../xflow/base.js").registerErrorCallback,
a=e("../../xflow/interface/constants.js"),c=e("../../utils/uri.js").URI,f=e("../../base/adapter.js").NodeAdapter;e=XML3D.createClass;var k=function(a,c){f.call(this,a,c);this.xflowDataNode=null};e(k,f);k.prototype.getXflowNode=function(){return this.xflowDataNode};k.prototype.getComputeRequest=function(a,c){return new d(this.xflowDataNode,a,c)};k.prototype.getComputeResult=function(c){return this.xflowDataNode._getResult(a.RESULT_TYPE.COMPUTE,c)};k.prototype.getOutputNames=function(){return this.xflowDataNode.getOutputNames()};
k.prototype.getOutputChannelInfo=function(a){return this.xflowDataNode.getOutputChannelInfo(a)};l(a.SHADER_CONSTANT_KEY.OBJECT_ID,"objectID");l(a.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM,"modelViewProjectionMatrix");l(a.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL,"modelViewProjectionNormalMatrix");l(a.SHADER_CONSTANT_KEY.VIEW_TRANSFORM,"modelViewMatrix");l(a.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL,"modelViewMatrixN");l(a.SHADER_CONSTANT_KEY.WORLD_TRANSFORM,"modelMatrix");b(function(a,b){a="Xflow: "+
a;var f=b?b.userData:null;if(f&&f.ownerDocument)if(f.ownerDocument===document)XML3D.debug.logError(a,f);else if(f.id){var d=new c("#"+f.id),d=d.getAbsoluteURI(f.ownerDocument._documentURL||f.ownerDocument.URL);XML3D.debug.logError(a,"External Node: "+d)}else XML3D.debug.logError(a,"External Document: "+f.ownerDocument.URL);else"string"==typeof f?XML3D.debug.logError(a,f):XML3D.debug.logError(a)});m.exports=k},{"../../base/adapter.js":20,"../../utils/uri.js":146,"../../xflow/base.js":148,"../../xflow/interface/constants.js":149,
"../../xflow/interface/request.js":152,"../../xflow/processing/vs-connect.js":199}],30:[function(e,m,l){var d=e("../../interface/notification.js"),b=e("../../base/adapter.js").NodeAdapter;e=function(a,c){b.call(this,a,c)};XML3D.createClass(e,b);e.prototype.getComputeCode=function(){return this.node.value};e.prototype.notifyChanged=function(a){switch(a.type){case d.VALUE_MODIFIED:case d.NODE_INSERTED:case d.NODE_REMOVED:(a=this.node.parentNode)&&(a=this.factory.getAdapter(a))&&a.updateXflowNode()}};
m.exports=e},{"../../base/adapter.js":20,"../../interface/notification.js":49}],31:[function(e,m,l){function d(a){var c=a._children,b;if(c&&0<c.length)for(b=c.length;b--;)c[b]instanceof f&&(c[b].setPlatform(a._platform),d(c[b]))}function b(c){var b=c.xflowDataNode;b.setCompute(c.node.getAttribute("compute"));b.computeDataflowUrl?c.updateAdapterHandle("dataflow",b.computeDataflowUrl):(c.disconnectAdapterHandle("dataflow"),a(c))}function a(a){var c=!1,b;(b=a.getConnectedAdapterHandle("src"))&&b.status===
q.STATUS.LOADING&&(c=!0);(b=a.getConnectedAdapterHandle("dataflow"))&&b.status===q.STATUS.LOADING&&(c=!0);for(var f in a.externalScripts)(b=a.getConnectedAdapterHandle(f))&&b.status===q.STATUS.LOADING&&(c=!0);a.xflowDataNode.setLoading(c)}var c=e("./base.js"),f=e("../../xflow/interface/graph.js").DataNode,k=e("../../xflow/interface/constants.js"),h=e("../../interface/notification.js"),g=e("../../utils/misc.js").dispatchCustomEvent,q=e("../../base/adapterhandle.js");e=function(a,b){c.call(this,a,b);
this.xflowDataNode=null;this.externalScripts={}};XML3D.createClass(e,c);e.prototype.init=function(){this.xflowDataNode=new f(!1);this.xflowDataNode.addLoadListener(this.onXflowLoadEvent.bind(this));this.xflowDataNode.userData=this.node;this.xflowDataNode.setPlatform(this.node.getAttribute("platform"));this.updateAdapterHandle("src",this.node.getAttribute("src"));this.assetData||(this.xflowDataNode.setFilter(this.node.getAttribute("filter")),b(this));for(var a=this.node.firstElementChild;null!==a;a=
a.nextElementSibling){var c=this.factory.getAdapter(a);if(c){if(c.getXflowNode)this.xflowDataNode.appendChild(c.getXflowNode());else if(c.getScriptType){var k=c.node.name;k||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",c.node),k="unknown_operator");this.externalScripts[k]=c;c.connectedAdapterHandle&&this.connectAdapterHandle(k,c.connectedAdapterHandle);this.xflowDataNode.setLoading(!0)}null!==this.xflowDataNode._platform&&
d(this.xflowDataNode)}}};e.prototype.updateAdapterHandle=function(a,c){var b=this.getConnectedAdapterHandle(a),f=this.getAdapterHandle(c),d=f&&f.status;b!=f&&(d===q.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+f.url+"' for "+a,this.node),this.connectAdapterHandle(a,f),this.connectedAdapterChanged(a,f?f.getAdapter():null,d))};e.prototype.onXflowLoadEvent=function(a,c,b){Infinity==c?g(this.node,"load",!1,!0,null):c>b&&g(this.node,"progress",!1,!0,null)};e.prototype.getDataComplete=
function(){return Infinity==this.xflowDataNode.getProgressLevel()};e.prototype.getDataProgressLevel=function(){return this.xflowDataNode.getProgressLevel()};e.prototype.notifyChanged=function(a){if(a.type===h.ADAPTER_HANDLE_CHANGED)this.connectedAdapterChanged(a.key,a.adapter,a.handleStatus),a.handleStatus===q.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find <data> element of url '"+a.url+"' for "+a.key,this.node);else if(a.type===h.NODE_INSERTED){var c=a.affectedNode;if(a=this.factory.getAdapter(c)){a=
a.getXflowNode();var f=null;do c=c.nextSibling;while(c&&!(f=this.factory.getAdapter(c)));f?this.xflowDataNode.insertBefore(a,f.getXflowNode()):this.xflowDataNode.appendChild(a)}}else if(a.type===h.NODE_REMOVED){if(a=this.factory.getAdapter(a.affectedNode))a=a.getXflowNode(),this.xflowDataNode.removeChild(a)}else a.type===h.VALUE_MODIFIED?(a=a.mutation.attributeName,"filter"!==a||this.assetData)?"compute"!==a||this.assetData?"src"===a?this.updateAdapterHandle(a,this.node.getAttribute(a)):"platform"===
a&&(a=this.xflowDataNode,a.setPlatform(this.node.getAttribute("platform")),d(a)):b(this):this.xflowDataNode.setFilter(this.node.getAttribute(a)):a.type===h.THIS_REMOVED&&this.clearAdapterHandles()};e.prototype.connectedAdapterChanged=function(c,b){"src"===c?this.xflowDataNode.sourceNode=b?b.getXflowNode():null:"dataflow"===c?this.xflowDataNode.dataflowNode=b?b.getXflowNode():null:this.externalScripts[c]&&(window.eval(b.script),this.xflowDataNode.notify(k.RESULT_STATE.CHANGED_STRUCTURE));this.xflowDataNode.setLoading(!0);
a(this)};e.prototype.toString=function(){return"DataAdapter"};m.exports=e},{"../../base/adapterhandle.js":21,"../../interface/notification.js":49,"../../utils/misc.js":144,"../../xflow/interface/constants.js":149,"../../xflow/interface/graph.js":151,"./base.js":29}],32:[function(e,m,l){function d(a,c,b){a._computeOperator===c&&a.setLoading(b);if(a._children)for(var f=a._children.length;f--;)d(a._children[f],c,b)}function b(a){var c=a.node.getAttribute("out");c?a.xflowDataNode.setFilter("keep("+c+
")"):a.xflowDataNode.setFilter("")}function a(a,c){var k=c.getAttribute("platform");a.xflowDataNode.clearChildren();a.xflowDataNode.setCompute("");a.clearAdapterHandles();a.dataflowRefs=[];a.externalScripts={};b(a);var g=c.lastElementChild,h=!0,e=null,u=a.xflowDataNode,l,w;do if(l=a.factory.getAdapter(g))if(l.getXflowNode)w=l.getXflowNode(),e?u.insertBefore(w,e):u.appendChild(w),e=w;else if(l.getComputeCode){l=l.getComputeCode().split(";");for(var z=l.length;z--;)l[z].trim()&&(h?h=!1:(w=new f(!1),
e?u.insertBefore(w,e):u.appendChild(w),u=w,e=null),u.userData=g,u.setPlatform(k),u.setCompute(l[z].trim()),u.computeDataflowUrl&&(w=a.dataflowRefs.length,a.dataflowRefs.push(u),a.updateAdapterHandle(w,u.computeDataflowUrl)))}else l.getScriptType&&(z=l.node.name,z||(XML3D.debug.logError("Parsing error: Externally referenced operators must have a 'name' attribute matching the name they were registered with. ",l.node),z="unknown_operator"),a.externalScripts[z]=l,l.connectedAdapterHandle&&a.connectAdapterHandle(z,
l.connectedAdapterHandle));while(g=g.previousElementSibling);for(var y in a.externalScripts)d(a.xflowDataNode,y,!0)}var c=e("./base.js"),f=e("../../xflow/interface/graph.js").DataNode,k=e("../../xflow/interface/constants.js"),h=e("../../interface/notification.js"),g=e("../../base/adapterhandle.js");e=function(a,b){c.call(this,a,b);this.xflowDataNode=null;this.externalScripts={}};XML3D.createClass(e,c);e.prototype.init=function(){this.xflowDataNode=new f(!1);this.dataflowRefs=[];a(this,this.node)};
e.prototype.updateAdapterHandle=function(a,c){var b=this.getConnectedAdapterHandle(a),f=this.getAdapterHandle(c),d=f&&f.status;b!=f&&(d===g.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find element of url '"+f.url+"' for "+a,this.node),this.connectAdapterHandle(a,f),this.connectedAdapterChanged(a,f?f.getAdapter():null,d))};e.prototype.notifyChanged=function(c){c.type===h.ADAPTER_HANDLE_CHANGED&&this.externalScripts[c.key]&&(window.eval(c.adapter.script),d(this.xflowDataNode,c.key,!1),this.xflowDataNode.notify(k.RESULT_STATE.CHANGED_STRUCTURE));
switch(c.type){case h.ADAPTER_HANDLE_CHANGED:this.connectedAdapterChanged(c.key,c.adapter,c.handleStatus);c.handleStatus===g.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find dataflow of url '"+c.url,this.node);break;case h.NODE_INSERTED:case h.NODE_REMOVED:a(this);break;case h.VALUE_MODIFIED:c=c.mutation.attributeName,"out"===c?b(this):"platform"===c&&a(this,this.node)}};e.prototype.updateXflowNode=function(){a(this,this.node)};e.prototype.connectedAdapterChanged=function(a,c,b){if(a=this.dataflowRefs[a])a.dataflowNode=
c?c.getXflowNode():null,a.setLoading(b===g.STATUS.LOADING)};m.exports=e},{"../../base/adapterhandle.js":21,"../../interface/notification.js":49,"../../xflow/interface/constants.js":149,"../../xflow/interface/graph.js":151,"./base.js":29}],33:[function(e,m,l){var d=e("../../base/adapter.js").NodeAdapterFactory;l=e("./asset.js");var b=e("./misc.js"),a=e("./script.js"),c=e("./texture.js"),f=e("./transform.js"),k=e("./values.js"),h=e("./data.js"),g=e("./compute.js"),q=e("./dataflow.js");e("./json/factory.js");
e("./javascript/factory.js");e=function(){d.call(this,"data")};XML3D.createClass(e,d);e.prototype.aspect="data";var r={mesh:b.SinkDataAdapter,shader:b.SinkDataAdapter,lightshader:b.SinkDataAdapter,"float":k,float2:k,float3:k,float4:k,float4x4:k,"int":k,int4:k,bool:k,"byte":k,ubyte:k,img:b.ImgDataAdapter,texture:c,data:h,proto:h,dataflow:q,compute:g,video:b.VideoDataAdapter,script:a,transform:f,asset:l.AssetAdapter,assetdata:l.AssetDataAdapter,assetmesh:l.AssetMeshAdapter,model:l.AssetAdapter};e.prototype.createAdapter=
function(a){var c=r[a.localName];if(void 0!==c)return new c(this,a);XML3D.debug.logWarning("Not supported as data element: "+a.localName);return null};m.exports=e},{"../../base/adapter.js":20,"./asset.js":28,"./compute.js":30,"./data.js":31,"./dataflow.js":32,"./javascript/factory.js":34,"./json/factory.js":35,"./misc.js":36,"./script.js":37,"./texture.js":38,"./transform.js":39,"./values.js":40}],34:[function(e,m,l){m=e("../../../base/resourcemanager.js").registerFormat;var d=e("../../../base/formathandler.js").FormatHandler,
b=e("../../../base/adapter.js").AdapterFactory;e=function(){d.call(this)};XML3D.createClass(e,d);e.prototype.isFormatSupported=function(a,b,d){return"application/javascript"===d||"text/javascript"===d};e.prototype.getFormatData=function(a,b,d,h){h(!0,a)};e=new e;m(e);var a=function(a){this.script=a};a.prototype.getScriptType=function(){return"application/javascript"};a.prototype.getScript=function(){return this.script};m=function(){b.call(this,"data")};XML3D.createClass(m,b);m.prototype.aspect="data";
m.prototype.createAdapter=function(c){return new a(c)};e.registerFactoryClass(m)},{"../../../base/adapter.js":20,"../../../base/formathandler.js":22,"../../../base/resourcemanager.js":23}],35:[function(e,m,l){function d(b,f,d,g,h){h=new r[f](h);f=a.DATA_TYPE.fromString(f);f=new k(f,h);h=new c;h.data=f;h.name=d;h.key=g;b.appendChild(h)}function b(b,f,g){if(r[g.type])for(var e=0;e<g.seq.length;++e){var q=g.seq[e],p=q.value,l=q.key;if("Object"===Object.prototype.toString.call(p).slice(8,-1)&&p.url){if(!n())throw Error("Big-endian binary data are not supported yet");
h.loadData(p.url,function(d){var h=g.type,e=l,q=r[h];d=new q(d,p.byteOffset,p.byteLength/q.BYTES_PER_ELEMENT);h=a.DATA_TYPE.fromString(h);h=new k(h,d);d=new c;d.data=h;d.name=f;d.key=e;b.appendChild(d)},null)}else d(b,g.type,f,l,p)}}var a=e("../../../xflow/interface/constants.js"),c=e("../../../xflow/interface/graph.js").InputNode,f=e("../../../xflow/interface/graph.js").DataNode,k=e("../../../xflow/interface/data.js").BufferEntry,h=e("../../../base/resourcemanager.js").Resource;m=e("../../../base/resourcemanager.js").registerFormat;
var g=e("../../../base/formathandler.js").JSONFormatHandler,q=e("../../../base/adapter.js").AdapterFactory;e=function(){g.call(this)};XML3D.createClass(e,g);e.prototype.isFormatSupported=function(a,c,b){return"application/json"===b&&"xml3d-json"==a.format&&"0.4.0"==a.version};e.prototype.getFormatData=function(a,c,d,k){try{if("xml3d-json"!=a.format)throw Error("Unknown JSON format: "+a.format);if("0.4.0"!=a.version)throw Error("Unknown JSON version: "+a.version);var h=new f(!1);h.userData="External Json";
var g=a.data,e;for(e in g)b(h,e,g[e]);k(!0,h)}catch(q){XML3D.debug.logException(q,"Failed to process XML3D json file"),k(!1)}};e=new e;m(e);var r={"int":Int32Array,int4:Int32Array,"float":Float32Array,float2:Float32Array,float3:Float32Array,float4:Float32Array,float4x4:Float32Array,bool:Uint8Array,"byte":Int8Array,ubyte:Uint8Array},n=function(){var a=new ArrayBuffer(4),c=new DataView(a);(new Int32Array(a))[0]=16909060;var b=16909060===c.getInt32(0,!0);return function(){return b}}(),p=function(a){this.xflowDataNode=
a};p.prototype.getXflowNode=function(){return this.xflowDataNode};m=function(){q.call(this,"data")};XML3D.createClass(m,q);m.prototype.aspect="data";m.prototype.createAdapter=function(a){return new p(a)};e.registerFactoryClass(m)},{"../../../base/adapter.js":20,"../../../base/formathandler.js":22,"../../../base/resourcemanager.js":23,"../../../xflow/interface/constants.js":149,"../../../xflow/interface/data.js":150,"../../../xflow/interface/graph.js":151}],36:[function(e,m,l){var d=e("./data.js"),
b=e("../../interface/notification.js"),a=e("../../utils/uri.js").URI,c=e("../../utils/misc.js"),f=e("../../base/resourcemanager.js").Resource,k=e("../../base/adapter.js").NodeAdapter;e=XML3D.createClass;l=function(a,c){d.call(this,a,c)};e(l,d);l.prototype.isSinkAdapter=function(){return!0};l.prototype.toString=function(){return"XML3D.data.SinkDataAdapter"};var h=function(a,c){k.call(this,a,c);this.image=this.textureEntry=null;c.src&&this.createImageFromURL(c.src)};e(h,k);h.prototype.createImageFromURL=
function(c){var b=this;c=(new a(c)).getAbsoluteURI(this.node.ownerDocument._documentURL||this.node.ownerDocument.URL);this.image=f.getImage(c,function(a,c){b.textureEntry&&b.textureEntry.setImage(c,!0)},function(a,c){XML3D.debug.logError("Could not load image URI="+c.src)});b.textureEntry&&b.textureEntry.setImage(this.image,!0)};h.prototype.setTextureEntry=function(a){this.textureEntry=a;this.image&&this.textureEntry.setImage(this.image,!0)};h.prototype.notifyChanged=function(a){a.type==b.VALUE_MODIFIED&&
"src"==a.mutation.attributeName&&this.createImageFromURL(this.node.src)};h.prototype.getValue=function(a,c){return this.image};h.prototype.getOutputs=function(){return{image:this}};h.prototype.resolveScript=function(){return null};var g=function(a,c){d.call(this,a,c);this.video=this.textureEntry=null;this._ticking=!1;this._boundTick=this._tick.bind(this);c.src&&this.createVideoFromURL(c.src)};e(g,k);g.prototype.createVideoFromURL=function(b){var d=this;b=(new a(b)).getAbsoluteURI(this.node.ownerDocument._documentURL||
this.node.ownerDocument.URL);this.video=f.getVideo(b,this.node.autoplay,this.node.loop,{canplay:function(a,b){c.dispatchCustomEvent(d.node,"canplay",!0,!0,null);d._startVideoRefresh()},ended:function(a,b){c.dispatchCustomEvent(d.node,"ended",!0,!0,null)},load:function(a,b){c.dispatchEvent(d.node,"load")},error:function(a,b){c.dispatchCustomEvent(d.node,"error",!0,!0,null);XML3D.debug.logError("Could not load video URI="+b.src)}});this.textureEntry&&this.textureEntry.setImage(this.video,!0)};g.prototype.play=
function(){this.video&&this.video.play()};g.prototype.pause=function(){this.video&&this.video.pause()};g.prototype._startVideoRefresh=function(){this._ticking||this._tick()};g.prototype._tick=function(){this._ticking=!0;window.requestAnimFrame(this._boundTick,30);this.textureEntry&&this.textureEntry.setImage(this.video)};g.prototype.setTextureEntry=function(a){this.textureEntry=a;this.video&&this.textureEntry.setImage(this.video,!0)};g.prototype.notifyChanged=function(a){a.type==b.VALUE_MODIFIED&&
"src"==a.mutation.attributeName&&this.createVideoFromURL(this.node.src)};g.prototype.getValue=function(a,c){return this.video};g.prototype.getOutputs=function(){return{video:this}};m.exports={ImgDataAdapter:h,VideoDataAdapter:g,SinkDataAdapter:l}},{"../../base/adapter.js":20,"../../base/resourcemanager.js":23,"../../interface/notification.js":49,"../../utils/misc.js":144,"../../utils/uri.js":146,"./data.js":31}],37:[function(e,m,l){var d=e("../../interface/notification.js");l=XML3D.createClass;var b=
e("../../base/adapter.js").NodeAdapter;e=function(a,c){b.call(this,a,c);this.connectedAdapterHandle=null;c.src&&(this.connectedAdapterHandle=this.getAdapterHandle(c.src),this.connectAdapterHandle(c.name,this.connectedAdapterHandle))};l(e,b);e.prototype.getScriptType=function(){return this.node.type};e.prototype.getScript=function(){return this.node.src?this.externalScript:this.node.value};e.prototype.notifyChanged=function(a){switch(a.type){case d.VALUE_MODIFIED:case d.NODE_INSERTED:case d.NODE_REMOVED:this.notifyOppositeAdapters();
break;case d.ADAPTER_HANDLE_CHANGED:this.externalScript=a.adapter.script,this.notifyOppositeAdapters()}};m.exports=e},{"../../base/adapter.js":20,"../../interface/notification.js":49}],38:[function(e,m,l){var d=e("../../xflow/interface/data.js").TextureEntry,b=e("../../xflow/interface/graph.js").InputNode,a=e("../../xflow/interface/constants.js"),c=e("../../interface/notification.js"),f=e("../../base/adapter.js").NodeAdapter,k=function(a){if("clamp"==a)return WebGLRenderingContext.CLAMP_TO_EDGE;if("repeat"==
a)return WebGLRenderingContext.REPEAT},h=function(a){if("nearest"==a)return WebGLRenderingContext.NEAREST;if("linear"==a)return WebGLRenderingContext.LINEAR;if("nearest-mipmap-nearest"==a)return WebGLRenderingContext.NEAREST_MIPMAP_NEAREST;if("linear-mipmap-nearest"==a)return WebGLRenderingContext.LINEAR_MIPMAP_NEAREST;if("nearest-mipmap-linear"==a)return WebGLRenderingContext.NEAREST_MIPMAP_LINEAR;if("linear-mipmap-linear"==a)return WebGLRenderingContext.LINEAR_MIPMAP_LINEAR};e=function(a,c){f.call(this,
a,c)};XML3D.createClass(e,f);e.prototype.init=function(){this.xflowInputNode=this.createXflowNode();this.xflowInputNode.data=this.createTextureEntry()};e.prototype.createTextureEntry=function(){var c=this.node,b=new d(null),f=b.getSamplerConfig();f.wrapS=k(c.wrapS);f.wrapT=k(c.wrapT);f.minFilter=h(c.filterMin);f.magFilter=h(c.filterMag);f.textureType=a.TEX_TYPE.TEXTURE_2D;f.generateMipMap=this.shouldGenerateMipMaps(f.minFilter,f.magFilter);(c=this.factory.getAdapter(this.node.firstElementChild))&&
c.setTextureEntry(b);return b};e.prototype.shouldGenerateMipMaps=function(a,c){return a!=WebGLRenderingContext.NEAREST&&a!=WebGLRenderingContext.LINEAR||c!=WebGLRenderingContext.NEAREST&&c!=WebGLRenderingContext.LINEAR};e.prototype.createXflowNode=function(){var a=new b;a.name=this.node.name;a.paramName=this.node.param?this.node.name:null;a.key=this.node.key;return a};e.prototype.setScriptValue=function(a){XML3D.debug.logError("Texture currently does not support setScriptValue()")};e.prototype.getOutputs=
function(){var a={};a[this.node.name]=this;return a};e.prototype.getValue=function(){return this.value};e.prototype.notifyChanged=function(a){a.type==c.VALUE_MODIFIED&&(a=a.mutation.attributeName,"name"==a?this.xflowInputNode.name=this.node.name:"key"==a?this.xflowInputNode.key=this.node.key:"param"==a&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null))};e.prototype.getXflowNode=function(){return this.xflowInputNode};e.prototype.toString=function(){return"XML3D.data.TextureDataAdapter"};
m.exports=e},{"../../base/adapter.js":20,"../../interface/notification.js":49,"../../xflow/interface/constants.js":149,"../../xflow/interface/data.js":150,"../../xflow/interface/graph.js":151}],39:[function(e,m,l){var d=e("../../interface/notification.js"),b=e("../../base/adapter.js").NodeAdapter;e=function(a,f){b.call(this,a,f);this.needsUpdate=this.isValid=!0};XML3D.createClass(e,b);var a=XML3D.math.mat4.identity(XML3D.math.mat4.create());e.prototype.init=function(){this.matrix=XML3D.math.mat4.create();
this.transform={translate:XML3D.math.mat4.create(),scale:XML3D.math.mat4.create(),scaleOrientation:XML3D.math.mat4.create(),scaleOrientationInv:XML3D.math.mat4.create(),center:XML3D.math.mat4.create(),centerInverse:XML3D.math.mat4.create(),rotation:XML3D.math.mat4.create()};this.needsUpdate=!0;this.checkForImproperNesting()};e.prototype.updateMatrix=function(){var c=this.node,b=this.transform,d=c.center._data;XML3D.math.mat4.fromQuat(b.scaleOrientation,c.scaleOrientation._data);XML3D.math.mat4.fromQuat(b.rotation,
c.rotation._data);XML3D.math.mat4.translate(b.translate,a,c.translation._data);XML3D.math.mat4.translate(b.center,a,d);XML3D.math.mat4.translate(b.centerInverse,a,XML3D.math.vec3.negate(d,d));XML3D.math.mat4.scale(b.scale,a,c.scale._data);XML3D.math.mat4.invert(b.scaleOrientationInv,b.scaleOrientation);c=this.matrix;XML3D.math.mat4.multiply(c,b.translate,b.center);XML3D.math.mat4.multiply(c,c,b.rotation);XML3D.math.mat4.multiply(c,c,b.scaleOrientation);XML3D.math.mat4.multiply(c,c,b.scale);XML3D.math.mat4.multiply(c,
c,b.scaleOrientationInv);XML3D.math.mat4.multiply(c,c,b.centerInverse);this.needsUpdate=!1};e.prototype.getMatrix=function(){this.needsUpdate&&this.updateMatrix();return this.matrix};e.prototype.notifyChanged=function(a){a.type==d.VALUE_MODIFIED?(this.needsUpdate=!0,this.notifyOppositeAdapters(d.ADAPTER_VALUE_CHANGED)):a.type==d.NODE_REMOVED&&(this.dispose(),this.notifyOppositeAdapters(d.ADAPTER_HANDLE_CHANGED))};e.prototype.dispose=function(){this.isValid=!1};e.prototype.checkForImproperNesting=
function(){for(var a=0;a<this.node.childNodes.length;a++)"transform"===this.node.childNodes[a].localName&&XML3D.debug.logError("Parsing error: Transform elements cannot be nested!",this.node)};m.exports=e},{"../../base/adapter.js":20,"../../interface/notification.js":49}],40:[function(e,m,l){var d=e("../../xflow/interface/data.js").BufferEntry,b=e("../../xflow/interface/graph.js").InputNode,a=e("../../xflow/interface/constants.js"),c=e("../../interface/notification.js"),f=e("../../base/adapter.js").NodeAdapter;
e=function(a,c){f.call(this,a,c);this.xflowInputNode=null};XML3D.createClass(e,f);e.prototype.init=function(){var c=this.node._configured;"[value set by script]"==this.node.textContent?c=c.scriptValue:(delete c.scriptValue,c=this.node.value);var f=a.DATA_TYPE.fromString(this.node.localName),c=new d(f,c);this.xflowInputNode=new b(null);this.xflowInputNode.name=this.node.name;this.xflowInputNode.data=c;this.xflowInputNode.key=this.node.key;this.xflowInputNode.paramName=this.node.param?this.node.name:
null;this.checkForImproperNesting()};e.prototype.getXflowNode=function(){return this.xflowInputNode};e.prototype.notifyChanged=function(a){a.type==c.VALUE_MODIFIED&&((a=a.mutation.attributeName,a)?"name"==a?this.xflowInputNode.name=this.node.name:"key"==a?this.xflowInputNode.key=this.node.key:"param"==a&&(this.xflowInputNode.paramName=this.node.param?this.node.name:null):(delete this.node._configured.scriptValue,this.xflowInputNode.data.setValue(this.node.value)))};e.prototype.setScriptValue=function(a){this.xflowInputNode.data.setValue(a)};
e.prototype.toString=function(){return"XML3D.data.ValueDataAdapter"};e.prototype.checkForImproperNesting=function(){for(var c=0;c<this.node.childNodes.length;c++)a.DATA_TYPE.fromString(this.node.childNodes[c].localName)&&XML3D.debug.logError("Parsing error: Value elements cannot be nested!",this.node)};m.exports=e},{"../../base/adapter.js":20,"../../interface/notification.js":49,"../../xflow/interface/constants.js":149,"../../xflow/interface/data.js":150,"../../xflow/interface/graph.js":151}],41:[function(e,
m,l){var d=e("../xflow/interface/request.js").ComputeRequest,b=e("../interface/notification.js"),a=e("../utils/css.js");e=function(a,b,d,h){this.owner=a;this.node=a.node;this.attrName=b;this.dataName=d;this.xflowRequest=this.adapterHandle=null;this.onlyDataTransform=h||!1;this._bindedCallback=this._onChange.bind(this)};e.prototype.clear=function(){this.xflowRequest&&this.xflowRequest.clear();this.xflowRequest=null;this.adapterHandle&&this.adapterHandle.removeListener(this._bindedCallback)};e.prototype.update=
function(){var a=this.owner.getAdapterHandle(this.node.getAttribute(this.attrName),"data",0);a!=this.adapterHandle&&(this.clear(),(this.adapterHandle=a)&&a.addListener(this._bindedCallback));this.updateMatrix()};e.prototype.updateMatrix=function(){this.owner.onTransformChange(this.attrName,this.getMatrix())};e.prototype.getMatrix=function(){var c=XML3D.math.mat4.create();return function(){if(!this.onlyDataTransform){var b=a.getCSSMatrix(this.node);if(b)return a.convertCssToMat4(b)}var k;if(this.adapterHandle&&
(k=this.adapterHandle.getAdapter())){if(k.getXflowNode&&(this.xflowRequest||(this.xflowRequest=new d(k.getXflowNode(),[this.dataName],this._bindedCallback)),b=this.xflowRequest.getResult(),b=b.getOutputData(this.dataName)&&b.getOutputData(this.dataName).getValue()))return b;if(k.getMatrix)return k.getMatrix()}return this.onlyDataTransform?null:c}}();e.prototype._onChange=function(a){if(a.type==b.ADAPTER_VALUE_CHANGED)this.owner.onTransformChange(this.attrName,a.adapterHandle.getAdapter().getMatrix());
else this.updateMatrix()};m.exports=e},{"../interface/notification.js":49,"../utils/css.js":141,"../xflow/interface/request.js":152}],42:[function(e,m,l){if(void 0!==window.XML3D)throw Error("Tried to define the XML3D namespace a second time. Please ensure xml3d.js is only loaded once!");var d=d||{},b=b||{};window.XML3D=d;window.Xflow=b;d.version="DEVELOPMENT SNAPSHOT (26.06.2015 09:48:16 GMT+0200)";d.xml3dNS="http://www.xml3d.org/2009/xml3d";d.xhtmlNS="http://www.w3.org/1999/xhtml";d.webglNS="http://www.xml3d.org/2009/xml3d/webgl";
d._xml3d=document.createElementNS(d.xml3dNS,"xml3d");d._parallel=void 0!=d._parallel?d._parallel:!1;d.xhtml=!(!document.doctype||!(new XMLSerializer).serializeToString(document.doctype).match(/xhtml/i));d.createElement=function(a){return document.createElementNS(d.xml3dNS,a)};d.extend=function(a,c){for(var b in c){var d=c.__lookupGetter__(b),h=c.__lookupSetter__(b);if(d||h)d&&a.__defineGetter__(b,d),h&&a.__defineSetter__(b,h);else if(void 0===c[b])delete a[b];else if("constructor"!==b||a!==window)a[b]=
c[b]}return a};d.isSuperclassOf=function(a,c){for(;c&&c.superclass;){if(c.superclass===a.prototype)return!0;c=c.superclass.constructor}return!1};d.createClass=function(a,c,b){b=b||{};if(c){var k=function(){};k.prototype=c.prototype;a.prototype=new k;a.prototype.constructor=a;a.superclass=c.prototype}a.isSuperclassOf=d.isSuperclassOf.bind(a,a);for(var h in b)a.prototype[h]=b[h];return a};d.debug=e("./utils/debug.js");d.util=e("./utils/misc.js");d.options=e("./utils/options.js");d.shaders=e("./renderer/webgl/materials/urn/shaders.js");
d.resource=e("./base/resourcemanager.js").Resource;d.resource.registerFormat=e("./base/resourcemanager.js").registerFormat;d.webcl=e("./utils/webcl.js").webcl;d.math=e("gl-matrix");d.math.bbox=e("./math/bbox.js");e("./math/math.js")(d.math);window.XML3DBox=e("./types/box.js");d.extend(window,e("./types/data-observer.js"));window.XML3DMatrix=e("./types/matrix.js");window.XML3DRay=e("./types/ray.js");window.XML3DRotation=e("./types/rotation.js");window.XML3DVec3=e("./types/vec3.js");b.registerOperator=
e("./xflow/operator/operator.js").registerOperator;b.constants=e("./xflow/interface/constants.js");d.extend(b,e("./xflow/interface/graph.js"));d.extend(b,e("./xflow/interface/data.js"));b.ComputeRequest=e("./xflow/interface/request.js").ComputeRequest;d.webgl=d.webgl||{};d.webgl.FullscreenQuad=e("./renderer/webgl/base/fullscreenquad.js");d.webgl.BaseRenderPass=e("./renderer/webgl/render-passes/base.js");d.webgl.ForwardRenderPass=e("./renderer/webgl/render-passes/forward.js");d.webgl.BaseRenderTree=
e("./renderer/webgl/render-trees/base.js");d.extend(d.webgl,e("./renderer/webgl/base/rendertarget.js"));e("./xflow/operator/default");m.exports={XML3D:d,Xflow:b}},{"./base/resourcemanager.js":23,"./math/bbox.js":51,"./math/math.js":52,"./renderer/webgl/base/fullscreenquad.js":87,"./renderer/webgl/base/rendertarget.js":90,"./renderer/webgl/materials/urn/shaders.js":107,"./renderer/webgl/render-passes/base.js":112,"./renderer/webgl/render-passes/forward.js":114,"./renderer/webgl/render-trees/base.js":123,
"./types/box.js":134,"./types/data-observer.js":135,"./types/matrix.js":136,"./types/ray.js":137,"./types/rotation.js":138,"./types/vec3.js":139,"./utils/debug.js":143,"./utils/misc.js":144,"./utils/options.js":145,"./utils/webcl.js":147,"./xflow/interface/constants.js":149,"./xflow/interface/data.js":150,"./xflow/interface/graph.js":151,"./xflow/interface/request.js":152,"./xflow/operator/default":169,"./xflow/operator/operator.js":189,"gl-matrix":1}],43:[function(e,m,l){function d(a){if(!(-1<x.indexOf(a))){x.push(a);
var c=h.debug.setup();if(t()){h.debug.logInfo("Configuring",a.querySelectorAll("*").length,"elements");try{g.configure(a)}catch(b){c&&h.debug.logException(b);x.splice(x.indexOf(a),1);return}try{p(a)}catch(f){c&&h.debug.logException(f);x.splice(x.indexOf(a),1);return}q(a,{onConfigured:[]});x.splice(x.indexOf(a),1);v&&v.takeRecords()}else{c&&h.debug.logWarning("Could not initialise WebGL, sorry :-(");a.hasAttribute("onunsupported")&&(c=new Function("event",a.getAttribute("onunsupported")),a.addEventListener("unsupported",
c,!1));if(h.util.dispatchCustomEvent(a,"unsupported",!1,!0,null)){c=document.createElementNS(h.xhtmlNS,"div");a.parentNode.insertBefore(c,a);c.appendChild(a);c.style.display="none";var d=document.createElementNS(h.xhtmlNS,"div");a.hasAttribute("class")&&d.setAttribute("class",a.getAttribute("class"));d.setAttribute("style",a.getAttribute("style"));d.style.border="2px solid red";d.style.fontFamily="verdana,sans-serif";d.style.color="red";d.style.padding="10px";d.style.backgroundColor="rgba(255, 0, 0, 0.3)";
var k=a.getAttribute("width");null!==k&&(d.style.width=k);k=a.getAttribute("height");null!==k&&(d.style.height=k);var k=document.createElement("h3"),e=document.createTextNode("Sorry, your browser doesn't appear to support XML3D.");k.appendChild(e);e=document.createElement("p");e.appendChild(document.createTextNode("Please visit "));var r=document.createElement("a");r.setAttribute("href","http://www.xml3d.org/help");r.appendChild(document.createTextNode("http://www.xml3d.org/help"));e.appendChild(r);
e.appendChild(document.createTextNode(" for more information."));d.appendChild(k);d.appendChild(e);c.parentNode.insertBefore(d,c)}x.splice(x.indexOf(a),1)}}}function b(a){if(!(-1<x.indexOf(a))&&(a._configured=void 0,a.parentNode)){var c=a.parentNode.previousElementSibling,b=a.parentNode.parentNode;b&&c&&"canvas"===c.tagName&&(b.removeChild(a.parentNode),b.removeChild(c))}}function a(a){"xml3d"===a.target.tagName&&d(a.target)}function c(a){"xml3d"===a.target.tagName&&b(a.target)}function f(){if(h.document)h.document.onunload()}
function k(a){for(var c=0;c<a.length;++c){var f=a[c];if("childList"==f.type){for(var h=f.addedNodes,k=h.length;k--;)"xml3d"==h[k].tagName&&d(h[k]);f=f.removedNodes;for(k=f.length;k--;)"xml3d"==f[k].tagName&&b(f[k])}}}var h=e("./global.js").XML3D,g=e("./interface/elements.js").config,q=e("./utils/misc.js").sendAdapterEvent,r=e("./utils/options.js"),n=e("./utils/css.js"),p=e("./renderer/renderer/configure.js"),t=e("./renderer/webgl/base/utils.js").supported;e("./interface/dom.js");e("./utils/debug.js");
(function(){if(navigator.userAgent.match(/(iPad|iPhone|iPod touch)/i)){var a=document.createElement("meta");a.name="format-detection";a.content="telephone=no";document.head.appendChild(a)}})();var x=[],u=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,v=null;document.addEventListener("DOMContentLoaded",function(){r.setOptionsFromQuery();n.init();var b=h.debug.setup();b&&h.debug.logInfo("xml3d.js version: "+h.version);var f=document.querySelectorAll("xml3d");b&&h.debug.logInfo("Found "+
f.length+" xml3d node(s)");for(b=0;b<f.length;b++)d(f[b]);u?(v=new u(k),v.observe(document.documentElement,{childList:!0,subtree:!0})):(document.addEventListener("DOMNodeInserted",a,!1),document.addEventListener("DOMNodeRemoved",c,!1))},!1);window.addEventListener("unload",f,!1);window.addEventListener("reload",f,!1);m.exports=h},{"./global.js":42,"./interface/dom.js":46,"./interface/elements.js":47,"./renderer/renderer/configure.js":66,"./renderer/webgl/base/utils.js":92,"./utils/css.js":141,"./utils/debug.js":143,
"./utils/misc.js":144,"./utils/options.js":145}],44:[function(e,m,l){e("../utils/array.js");var d=e("../base/resourcemanager.js").Resource,b=function(a){if(!a)return!1;switch(a.toLowerCase()){case "true":case "1":return!0;case "false":case "0":return!1;default:return Boolean(a)}};e={};l=function(a){};e.IDHandler=function(a){this.setFromAttribute=function(a,c,b){d.notifyNodeIdChange(b,c,a)};this.desc={get:function(){return this.getAttribute(a)||""},set:function(c){this.setAttribute(a,c)}}};e.StringAttributeHandler=
function(a){this.desc={get:function(){return this.getAttribute(a)||""},set:function(c){this.setAttribute(a,c)}}};e.EnumAttributeHandler=function(a,c){this.init=function(b,d){d[a]=c.d;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,d)};this.setFromAttribute=function(b,d,e,r){b=b.toLowerCase();r[a]=b&&void 0!==c.e[b]?c.e[b]:c.d;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return c.e[this._configured.storage[a]]},set:function(b){this.setAttribute(a,b);var d=this._configured.storage;
b="string"==typeof b?b.toLowerCase():void 0;d[a]=b&&void 0!==c.e[b]?c.e[b]:c.d}}};e.EnumAttributeHandler.prototype=new l;e.EnumAttributeHandler.prototype.constructor=e.EnumAttributeHandler;e.EventAttributeHandler=function(a){var c=a.substring(2);this.init=function(c,b){b[a]=null;c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=function(b,d,e,r){null!=r[a]&&e.removeEventListener(c,r[a]);b?(r[a]=eval("crx = function "+a+"(event){\n  "+b+"\n}"),XML3D.xhtml&&
e.addEventListener(c,r[a],!1)):r[a]=null;return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(b){var d=this._configured.storage;XML3D.xhtml&&d[a]&&this.removeEventListener(c,d[a]);d[a]="function"==typeof b?b:void 0;XML3D.xhtml&&d[a]&&this.addEventListener(c,d[a],!1);return!1}}};e.EventAttributeHandler.prototype=new l;e.EventAttributeHandler.prototype.constructor=e.EventAttributeHandler;e.IntAttributeHandler=function(a,c){this.init=function(b,
d){d[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,d)};this.setFromAttribute=function(b,d,e,r){var n=b.match(/^\d+/);!n||isNaN(+n[0])?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,e),e.setAttribute(a,d),r[a]=c):r[a]=+n[0];e._configured.canvas&&(e._configured.canvas[a]=r[a]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(b){var d=this._configured.storage,e=+b;isNaN(e)?(XML3D.debug.logWarning("Invalid attribute ["+
a+"] value: "+b,this),d[a]=c):d[a]=Math.floor(e);this.setAttribute(a,d[a]+"")}}};e.IntAttributeHandler.prototype=new l;e.IntAttributeHandler.prototype.constructor=e.IntAttributeHandler;e.FloatAttributeHandler=function(a,c){this.init=function(b,d){d[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,d)};this.setFromAttribute=function(b,d,e,r){var n=+b;isNaN(n)?(XML3D.debug.logWarning("Invalid attribute value: "+b,e),e.setAttribute(a,d),r[a]=c):r[a]=n;return!1};this.desc={get:function(){XML3D.flushDOMChanges();
return this._configured.storage[a]},set:function(b){var d=this._configured.storage,e=+b;isNaN(e)?(XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,this),d[a]=c):d[a]=e;this.setAttribute(a,d[a]+"")}}};e.BoolAttributeHandler=function(a,c){this.init=function(b,d){d[a]=c;b.hasAttribute(a)&&this.setFromAttribute(b.getAttribute(a),null,b,d)};this.setFromAttribute=function(c,d,k,e){e[a]=b(c);return!1};this.desc={get:function(){XML3D.flushDOMChanges();return this._configured.storage[a]},set:function(c){var b=
this._configured.storage;b[a]=Boolean(c);this.setAttribute(a,b[a]+"")}}};e.XML3DVec3AttributeHandler=function(a,c){var b=this;this.init=function(c,b){b[a]=null};this.initVec3=function(c,b,d,k,h){b[a]=new window.XML3DVec3(d,k,h,function(b){c.setAttribute(a,b.x+" "+b.y+" "+b.z)})};this.setFromAttribute=function(b,d,h,e){if(!e[a]){var p=!0;this.initVec3(h,e,0,0,0)}d=e[a];e=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);!e||isNaN(+e[1])||isNaN(+e[2])||isNaN(+e[3])?(d._data.set(c),!p&&XML3D.debug.logWarning("Invalid attribute ["+
a+"] value: "+b,h)):(d._data[0]=+e[1],d._data[1]=+e[2],d._data[2]=+e[3]);return!1};this.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c[a]||b.setFromAttribute(this.getAttribute(a),null,this,c);return c[a]},set:function(c){throw Error("Can't set "+this.nodeName+"::"+a+": it's readonly");}}};e.XML3DRotationAttributeHandler=function(a,c){var b=this;this.init=function(c,b){b[a]=null};this.initRotation=function(c,b){b[a]=new window.XML3DRotation(null,null,function(b){c.setAttribute(a,
b.axis.x+" "+b.axis.y+" "+b.axis.z+" "+b.angle)})};this.setFromAttribute=function(b,d,h,e){if(!e[a]){var p=!0;this.initRotation(h,e)}d=e[a];e=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);!e||isNaN(+e[1])||isNaN(+e[2])||isNaN(+e[3])||isNaN(+e[4])?(d._axis._data[0]=c[0],d._axis._data[1]=c[1],d._axis._data[2]=c[2],d._angle=c[3],d._updateQuaternion(),!p&&XML3D.debug.logWarning("Invalid attribute ["+a+"] value: "+b,h)):(d._axis._data[0]=+e[1],d._axis._data[1]=+e[2],d._axis._data[2]=+e[3],d._angle=+e[4],
d._updateQuaternion());return!1};this.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c[a]||b.setFromAttribute(this.getAttribute(a),null,this,c);return c[a]},set:function(c){throw Error("Can't set "+this.nodeName+"::"+a+": it's readonly");}}};var a=function(a){a.init=function(a,c){a._configured.registerMixed()};a.desc={get:function(){XML3D.flushDOMChanges();var c=this._configured.storage;c.value||(c.value=a.parse(this));return c.value},set:function(a){throw Error("Can't set "+
this.nodeName+"::value: it's readonly");}};a.resetValue=function(a){a.value=null}},c=function(a){var c="";for(a=a.firstChild;a;)c+=3==a.nodeType?a.textContent:" ",a=a.nextSibling;return c};e.FloatArrayValueHandler=function(c){a(this)};e.FloatArrayValueHandler.prototype.parse=function(a){return(a=c(a).match(/([+\-0-9eE\.]+)/g))?new Float32Array(a):new Float32Array};e.Float2ArrayValueHandler=e.FloatArrayValueHandler;e.Float3ArrayValueHandler=e.FloatArrayValueHandler;e.Float4ArrayValueHandler=e.FloatArrayValueHandler;
e.Float4x4ArrayValueHandler=e.FloatArrayValueHandler;e.IntArrayValueHandler=function(c){a(this)};e.IntArrayValueHandler.prototype.parse=function(a){return(a=c(a).match(/([+\-0-9]+)/g))?new Int32Array(a):new Int32Array};e.BoolArrayValueHandler=function(c){a(this)};e.BoolArrayValueHandler.prototype.parse=function(a){a=c(a).match(/(true|false|0|1)/ig);return a?(a=Array.map(a,b))?new Uint8Array(a):new Uint8Array:new Uint8Array};e.StringValueHandler=function(c){a(this)};e.StringValueHandler.prototype.parse=
function(a){return a.textContent};e.CanvasStyleHandler=function(a,c){this.init=function(c,b){c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=function(c,b,d,e){d._configured.canvas.setAttribute(a,c)};this.desc={get:function(){return this._configured.canvas.style},set:function(a){}}};e.CanvasClassHandler=function(a){this.init=function(c,b){c._configured.canvas.className="_xml3d";c.hasAttribute(a)&&this.setFromAttribute(c.getAttribute(a),null,c,b)};this.setFromAttribute=
function(c,b,d,e){d._configured.canvas.setAttribute(a,c+" _xml3d")};this.desc={get:function(){return this._configured.canvas.className},set:function(a){this._configured.canvas.className=a}}};m.exports=e},{"../base/resourcemanager.js":23,"../utils/array.js":140}],45:[function(e,m,l){l=e("./methods.js");var d=e("./attributes.js");e=e("./properties.js");var b={triangles:0,0:"triangles",trianglestrips:1,1:"trianglestrips",lines:2,2:"lines",linestrips:3,3:"linestrips",points:4,4:"points"},a={"2d":0,0:"2d",
"1d":1,1:"1d","3d":2,2:"3d"},c={nearest:1,1:"nearest",linear:2,2:"linear","nearest-mipmap-nearest":3,3:"nearest-mipmap-nearest","linear-mipmap-nearest":4,4:"linear-mipmap-nearest","nearest-mipmap-linear":5,5:"nearest-mipmap-linear","linear-mipmap-linear":6,6:"linear-mipmap-linear"},f={clamp:0,0:"clamp",repeat:1,1:"repeat",border:2,2:"border"},k={auto:1,1:"auto",js:2,2:"js",gl:3,3:"gl",cl:4,4:"cl"},h={};h.xml3d={id:{a:d.IDHandler},className:{a:d.CanvasClassHandler,id:"class"},style:{a:d.CanvasStyleHandler},
onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},onload:{a:d.EventAttributeHandler},complete:{p:e.xml3dComplete},height:{a:d.IntAttributeHandler,params:600},width:{a:d.IntAttributeHandler,
params:800},getElementByPoint:{m:l.xml3dGetElementByPoint},generateRay:{m:l.xml3dGenerateRay},getElementByRay:{m:l.xml3dGetElementByRay},getBoundingBox:{m:l.deprecatedGetBoundingBoxWorld},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},getRenderInterface:{m:l.xml3dGetRenderInterface},activeView:{a:d.StringAttributeHandler},_term:void 0};h.compute={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},value:{a:d.StringValueHandler},_term:void 0};
h.data={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},compute:{a:d.StringAttributeHandler},platform:{a:d.EnumAttributeHandler,params:{e:k,d:1}},filter:{a:d.StringAttributeHandler},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},complete:{p:e.XML3DNestedDataContainerTypeComplete},progressLevel:{p:e.XML3DNestedDataContainerTypeProgressLevel},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},
getComputeInfo:{m:l.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:l.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:l.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:d.StringAttributeHandler},_term:void 0};h.dataflow={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},platform:{a:d.EnumAttributeHandler,params:{e:k,d:1}},out:{a:d.StringAttributeHandler},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},
complete:{p:e.XML3DNestedDataContainerTypeComplete},progressLevel:{p:e.XML3DNestedDataContainerTypeProgressLevel},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:l.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:l.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:l.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},
_term:void 0};h.asset={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},complete:{p:e.AssetComplete},progressLevel:{p:e.AssetProgressLevel},src:{a:d.StringAttributeHandler},name:{a:d.StringAttributeHandler},pick:{a:d.StringAttributeHandler},transform:{a:d.StringAttributeHandler},shader:{a:d.StringAttributeHandler},_term:void 0};h.defs={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},
_term:void 0};h.group={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},visible:{a:d.BoolAttributeHandler,
params:!0},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getLocalMatrix:{m:l.groupGetLocalMatrix},getBoundingBox:{m:l.deprecatedGetBoundingBoxWorld},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},transform:{a:d.StringAttributeHandler},shader:{a:d.StringAttributeHandler},_term:void 0};h.mesh={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},
onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},complete:{p:e.XML3DNestedDataContainerTypeComplete},progressLevel:{p:e.XML3DNestedDataContainerTypeProgressLevel},visible:{a:d.BoolAttributeHandler,params:!0},
type:{a:d.EnumAttributeHandler,params:{e:b,d:0}},compute:{a:d.StringAttributeHandler},transform:{a:d.StringAttributeHandler},shader:{a:d.StringAttributeHandler},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:l.deprecatedGetBoundingBoxLocal},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},getOutputNames:{m:l.meshGetOutputNames},getOutputChannelInfo:{m:l.meshGetOutputChannelInfo},getComputeInfo:{m:l.meshGetComputeInfo},getProtoInfo:{m:l.meshGetProtoInfo},
isOutputConnected:{m:l.meshIsOutputConnected},getResult:{m:l.meshGetResult},src:{a:d.StringAttributeHandler},_term:void 0};h.model={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},
onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},complete:{p:e.AssetComplete},progressLevel:{p:e.AssetProgressLevel},visible:{a:d.BoolAttributeHandler,params:!0},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},getBoundingBox:{m:l.deprecatedGetBoundingBoxLocal},getWorldBoundingBox:{m:l.getWorldBoundingBox},getLocalBoundingBox:{m:l.getLocalBoundingBox},src:{a:d.StringAttributeHandler},pick:{a:d.StringAttributeHandler},
transform:{a:d.StringAttributeHandler},shader:{a:d.StringAttributeHandler},_term:void 0};h.transform={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},translation:{a:d.XML3DVec3AttributeHandler,params:[0,0,0]},scale:{a:d.XML3DVec3AttributeHandler,params:[1,1,1]},rotation:{a:d.XML3DRotationAttributeHandler,params:[0,0,1,0]},center:{a:d.XML3DVec3AttributeHandler,params:[0,0,0]},scaleOrientation:{a:d.XML3DRotationAttributeHandler,params:[0,0,1,0]},_term:void 0};h.shader={id:{a:d.IDHandler},
className:{a:d.StringAttributeHandler,id:"class"},onload:{a:d.EventAttributeHandler},onprogress:{a:d.EventAttributeHandler},complete:{p:e.XML3DNestedDataContainerTypeComplete},progressLevel:{p:e.XML3DNestedDataContainerTypeProgressLevel},compute:{a:d.StringAttributeHandler},getOutputNames:{m:l.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:l.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:l.XML3DShaderProviderTypeGetProtoInfo},
isOutputConnected:{m:l.XML3DShaderProviderTypeIsOutputConnected},getResult:{m:l.XML3DShaderProviderTypeGetResult},script:{a:d.StringAttributeHandler},src:{a:d.StringAttributeHandler},_term:void 0};h.light={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},
onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},visible:{a:d.BoolAttributeHandler,params:!0},global:{a:d.BoolAttributeHandler,params:!1},intensity:{a:d.FloatAttributeHandler,params:1},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},shader:{a:d.StringAttributeHandler},_term:void 0};h.lightshader={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onload:{a:d.EventAttributeHandler},
onprogress:{a:d.EventAttributeHandler},complete:{p:e.XML3DNestedDataContainerTypeComplete},progressLevel:{p:e.XML3DNestedDataContainerTypeProgressLevel},compute:{a:d.StringAttributeHandler},getOutputNames:{m:l.XML3DShaderProviderTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DShaderProviderTypeGetOutputChannelInfo},getComputeInfo:{m:l.XML3DShaderProviderTypeGetComputeInfo},getProtoInfo:{m:l.XML3DShaderProviderTypeGetProtoInfo},isOutputConnected:{m:l.XML3DShaderProviderTypeIsOutputConnected},getResult:{m:l.XML3DShaderProviderTypeGetResult},
script:{a:d.StringAttributeHandler},src:{a:d.StringAttributeHandler},_term:void 0};h.script={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},value:{a:d.StringValueHandler},src:{a:d.StringAttributeHandler},name:{a:d.StringAttributeHandler},type:{a:d.StringAttributeHandler},_term:void 0};h.assetmesh={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},match:{a:d.StringAttributeHandler},type:{a:d.EnumAttributeHandler,params:{e:b,
d:0}},compute:{a:d.StringAttributeHandler},filter:{a:d.StringAttributeHandler},includes:{a:d.StringAttributeHandler},shader:{a:d.StringAttributeHandler},transform:{a:d.StringAttributeHandler},platform:{a:d.EnumAttributeHandler,params:{e:k,d:1}},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:l.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:l.XML3DNestedDataContainerTypeGetProtoInfo},
isOutputConnected:{m:l.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:d.StringAttributeHandler},_term:void 0};h.assetdata={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},compute:{a:d.StringAttributeHandler},filter:{a:d.StringAttributeHandler},includes:{a:d.StringAttributeHandler},platform:{a:d.EnumAttributeHandler,params:{e:k,d:1}},getOutputNames:{m:l.XML3DNestedDataContainerTypeGetOutputNames},
getOutputChannelInfo:{m:l.XML3DNestedDataContainerTypeGetOutputChannelInfo},getComputeInfo:{m:l.XML3DNestedDataContainerTypeGetComputeInfo},getProtoInfo:{m:l.XML3DNestedDataContainerTypeGetProtoInfo},isOutputConnected:{m:l.XML3DNestedDataContainerTypeIsOutputConnected},getResult:{m:l.XML3DNestedDataContainerTypeGetResult},src:{a:d.StringAttributeHandler},_term:void 0};h["float"]={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,
params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.FloatArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.float2={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.Float2ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.float3={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,
id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.Float3ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.float4={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.Float4ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},
_term:void 0};h.float4x4={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.Float4x4ArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h["int"]={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,
params:0},value:{a:d.IntArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.int4={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.IntArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.bool={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},
param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},value:{a:d.BoolArrayValueHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.texture={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},name:{a:d.StringAttributeHandler},param:{a:d.BoolAttributeHandler,params:!1},key:{a:d.FloatAttributeHandler,params:0},type:{a:d.EnumAttributeHandler,params:{e:a,d:0}},filterMin:{a:d.EnumAttributeHandler,params:{e:c,d:6}},filterMag:{a:d.EnumAttributeHandler,
params:{e:c,d:2}},filterMip:{a:d.EnumAttributeHandler,params:{e:c,d:1}},wrapS:{a:d.EnumAttributeHandler,params:{e:f,d:0}},wrapT:{a:d.EnumAttributeHandler,params:{e:f,d:0}},wrapU:{a:d.EnumAttributeHandler,params:{e:f,d:0}},borderColor:{a:d.StringAttributeHandler},setScriptValue:{m:l.XML3DDataSourceTypeSetScriptValue},_term:void 0};h.img={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},src:{a:d.StringAttributeHandler},_term:void 0};h.video={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,
id:"class"},src:{a:d.StringAttributeHandler},autoplay:{a:d.BoolAttributeHandler,params:!1},play:{m:l.videoPlay},pause:{m:l.videoPause},_term:void 0};h.view={id:{a:d.IDHandler},className:{a:d.StringAttributeHandler,id:"class"},onclick:{a:d.EventAttributeHandler},ondblclick:{a:d.EventAttributeHandler},onmousedown:{a:d.EventAttributeHandler},onmouseup:{a:d.EventAttributeHandler},onmouseover:{a:d.EventAttributeHandler},onmousemove:{a:d.EventAttributeHandler},onmouseout:{a:d.EventAttributeHandler},onkeypress:{a:d.EventAttributeHandler},
onkeydown:{a:d.EventAttributeHandler},onkeyup:{a:d.EventAttributeHandler},visible:{a:d.BoolAttributeHandler,params:!0},position:{a:d.XML3DVec3AttributeHandler,params:[0,0,0]},orientation:{a:d.XML3DRotationAttributeHandler,params:[0,0,1,0]},fieldOfView:{a:d.FloatAttributeHandler,params:.785398},getWorldMatrix:{m:l.XML3DGraphTypeGetWorldMatrix},setDirection:{m:l.viewSetDirection},setUpVector:{m:l.viewSetUpVector},lookAt:{m:l.viewLookAt},getDirection:{m:l.viewGetDirection},getUpVector:{m:l.viewGetUpVector},
getViewMatrix:{m:l.viewGetViewMatrix},perspective:{a:d.StringAttributeHandler},_term:void 0};m.exports={classInfo:h,MeshTypes:b,FilterTypes:c,TextureTypes:a,WrapTypes:f,PlatformTypes:k,DataFieldTypes:{"float ":0,0:"float ","float2 ":1,1:"float2 ",float3:2,2:"float3",float4:3,3:"float4",float4x4:4,4:"float4x4","int":10,10:"int",int4:11,11:"int4",bool:20,20:"bool",texture:30,30:"texture"},DataChannelOrigin:{"origin_value ":0,0:"origin_value ",origin_child:1,1:"origin_child",origin_source:2,2:"origin_source",
origin_compute:3,3:"origin_compute",origin_proto:4,4:"origin_proto"}}},{"./attributes.js":44,"./methods.js":48,"./properties.js":50}],46:[function(e,m,l){var d=e("./elements.js").config,b=e("./configuration.js").classInfo;e={};var a=document.getElementById;e.getElementById=function(c){var b=a.call(this,c);if(b)return b;for(var b=this.getElementsByTagName("*"),f=0;f<b.length;f++){var d=b[f];if(d.getAttribute("id")===c)return d}return null};var c=document.createElementNS;e.createElementNS=function(a,
f){var e=c.call(this,a,f);(a==XML3D.xml3dNS||b[f.toLowerCase()])&&d.element(e);return e};var f=document.createElement;e.createElement=function(a){var c=f.call(this,a);b[a.toLowerCase()]&&d.element(c);return c};XML3D.extend(window.document,e)},{"./configuration.js":45,"./elements.js":47}],47:[function(e,m,l){function d(d){for(var e=0;e<d.length;++e){var k=d[e];if("attributes"===k.type){var g=k,r=g.target;if(k=r._configured){var q=!1,n=k.handlers[g.attributeName]||k.handlers[g.attributeName.toLowerCase()];
n&&n.setFromAttribute&&(q=r.getAttribute(g.attributeName),q=n.setFromAttribute(q,g.oldValue,r,k.storage));q||(g=new h.NotificationWrapper(g,h.VALUE_MODIFIED,g.target),k.notify(g))}}else if("childList"===k.type){r=k.addedNodes;for(g=0;g<r.length;g++)if(r[g].nodeType===Node.TEXT_NODE)b(k);else{var q=r[g],p=k;if(n=p.target._configured)x.element(q),f(q),q=new h.NotificationWrapper(p,h.NODE_INSERTED,q),n.notify(q)}r=k.removedNodes;for(g=0;g<r.length;g++)if(r[g].nodeType!==Node.TEXT_NODE&&(n=r[g],q=k,p=
q.target._configured)){var t=new h.NotificationWrapper(q,h.NODE_REMOVED,n);p.notify(t);n._configured?(t.type=h.THIS_REMOVED,c(n,t),a(n)):n.nodeType===Node.TEXT_NODE&&b(q)}}else"characterData"==k.type&&b(k)}}function b(a){for(var c=a.target;!c._configured&&c.parentElement;)c=c.parentElement;var b=c._configured;b&&(a=new h.NotificationWrapper(a,h.VALUE_MODIFIED,c),void 0!==b.handlers.value&&b.handlers.value.resetValue(b.storage),b.notify(a))}function a(c){q.notifyNodeIdChange(c,c.id,null);for(c=c.firstElementChild;c;)a(c),
c=c.nextElementSibling}function c(a,b){a._configured&&(a._configured.notify(b),a._configured.remove(b));for(var f=a.firstElementChild;f;)c(f,b),f=f.nextElementSibling}function f(a){for(var c=a.firstElementChild;c;)f(c),c=c.nextElementSibling;q.notifyNodeIdChange(a,null,a.id)}function k(a,c,b){var f={get:function(){return b[a]}};try{Object.defineProperty(c,a,f)}catch(d){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+a)}}var h=e("./notification.js"),g=e("./configuration.js").classInfo;e("../utils/array.js");
var q=e("../base/resourcemanager.js").Resource;e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var r;e?r=new e(d):(XML3D.debug.logError("XML3D requires MutationObservers, which your browser does not support. Please consider upgrading to a newer version."),r={takeRecords:function(){return[]},observe:function(a,c){}});XML3D.flushDOMChanges=function(){var a=r.takeRecords();a.length&&d(a)};var n=function(a){a&&(this.element=a,this.handlers=null,this.storage={},this.adapters=
{},r.observe(a,{childList:!0,attributes:!0,attributeOldValue:!0}))};n.prototype.registerAttributes=function(a){var c=this.element,b=c instanceof HTMLElement,f=b?"_html":"_xml",d=f+"handlers",f=f+"proto",e=!!c.__proto__;a._cache||(a._cache={});if(!a._cache[d]){var k;e&&(k=function(){},k.prototype=c.__proto__,k=new k);var h={},g;for(g in a)if("_cache"!=g)if(void 0===a[g])k&&delete k[g];else if(void 0!==a[g].a){var r=a[g].id||g,q=new a[g].a(r,a[g].params);h[b?r.toLowerCase():r]=q;if(k)try{Object.defineProperty(k,
g,q.desc)}catch(n){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+g)}}else if(void 0!==a[g].m)k&&(k[g]=a[g].m);else if(void 0!==a[g].p){if(k)try{Object.defineProperty(k,g,a[g].p)}catch(p){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+g)}}else XML3D.debug.logError("Can't configure "+c.nodeName+"::"+g);a._cache[d]=h;a._cache[f]=k}this.handlers=a._cache[d];if(e)for(g in c.__proto__=a._cache[f],a)"_cache"!=g&&a[g]&&void 0!==a[g].a&&(r=a[g].id||g,q=this.handlers[b?r.toLowerCase():
r],q.init&&q.init(c,this.storage),delete c[g]);else for(g in a)if("_cache"!=g)if(void 0===a[g])delete c[g];else if(void 0!==a[g].a){r=a[g].id||g;q=this.handlers[b?r.toLowerCase():r];q.init&&q.init(c,this.storage);try{Object.defineProperty(c,g,q.desc)}catch(t){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+g)}}else if(void 0!==a[g].m)c[g]=a[g].m;else if(void 0!==a[g].p)try{Object.defineProperty(c,g,a[g].p)}catch(x){XML3D.debug.logWarning("Can't configure "+c.nodeName+"::"+g)}return c};n.prototype.registerMixed=
function(){r.observe(this.element,{childList:!0,attributes:!0,attributeOldValue:!0,characterData:!0,subtree:!0})};n.prototype.notify=function(a){var c=this.adapters,b;for(b in c)try{c[b].notifyChanged(a)}catch(f){XML3D.debug.logException(f)}};n.prototype.remove=function(a){for(var c in this.adapters){a=this.adapters[c];if(a.onDispose)a.onDispose();a.clearAdapterHandles&&a.clearAdapterHandles()}this.adapters={};for(c in this.handlers)a=this.handlers[c],a.remove&&a.remove()};n.prototype.toString=function(){return"ElementHandler ("+
this.element.nodeName+", id: "+this.element.id+")"};var p="clientHeight clientLeft clientTop clientWidth offsetHeight offsetLeft offsetTop offsetWidth".split(" "),t=function(a){n.call(this,a);var c=document.createElement("canvas");c.width=800;c.height=600;this.canvas=c;for(var b in p)k(p[b],a,c);a.getBoundingClientRect=function(){return c.getBoundingClientRect()}};XML3D.createClass(t,n);var x={element:function(a){if(void 0===a._configured){var c=g[a.localName];if(void 0===c)XML3D.debug.logInfo("Unrecognised element "+
a.localName);else{a._configured="xml3d"==a.localName?new t(a):new n(a);a._configured.registerAttributes(c);try{void 0==a.style&&(a.style=null)}catch(b){}c=a.firstElementChild;for(q.notifyNodeIdChange(a,null,a.getAttribute("id"));c;)x.element(c),c=c.nextElementSibling}}},configure:function(a){Array.isArray(a)?Array.forEach(a,function(a){x.element(a)}):x.element(a)}};m.exports={ElementHandler:n,XML3DHandler:t,config:x}},{"../base/resourcemanager.js":23,"../utils/array.js":140,"./configuration.js":45,
"./notification.js":49}],48:[function(e,m,l){function d(a,c){var b={},f;for(f in c){var d=c[f],e=a.getOutputData(d)&&a.getOutputData(d).getValue();e&&(b[d]=e)}return b}var b=e("../base/resourcemanager.js").Resource,a=e("../utils/misc.js").sendAdapterEvent,c=e("../utils/misc.js").callAdapterFunc,f={xml3dGetElementByRay:function(a,c,b){XML3D.flushDOMChanges();var f=this._configured.adapters||{},d;for(d in f)if(f[d].getElementByRay)return f[d].getElementByRay(a,c,b);return null},viewGetDirection:function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,
0,-1))},viewSetPosition:function(a){this.position=a}},k=XML3D.math.vec3.create(),h=XML3D.math.vec3.create(),g=XML3D.math.vec3.create();f.viewSetDirection=function(a){a=a||new window.XML3DVec3(0,0,-1);a=a.normalize();var c=this.orientation.rotateVec3(new window.XML3DVec3(0,1,0)),c=c.normalize();XML3D.math.vec3.cross(k,a._data,c._data);XML3D.math.vec3.length(k)||(k=this.orientation.rotateVec3(new window.XML3DVec3(1,0,0))._data);XML3D.math.vec3.cross(h,k,a._data);XML3D.math.vec3.negate(g,a._data);a=
XML3D.math.quat.create();XML3D.math.quat.setFromBasis(k,h,g,a);this.orientation._setQuaternion(a)};f.viewSetUpVector=function(a){a=a||new window.XML3DVec3(0,1,0);a=a.normalize();var c=new window.XML3DRotation;c.setRotation(new window.XML3DVec3(0,1,0),a);c=this.orientation.multiply(c);c=c.normalize();this.orientation.set(c)};f.viewGetUpVector=function(){return this.orientation.rotateVec3(new window.XML3DVec3(0,1,0))};f.viewLookAt=function(a){this.setDirection(a.subtract(this.position))};f.viewGetViewMatrix=
function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getViewMatrix)return a[c].getViewMatrix();a=this.position;c=this.orientation;var b=c.axis;return(new window.XML3DMatrix).translate(a.x,a.y,a.z).rotateAxisAngle(b.x,b.y,b.z,c.angle).inverse()};f.xml3dGetElementByPoint=function(a,c,b,f){XML3D.flushDOMChanges();var d=this._configured.adapters||{},e;for(e in d)if(d[e].getElementByPoint)return d[e].getElementByPoint(a,c,b,f);return null};f.xml3dGenerateRay=function(a,
c){var b=this._configured.adapters||{},f;for(f in b)if(b[f].generateRay)return b[f].generateRay(a,c);return new window.XML3DRay};f.deprecatedGetBoundingBoxWorld=function(){XML3D.debug.logWarning("getBoundingBox is deprecated and will be removed in a future version! Please use getLocalBoundingBox or getWorldBoundingBox instead.");return f.getWorldBoundingBox.call(this)};f.deprecatedGetBoundingBoxLocal=function(){XML3D.debug.logWarning("getBoundingBox is deprecated and will be removed in a future version! Please use getLocalBoundingBox or getWorldBoundingBox instead.");
return f.getLocalBoundingBox.call(this)};f.groupGetLocalMatrix=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getLocalMatrix)return a[c].getLocalMatrix();return new window.XML3DMatrix};f.getWorldBoundingBox=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getWorldBoundingBox)return a[c].getWorldBoundingBox();return new window.XML3DBox};f.getLocalBoundingBox=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||
{},c;for(c in a)if(a[c].getLocalBoundingBox)return a[c].getLocalBoundingBox();return new window.XML3DBox};f.xml3dGetRenderInterface=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getRenderInterface)return a[c].getRenderInterface();return{}};f.XML3DGraphTypeGetWorldMatrix=function(){XML3D.flushDOMChanges();var a=this._configured.adapters||{},c;for(c in a)if(a[c].getWorldMatrix)return a[c].getWorldMatrix();return new window.XML3DMatrix};f.videoPlay=function(){a(this,
{play:[]})};f.videoPause=function(){a(this,{pause:[]})};f.XML3DNestedDataContainerTypeGetOutputNames=f.XML3DShaderProviderTypeGetOutputNames=f.meshGetOutputNames=function(){XML3D.flushDOMChanges();var a=b.getAdapter(this,"data");return a?a.getOutputNames():null};f.XML3DNestedDataContainerTypeGetResult=f.XML3DShaderProviderTypeGetResult=f.meshGetResult=function(a){XML3D.flushDOMChanges();var c=b.getAdapter(this,"data");return c?(a=c.getComputeResult(a))?new window.XML3DDataResult(a):null:null};f.XML3DNestedDataContainerTypeGetOutputChannelInfo=
f.XML3DShaderProviderTypeGetOutputChannelInfo=f.meshGetOutputChannelInfo=function(a){XML3D.flushDOMChanges();var c=b.getAdapter(this,"data");return c?(a=c.getOutputChannelInfo(a))?new window.XML3DDataChannelInfo(a.type,a.origin,a.originalName,a.seqLength,a.seqMinKey,a.seqMaxKey):null:null};f.XML3DNestedDataContainerTypeGetComputeInfo=f.XML3DShaderProviderTypeGetComputeInfo=f.meshGetComputeInfo=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+"::getComputeInfo is not implemeted yet.");
return null};f.XML3DNestedDataContainerTypeGetProtoInfo=f.XML3DShaderProviderTypeGetProtoInfo=f.meshGetProtoInfo=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+"::getProtoInfo is not implemeted yet.");return null};f.XML3DNestedDataContainerTypeIsOutputConnected=f.XML3DShaderProviderTypeIsOutputConnected=f.meshIsOutputConnected=function(){XML3D.flushDOMChanges();XML3D.debug.logError(this.nodeName+"::isOutputConnected is not implemeted yet.");return!1};f.dataAddOutputFieldListener=
function(a,b){XML3D.flushDOMChanges();if(!a)return!1;"String"===Object.prototype.toString.call(a).slice(8,-1)&&(a=[a]);if(0==a.length)return!1;var f=c(this,{getComputeRequest:[a,function(c,f){b(d(c.getResult(),a))}]});if(0==f.length)return!1;f=f[0].getResult();f=d(f,a);Object.keys(f).length&&b(f);return!0};f.XML3DDataSourceTypeSetScriptValue=function(a){var c=this._configured;c&&("[value set by script]"!=this.textContent&&(this.textContent="[value set by script]"),XML3D.flushDOMChanges(),c.scriptValue=
a,(c=b.getAdapter(this,"data"))&&c.setScriptValue(a))};m.exports=f},{"../base/resourcemanager.js":23,"../utils/misc.js":144}],49:[function(e,m,l){e={NODE_INSERTED:0,VALUE_MODIFIED:1,NODE_REMOVED:2,THIS_REMOVED:3,ADAPTER_HANDLE_CHANGED:4,ADAPTER_VALUE_CHANGED:5,Notification:function(d){this.type=d}};e.Notification.prototype.toString=function(){return"Notification (type:"+this.type+")"};e.NotificationWrapper=function(d,b,a){this.mutation=d;this.type=b;this.affectedNode=a};XML3D.createClass(e.NotificationWrapper,
e.Notification);e.NotificationWrapper.prototype.toString=function(){return"NotificationWrapper (type:"+this.type+", wrapped: "+this.mutation+")"};e.AdapterHandleNotification=function(d,b){this.adapterHandle=d;this.type=b};XML3D.createClass(e.AdapterHandleNotification,e.Notification);e.AdapterHandleNotification.prototype.toString=function(){return"AdapterHandleNotification (type:"+this.type+")"};e.ConnectedAdapterNotification=function(d,b){this.adapter=d.adapterHandle.getAdapter();this.key=b;this.url=
d.adapterHandle.url;this.type=d.type;this.handleStatus=d.adapterHandle.status};XML3D.createClass(e.ConnectedAdapterNotification,e.Notification);e.ConnectedAdapterNotification.prototype.toString=function(){return"ConnectedAdapterNotification (type:"+this.type+", key: "+this.key+")"};m.exports=e},{}],50:[function(e,m,l){m.exports={XML3DNestedDataContainerTypeComplete:{get:function(){XML3D.flushDOMChanges();var d=this._configured.adapters||{},b;for(b in d)if(d[b].getDataComplete)return d[b].getDataComplete();
return!1},set:function(){}},XML3DNestedDataContainerTypeProgressLevel:{get:function(){XML3D.flushDOMChanges();var d=this._configured.adapters||{},b;for(b in d)if(d[b].getDataProgressLevel)return d[b].getDataProgressLevel();return!1},set:function(){}},AssetComplete:{get:function(){XML3D.flushDOMChanges();var d=this._configured.adapters||{},b;for(b in d)if(d[b].getAssetComplete)return d[b].getAssetComplete();return!1},set:function(){}},AssetProgressLevel:{get:function(){XML3D.flushDOMChanges();var d=
this._configured.adapters||{},b;for(b in d)if(d[b].getAssetProgressLevel)return d[b].getAssetProgressLevel();return!1},set:function(){}},xml3dComplete:{get:function(){XML3D.flushDOMChanges();var d=this._configured.adapters||{},b;for(b in d)if(d[b].getComplete)return d[b].getComplete();return!1},set:function(){}}}},{}],51:[function(e,m,l){(function(d){var b={create:function(){var a=new Float32Array(6);a[0]=Number.MAX_VALUE;a[1]=Number.MAX_VALUE;a[2]=Number.MAX_VALUE;a[3]=-Number.MAX_VALUE;a[4]=-Number.MAX_VALUE;
a[5]=-Number.MAX_VALUE;return a},clone:function(a){var c=new Float32Array(6);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];return c},copy:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];return a},copyMin:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},copyMax:function(a,c){a[0]=c[3];a[1]=c[4];a[2]=c[5];return a},extendWithBox:function(a,c){for(var b=0;3>b;b++)a[b]=Math.min(c[b],a[b]),a[b+3]=Math.max(c[b+3],a[b+3]);return a},empty:function(a){a[0]=Number.MAX_VALUE;
a[1]=Number.MAX_VALUE;a[2]=Number.MAX_VALUE;a[3]=-Number.MAX_VALUE;a[4]=-Number.MAX_VALUE;a[5]=-Number.MAX_VALUE;return a},isEmpty:function(a){return a[0]>a[3]||a[1]>a[4]||a[2]>a[5]},center:function(a,c){a[0]=.5*(c[0]+c[3]);a[1]=.5*(c[1]+c[4]);a[2]=.5*(c[2]+c[5]);return a},size:function(a,c){a[0]=c[3]-c[0];a[1]=c[4]-c[1];a[2]=c[5]-c[2];return a},halfSize:function(a,c){a[0]=.5*(c[3]-c[0]);a[1]=.5*(c[4]-c[1]);a[2]=.5*(c[5]-c[2]);return a},transform:function(a,c,f){if(f[0]>f[3]||f[1]>f[4]||f[2]>f[5])b.copy(a,
f);else{f=b.clone(f);if(0==c[3]&&0==c[7]&&0==c[11]&&1==c[15]){for(var d=0;3>d;d++){a[d]=a[d+3]=c[12+d];for(var e=0;3>e;e++){var g,q;g=c[4*e+d]*f[e];q=c[4*e+d]*f[e+3];g<q?(a[d]+=g,a[d+3]+=q):(a[d]+=q,a[d+3]+=g)}}return a}throw Error("Matrix is not affine");}}};b.transform2=function(){var a=XML3D.math.mat4.create(),c=XML3D.math.vec3.create(),f=XML3D.math.vec3.create();return function(d,e,g){b.center(c,g);b.halfSize(f,g);XML3D.math.mat4.copy(a,e);a.set([0,0,0,1],12);for(g=0;16>g;g++)a[g]=Math.abs(a[g]);
XML3D.math.vec3.transformMat4(f,f,a);XML3D.math.vec3.transformMat4(c,c,e);d[0]=c[0]-f[0];d[1]=c[1]-f[1];d[2]=c[2]-f[2];d[3]=c[0]+f[0];d[4]=c[1]+f[1];d[5]=c[2]+f[2];return d}}();b.longestSide=function(a){var c=Math.abs(a[3]-a[0]),b=Math.abs(a[4]-a[1]);a=Math.abs(a[5]-a[2]);return Math.max(c,Math.max(b,a))};b.intersects=function(a,c,b){var d=1/c._direction.x,e=1/c._direction.y,g=1/c._direction.z,q=(a[0]-c._origin.x)*d,d=(a[3]-c._origin.x)*d,r=(a[1]-c._origin.y)*e,e=(a[4]-c._origin.y)*e,n=(a[2]-c._origin.z)*
g;c=(a[5]-c._origin.z)*g;a=Math.max(Math.max(Math.min(q,d),Math.min(r,e)),Math.min(n,c));q=Math.min(Math.min(Math.max(q,d),Math.max(r,e)),Math.max(n,c));if(void 0===b||void 0===b.dist)return 0<q&&a<=q;if(0>q||a>q)return b.dist=Number.MAX_VALUE,!1;b.dist=a;return!0};b.asXML3DBox=function(a){var c=new window.XML3DBox;c.min._data[0]=a[0];c.min._data[1]=a[1];c.min._data[2]=a[2];c.max._data[0]=a[3];c.max._data[1]=a[4];c.max._data[2]=a[5];return c};b.fromXML3DBox=function(a){var c=new Float32Array(6);c[0]=
a.min._data[0];c[1]=a.min._data[1];c[2]=a.min._data[2];c[3]=a.max._data[0];c[4]=a.max._data[1];c[5]=a.max._data[2];return c};b.str=function(a){return"bbox("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};b.EMPTY_BOX=b.create();d.exports=b})(m)},{}],52:[function(e,m,l){m.exports=function(d){d.vec3.reciprocal=function(a,b){b||(b=a);b[0]=1/a[0];b[1]=1/a[1];b[2]=1/a[2];return b};d.mat4.multiplyOffsetVec3=function(a,b,d,e,g){g||(g=d);e||(e=0);var q=d[e+0],r=d[e+1];d=d[e+2];g[0]=a[b+0]*q+a[b+
4]*r+a[b+8]*d+a[b+12];g[1]=a[b+1]*q+a[b+5]*r+a[b+9]*d+a[b+13];g[2]=a[b+2]*q+a[b+6]*r+a[b+10]*d+a[b+14];return g};d.mat4.multiplyOffsetDirection=function(a,b,d,e,g){g||(g=d);e||(e=0);var q=d[e+0],r=d[e+1];d=d[e+2];g[0]=a[b+0]*q+a[b+4]*r+a[b+8]*d;g[1]=a[b+1]*q+a[b+5]*r+a[b+9]*d;g[2]=a[b+2]*q+a[b+6]*r+a[b+10]*d;return g};XML3D.math.mat4.identity(XML3D.math.mat4.create());var b=XML3D.math.mat4.create(),a=XML3D.math.vec3.create();d.mat4.makeTransformXflow=function(c,f,d,e,g,q){XML3D.math.mat4.identity(q);
c&&XML3D.math.mat4.translate(q,q,c);e&&XML3D.math.mat4.translate(q,q,e);f&&(XML3D.math.mat4.fromRotationTranslation(b,[f[0],f[1],f[2],f[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));g&&(XML3D.math.mat4.fromRotationTranslation(b,[g[0],g[1],g[2],g[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));d&&XML3D.math.mat4.scale(q,q,d);g&&(XML3D.math.mat4.fromRotationTranslation(b,[g[0],g[1],g[2],-g[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));e&&XML3D.math.mat4.translate(q,q,XML3D.math.vec3.negate(a,e))};d.mat4.makeTransformInvXflow=
function(c,f,d,e,g,q){XML3D.math.mat4.identity(q);e&&XML3D.math.mat4.translate(q,q,e);g&&(XML3D.math.mat4.fromRotationTranslation(b,[g[0],g[1],g[2],g[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));d&&XML3D.math.mat4.scale(q,q,XML3D.math.vec3.reciprocal(d,a));g&&(XML3D.math.mat4.fromRotationTranslation(b,[g[0],g[1],g[2],-g[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));f&&(XML3D.math.mat4.fromRotationTranslation(b,[f[0],f[1],f[2],-f[3]],[0,0,0]),XML3D.math.mat4.multiply(q,q,b));e&&XML3D.math.mat4.translate(q,
q,XML3D.math.vec3.negate(a,e));c&&XML3D.math.mat4.translate(q,q,XML3D.math.vec3.negate(a,c))};d.mat4.multiplyOffset=function(a,b,d,e,g,q){var r=g[q+0],n=g[q+1],p=g[q+2],t=g[q+3],x=g[q+4],u=g[q+5],l=g[q+6],w=g[q+7],z=g[q+8],m=g[q+9],E=g[q+10],C=g[q+11],A=g[q+12],B=g[q+13],D=g[q+14];g=g[q+15];q=d[e+0];var H=d[e+1],F=d[e+2],G=d[e+3],I=d[e+4],K=d[e+5],L=d[e+6],M=d[e+7],N=d[e+8],J=d[e+9],O=d[e+10],P=d[e+11],Q=d[e+12],R=d[e+13],S=d[e+14];d=d[e+15];a[b+0]=q*r+H*x+F*z+G*A;a[b+1]=q*n+H*u+F*m+G*B;a[b+2]=q*
p+H*l+F*E+G*D;a[b+3]=q*t+H*w+F*C+G*g;a[b+4]=I*r+K*x+L*z+M*A;a[b+5]=I*n+K*u+L*m+M*B;a[b+6]=I*p+K*l+L*E+M*D;a[b+7]=I*t+K*w+L*C+M*g;a[b+8]=N*r+J*x+O*z+P*A;a[b+9]=N*n+J*u+O*m+P*B;a[b+10]=N*p+J*l+O*E+P*D;a[b+11]=N*t+J*w+O*C+P*g;a[b+12]=Q*r+R*x+S*z+d*A;a[b+13]=Q*n+R*u+S*m+d*B;a[b+14]=Q*p+R*l+S*E+d*D;a[b+15]=Q*t+R*w+S*C+d*g};d.quat.slerpOffset=function(a,b,d,e,g,q,r,n){q||(q=a);var p=b+1,t=b+2,x=b+3,u=e+1,l=e+2,w=e+3,z=r+1,m=r+2,E=r+3,C=a[b]*d[e]+a[p]*d[u]+a[t]*d[l]+a[x]*d[w],A;if(.01>1-Math.abs(C))A=1-
g;else{var B=Math.acos(Math.abs(C)),D=Math.sin(B);A=Math.sin(B*(1-g))/D;g=Math.sin(B*g)/D}n&&0>C&&(A=-A);q[r]=A*a[b]+g*d[e];q[z]=A*a[p]+g*d[u];q[m]=A*a[t]+g*d[l];q[E]=A*a[x]+g*d[w]};d.vec3.transformDirection=function(a,b,d){var e=b[0],g=b[1];b=b[2];a[0]=d[0]*e+d[4]*g+d[8]*b;a[1]=d[1]*e+d[5]*g+d[9]*b;a[2]=d[2]*e+d[6]*g+d[10]*b;return a};d.quat.setFromMat3=function(a,b){var d=a[0]+a[4]+a[8];0<d?(d=2*Math.sqrt(d+1),b[0]=(a[7]-a[5])/d,b[1]=(a[2]-a[6])/d,b[2]=(a[3]-a[1])/d,b[3]=.25*d):a[0]>a[4]&&a[0]>
a[8]?(d=2*Math.sqrt(1+a[0]-a[4]-a[8]),b[3]=(a[7]-a[5])/d,b[0]=.25*d,b[1]=(a[1]+a[3])/d,b[2]=(a[2]+a[6])/d):a[4]>a[8]?(d=2*Math.sqrt(1+a[4]-a[0]-a[8]),b[3]=(a[2]-a[6])/d,b[0]=(a[1]+a[3])/d,b[1]=.25*d,b[2]=(a[5]+a[7])/d):(d=2*Math.sqrt(1+a[8]-a[0]-a[4]),b[3]=(a[3]-a[1])/d,b[0]=(a[2]+a[6])/d,b[1]=(a[5]+a[7])/d,b[2]=.25*d)};d.quat.setFromBasis=function(a,b,d,e){var g=1/XML3D.math.vec3.length(a),q=1/XML3D.math.vec3.length(b),r=1/XML3D.math.vec3.length(d),n=XML3D.math.mat3.create();n[0]=a[0]*g;n[1]=b[0]*
q;n[2]=d[0]*r;n[3]=a[1]*g;n[4]=b[1]*q;n[5]=d[1]*r;n[6]=a[2]*g;n[7]=b[2]*q;n[8]=d[2]*r;XML3D.math.quat.setFromMat3(n,e)}}},{}],53:[function(e,m,l){var d=e("../../../base/adapter.js").NodeAdapter,b=function(a,c){d.call(this,a,c)};XML3D.createClass(b,d);b.prototype.getShader=function(){return null};b.prototype.getParentRenderAdapter=function(){return this.factory.getAdapter(this.node.parentNode,b)};b.prototype.initElement=function(a){this.factory.getAdapter(a);this.initChildElements(a)};b.prototype.initChildElements=
function(a){for(a=a.firstElementChild;a;)this.initElement(a),a=a.nextElementSibling};b.prototype.applyTransformMatrix=function(a){return a};b.prototype.getScene=function(){return this.factory.renderer.scene};m.exports=b},{"../../../base/adapter.js":20}],54:[function(e,m,l){var d=e("./base.js");e=function(b,a){d.call(this,b,a)};XML3D.createClass(e,d);m.exports=e},{"./base.js":53}],55:[function(e,m,l){var d=e("../../../base/adapter.js").NodeAdapterFactory;l=e("../../../data/adapter/factory.js");e("../../../base/formathandler.js").xml3dFormatHandler.registerFactoryClass(l);
l=function(a){d.call(this,"webgl",a);this.type="RenderAdapterFactory"};XML3D.createClass(l,d);l.prototype.aspect="webgl";var b={xml3d:e("./xml3d.js"),view:e("./view.js"),defs:e("./defs.js"),mesh:e("./mesh.js"),model:e("./model.js"),shader:e("./shader.js"),group:e("./group.js"),light:e("./light.js"),lightshader:e("./lightshader.js")};l.prototype.createAdapter=function(a){var c=b[a.localName];return void 0!==c?new c(this,a):null};l.prototype.setScene=function(a){this.scene=a};l.prototype.getScene=function(){return this.scene};
l.prototype.setRenderer=function(a){this.renderer=a};l.prototype.getRenderer=function(){return this.renderer};m.exports=l},{"../../../base/adapter.js":20,"../../../base/formathandler.js":22,"../../../data/adapter/factory.js":33,"./defs.js":54,"./group.js":56,"./light.js":57,"./lightshader.js":58,"./mesh.js":59,"./model.js":60,"./shader.js":61,"./view.js":63,"./xml3d.js":64}],56:[function(e,m,l){var d=e("./transformable.js"),b=e("../../../interface/notification.js");e=function(a,c){d.call(this,a,c,
!0,!0);this.createRenderNode()};XML3D.createClass(e,d);l=e.prototype;l.createRenderNode=function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,visible:this.node.visible,name:this.node.id});this.updateLocalMatrix();this.updateShaderHandler();a=XML3D.math.bbox.create();this.renderNode.setWorldSpaceBoundingBox(a)};l.notifyChanged=function(a){d.prototype.notifyChanged.call(this,a);if(a.type!==b.VALUE_MODIFIED)return this.handleConnectedAdapterEvent(a)};
l.handleConnectedAdapterEvent=function(a){switch(a.type){case b.NODE_INSERTED:this.initElement(a.mutation.target);break;case b.THIS_REMOVED:this.dispose();break;case b.ADAPTER_HANDLE_CHANGED:break;case b.NODE_REMOVED:break;default:XML3D.debug.logWarning("Unhandled connected adapter event for "+a.key+" in shader adapter")}};l.dispose=function(){this.traverse(function(a){a&&a.destroy&&a.dispose()});this.getRenderNode().remove();this.clearAdapterHandles()};l.getWorldBoundingBox=function(){var a=XML3D.math.bbox.create();
this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)};l.getLocalBoundingBox=function(){var a=XML3D.math.mat4.create();return function(){var c=new window.XML3DBox;if(!this.renderNode.visible)return c;Array.prototype.forEach.call(this.node.childNodes,function(a){a.getLocalBoundingBox&&a.visible&&c.extend(a.getLocalBoundingBox())});this.renderNode.getLocalMatrix(a);var b=XML3D.math.bbox.fromXML3DBox(c);XML3D.math.bbox.transform(b,a,b);return XML3D.math.bbox.asXML3DBox(b)}}();
l.getLocalMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getLocalMatrix(a._data);return a};l.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldMatrix(a._data);return a};m.exports=e},{"../../../interface/notification.js":49,"./transformable.js":62}],57:[function(e,m,l){var d=e("./transformable.js"),b=e("../../../interface/notification.js");e=function(a,c){d.call(this,a,c,!1,!0);this.updateLightShader();this.createRenderNode()};XML3D.createClass(e,d);e.prototype.createRenderNode=
function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode(),c=this.getLightShader();this.renderNode=this.factory.getScene().createRenderLight({light:{type:c?c.getLightType():null,data:c?c.getDataNode():null},parent:a,shader:c,visible:this.node.visible?void 0:!1,localIntensity:this.node.intensity})};e.prototype.notifyChanged=function(a){switch(a.type){case b.THIS_REMOVED:this.dispose();break;case b.ADAPTER_HANDLE_CHANGED:if("shader"==a.key){this.renderNode.remove();break}break;
case b.VALUE_MODIFIED:this.valueModified(a.mutation);break;case b.ADAPTER_VALUE_CHANGED:this.renderNode.setLightType(a.adapter.getLightType(),a.adapter.getDataNode())}};e.prototype.valueModified=function(a){var c=a.target.getAttribute(a.attributeName);switch(a.attributeName){case "visible":this.renderNode.setLocalVisible(c&&"false"!==c.toLowerCase());break;case "intensity":this.renderNode.setLocalIntensity(c);break;case "shader":this.renderNode.remove(),this.updateLightShader(),this.createRenderNode()}};
e.prototype.updateLightShader=function(){var a=this.node.shader;if(!a){var c=this.node.getAttribute("style");c&&(c=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(c))&&(a=c[1])}this.connectAdapterHandle("shader",this.getAdapterHandle(a))};e.prototype.getLightShader=function(){return this.getConnectedAdapter("shader")};e.prototype.dispose=function(){this.getRenderNode().remove();this.clearAdapterHandles()};e.prototype.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldMatrix(a._data);
return a};m.exports=e},{"../../../interface/notification.js":49,"./transformable.js":62}],58:[function(e,m,l){var d=e("./base.js"),b=e("../../../interface/notification.js"),a=e("../../../base/resourcemanager.js").Resource;e=function(c,b){d.call(this,c,b);this.dataAdapter=a.getAdapter(this.node,"data")};XML3D.createClass(e,d,{getDataNode:function(){return this.dataAdapter.getXflowNode()},getLightType:function(){var a=this.node.getAttribute("script");if(0===a.indexOf("urn:xml3d:lightshader:"))return a.substring(22,
a.length);XML3D.debug.logError("Unsupported light type "+a);return null},notifyChanged:function(a){switch(a.type){case b.THIS_REMOVED:this.notifyOppositeAdapters();break;case b.VALUE_MODIFIED:this.notifyOppositeAdapters(b.ADAPTER_VALUE_CHANGED)}}});m.exports=e},{"../../../base/resourcemanager.js":23,"../../../interface/notification.js":49,"./base.js":53}],59:[function(e,m,l){var d=e("./transformable.js"),b=e("../../../interface/notification.js"),a=e("../../../base/resourcemanager.js").Resource;e=
function(a,b){d.call(this,a,b,!0,!0);this.createRenderNode()};XML3D.createClass(e,d,{createRenderNode:function(){var c=a.getAdapter(this.node,"data"),b=this.getParentRenderAdapter(),b=b.getRenderNode&&b.getRenderNode();this.renderNode=this.getScene().createRenderObject({parent:b,node:this.node,object:{data:c.getXflowNode(),type:this.getMeshType()},name:this.node.id,visible:this.node.visible?void 0:!1});this.updateLocalMatrix();this.updateShaderHandler()},getMeshType:function(){return this.node.hasAttribute("type")?
this.node.getAttribute("type"):"triangles"},notifyChanged:function(a){d.prototype.notifyChanged.call(this,a);switch(a.type){case b.THIS_REMOVED:this.dispose();break;case b.VALUE_MODIFIED:this.valueChanged(a.mutation)}},valueChanged:function(a){switch(a.attributeName){case "type":this.renderNode.setType(a.target.getAttribute("type"))}},dispose:function(){this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(e.prototype,{getLocalBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;
this.renderNode.getObjectSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldMatrix:function(){var a=new window.XML3DMatrix,b=this.renderNode;b&&b.getWorldMatrix(a._data);return a}});m.exports=e},{"../../../base/resourcemanager.js":23,"../../../interface/notification.js":49,
"./transformable.js":62}],60:[function(e,m,l){function d(a,b){if(a){b||a.remove();for(var c=a.getChildren(),f=c.length;f--;)d(c[f],!1)}}function b(a,d,f){if(f.postTransformXflowNode){var e=new c(f.postTransformXflowNode,["transform"],a._bindedRequestCallback);d=a.getScene().createRenderGroup({parent:d,visible:!0,name:void 0});a.postTransformXflowRequests.push(e);a.postTransformRenderGroups.push(d);a.updatePostTransform(d,e)}d=a.getScene().createRenderGroup({parent:d,visible:!0,name:a.node.id});d.setLocalMatrix(f.transform||
g);d.setMaterial(a.getMaterialConfiguration(f.shader,a._subRenderNodes.length));a._subRenderNodes.push(d);for(var h=f.meshes,e=0;e<h.length;++e){var k=a.getScene().createRenderObject({parent:d,node:h[e].refNode||a.node,object:{data:h[e].xflowNode,type:h[e].type},name:a.node.id,visible:!0});k.setLocalMatrix(h[e].transform||g);k.setMaterial(a.getMaterialConfiguration(h[e].shader,a._subRenderNodes.length));a._subRenderNodes.push(k)}f=f.groups;for(e=0;e<f.length;++e)b(a,d,f[e])}var a=e("./transformable.js"),
c=e("../../../xflow/interface/request.js").ComputeRequest,f=e("../../../interface/notification.js"),k=e("../../../base/resourcemanager.js").Resource,h=e("../../../base/adapterhandle.js");e=function(b,c){a.call(this,b,c,!1,!0);this.asset=null;this.postTransformXflowRequests=[];this.postTransformRenderGroups=[];this.createRenderNode();this._bindedRequestCallback=this.onXflowRequestChange.bind(this);this.transformFetcher.update()};var g=XML3D.math.mat4.create();XML3D.createClass(e,a,{createRenderNode:function(){this.asset=
k.getAdapter(this.node,"data").getAsset();this.asset.addChangeListener(this);var a=this.getParentRenderAdapter(),a=a.getRenderNode&&a.getRenderNode();this.renderNode=this.getScene().createRenderGroup({parent:a,visible:this.node.visible,name:this.node.id});this.renderNode.setLocalMatrix(g);this.createModelRenderNodes()},clearModelRenderNodes:function(){this.clearAdapterHandles();this._subRenderNodes=[];for(var a=this.postTransformXflowRequests.length;a--;)this.postTransformXflowRequests[a].clear();
d(this.renderNode,!0);this.postTransformXflowRequests.length=0;this.postTransformRenderGroups.length=0},createModelRenderNodes:function(){this.clearModelRenderNodes();if(!this.asset.isSubtreeLoading())try{this.asset.checkValidity();var a=this.asset.getResult().getDataTree();b(this,this.renderNode,a)}catch(c){XML3D.debug.logError("Asset Error: "+c.message,c.node||this.node),this.clearModelRenderNodes()}},getMaterialConfiguration:function(a,b){var c=null;if(a){var d=this.getAdapterHandle(a);this.connectAdapterHandle("shader_"+
b,d);switch(d.status){case h.STATUS.NOT_FOUND:XML3D.debug.logError("Could not find <shader> of url '"+d.url+"' ",this.node);break;case h.STATUS.READY:(d=d.getAdapter())&&d.getMaterialConfiguration&&(c=d.getMaterialConfiguration())}}return c},notifyChanged:function(b){a.prototype.notifyChanged.call(this,b);switch(b.type){case f.THIS_REMOVED:this.dispose();break;case f.ADAPTER_HANDLE_CHANGED:var c=b.key.split("_");"shader"==c[0]&&(c=this._subRenderNodes[+c[1]],XML3D.debug.assert(c),b.handleStatus==
h.STATUS.NOT_FOUND?c.setMaterial(null):(b=b.adapter)&&b.getMaterialConfiguration&&c.setMaterial(b.getMaterialConfiguration()),this.factory.renderer.requestRedraw("Material model changed."))}},onAssetChange:function(){this.renderNode&&this.createModelRenderNodes()},onXflowRequestChange:function(a){var b=this.postTransformXflowRequests.indexOf(a);-1!=b&&this.updatePostTransform(this.postTransformRenderGroups[b],a)},updatePostTransform:function(a,b){var c=b.getResult();(c=c.getOutputData("transform")&&
c.getOutputData("transform").getValue())?a.setLocalMatrix(c):(XML3D.debug.logWarning("Post Transform entry does not contain any 'transform' value.",this.node),a.setLocalMatrix(g))},dispose:function(){this.asset.removeChangeListener(this);this.clearModelRenderNodes();this.getRenderNode().remove();this.clearAdapterHandles()}});XML3D.extend(e.prototype,{getLocalBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getObjectSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},
getWorldBoundingBox:function(){if(this.renderNode){var a=new XML3D.math.bbox.create;this.renderNode.getWorldSpaceBoundingBox(a);return XML3D.math.bbox.asXML3DBox(a)}return new window.XML3DBox},getWorldMatrix:function(){var a=new window.XML3DMatrix,b=this.renderNode;b&&b.getWorldMatrix(a._data);return a}});m.exports=e},{"../../../base/adapterhandle.js":21,"../../../base/resourcemanager.js":23,"../../../interface/notification.js":49,"../../../xflow/interface/request.js":152,"./transformable.js":62}],
61:[function(e,m,l){var d=e("./base.js"),b=e("../../../interface/notification.js"),a=e("../../../utils/uri.js").URI,c=e("../../../base/resourcemanager.js").Resource,f=e("../../../base/adapterhandle.js");e=function(a,b){d.call(this,a,b);this._dataAdapter=c.getAdapter(this.node,"data");this._materialModel=this._materialConfiguration=null;this.updateMaterialConfiguration()};XML3D.createClass(e,d);XML3D.extend(e.prototype,{getMaterialConfiguration:function(){return this._materialConfiguration},updateMaterialConfiguration:function(){this.updateMaterialModel();
this._materialConfiguration=this._materialModel?this.getScene().createMaterialConfiguration(this._materialModel,this._dataAdapter.getXflowNode(),{name:this.node.id}):null;this.notifyOppositeAdapters()},updateMaterialModel:function(){this._materialModel=null;var a=this.getShaderScriptURI();"urn"==a.scheme?(this.disconnectAdapterHandle("script"),this._materialModel={type:"urn",urn:a}):(this.connectAdapterHandle("script",this.getAdapterHandle(a,"data",0)),(a=this.getConnectedAdapter("script"))&&a.getScriptType&&
(this._materialModel={type:a.getScriptType(),script:a.getScript()}))},getShaderScriptURI:function(){return new a(this.node.getAttribute("script"))},notifyChanged:function(a){switch(a.type){case b.VALUE_MODIFIED:a=a.mutation.attributeName;switch(a){case "script":this.updateMaterialConfiguration();break;default:XML3D.debug.logWarning("Unhandled mutation event in shader adapter for parameter '"+a+"'")}break;case b.ADAPTER_HANDLE_CHANGED:a.handleStatus==f.STATUS.NOT_FOUND&&XML3D.debug.logError("Could not find material for url '"+
a.url+"'"),this.updateMaterialConfiguration()}}});m.exports=e},{"../../../base/adapterhandle.js":21,"../../../base/resourcemanager.js":23,"../../../interface/notification.js":49,"../../../utils/uri.js":146,"./base.js":53}],62:[function(e,m,l){var d=e("./base.js"),b=e("../../../data/transform-fetcher.js"),a=e("../../../interface/notification.js"),c=e("../../../base/adapterhandle.js");e=function(a,c,e,g){d.call(this,a,c);this.shaderHandler=this.renderNode=null;this.handleShader=e||!1;g&&(this.transformFetcher=
new b(this,"transform","transform"))};XML3D.createClass(e,d);XML3D.extend(e.prototype,{updateShaderHandler:function(){var a,b=this.node;a=b.shader;""==a&&(b=b.getAttribute("style"))&&(b=/shader\s*:\s*url\s*\(\s*(\S+)\s*\)/i.exec(b))&&(a=b[1]);a?(this.shaderHandler=this.getAdapterHandle(a),this.connectAdapterHandle("shader",this.shaderHandler)):(this.disconnectAdapterHandle("shader"),this.shaderHandler=null);this.referencedShaderChanged()},referencedShaderChanged:function(){if(this.shaderHandler)if(this.shaderHandler.status===
c.STATUS.NOT_FOUND)XML3D.debug.logError("Could not find element of url '"+this.shaderHandler.url+"' for shader",this.node),this.getRenderNode().setMaterial(null);else{var a=this.shaderHandler.getAdapter();a&&a.getMaterialConfiguration?this.getRenderNode().setMaterial(a.getMaterialConfiguration()):this.getRenderNode().setMaterial(null)}else this.getRenderNode().setMaterial(null)},onDispose:function(){this.transformFetcher&&this.transformFetcher.clear()},onConfigured:function(){},getRenderNode:function(){this.renderNode||
(this.renderNode=this.createRenderNode?this.createRenderNode():null,this.updateLocalMatrix());return this.renderNode},updateLocalMatrix:function(){this.transformFetcher&&this.transformFetcher.update()},onTransformChange:function(a,b){"transform"==a&&this.renderNode.setLocalMatrix(b)},notifyChanged:function(b){if(b.type==a.VALUE_MODIFIED){var c=b.mutation.attributeName;"transform"==c?this.transformFetcher&&this.transformFetcher.update():"style"==c?this.transformFetcher&&this.transformFetcher.updateMatrix():
"visible"==c?(b=b.mutation.target.getAttribute("visible"),this.renderNode.setLocalVisible(b&&"false"!==b.toLowerCase()),this.factory.renderer.requestRedraw("Transformable visibility changed.")):"shader"==c&&this.handleShader&&(this.updateShaderHandler(),this.factory.renderer.requestRedraw("Transformable shader changed."))}else b.type==a.ADAPTER_HANDLE_CHANGED&&"shader"==b.key&&(this.updateShaderHandler(),this.factory.renderer.requestRedraw("Shader reference changed."))}});m.exports=e},{"../../../base/adapterhandle.js":21,
"../../../data/transform-fetcher.js":41,"../../../interface/notification.js":49,"./base.js":53}],63:[function(e,m,l){var d=e("./transformable.js"),b=e("../../../data/transform-fetcher.js"),a=e("../../../interface/notification.js");e=function(a,f){d.call(this,a,f,!1,!1);this.perspectiveFetcher=new b(this,"perspective","perspective",!0);this.createRenderNode()};XML3D.createClass(e,d);l=e.prototype;l.createRenderNode=function(){var a=this.getParentRenderAdapter(),a=a.getRenderNode?a.getRenderNode():
this.factory.renderer.scene.createRootNode();this.renderNode=this.factory.renderer.scene.createRenderView({position:this.node.position._data,orientation:this.node.orientation.toMatrix()._data,fieldOfView:this.node.fieldOfView,parent:a});this.perspectiveFetcher.update()};l.getViewMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getWorldToViewMatrix(a._data);return a};l.getWorldMatrix=function(){var a=new window.XML3DMatrix;this.renderNode.getViewToWorldMatrix(a._data);return a};l.notifyChanged=
function(b){switch(b.type){case a.THIS_REMOVED:this.dispose();break;case a.VALUE_MODIFIED:switch(b=b.mutation.attributeName,b){case "orientation":this.renderNode.updateOrientation(this.node.orientation.toMatrix()._data);break;case "position":this.renderNode.updatePosition(this.node.position._data);break;case "perspective":this.perspectiveFetcher.update();break;case "fieldOfView":this.renderNode.updateFieldOfView(this.node.fieldOfView);break;default:XML3D.debug.logWarning("Unhandled value changed event in view adapter for attribute:"+
b)}}this.factory.getRenderer().requestRedraw("View changed")};l.onTransformChange=function(a,b){d.prototype.onTransformChange.call(this,a,b);"perspective"==a&&this.renderNode.setProjectionOverride(b)};l.dispose=function(){this.perspectiveFetcher.clear();this.getRenderNode().remove();this.clearAdapterHandles()};m.exports=e},{"../../../data/transform-fetcher.js":41,"../../../interface/notification.js":49,"./transformable.js":62}],64:[function(e,m,l){var d=e("./base.js"),b=e("../utils.js"),a=e("../../../interface/notification.js"),
c=e("../../../utils/misc.js").dispatchCustomEvent,f=e("../../../utils/misc.js").getOrCreateActiveView,k=e("../../../base/resourcemanager.js").Resource;e=function(a,b){d.call(this,a,b);this.firstLoadFired=this.fireLoadEventAfterDraw=!1};XML3D.createClass(e,d);XML3D.extend(e.prototype,{updateActiveViewAdapter:function(){var a=this.node.getAttribute("activeView");a?this.connectAdapterHandle("activeView",this.getAdapterHandle(a)):this.disconnectAdapterHandle("activeView")},setViewAdapter:function(a){a=
a||this.getConnectedAdapter("activeView");a&&a.getRenderNode||(a=f(this.node),a=this.factory.getAdapter(a));this.factory.getScene().setActiveView(a.getRenderNode())},dispose:function(){this.clearAdapterHandles()}});e.prototype.notifyChanged=function(b){switch(b.type){case a.ADAPTER_HANDLE_CHANGED:this.setViewAdapter(b.adapter);return;case a.NODE_INSERTED:this.initElement(b.mutation.target);return;case a.NODE_REMOVED:return}(b=b.mutation.attributeName)&&"activeview"===b.toLowerCase()&&(this.updateActiveViewAdapter(),
this.setViewAdapter())};e.prototype.onConfigured=function(){this.updateActiveViewAdapter();this.setViewAdapter();var a=this.onLoadComplete.bind(this);k.addLoadCompleteListener(0,a);k.addLoadCompleteListener(this.factory.canvasId,a);this.onLoadComplete()};e.prototype.onLoadComplete=function(a){k.isLoadComplete(0)&&k.isLoadComplete(this.factory.canvasId)&&(this.fireLoadEventAfterDraw=!0)};e.prototype.onFrameDrawn=function(){this.fireLoadEventAfterDraw&&(this.fireLoadEventAfterDraw=!1,this.firstLoadFired=
!0,c(this.node,"load",!1,!0,null))};e.prototype.getComplete=function(){return this.fireLoadEventAfterDraw||!this.firstLoadFired?!1:k.isLoadComplete(0)&&k.isLoadComplete(this.factory.canvasId)};e.prototype.getWorldBoundingBox=function(){var a=new window.XML3DBox;Array.prototype.forEach.call(this.node.childNodes,function(b){b.getWorldBoundingBox&&a.extend(b.getWorldBoundingBox())});return a};e.prototype.getLocalBoundingBox=e.prototype.getWorldBoundingBox;e.prototype.getElementByPoint=function(a,c,d,
f){c=b.convertPageCoords(this.node,a,c);a=c.x;c=c.y;var e=this.factory.getRenderer(),k=e.getRenderObjectFromPickingBuffer(a,c);if(k){if(d){var t=e.getWorldSpacePositionByPoint(a,c,k);d.set(t[0],t[1],t[2])}f&&(t=e.getWorldSpaceNormalByPoint(a,c,k),f.set(t[0],t[1],t[2]))}else d&&d.set(NaN,NaN,NaN),f&&f.set(NaN,NaN,NaN);return k?k.node:null};e.prototype.getRenderInterface=function(){return this.factory.getRenderer().getRenderInterface()};e.prototype.generateRay=function(a,c){var d=b.convertPageCoords(this.node,
a,c);return this.factory.getRenderer().generateRay(d.x,d.y)};e.prototype.getElementByRay=function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(c,d,f){var e=this.factory.getRenderer();e.calculateMatricesForRay(c,a,b);var k=e.getRenderObjectByRay(c,a,b);if(null!==k&&(d||f)){if(d){var l=e.getWorldSpacePositionByRay(c,k,a,b);d.set(l[0],l[1],l[2])}f&&(l=e.getWorldSpaceNormalByRay(c,k,a,b),f.set(l[0],l[1],l[2]))}else d&&d.set(NaN,NaN,NaN),f&&f.set(NaN,NaN,NaN);return null!==
k?k.node:null}}();m.exports=e},{"../../../base/resourcemanager.js":23,"../../../interface/notification.js":49,"../../../utils/misc.js":144,"../utils.js":85,"./base.js":53}],65:[function(e,m,l){function d(d,e){this._xml3dElement=d;this._canvas=e;this.id=++c;this._mouseHandler=new b.MouseEventHandler(d,this);this._registerCanvasListeners(this._mouseHandler,b.EVENTS);this.hasTouchEvents()&&(this._touchHandler=new a.TouchEventHandler(d,this),this._registerCanvasListeners(this._touchHandler,a.EVENTS))}
var b=e("./events/mouse.js"),a=e("./events/touch.js"),c=0;d.prototype.hasTouchEvents=function(){return"ontouchstart"in window};d.prototype.getCanvas=function(){return this._canvas};d.prototype.dispatchEvent=function(a){this._xml3dElement.dispatchEvent(a)};d.prototype._registerCanvasListeners=function(a,b){var c=this._canvas;b.forEach(function(b){c.addEventListener(b,function(c){a[b]&&a[b].call(a,c);c.stopPropagation()})})};d.prototype.dispatchCustomEvent=function(a,b){b=b||null;var c=document.createEvent("CustomEvent");
c.initCustomEvent(a,!0,!0,b);this._xml3dElement.dispatchEvent(c)};d.prototype.dispatchUpdateEvent=function(){this.dispatchCustomEvent("update")};d.prototype.dispatchResizeEvent=function(a){this.dispatchCustomEvent("resize",a)};d.prototype.dispatchFrameDrawnEvent=function(a,b,c){c=c||{count:{primitives:0,objects:0}};this.dispatchCustomEvent("framedrawn",{timeStart:a,timeEnd:b,renderTimeInMilliseconds:b-a,count:c.count})};m.exports=d},{"./events/mouse.js":67,"./events/touch.js":68}],66:[function(e,
m,l){l=e("./adapter/factory.js");e("../../base/formathandler.js").xml3dFormatHandler.registerFactoryClass(l);var d=e("./renderer-factory.js");m.exports=function(b){b instanceof Array||(b=[b]);b.forEach(function(a){XML3D.debug.logDebug("Configuring Renderer for",a.id);d.createRenderer(a)})}},{"../../base/formathandler.js":22,"./adapter/factory.js":55,"./renderer-factory.js":71}],67:[function(e,m,l){var d=e("../../../utils/options.js");d.register("renderer-mousemove-picking",!0);d.register("renderer-movement-aware-click-handler",
!1);e=function(a,b){this._defaultTarget=a;this._canvasHandler=b;this._lastMousePosition={x:0,y:0}};var b;try{new MouseEvent("click",{}),b=!0}catch(a){b=!1}e.prototype={dispatchMouseEvent:function(a,b,d){d=d||{};b=b||this._defaultTarget;var e=void 0!==d.x?d.x:a.clientX,g=void 0!==d.y?d.y:a.clientY;d.noCopy||(a=this.copyMouseEvent(a));this.initExtendedMouseEvent(a,e,g);b.dispatchEvent(a)},copyMouseEvent:function(a){var d;b?d="[object WheelEvent]"===a.toString()?new WheelEvent(a.type,a):new MouseEvent(a.type,
a):"[object WheelEvent]"===a.toString()?(d=document.createEvent("WheelEvent"),d.initWheelEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.button,a.relatedTarget,"",a.deltaX,a.deltaY,a.deltaZ,a.deltaMode)):(d=document.createEvent("MouseEvent"),d.initMouseEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget));a.dataTransfer&&(d.data={url:a.dataTransfer.getData("URL"),
text:a.dataTransfer.getData("Text")});d.preventDefault=function(){a.preventDefault()};return d},createMouseEvent:function(a,d){d=d||{};var e={bubbles:void 0!==d.bubbles?d.bubbles:!0,cancelable:void 0!==d.cancelable?d.cancelable:!0,view:d.view||window,detail:void 0!==d.detail?d.detail:0,screenX:void 0!==d.screenX?d.screenX:0,screenY:void 0!==d.screenY?d.screenY:0,clientX:void 0!==d.clientX?d.clientX:0,clientY:void 0!==d.clientY?d.clientY:0,ctrl:void 0!==d.ctrl?d.ctrl:!1,alt:void 0!==d.alt?d.alt:!1,
shift:void 0!==d.shift?d.shift:!1,meta:void 0!==d.meta?d.meta:!1,button:void 0!==d.button?d.button:0,relatedTarget:d.relatedTarget};if(b)return new MouseEvent(a,e);var h=document.createEvent("MouseEvent");h.initMouseEvent(a,e.bubbles,e.cancelable,e.view,e.detail,e.screenX,e.screenY,e.clientX,e.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,e.relatedTarget);return h},initExtendedMouseEvent:function(a,b,d){var e=this._canvasHandler;(function(){var g=void 0,q=void 0;a.__defineGetter__("normal",
function(){if(void 0!==q)return q;var a=e.getWorldSpaceNormalByPoint(b,d);return q=a?new window.XML3DVec3(a[0],a[1],a[2]):null});a.__defineGetter__("position",function(){if(!g){var a=e.getWorldSpacePositionByPoint(b,d);g=a?new window.XML3DVec3(a[0],a[1],a[2]):null}return g})})()},dispatchMouseEventOnPickedObject:function(a,b){b=b||{};var d=this.getMousePosition(a),e=null;b.omitUpdate||(e=this._canvasHandler.getPickObjectByPoint(d.x,d.y));this.dispatchMouseEvent(a,e&&e.node,d)},getMousePosition:function(a){return this._canvasHandler.getMousePosition(a)},
mouseup:function(a){this.dispatchMouseEventOnPickedObject(a)},mousedown:function(a){this._lastMousePosition=this.getMousePosition(a);this.dispatchMouseEventOnPickedObject(a)},click:function(a){if(!0===d.getValue("renderer-movement-aware-click-handler")){var b=this.getMousePosition(a);if(4<Math.abs(b.x-this._lastMousePosition.x)||4<Math.abs(b.y-this._lastMousePosition.y))return}this.dispatchMouseEventOnPickedObject(a)},dblclick:function(a){this.dispatchMouseEventOnPickedObject(a)},mousemove:function(a){var b=
this.getMousePosition(a),e=d.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!e});e&&(e=this._canvasHandler.getPickedObject(),e!==this.lastPickObj&&(this.lastPickObj&&(this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,clientY:b.y,button:a.button}),this.lastPickObj),e||this.dispatchMouseEvent(this.createMouseEvent("mouseover",{clientX:b.x,clientY:b.y,button:a.button}),this._defaultTarget)),e&&(this.dispatchMouseEvent(this.createMouseEvent("mouseover",
{clientX:b.x,clientY:b.y,button:a.button}),e),this.lastPickObj||this.dispatchMouseEvent(this.createMouseEvent("mouseout",{clientX:b.x,clientY:b.y,button:a.button}),this._defaultTarget)),this.lastPickObj=e))},mouseout:function(a){var b=this.getMousePosition(a);this.dispatchMouseEvent(a,this.lastPickObj,b)},mouseover:function(a){var b=d.getValue("renderer-mousemove-picking");this.dispatchMouseEventOnPickedObject(a,{omitUpdate:!b})},wheel:function(a){this.dispatchMouseEventOnPickedObject(a,{type:"wheel"})}};
m.exports={EVENTS:"click dblclick mousedown mouseup mouseover mousemove mouseout wheel".split(" "),MouseEventHandler:e}},{"../../../utils/options.js":145}],68:[function(e,m,l){e=function(d,b){this._defaultTarget=d;this._canvasHandler=b};e.prototype={copyTouchEvent:function(d,b){var a=this.copyTouchEventData(d,b);return this.createTouchEvent(a)},copyTouchEventData:function(d,b){return{type:b.type||d.type,timeStamp:Date.now(),bubbles:d.bubbles,cancelable:d.cancelable,detail:d.detail,screenX:d.screenX,
screenY:d.screenY,pageX:d.pageX,pageY:d.pageY,clientX:d.clientX,clientY:d.clientY,ctrlKey:d.ctrlKey,altKey:d.altKey,shiftKey:d.shiftKey,metaKey:d.metaKey,scale:d.scale,rotation:d.rotation,view:d.view,touches:d.touches,changedTouches:d.changedTouches,targetTouches:d.targetTouches}},createTouchEvent:function(d){var b;try{b=document.createEvent("TouchEvent")}catch(a){XML3D.debug.logWarning("Create Touch Event failed, creating UI instead"),b=document.createEvent("UIEvent")}b&&b.initTouchEvent&&(0==b.initTouchEvent.length?
b.initTouchEvent(d.touches,d.targetTouches,d.changedTouches,d.type,d.view,d.screenX,d.screenY,d.clientX,d.clientY):12==b.initTouchEvent.length?b.initTouchEvent(d.type,d.bubbles,d.cancelable,d.view,d.detail,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.touches,d.targetTouches,d.changedTouches):b.initTouchEvent(d.type,d.bubbles,d.cancelable,d.view,d.detail,d.screenX,d.screenY,d.pageX,d.pageY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,d.touches,d.targetTouches,d.changedTouches,d.scale,d.rotation));return b},
dispatchTouchEventOnPickedObject:function(d,b){b=b||{};var a=this.copyTouchEvent(d,b);a.preventDefault=function(){d.preventDefault()};this._defaultTarget.dispatchEvent(a)},touchstart:function(d){this.dispatchTouchEventOnPickedObject(d)},touchend:function(d){this.dispatchTouchEventOnPickedObject(d)},touchmove:function(d){this.dispatchTouchEventOnPickedObject(d)},touchcancel:function(d){this.dispatchTouchEventOnPickedObject(d)}};m.exports={EVENTS:["touchstart","touchmove","touchend","touchcancel"],
TouchEventHandler:e}},{}],69:[function(e,m,l){function d(){this._lights=[];this._models={};this._inUpdate=!1}d.prototype={add:function(b){this._lights.push(b);this._addModel(b.model)},remove:function(b){var a=this._lights.indexOf(b);-1!=a&&this._lights.splice(a,1);this._removeModel(b.model)},fillGlobalParameters:function(b,a){for(var c in this._models){var d=this._models[c];if(d.changed||a){var e=c+"Light",h;for(h in d.parameters){var g=e+h.charAt(0).toUpperCase()+h.slice(1);b[g]=d.parameters[h]}d.changed=
!1}}},lightValueChanged:function(b){if(!this._inUpdate){this._inUpdate=!0;var a=this;(b?[b]:this._lights).forEach(function(b){b=b.model;var d=a.getModelEntry(b.id),e=d.lightModels.indexOf(b);0>e||(b.fillLightParameters(d.parameters,e),b.getLightData(d.parameters,e),d.changed=!0)});this._inUpdate=!1}},getModelEntry:function(b){return this._models[b]},getModels:function(b){return Object.keys(this._models)},getModelCount:function(b){return(b=this.getModelEntry(b))?b.lightModels.length:0},_addModel:function(b){var a=
this._models[b.id];a||(a=this._models[b.id]={lightModels:[],parameters:{}});a.lightModels.push(b);this._lightStructureChanged(a)},_removeModel:function(b){var a=this.getModelEntry(b.id);b=a.lightModels.indexOf(b);-1!=b&&a.lightModels.splice(b,1);this._lightStructureChanged(a)},_lightStructureChanged:function(b){this._inUpdate=!0;var a=b.lightModels.length;a?(b.parameters=b.lightModels[0].allocateParameterArray(a),b.lightModels.forEach(function(a,d){a.fillLightParameters(b.parameters,d);a.getLightData(b.parameters,
d)}),b.changed=!0,this._inUpdate=!1):b.parameters={}}};m.exports=d},{}],70:[function(e,m,l){function d(a){var b=new k,c;for(c in a){var d=a[c],e=b,r=c,q=d.type,d=new g(q,new f.TYPED_ARRAY_MAP[q](d["default"])),q=new h;q.data=d;q.name=r;e.appendChild(q)}return b}function b(a,b,c){a.getWorldMatrix(x);b&&XML3D.math.vec3.transformMat4(b,b,x);c&&(XML3D.math.vec3.transformDirection(c,c,x),XML3D.math.vec3.normalize(c,c))}function a(a,b,c){var d=a.intensity.subarray(3*b,3*b+3);XML3D.math.vec3.scale(d,d,c.localIntensity);
a.on[b]=c.visible}var c=e("../tools/frustum.js").Frustum,f=e("../../../xflow/interface/constants.js"),k=e("../../../xflow/interface/graph.js").DataNode,h=e("../../../xflow/interface/graph.js").InputNode,g=e("../../../xflow/interface/data.js").BufferEntry,q=e("../../../xflow/interface/request.js").ComputeRequest,r={intensity:{type:f.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,1]},position:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,0]},shadowBias:{type:f.DATA_TYPE.FLOAT,
"default":[1E-4]},direction:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,-1]},castShadow:{type:f.DATA_TYPE.BOOL,"default":[!1]},on:{type:f.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:f.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},nearFar:{type:f.DATA_TYPE.FLOAT2,"default":[1,100]}},n={intensity:{type:f.DATA_TYPE.FLOAT3,"default":[1,1,1]},attenuation:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,1]},position:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,0]},direction:{type:f.DATA_TYPE.FLOAT3,"default":[0,
0,-1]},falloffAngle:{type:f.DATA_TYPE.FLOAT,"default":[Math.PI/4]},softness:{type:f.DATA_TYPE.FLOAT,"default":[0]},shadowBias:{type:f.DATA_TYPE.FLOAT,"default":[1E-4]},castShadow:{type:f.DATA_TYPE.BOOL,"default":[!1]},matrix:{type:f.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},on:{type:f.DATA_TYPE.BOOL,"default":[!0]}},p={intensity:{type:f.DATA_TYPE.FLOAT3,"default":[1,1,1]},direction:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,-1]},shadowBias:{type:f.DATA_TYPE.FLOAT,"default":[1E-4]},
position:{type:f.DATA_TYPE.FLOAT3,"default":[0,0,0]},castShadow:{type:f.DATA_TYPE.BOOL,"default":[!1]},on:{type:f.DATA_TYPE.BOOL,"default":[!0]},matrix:{type:f.DATA_TYPE.FLOAT4X4,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},t=function(a,b,c,f){this.id=a;this.light=b;this.dataNode=c;this.configuration=f;this.parameters=Object.keys(f);c?c.insertBefore(d(f),null):c=d(f);this.fovy=Math.PI/2;this.lightParameterRequest=new q(c,this.parameters,this.lightParametersChanged.bind(this));this.lightParametersChanged(this.lightParameterRequest,
null)};t.prototype={fillLightParameters:function(a,b){var c=this.lightParameterRequest.getResult();this.parameters.forEach(function(d){var e=c.getOutputData(d),g=f.DATA_TYPE_TUPLE_SIZE[e.type],e=e.getValue();a[d].set(e.subarray(0,g),b*g)});this.transformParameters(a,b)},allocateParameterArray:function(a){var b={},c=this.configuration;this.parameters.forEach(function(d){var e=c[d].type;b[d]=new f.TYPED_ARRAY_MAP[e](f.DATA_TYPE_TUPLE_SIZE[e]*a)});return b},getParameter:function(a){return a in this.configuration?
this.lightParameterRequest.getResult().getOutputData(a).getValue():null},lightParametersChanged:function(a,b){b&&this.light.lightValueChanged()},_expandNearFar:function(a){var b=Math.max(.3*(a.far-a.near),.05);a.near-=b;a.far+=b},getLightData:function(a,b){var c=a.matrix.subarray(16*b,16*b+16);this.getLightViewProjectionMatrix(c)},getLightViewProjectionMatrix:function(a){var b=XML3D.math.mat4.create(),c=XML3D.math.mat4.create();this.getLightViewMatrix(b);this.getLightProjectionMatrix(c);XML3D.math.mat4.multiply(a,
c,b)},getLightProjectionMatrix:function(a){this.light.getFrustum(1).getProjectionMatrix(a)},getLightViewMatrix:function(a){var b=this.getParameter("direction"),c=this.getParameter("position");this.light.getWorldMatrix(a);b=XML3D.math.quat.rotationTo(XML3D.math.quat.create(),u,b);c=XML3D.math.mat4.fromRotationTranslation(XML3D.math.mat4.create(),b,c);XML3D.math.mat4.mul(a,a,c);XML3D.math.mat4.invert(a,a)}};var x=XML3D.math.mat4.create(),u=XML3D.math.vec3.fromValues(0,0,-1);e=function(a,b){t.call(this,
"point",b,a,r)};XML3D.createClass(e,t,{getFrustum:function(a,b){var d=this.light.scene.lights.getModelEntry(this.id);if(XML3D.math.bbox.isEmpty(b))return d.parameters.nearFar[0]=1,d.parameters.nearFar[1]=110,new c(1,110,0,this.fovy,a,!1);var f=XML3D.math.mat4.create();this.getLightViewMatrix(f);XML3D.math.bbox.transform(b,f,b);f={near:-b[5],far:-b[2]};this._expandNearFar(f);d.parameters.nearFar[0]=1;d.parameters.nearFar[1]=f.far;return new c(1,f.far,0,this.fovy,a,!1)},transformParameters:function(c,
d){var f=c.position.subarray(3*d,3*d+3);b(this.light,f,null);a(c,d,this.light)}});l=function(a,b){t.call(this,"spot",b,a,n)};XML3D.createClass(l,t,{getFrustum:function(a,b){if(XML3D.math.bbox.isEmpty(b))return new c(1,110,0,this.fovy,a,!1);var d=XML3D.math.mat4.create();this.getLightViewMatrix(d);XML3D.math.bbox.transform(b,d,b);d={near:-b[5],far:-b[2]};this._expandNearFar(d);return new c(1,d.far,0,this.fovy,a,!1)},transformParameters:function(c,d){var f=c.position.subarray(3*d,3*d+3),e=c.direction.subarray(3*
d,3*d+3);b(this.light,f,e);a(c,d,this.light)},lightParametersChanged:function(a,b){this.fovy=2*this.getParameter("falloffAngle")[0];t.prototype.lightParametersChanged.call(this,a,b)}});var v=function(a,b){t.call(this,"directional",b,a,p)};XML3D.createClass(v,t,{getFrustum:function(a,b){if(XML3D.math.bbox.isEmpty(b))return new c(1,110,0,this.fovy,a,!0);var d=XML3D.math.mat4.create();this.getLightViewMatrix(d);XML3D.math.bbox.transform(b,d,b);d={near:-b[5],far:-b[2]};this._expandNearFar(d);return new c(1,
d.far,0,this.fovy,a,!0)},transformParameters:function(c,d){var f=c.direction.subarray(3*d,3*d+3);b(this.light,null,f);a(c,d,this.light)},getLightViewMatrix:function(a){var b=this.light.scene.lights.getModelEntry(this.id),c=b.parameters.direction,d=b.parameters.position,f=new XML3D.math.bbox.create;this.light.scene.getBoundingBox(f);var e=XML3D.math.vec3.create(),g=XML3D.math.vec3.create(),h=XML3D.math.vec3.create();XML3D.math.bbox.center(g,f);XML3D.math.bbox.size(e,f);f=XML3D.math.vec3.len(e);XML3D.math.vec3.scale(h,
c,-.55*f);d=XML3D.math.vec3.add(d,g,h);b.parameters.position=d;XML3D.math.mat4.identity(a);g=XML3D.math.mat4.create();h=XML3D.math.vec3.fromValues(0,1,0);0==c[0]&&0==c[2]&&(h=XML3D.math.vec3.fromValues(0,0,1));f=XML3D.math.vec3.create();e=XML3D.math.vec3.len(c);XML3D.math.vec3.scale(f,c,-XML3D.math.vec3.dot(h,c)/(e*e));XML3D.math.vec3.add(f,f,h);XML3D.math.vec3.normalize(f,f);XML3D.math.mat4.lookAt(g,XML3D.math.vec3.fromValues(0,0,0),c,f);XML3D.math.mat4.invert(g,g);XML3D.math.mat4.translate(a,a,
d);XML3D.math.mat4.multiply(a,a,g);f=new XML3D.math.bbox.create;this.light.scene.getBoundingBox(f);XML3D.math.bbox.transform(f,a,f);e=XML3D.math.vec3.create();XML3D.math.bbox.size(e,f);g=e[0]>e[1]?e[0]:e[1];this.fovy=2*Math.atan(.55*g);b.parameters.direction=c;b.parameters.position=d;XML3D.math.mat4.invert(a,a)}});m.exports={PointLightModel:e,SpotLightModel:l,DirectionalLightModel:v}},{"../../../xflow/interface/constants.js":149,"../../../xflow/interface/data.js":150,"../../../xflow/interface/graph.js":151,
"../../../xflow/interface/request.js":152,"../tools/frustum.js":83}],71:[function(e,m,l){var d=e("../webgl/renderer.js"),b=e("../webgl/canvas-handler.js");m.exports=new function(){this.createRenderer=function(a){var c=new b(a,a._configured.canvas);a=new d(a,c);c.setRenderer(a);window.requestAnimationFrame(c.tick);return a}}},{"../webgl/canvas-handler.js":93,"../webgl/renderer.js":125}],72:[function(e,m,l){m.exports={NODE_TYPE:{GROUP:"group",OBJECT:"object",LIGHT:"light",VIEW:"view"},EVENT_TYPE:{VIEW_CHANGED:"view_changed",
LIGHT_STRUCTURE_CHANGED:"light_structure_changed",LIGHT_VALUE_CHANGED:"light_value_changed",SCENE_SHAPE_CHANGED:"scene_shape_changed",SCENE_STRUCTURE_CHANGED:"scene_structure_changed",DRAWABLE_STATE_CHANGED:"drawable_state_changed"}}},{}],73:[function(e,m,l){e=e("../../../contrib/EventDispatcher.js");l=function(d,b){this.context=d;this._type=b;this._valid=!1};l.TYPES={MESH:"mesh",VOLUME:"volume"};l.READY_STATE={COMPLETE:"complete",INCOMPLETE:"incomplete"};XML3D.createClass(l,e,{getType:function(){return this._type},
isValid:function(){return this._valid},setShaderComposer:function(d){},update:function(d){}});m.exports=l},{"../../../contrib/EventDispatcher.js":24}],74:[function(e,m,l){var d=e("../../webgl/base/utils.js").getUniqueCounter();m.exports=function(b,a,c){c=c||{};this.id=d();this.model=b;this.dataNode=a;this.name=c.name||null}},{"../../webgl/base/utils.js":92}],75:[function(e,m,l){e=e("../../../contrib/EventDispatcher.js");var d=function(){this.pages=[];this.nextOffset=0;this.freeEntries=[];this.addPage()};
XML3D.createClass(d,e,{addPage:function(){var b=new Float32Array(d.PAGE_SIZE);this.pages.push(b);this.nextOffset=0;XML3D.debug.logInfo("Adding page",this.pages.length,"(",d.PAGE_SIZE*Float32Array.BYTES_PER_ELEMENT*this.pages.length/1024,"kB)")},getPageEntry:function(b){if(!b)throw Error("No size given for page entry");return this.reusePageEntry(b)||this.createPageEntry(b)},reusePageEntry:function(b){return(b=this.freeEntries[b])&&b.length?b.pop():null},createPageEntry:function(b){if(this.nextOffset+
b>d.PAGE_SIZE)return this.addPage(),this.getPageEntry(b);var a=this.pages[this.pages.length-1],c=this.nextOffset;this.nextOffset+=b;return{page:a,offset:c,size:b}},freePageEntry:function(b){var a=this.freeEntries[b.size];a||(a=this.freeEntries[b.size]=[]);a.push(b)}});d.PAGE_SIZE=4096;m.exports=d},{"../../../contrib/EventDispatcher.js":24}],76:[function(e,m,l){var d=e("./rendernode.js");e=e("./constants.js");var b=e.NODE_TYPE,a=e.EVENT_TYPE;e=function(a,f,e){d.call(this,b.GROUP,a,f,e);e=e||{};this._material=
e.material||null;this.boundingBoxDirty=!1;this.setWorldSpaceBoundingBox(XML3D.math.bbox.EMPTY_BOX)};e.ENTRY_SIZE=38;XML3D.createClass(e,d);XML3D.extend(e.prototype,{getLocalMatrix:function(a){for(var b=this.offset+16,d=0;16>d;d++,b++)a[d]=this.page[b]},setLocalMatrix:function(a){for(var b=this.offset+16,d=0;16>d;d++,b++)this.page[b]=a[d];this.setTransformDirty();this.setBoundingBoxDirty()},getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var b=this.offset+
32;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},setWorldSpaceBoundingBox:function(a){var b=this.offset+32;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5]},updateWorldSpaceBoundingBox:function(){var a=XML3D.math.bbox.create();return function(){for(var b=XML3D.math.bbox.create(),d=0,e=this.children.length;d<e;d++){var g=this.children[d];g.isVisible()&&(g.getWorldSpaceBoundingBox(a),
XML3D.math.bbox.extendWithBox(b,a))}this.setWorldSpaceBoundingBox(b);this.boundingBoxDirty=!1}}(),addChild:function(b){this.children.push(b);this.setBoundingBoxDirty();this.scene.dispatchEvent({type:a.SCENE_STRUCTURE_CHANGED,newChild:b})},removeChild:function(b){var d=this.children.indexOf(b);-1!=d&&this.children.splice(d,1);this.scene.dispatchEvent({type:a.SCENE_STRUCTURE_CHANGED,removedChild:b})},getChildren:function(){return this.children},updateWorldMatrix:function(a){var b=this.page,d=this.offset;
XML3D.math.mat4.multiplyOffset(b,d+0,b,d+16,a,0);this.transformDirty=!1},setTransformDirty:function(){this.transformDirty=!0;this.children.forEach(function(a){a.setTransformDirty()})},setMaterial:function(a){this._material!==a&&(this._material=a,this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()}))},parentMaterialChanged:function(){this._material||this.children.forEach(function(a){a.parentMaterialChanged&&a.parentMaterialChanged()})},getMaterial:function(){return this._material||
this.parent.getMaterial()},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent&&this.parent.setBoundingBoxDirty()},setLocalVisible:function(a){this.localVisible=a;this.setVisible(this.parent&&this.parent.isVisible()&&a);this.setBoundingBoxDirty()},findRayIntersections:function(){var a=XML3D.math.bbox.create();return function(b,d){this.getWorldSpaceBoundingBox(a);if(XML3D.math.bbox.intersects(a,b))for(var e=0;e<this.children.length;e++)this.children[e].findRayIntersections(b,d)}}()});
m.exports=e},{"./constants.js":72,"./rendernode.js":78}],77:[function(e,m,l){var d=e("./rendernode.js");l=e("./constants.js");var b=e("../lights/light-models.js"),a=l.NODE_TYPE,c=l.EVENT_TYPE,f=XML3D.math.mat4.create();new Float32Array([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]);var k=new XML3D.math.bbox.create;e=function(b,c,f){d.call(this,a.LIGHT,b,c,f);f=f||{};b=f.light||{};this.userData=null;this.localIntensity=void 0!==f.localIntensity?f.localIntensity:1;this.setLightType(b.type,b.data)};e.ENTRY_SIZE=
16;XML3D.createClass(e,d);XML3D.extend(e.prototype,{setLightType:function(a,c){a=a||"directional";if(this.model){if(this.model.id==a)return;this.scene.lights.remove(this);this.lightStructureChanged(!0)}var d;a:switch(d=a,d){case "point":d=new b.PointLightModel(c,this);break a;case "spot":d=new b.SpotLightModel(c,this);break a;case "directional":d=new b.DirectionalLightModel(c,this);break a;default:XML3D.debug.logWarning("Unknown light model: ",d,". Using directional instead."),d=new b.DirectionalLightModel(c,
this)}this.model=d;this.scene.lights.add(this);this.lightStructureChanged(!1)},getFrustum:function(a){this.scene.getBoundingBox(k);return this.model.getFrustum(a,k)},lightValueChanged:function(){this.model&&this.scene.dispatchEvent({type:c.LIGHT_VALUE_CHANGED,light:this})},lightStructureChanged:function(a){this.scene.dispatchEvent({type:c.LIGHT_STRUCTURE_CHANGED,light:this,removed:a})},updateWorldMatrix:function(){this.parent&&(this.parent.getWorldMatrix(f),this.setWorldMatrix(f),this.lightValueChanged())},
setTransformDirty:function(){this.updateWorldMatrix()},setVisible:function(a){a=this.localVisible&&a;this.visible!=a&&(this.visible=a,this.lightValueChanged())},setLocalIntensity:function(a){this.localIntensity=a;this.lightValueChanged()},remove:function(){this.parent.removeChild(this);this.scene.lights.remove(this);this.lightStructureChanged(!0)},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});m.exports=e},{"../lights/light-models.js":70,"./constants.js":72,"./rendernode.js":78}],
78:[function(e,m,l){e=function(d,b,a,c){c=c||{};var f=!1!==c.visible;this.scene=b;this.type=d;this.name=c.name||"";this.page=a.page;this.offset=a.offset;this.entrySize=a.size;this.transformDirty=!0;this.children=[];this.setParent(c.parent||b.rootNode);this.visible=void 0;this.setLocalVisible(f)};XML3D.extend(e.prototype,{getChildren:function(){return this.children},getParent:function(){return this.parent},setParent:function(d){(this.parent=d)&&d.addChild&&d.addChild(this);this.setLocalVisible(this.localVisible)},
traverse:function(d){d(this);this.children.forEach(function(b){b.traverse(d)})},getWorldMatrix:function(d){this.transformDirty&&(this.parent.getWorldMatrix(d),this.updateWorldMatrix(d));for(var b=this.offset+0,a=0;16>a;a++,b++)d[a]=this.page[b]},setWorldMatrix:function(d){for(var b=this.offset+0,a=0;16>a;a++,b++)this.page[b]=d[a];this.transformDirty=!1;this.setBoundingBoxDirty&&this.setBoundingBoxDirty()},isVisible:function(){return this.visible},setTransformDirty:function(){this.transformDirty=!0},
setLocalVisible:function(d){this.localVisible=d;this.setVisible(this.parent&&this.parent.isVisible()&&d)},setVisible:function(d){var b=d;!1===this.localVisible&&(b=!1);this.visible!==b&&(this.visible=b,this.children.forEach(function(a){a.setVisible(b)}))},remove:function(){this.parent.removeChild(this);this.scene.freePageEntry({page:this.page,offset:this.offset,size:this.entrySize})},findRayIntersections:function(){}});m.exports=e},{}],79:[function(e,m,l){var d=e("../../webgl/system/system-notifier.js"),
b=e("./rendernode.js"),a=e("./drawableclosure.js"),c=e("./constants.js");e("./scene.js");var f=e("../../../xflow/interface/request.js").ComputeRequest,k=function(a,d,f){b.call(this,c.NODE_TYPE.OBJECT,a,d,f);f=f||{};this.node=f.node;this.object=f.object||{data:null,type:"triangles"};this.boundingBoxDirty=this.transformDirty=!0;this.transformDataRequest=this.createTransformRequest();this.drawable=this.createDrawable();this._material=f.material||null;this._actualMaterial=null;this.initMaterial();this.override=
null};k.ENTRY_SIZE=108;k.IDENTITY_MATRIX=XML3D.math.mat4.create();XML3D.createClass(k,b,{createTransformRequest:function(){return this.object.data?new f(this.object.data,["meshTransform"],this.onTransformDataChange.bind(this)):null},createDrawable:function(){var b=this.scene.createDrawable(this);if(b){var d=this;b.addEventListener(c.EVENT_TYPE.DRAWABLE_STATE_CHANGED,function(b){b.newState===a.READY_STATE.COMPLETE?d.scene.moveFromQueueToReady(d):b.newState===a.READY_STATE.INCOMPLETE&&b.oldState===
a.READY_STATE.COMPLETE&&d.scene.moveFromReadyToQueue(d)});b.updateTypeRequest();b.calculateBoundingBox();b.addEventListener(c.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(a){d.scene.dispatchEvent({type:c.EVENT_TYPE.SCENE_SHAPE_CHANGED})})}return b},setType:function(a){this.object.type=a},getType:function(){return this.object.type},getDataNode:function(){return this.object?this.object.data:null},getLocalMatrix:function(a){for(var b=this.offset+16,c=0;16>c;c++,b++)a[c]=this.page[b]},setLocalMatrix:function(a){for(var b=
this.offset+16,c=0;16>c;c++,b++)this.page[b]=a[c];this.setTransformDirty();this.setBoundingBoxDirty()},dispose:function(){this.transformDataRequest&&this.transformDataRequest.clear();this.scene.remove(this)},onTransformDataChange:function(){this.setTransformDirty()},getModelViewMatrix:function(a){for(var b=this.offset+44,c=0;16>c;c++,b++)a[c]=this.page[b]},getModelMatrixN:function(a){var b=this.offset+76;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+4];a[4]=this.page[b+
5];a[5]=this.page[b+6];a[6]=this.page[b+8];a[7]=this.page[b+9];a[8]=this.page[b+10]},getModelViewMatrixN:function(a){var b=this.offset+92;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+4];a[4]=this.page[b+5];a[5]=this.page[b+6];a[6]=this.page[b+8];a[7]=this.page[b+9];a[8]=this.page[b+10]},getModelViewProjectionMatrix:function(a){for(var b=this.offset+60,c=0;16>c;c++,b++)a[c]=this.page[b]},updateWorldSpaceMatrices:function(a,b){this.transformDirty&&this.updateWorldMatrix();
this.updateModelViewMatrix(a);this.updateModelMatrixN();this.updateModelViewMatrixN();this.updateModelViewProjectionMatrix(b)},updateWorldMatrix:function(){var a=XML3D.math.mat4.create();return function(){this.parent.getWorldMatrix(a);XML3D.math.mat4.multiplyOffset(a,0,this.page,this.offset+16,a,0);if(this.transformDataRequest){var b=this.transformDataRequest.getResult().getOutputData("meshTransform");b&&b.getValue()&&XML3D.math.mat4.multiply(a,a,b.getValue())}this.setWorldMatrix(a);this.boundingBoxDirty=
!0;this.transformDirty=!1}}(),updateModelViewMatrix:function(a){this.transformDirty&&this.updateWorldMatrix();var b=this.page,c=this.offset;XML3D.math.mat4.multiplyOffset(b,c+44,b,c+0,a,0)},updateModelMatrixN:function(){var a=XML3D.math.mat4.create();return function(){this.getWorldMatrix(a);for(var b=XML3D.math.mat4.invert(a,a),b=b?XML3D.math.mat4.transpose(b,b):k.IDENTITY_MATRIX,c=this.offset+76,d=0;16>d;d++,c++)this.page[c]=b[d]}}(),updateModelViewMatrixN:function(){var a=XML3D.math.mat4.create();
return function(){this.getModelViewMatrix(a);for(var b=XML3D.math.mat4.invert(a,a),b=b?XML3D.math.mat4.transpose(b,b):k.IDENTITY_MATRIX,c=this.offset+92,d=0;16>d;d++,c++)this.page[c]=b[d]}}(),updateModelViewProjectionMatrix:function(a){var b=this.page,c=this.offset;XML3D.math.mat4.multiplyOffset(b,c+60,b,c+44,a,0)},setTransformDirty:function(){this.transformDirty=!0;this.setBoundingBoxDirty();this.scene.dispatchEvent({type:c.EVENT_TYPE.SCENE_SHAPE_CHANGED});this.scene.requestRedraw("Transformation changed")},
setObjectSpaceBoundingBox:function(a){var b=this.offset+32;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5];this.setBoundingBoxDirty()},getObjectSpaceBoundingBox:function(a){var b=this.offset+32;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},setBoundingBoxDirty:function(){this.boundingBoxDirty=!0;this.parent.setBoundingBoxDirty()},setWorldSpaceBoundingBox:function(a){var b=
this.offset+38;this.page[b]=a[0];this.page[b+1]=a[1];this.page[b+2]=a[2];this.page[b+3]=a[3];this.page[b+4]=a[4];this.page[b+5]=a[5]},getWorldSpaceBoundingBox:function(a){this.boundingBoxDirty&&this.updateWorldSpaceBoundingBox();var b=this.offset+38;a[0]=this.page[b];a[1]=this.page[b+1];a[2]=this.page[b+2];a[3]=this.page[b+3];a[4]=this.page[b+4];a[5]=this.page[b+5]},updateWorldSpaceBoundingBox:function(){var a=new XML3D.math.bbox.create,b=new XML3D.math.mat4.create;return function(){this.getObjectSpaceBoundingBox(a);
this.getWorldMatrix(b);XML3D.math.bbox.transform(a,b,a);this.setWorldSpaceBoundingBox(a);this.boundingBoxDirty=!1}}(),setLocalVisible:function(a){this.localVisible=a;this.setVisible(this.parent&&this.parent.isVisible()&&a);this.setBoundingBoxDirty()},getProgram:function(){return this.drawable.getProgram()},hasTransparency:function(){var a=this.getProgram();return a?a.hasTransparency():!1},updateForRendering:function(){d.setNode(this.node);try{this.drawable&&this.drawable.update(this.scene)}catch(a){XML3D.debug.logError("Mesh Error: "+
a.message,this.node)}d.setNode(null)},findRayIntersections:function(){var a=XML3D.math.bbox.create(),b={dist:0};return function(c,d){this.getWorldSpaceBoundingBox(a);XML3D.math.bbox.intersects(a,c,b)&&d.push(this)}}(),setMaterial:function(a){this._material!==a&&(this._actualMaterial=(this._material=a)?a:this.parent.getMaterial(),this.materialChanged())},parentMaterialChanged:function(){this._material||this.initMaterial()},initMaterial:function(){this._actualMaterial=this._material?this._material:
this.parent.getMaterial();this.materialChanged()},materialChanged:function(){XML3D.debug.logDebug("material changed",this._actualMaterial);if(this.drawable){var a=this.scene.shaderFactory.createComposerFromMaterialConfiguration(this._actualMaterial);this.drawable.setShaderComposer(a)}}});m.exports=k},{"../../../xflow/interface/request.js":152,"../../webgl/system/system-notifier.js":131,"./constants.js":72,"./drawableclosure.js":73,"./rendernode.js":78,"./scene.js":81}],80:[function(e,m,l){var d=e("./rendernode.js");
l=e("./constants.js");var b=e("../tools/frustum.js").Frustum,a=l.NODE_TYPE,c=.25*Math.PI;e=function(f,e,h){d.call(this,a.VIEW,f,e,h);h=h||{};this.position=h.position||XML3D.math.vec3.create();this.orientation=h.orientation||XML3D.math.mat4.create();this.fieldOfView=void 0!==h.fieldOfView?h.fieldOfView:c;this.worldSpacePosition=XML3D.math.vec3.create();this.projectionOverride=h.projectionOverride;this.projectionDirty=this.viewDirty=!0;this.frustum=new b(1,1E5,0,this.fieldOfView,1);this.lastAspectRatio=
1};e.ENTRY_SIZE=48;XML3D.createClass(e,d);XML3D.extend(e.prototype,{getFrustum:function(){return this.frustum},updateViewMatrix:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(){XML3D.math.mat4.identity(a);a[12]=this.position[0];a[13]=this.position[1];a[14]=this.position[2];XML3D.math.mat4.multiply(a,a,this.orientation);this.parent.getWorldMatrix(b);XML3D.math.mat4.multiply(a,b,a);XML3D.math.vec3.set(this.worldSpacePosition,a[12],a[13],a[14]);this.setViewToWorldMatrix(a);
XML3D.math.mat4.invert(a,a);this.setWorldToViewMatrix(a);this.viewDirty=!1}}(),updateProjectionMatrix:function(){var a=XML3D.math.mat4.create();return function(b){if(this.projectionOverride)this.setProjectionMatrix(this.projectionOverride),this.frustum.setFrustum(1,1E5,0,this.fieldOfView,1);else{var c=this.getClippingPlanes(),d=c.near,c=c.far,e=this.fieldOfView;XML3D.math.mat4.perspective(a,e,b,d,c);this.setProjectionMatrix(a);this.frustum.setFrustum(d,c,0,e,b);this.lastAspectRatio=b}}}(),getClippingPlanes:function(){var a=
XML3D.math.mat4.create(),b=new XML3D.math.bbox.create;return function(){this.scene.getBoundingBox(b);if(XML3D.math.bbox.isEmpty(b))return{near:1,far:10};this.getWorldToViewMatrix(a);XML3D.math.bbox.transform(b,a,b);var c=-b[5],d=-b[2],e=Math.max(.005*(d-c),.05),d=d+e;return{near:Math.max(c-e,e,.01),far:d}}}(),setMatrix:function(a,b){for(var c=this.offset+b,d=0;16>d;d++,c++)this.page[c]=a[d]},setWorldToViewMatrix:function(a){this.setMatrix(a,16)},setViewToWorldMatrix:function(a){this.setMatrix(a,0)},
setProjectionMatrix:function(a){for(var b=this.offset+32,c=0;16>c;c++,b++)this.page[b]=a[c];this.projectionDirty=!1},setProjectionOverride:function(a){this.projectionOverride=a;this.setProjectionDirty();this.scene.requestRedraw("Projection changed")},setTransformDirty:function(){this.viewDirty=!0;this.setProjectionDirty();this.scene.requestRedraw("Transformation changed")},setProjectionDirty:function(){this.projectionDirty=!0},updatePosition:function(a){this.setTransformDirty();this.position[0]=a[0];
this.position[1]=a[1];this.position[2]=a[2]},updateOrientation:function(a){this.setTransformDirty();for(var b=0;16>b;b++)this.orientation[b]=a[b]},updateFieldOfView:function(a){this.setTransformDirty();this.fieldOfView=a},getViewToWorldMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+0,c=0;16>c;c++,b++)a[c]=this.page[b]},getWorldToViewMatrix:function(a){this.viewDirty&&this.updateViewMatrix();for(var b=this.offset+16,c=0;16>c;c++,b++)a[c]=this.page[b]},getProjectionMatrix:function(a,
b){(this.projectionDirty||b!=this.lastAspectRatio)&&this.updateProjectionMatrix(b);for(var c=this.offset+32,d=0;16>d;d++,c++)a[d]=this.page[c]},getWorldSpacePosition:function(){return this.worldSpacePosition},getWorldSpaceBoundingBox:function(a){XML3D.math.bbox.empty(a)}});m.exports=e},{"../tools/frustum.js":83,"./constants.js":72,"./rendernode.js":78}],81:[function(e,m,l){var d=e("./pager.js"),b=e("./renderobject.js"),a=e("./renderview.js"),c=e("./rendergroup.js"),f=e("./renderlight.js"),k=e("./material-configuration.js"),
h=e("../lights/light-manager.js"),g=e("./constants.js"),q=e("../../../xflow/interface/graph.js").InputNode,r=e("../../../xflow/interface/graph.js").DataNode,n=e("../../../xflow/interface/data.js").BufferEntry,p=e("../../../xflow/interface/constants.js"),t=e("../../../utils/uri.js").URI;e=function(){d.call(this);this.boundingBox=new XML3D.math.bbox.create;this.lights=new h;this._defaultMaterial=this.activeView=null;this.rootNode=this.createRootNode()};XML3D.createClass(e,d);XML3D.extend(e.prototype,
{getActiveView:function(){return this.activeView},setActiveView:function(a){if(a!=this.activeView){if(!a)throw Error("Active view must not be null");this.activeView=a;this.dispatchEvent({type:g.EVENT_TYPE.VIEW_CHANGED,newView:this.activeView})}},createRenderObject:function(a){var c=this.getPageEntry(b.ENTRY_SIZE);return new b(this,c,a)},createRenderGroup:function(a){var b=this.getPageEntry(c.ENTRY_SIZE);return new c(this,b,a)},createRenderView:function(b){var c=this.getPageEntry(a.ENTRY_SIZE);return new a(this,
c,b)},createRenderLight:function(a){var b=this.getPageEntry(f.ENTRY_SIZE);return new f(this,b,a)},createMaterialConfiguration:function(a,b,c){return new k(a,b,c)},createRootNode:function(){var a=this.getPageEntry(c.ENTRY_SIZE),a=new c(this,a,{material:this.getDefaultMaterial()});a.setWorldMatrix(XML3D.math.mat4.create());a.setLocalMatrix(XML3D.math.mat4.create());a.transformDirty=!1;a.visible=!0;return a},updateBoundingBox:function(){this.rootNode.boundingBoxDirty&&this.activeView&&this.activeView.setProjectionDirty();
this.rootNode.getWorldSpaceBoundingBox(this.boundingBox)},getBoundingBox:function(a){this.updateBoundingBox();XML3D.math.bbox.copy(a,this.boundingBox)},createDrawable:function(){throw Error("Scene::createDrawable not implemented");},requestRedraw:function(){throw Error("Scene::requestRedraw not implemented");},traverse:function(a){this.rootNode.traverse(a)},findRayIntersections:function(a){var b=[];this.rootNode.findRayIntersections(a,b);return b},getDefaultMaterial:function(){if(!this._defaultMaterial){var a=
new q;a.data=new n(p.DATA_TYPE.FLOAT3,new Float32Array([1,0,0]));a.name="diffuseColor";var b=new r(!1);b.appendChild(a);this._defaultMaterial=this.createMaterialConfiguration({type:"urn",urn:new t("urn:xml3d:shader:matte")},b,{name:"default"})}return this._defaultMaterial}});m.exports=e},{"../../../utils/uri.js":146,"../../../xflow/interface/constants.js":149,"../../../xflow/interface/data.js":150,"../../../xflow/interface/graph.js":151,"../lights/light-manager.js":69,"./constants.js":72,"./material-configuration.js":74,
"./pager.js":75,"./rendergroup.js":76,"./renderlight.js":77,"./renderobject.js":79,"./renderview.js":80}],82:[function(e,m,l){var d=e("../../../xflow/interface/data.js").DataChangeNotifier;e=function(){d.addListener(this.dataEntryChanged)};e.prototype.dataEntryChanged=function(b,a){if(b.userData.webglData)for(var c in b.userData.webglData)b.userData.webglData[c].changed=Math.max(b.userData.webglData[c].changed,a)};m.exports=e},{"../../../xflow/interface/data.js":150}],83:[function(e,m,l){var d=XML3D.math.vec3,
b=d.create(),a=d.create();e=function(a,b,c,d,e,r){this.orthographic="undefined"===typeof r?!1:r;this.setFrustum(a,b,c,d,e,this.orthographic)};XML3D.extend(e.prototype,{setFrustum:function(a,b,c,d,e,r){if(c&&d)throw Error("fovx and fovy cannot both be non-zero.");c?(this.right=a*Math.tan(c/2),this.left=-this.right,this.top=(this.right-this.left)/e/2,this.bottom=-this.top):(this.top=a*Math.tan(.5*d),this.bottom=-this.top,this.right=(this.top-this.bottom)*e/2,this.left=-this.right);this.nearPlane=a;
this.farPlane=b;this.orthographic="undefined"===typeof r?!1:r},getProjectionMatrix:function(a){var b=Number.MAX_VALUE,c=this.right+this.left,d=this.right-this.left,e=this.top+this.bottom,r=this.top-this.bottom,n=this.farPlane+this.nearPlane,p=this.farPlane-this.nearPlane;if(1>Math.abs(d)&&Math.abs(c)>b*Math.abs(d)||1>Math.abs(r)&&Math.abs(e)>b*Math.abs(r)||1>Math.abs(p)&&Math.abs(n)>b*Math.abs(p))throw Error("Bad viewing frustum: projection matrix cannot be computed.");if(this.orthographic){var t=
-c/d,l=-e/r,u=-n/p;if(1>Math.abs(d)&&2>b*Math.abs(d)||1>Math.abs(r)&&2>b*Math.abs(r)||1>Math.abs(p)&&2>b*Math.abs(p))throw Error("Bad viewing frustum:  projection matrix cannot be computed.");c=2/d;e=2/r;n=-2/p;XML3D.math.mat4.identity(a);a[0]=c;a[5]=e;a[10]=n;a[12]=t;a[13]=l;a[14]=u;a[15]=1}else{c/=d;e/=r;n=-n/p;t=-2*this.farPlane*this.nearPlane;if(1>Math.abs(p)&&Math.abs(t)>b*Math.abs(p))throw Error("Bad viewing frustum: projection matrix cannot be computed.");p=t/p;t=2*this.nearPlane;if(1>Math.abs(d)&&
Math.abs(t)>b*Math.abs(d)||1>Math.abs(r)&&Math.abs(t)>b*Math.abs(r))throw Error("Bad viewing frustum: projection matrix cannot be computed.");b=t/d;r=t/r;XML3D.math.mat4.identity(a);a[0]=b;a[5]=r;a[8]=c;a[9]=e;a[10]=n;a[11]=-1;a[14]=p;a[15]=0}},getPlanes:function(){var a=d.create(),b=d.create(),c=d.create(),e=d.create(),q=d.create(),r=d.create(),n=d.create(),p=d.create();return function(t,l){var u=d.transformMat4(a,[this.left,this.bottom,-this.nearPlane],l),v=d.transformMat4(b,[this.left,this.top,
-this.nearPlane],l),w=d.transformMat4(c,[this.right,this.top,-this.nearPlane],l),m=d.transformMat4(e,[this.right,this.bottom,-this.nearPlane],l),y,E,C,A;this.orthographic?(y=d.transformMat4(q,[this.left,this.bottom,-this.farPlane],l),E=d.transformMat4(r,[this.left,this.top,-this.farPlane],l),C=d.transformMat4(n,[this.right,this.top,-this.farPlane],l),A=d.transformMat4(p,[this.right,this.bottom,-this.farPlane],l),t[0].setFromPoints(w,C,E),t[1].setFromPoints(m,A,C),t[2].setFromPoints(u,y,A),t[3].setFromPoints(v,
E,y)):(y=this.farPlane/this.nearPlane,E=y*this.left,C=y*this.right,A=y*this.top,y=d.transformMat4(q,[E,y*this.bottom,-this.farPlane],l),E=d.transformMat4(r,[E,A,-this.farPlane],l),C=d.transformMat4(n,[C,A,-this.farPlane],l),A=d.transformMat4(p,[0,0,0],l),t[0].setFromPoints(A,w,v),t[1].setFromPoints(A,m,w),t[2].setFromPoints(A,u,m),t[3].setFromPoints(A,v,u));t[4].setFromPoints(u,m,w);t[5].setFromPoints(y,E,C)}}()});var c=function(){this.distance=0;this.normal=d.create()};XML3D.extend(c.prototype,{setFromPoints:function(c,
e,h){d.cross(this.normal,d.sub(a,h,c),d.sub(b,e,c));d.normalize(this.normal,this.normal);this.distance=-d.dot(this.normal,c)},set:function(a,b,c,e){d.set(this.normal,a,b,c);d.normalize(this.normal,this.normal);this.distance=e}});l=function(a,b){this.frustumPlanes=[new c,new c,new c,new c,new c,new c];a&&b&&this.set(a,b)};XML3D.extend(l.prototype,{set:function(a,b){a.getPlanes(this.frustumPlanes,b)},isBoxVisible:function(){return function(a){if(XML3D.math.bbox.isEmpty(a))return!1;for(var b=0;b<this.frustumPlanes.length;b++){var c=
this.frustumPlanes[b],d=c.normal;if(0>(0<=d[0]?a[3]:a[0])*d[0]+(0<=d[1]?a[4]:a[1])*d[1]+(0<=d[2]?a[5]:a[2])*d[2]+c.distance)return!1}return!0}}()});m.exports={Plane:c,Frustum:e,FrustumTest:l}},{}],84:[function(e,m,l){e=function(){};var d=XML3D.math.bbox.create(),b=XML3D.math.vec3.create();XML3D.extend(e.prototype,{sortScene:function(a,c){for(var f=a.ready,e={},h=[],g=[],q,r=0,n=f.length;r<n;r++)if(q=f[r],!1!==q.inFrustum)if(q.hasTransparency())g.push(q);else{var p=q.getProgram();e[p.id]=e[p.id]||
[];e[p.id].push(q)}for(var t in e){f=e[t];n=Array(f.length);for(r=0;r<f.length;r++)q=f[r],q.getWorldSpaceBoundingBox(d),XML3D.math.bbox.center(b,d),c&&XML3D.math.vec3.transformMat4(b,b,c),n[r]={obj:q,depth:b[2]};n.sort(function(a,b){return b.depth-a.depth});e[t]=n.map(function(a){return a.obj})}t=g.length;if(1<t){for(r=0;r<t;r++)q=g[r],q.getWorldSpaceBoundingBox(d),XML3D.math.bbox.center(b,d),c&&XML3D.math.vec3.transformMat4(b,b,c),g[r]=[q,b[2]];g.sort(function(a,b){return a[1]-b[1]});for(r=0;r<t;r++)h[r]=
g[r][0]}else 1==t&&(h[0]=g[0]);return{opaque:e,transparent:h}}});m.exports=e},{}],85:[function(e,m,l){m.exports={convertPageCoords:function(d,b,a){var c;c=d.getBoundingClientRect();var f=document.body,e=document.documentElement;d=c.left+(window.pageXOffset||e.scrollLeft||f.scrollLeft)-(e.clientLeft||f.clientLeft||0);c=Math.round(c.top+(window.pageYOffset||e.scrollTop||f.scrollTop)-(e.clientTop||f.clientTop||0));d=Math.round(d);return{x:b-d,y:a-c}}}},{}],86:[function(e,m,l){var d=e("texture-manager").SimpleTextureManager,
b=e("./texture.js").GLTexture,a=e("./texture.js").GLCubeMap,c=e("./rendertarget.js").GLCanvasTarget,f=e("./../shader/programfactory.js"),k=e("../../../xflow/interface/constants.js"),h={alpha:!0,premultipliedAlpha:!1,antialias:!0,stencil:!0,preserveDrawingBuffer:!0};e=function(a,b){var e;try{e=a.getContext("experimental-webgl",h)}catch(k){e=null}this.gl=e;this.id=b;this.canvasTarget=new c(this,a.clientWidth,a.clientHeight);this.programFactory=new f(this);this.textureManager=new d({units:this.gl.getParameter(WebGLRenderingContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS)});
this.stats={materials:0,meshes:0};e=this.gl;var t={},l;for(l in g){var u=g[l],v=e.getExtension(u);v?t[u]=v:XML3D.debug.logInfo(u,"is not supported on your graphics card")}this.extensions=t};var g=e.EXTENSIONS={};g.STANDARD_DERIVATES="OES_standard_derivatives";g.MULTIPLE_RENDER_TARGETS="WEBGL_draw_buffers";g.DEPTH_TEXTURE="WEBGL_depth_texture";g.FLOAT_COLOR_BUFFER="WEBGL_color_buffer_float";g.FLOAT_TEXTURES="OES_texture_float";g.UINT32_INDICES="OES_element_index_uint";XML3D.extend(e.prototype,{getXflowEntryWebGlData:function(a){var b=
this.id;a?(a.userData.webglData||(a.userData.webglData={}),a.userData.webglData[b]||(a.userData.webglData[b]={changed:k.DATA_ENTRY_STATE.CHANGED_NEW}),a=a.userData.webglData[b]):a=null;return a},requestRedraw:function(a){},handleResizeEvent:function(a,b){this.canvasTarget=new c(this,a,b)},getStatistics:function(){return this.stats},getExtensionByName:function(a){return this.extensions[a]},createTexture:function(){return new b(this)},createCubeMap:function(){return new a(this)}});m.exports=e},{"../../../xflow/interface/constants.js":149,
"./../shader/programfactory.js":129,"./rendertarget.js":90,"./texture.js":91,"texture-manager":16}],87:[function(e,m,l){e=function(d){this.gl=d.gl;this.createGLAssets()};XML3D.extend(e.prototype,{createGLAssets:function(){var d=this.gl;this.posBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this.posBuffer);d.bufferData(d.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),d.STATIC_DRAW)},draw:function(d){var b=this.gl;d=d.attributes.position;b.enableVertexAttribArray(d.location);b.bindBuffer(b.ARRAY_BUFFER,
this.posBuffer);b.vertexAttribPointer(d.location,3,b.FLOAT,!1,0,0);b.drawArrays(b.TRIANGLE_STRIP,0,4);b.disableVertexAttribArray(d.location)}});m.exports=e},{}],88:[function(e,m,l){e=function(b,a){this.context=b;this.glType=d(a);this.buffers={};this.uniformOverride={};this.maxIndex=this.minIndex=0;this.isIndexed=!1;this.vertexCount=null;this.minAttributeCount=-1;this.context.getStatistics().meshes++;this.multiDraw=this.glType==WebGLRenderingContext.LINE_STRIP||this.glType==WebGLRenderingContext.TRIANGLE_STRIP};
XML3D.extend(e.prototype,{setIndexRange:function(b,a){this.minIndex=b;this.maxIndex=a},checkBufferCompatible:function(b,a){var c=a.getIterateCount();this.minAttributeCount=-1==this.minAttributeCount?c:Math.min(this.minAttributeCount,c);if(this.isIndexed){if(c<=this.maxIndex)throw Error("Index range of ["+this.minIndex+", "+this.maxIndex+"]  goes beyond element count "+c+" of attribute '"+b+"'");}else if(null!==this.vertexCount&&c<this.vertexCount)throw Error("VertexCount "+this.vertexCount+" is larger than element count "+
c+" of attribute '"+b+"'");},removeBuffer:function(b){delete this.buffers[b]},setBuffer:function(b,a){this.buffers[b]=a;this.isIndexed=this.isIndexed||"index"==b},clear:function(){this.buffers={};this.uniformOverride={};this.minIndex=this.maxIndex=0;this.isIndexed=!1;this.minAttributeCount=-1},setUniformOverride:function(b,a){void 0===a&&delete this.uniformOverride[b];this.uniformOverride[b]=a},setVertexCount:function(b){this.vertexCount=b},isReadyToRender:function(){return 0<this.minAttributeCount},
getElementCount:function(){try{return this.buffers.index.length}catch(b){return 0}},getVertexCount:function(){try{return null!=this.vertexCount?this.vertexCount:this.minAttributeCount}catch(b){return 0}},_bindVertexBuffers:function(b){var a=this.context.gl;b=b.attributes;var c=this.buffers,d,e,h=Object.keys(b),g=h.length;for(d=0;d<g;d++){e=h[d];var q=c[e];e=b[e].location;q&&(a.enableVertexAttribArray(e),a.bindBuffer(a.ARRAY_BUFFER,q),a.vertexAttribPointer(e,q.tupleSize,q.glType,!1,0,0))}},_unbindVertexBuffers:function(b){var a=
this.context.gl;b=b.attributes;for(var c in b)a.disableVertexAttribArray(b[c].location);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)},draw:function(b){var a=this.context.gl,c=this.buffers,d=0,e;this._bindVertexBuffers(b);if(this.isIndexed){d=c.index;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d);if(this.multiDraw&&this.vertexCount)for(e=c=0;e<this.vertexCount.length;e++){var h=this.vertexCount[e];a.drawElements(this.glType,h,d.glType,c*d.bytesPerElement);c+=h}else a.drawElements(this.glType,
this.getElementCount(),d.glType,0);d=this.getElementCount()/3}else if(this.multiDraw&&this.vertexCount)for(e=c=0;e<this.vertexCount.length;e++)h=this.vertexCount[e],a.drawArrays(this.glType,c,h),c+=h;else a.drawArrays(this.glType,0,this.getVertexCount()),d=this.getVertexCount();this._unbindVertexBuffers(b);b.undoUniformVariableOverride&&b.undoUniformVariableOverride(this.uniformOverride);return d}});var d=function(b){var a=window.WebGLRenderingContext;b&&b.toLoweGLase&&(b=b.toLowerCase());switch(b){case "triangles":return a.TRIANGLES;
case "tristrips":return a.TRIANGLE_STRIP;case "points":return a.POINTS;case "lines":return a.LINES;case "linestrips":return a.LINE_STRIP;default:throw Error("Unknown primitive type: "+b);}};m.exports=e},{}],89:[function(e,m,l){var d=e("./utils.js"),b=e("../system/system-notifier.js"),a=function(a,c,d){var e=a.createShader(c);a.shaderSource(e,d);a.compileShader(e);if(0==a.getShaderParameter(e,WebGLRenderingContext.COMPILE_STATUS)){var e=a.getShaderInfoLog(e),q="",q=c==WebGLRenderingContext.VERTEX_SHADER?
"Vertex shader failed to compile: \n":"Fragment shader failed to compile: \n",q=q+(e+"\n--------\n")+"Shader Source:\n--------\n",q=q+XML3D.debug.formatSourceCode(d);a.getError();b.sendEvent("glsl",{glslType:"compile_error",shaderType:c==WebGLRenderingContext.VERTEX_SHADER?"vertex":"fragment",code:d,message:e});throw Error(q);}return e},c=d.getUniqueCounter();e=function(a,b){this.gl=a;this.sources=b;this.id=c();this.attributes={};this.uniforms={};this.samplers={};this.handle=null;this.create()};XML3D.extend(e.prototype,
{create:function(){XML3D.debug.logDebug("Create shader program: ",this.id);var c=this.gl,e=[this.sources.vertex],h=[this.sources.fragment],g,q,r=[];for(q in e)g=e[q],g=a(c,WebGLRenderingContext.VERTEX_SHADER,g),r.push(g);for(q in h)g=h[q],g=a(c,WebGLRenderingContext.FRAGMENT_SHADER,g),r.push(g);var e=c.createProgram(),n;for(n in r)c.attachShader(e,r[n]);c.linkProgram(e);if(0==c.getProgramParameter(e,WebGLRenderingContext.LINK_STATUS))throw r=c.getProgramInfoLog(e),n="Shader linking failed: \n"+r+
"\n--------\n",c.getError(),b.sendEvent("glsl",{glslType:"link_error",message:r}),Error(n);if(this.handle=e){b.sendEvent("glsl",{glslType:"success"});this.bind();c=this.gl;r=this.handle;e=c.getProgramParameter(r,c.ACTIVE_ATTRIBUTES);for(n=0;n<e;n++)if(h=c.getActiveAttrib(r,n))q={},q.name=h.name,q.size=h.size,q.glType=h.type,q.location=c.getAttribLocation(r,h.name),this.attributes[h.name]=q;e=c.getProgramParameter(r,c.ACTIVE_UNIFORMS);for(n=0;n<e;n++)if(h=c.getActiveUniform(r,n))q={},q.name=h.name,
q.size=h.size,q.glType=h.type,q.location=c.getUniformLocation(r,h.name),g=q.name,"[0]"==g.substring(g.length-3)&&(g=g.substring(0,g.length-3)),h.type==c.SAMPLER_2D||h.type==c.SAMPLER_CUBE?(q.cachedUnits=new Int32Array(q.size),q.textures=[],d.setUniform(c,q,q.cachedUnits),this.samplers[g]=q):this.uniforms[g]=q}},bind:function(){this.handle||XML3D.debug.logError("Trying to bind invalid GLProgram.");this.gl.useProgram(this.handle);for(var a in this.samplers){var b=this.samplers[a];b.textures.length&&
this.setSamplerFromTextures(b)}},unbind:function(){},isValid:function(){return!!this.handle},setUniformVariables:function(a,b,c){var d,e,r,n;if(a&&c.envBase)for(d=a.length,e=c.envBase,r=c.envOverride;d--;)n=a[d],this.setUniformVariable(n,r&&void 0!==r[n]?r[n]:e[n]);if(b&&c.sysBase)for(d=b.length,e=c.sysBase;d--;)n=b[d],this.setUniformVariable(n,e[n])},setUniformVariable:function(a,b){void 0!==b&&(this.uniforms[a]?d.setUniform(this.gl,this.uniforms[a],b):this.samplers[a]&&this.setUniformSampler(this.samplers[a],
b))},setSamplerFromTextures:function(a){for(var b=a.textures,c=a.cachedUnits,e=!1,q=0,r=b.length;q<r;q++){var n=b[q].unit;-1==n&&(n=b[q]._bind());n!=c[q]&&(c[q]=n,e=!0)}e&&(XML3D.debug.logDebug("Setting new texture units:",a.name,c),d.setUniform(this.gl,a,c))},setSamplerFromArray:function(a,b){for(var c=a.cachedUnits,e=!1,q=0,r=b.length;q<r;q++){var n=b[q];n!=c[q]&&(c[q]=n,e=!0)}e&&(d.setUniform(this.gl,a,c),XML3D.debug.logDebug("Setting global texture units:",a.name,c,this.id))},setUniformSampler:function(a,
b){XML3D.debug.assert(b&&a);XML3D.debug.assert(Array.isArray(b),"Program::setUniformSampler: Unexpected value.");XML3D.debug.assert(b.length,"Program::setUniformSampler: No entry in value.");void 0!=b[0].unit?(a.textures=b,this.setSamplerFromTextures(a)):this.setSamplerFromArray(a,b)}});m.exports=e},{"../system/system-notifier.js":131,"./utils.js":92}],90:[function(e,m,l){e=function(a,b,d){this.context=a;this.width=b;this.height=d};l=function(){};XML3D.extend(e.prototype,{getWidth:function(){return this.width},
getHeight:function(){return this.height},getScale:function(){return 1},bind:l,unbind:l,resize:l});var d=function(a,b){this.context=a;this.width=b.width||800;this.height=b.height||600;this.scale=b.scale||1;this.opt=this.fillOptions(b);this.handle=null;this.colorTarget={handle:null,isTexture:!1};this.depthTarget={handle:null,isTexture:!1};this.stencilTarget={handle:null,isTexture:!1};this.valid=!1};XML3D.extend(d.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},
getScale:function(){return this.scale},bind:function(){var a=!1;this.handle||(this.createFrameBuffer(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),a=!0);if(this.valid){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.handle);a&&b.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},resize:function(a,b){this.dispose();this.width=a;this.height=b;this.bind()},createFrameBuffer:function(a,b,d){var e=this.context.gl;
this.handle=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,this.handle);a&&this.createColorTarget(a);b&&this.createDepthTarget(b);d&&this.createStencilTarget(d);this.checkStatus()},createColorTarget:function(a){var b=this.context.gl;if(this.opt.colorAsRenderbuffer){var d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,
b.RENDERBUFFER,d);this.colorTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,this.height,b.RGBA,this.opt.colorType||b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.handle,0),this.colorTarget={handle:d,isTexture:!0}},createDepthTarget:function(a){var b=this.context.gl;this.opt.isDepth=!0;if(this.opt.depthAsRenderbuffer){var d=b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,
a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.RENDERBUFFER,d);this.depthTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,this.height,b.DEPTH_COMPONENT,b.FLOAT,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_ATTACHMENT,b.TEXTURE_2D,d.handle,0),this.depthTarget={handle:d,isTexture:!0}},createStencilTarget:function(a){var b=this.context.gl;if(this.opt.stencilAsRenderbuffer){var d=
b.createRenderbuffer();b.bindRenderbuffer(b.RENDERBUFFER,d);b.renderbufferStorage(b.RENDERBUFFER,a,this.width,this.height);b.bindRenderbuffer(b.RENDERBUFFER,null);b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,d);this.stencilTarget={handle:d,isTexture:!1}}else d=this.context.createTexture(),d.createTex2DFromData(a,this.width,this.height,b.STENCIL_COMPONENT,b.UNSIGNED_BYTE,this.opt),b.framebufferTexture2D(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.TEXTURE_2D,d.handle,0),this.stencilTarget=
{handle:d,isTexture:!0}},checkStatus:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.handle);var b=a.checkFramebufferStatus(a.FRAMEBUFFER);switch(b){case a.FRAMEBUFFER_COMPLETE:break;case a.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case a.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");
break;case a.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+b)}a.bindFramebuffer(a.FRAMEBUFFER,null);return this.valid=b==a.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var b=this.context.gl,b={wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.NEAREST,magFilter:b.NEAREST,depthMode:b.LUMINANCE,depthCompareMode:b.COMPARE_R_TO_TEXTURE,depthCompareFunc:b.LEQUAL,colorsAsRenderbuffer:!1,
depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},d;for(d in a)b[d]=a[d];return b},dispose:function(){if(this.handle){var a=this.context.gl;a.deleteFramebuffer(this.handle);null!==this.colorTarget&&(this.colorTarget.isTexture?this.colorTarget.handle.dispose():a.deleteRenderBuffer(this.colorTarget.handle));null!==this.depthTarget&&(this.depthTarget.isTexture?this.depthTarget.handle.dispose():a.deleteRenderBuffer(this.depthTarget.handle));null!==this.stencilTarget&&(this.stencilTarget.isTexture?
this.stencilTarget.handle.dispose():a.deleteRenderBuffer(this.stencilTarget.handle))}}});l=function(a,b,e){d.call(this,a,e);this.scaleToMaxDimension(b)};XML3D.createClass(l,d);XML3D.extend(l.prototype,{scaleToMaxDimension:function(a){var b=this.height-a,d=this.width-a;if(0<b||0<d)a=b>d?a/this.height:a/this.width,this.width=Math.floor(this.width*a),this.height=Math.floor(this.height*a),this.scale=a}});var b=function(a,b){var d=a.gl;this.context=a;this.height=this.width=b.width||800;this.scale=b.scale||
1;this.opt=this.fillOptions(b);this.stencilTarget=this.depthTarget=this.colorTarget=this.stex=this.dtex=this.ctex=this.handle=null;this.valid=!1;this.glSides=[d.TEXTURE_CUBE_MAP_POSITIVE_X,d.TEXTURE_CUBE_MAP_NEGATIVE_X,d.TEXTURE_CUBE_MAP_POSITIVE_Y,d.TEXTURE_CUBE_MAP_NEGATIVE_Y,d.TEXTURE_CUBE_MAP_POSITIVE_Z,d.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.framebuffers=[]};XML3D.extend(b.prototype,{getWidth:function(){return this.width},getHeight:function(){return this.height},getScale:function(){return this.scale},
bind:function(a){var b=!1;0>=this.framebuffers.length&&(this.createFrameBuffers(this.opt.colorFormat,this.opt.depthFormat,this.opt.stencilFormat),b=!0);if(this.valid){var d=this.context.gl;d.bindFramebuffer(d.FRAMEBUFFER,this.framebuffers[a]);b&&d.viewport(0,0,this.width,this.height)}},unbind:function(){var a=this.context.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)},resize:function(a,b){this.dispose();this.width=a;this.height=b;this.bind()},createFrameBuffers:function(a,b,d){var e=this.context.gl;a&&
(this.ctex=this.context.createCubeMap(),this.ctex.createTex2DFromData(a,this.width,this.height,e.RGBA,this.opt.colorType||e.UNSIGNED_BYTE,this.opt),this.colorTarget={handle:this.ctex,isTexture:!0});b&&(this.opt.isDepth=!0,this.opt.depthAsRenderbuffer||(this.dtex=this.context.createCubeMap(),this.dtex.createTex2DFromData(b,this.width,this.height,e.DEPTH_COMPONENT,e.FLOAT,this.opt),this.depthTarget={handle:this.dtex,isTexture:!0}));d&&(this.stex=this.context.createCubeMap(),this.stex.createTex2DFromData(d,
this.width,this.height,e.STENCIL_COMPONENT,e.UNSIGNED_BYTE,this.opt),this.stencilTarget={handle:this.stex,isTexture:!0});for(var h=0;h<this.glSides.length;++h)this.framebuffers[h]=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffers[h]),a&&this.createColorTarget(a,h),b&&this.createDepthTarget(b,h),d&&this.createStencilTarget(d,h),this.checkStatus(h)},createColorTarget:function(a,b){var d=this.context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,this.glSides[b],this.ctex.handle,
0)},createDepthTarget:function(a,b){var d=this.context.gl;this.opt.depthAsRenderbuffer?(this.dtex||(this.dtex=[]),this.dtex[b]=d.createRenderbuffer(),d.bindRenderbuffer(d.RENDERBUFFER,this.dtex[b]),d.renderbufferStorage(d.RENDERBUFFER,a,this.width,this.height),d.bindRenderbuffer(d.RENDERBUFFER,null),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.dtex[b]),this.depthTarget||(this.depthTarget=[]),this.depthTarget[b]={handle:this.dtex[b],isTexture:!1}):d.framebufferTexture2D(d.FRAMEBUFFER,
d.DEPTH_ATTACHMENT0,this.glSides[b],this.dtex.handle,0)},createStencilTarget:function(a,b){var d=this.context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,this.glSides[b],this.stex.handle,0)},checkStatus:function(a){var b=this.context.gl;b.bindFramebuffer(b.FRAMEBUFFER,this.framebuffers[a]);a=b.checkFramebufferStatus(b.FRAMEBUFFER);switch(a){case b.FRAMEBUFFER_COMPLETE:break;case b.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT");
break;case b.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case b.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case b.FRAMEBUFFER_UNSUPPORTED:XML3D.debug.logError("Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED");break;default:XML3D.debug.logError("Incomplete framebuffer: "+a)}b.bindFramebuffer(b.FRAMEBUFFER,null);return this.valid=
a==b.FRAMEBUFFER_COMPLETE},fillOptions:function(a){var b=this.context.gl,b={wrapS:b.CLAMP_TO_EDGE,wrapT:b.CLAMP_TO_EDGE,minFilter:b.NEAREST,magFilter:b.NEAREST,depthMode:b.LUMINANCE,depthCompareMode:b.COMPARE_R_TO_TEXTURE,depthCompareFunc:b.LEQUAL,colorsAsRenderbuffer:!1,depthAsRenderbuffer:!1,stencilAsRenderbuffer:!1,isDepth:!1},d;for(d in a)b[d]=a[d];return b},dispose:function(){if(!(0>=this.framebuffers.length)){var a=this.context.gl,b;for(b in this.framebuffers)a.deleteFramebuffer(this.framebuffers[b]);
null!==this.colorTarget.handle&&this.colorTarget.handle.dispose();null!==this.depthTarget&&this.depthTarget.handle.dispose();null!==this.stencilTarget&&this.stencilTarget.handle.dispose();this.framebuffers=[]}}});m.exports={GLCanvasTarget:e,GLRenderTarget:d,GLScaledRenderTarget:l,GLCubeMapRenderTarget:b}},{}],91:[function(e,m,l){var d=e("./utils.js");l=e("../../../contrib/state-machine.js");var b=e("../../../xflow/interface/data.js").SamplerConfig,a=e("../../../xflow/interface/constants.js"),c=d.getUniqueCounter(),
f=function(a){b.call(this);this.context=a;this.id=c();this.unit=-1;this.setDefaults();this.height=this.width=0;this.handle=null;this.textureType=a.gl.TEXTURE_2D;this.textureUnitCallback=this.lostTextureUnit.bind(this)};XML3D.createClass(f,b);f.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};(function(){var a=null;return function(b){if(!a){a=new f(b);b=new Uint8Array(768);for(var c=0;c<b.length;c++)b[c]=128;a.createTex2DFromData(WebGLRenderingContext.RGB,16,16,WebGLRenderingContext.RGB,
WebGLRenderingContext.UNSIGNED_BYTE,{texels:b,wrapS:WebGLRenderingContext.REPEAT,wrapT:WebGLRenderingContext.REPEAT,minFilter:WebGLRenderingContext.LINEAR,magFilter:WebGLRenderingContext.LINEAR})}return a}})();var k=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},h=function(b,c){switch(b){case a.TEXTURE_FORMAT.ALPHA:return c.ALPHA;case a.TEXTURE_FORMAT.RGB:return c.RGB;case a.TEXTURE_FORMAT.RGBA:return c.RGBA;case a.TEXTURE_FORMAT.LUMINANCE:return c.LUMINANCE;case a.TEXTURE_FORMAT.LUMINANCE_ALPHA:return c.LUMINANCE_ALPHA;
default:throw Error("Unsupported Texture Format!");}},g=function(b,c){switch(b){case a.TEXTURE_TYPE.FLOAT:return c.FLOAT;case a.TEXTURE_TYPE.UBYTE:return c.UNSIGNED_BYTE;case a.TEXTURE_TYPE.USHORT_4_4_4_4:return c.UNSIGNED_SHORT_4_4_4_4;case a.TEXTURE_TYPE.USHORT_5_5_5_1:return c.UNSIGNED_SHORT_5_5_5_1;case a.TEXTURE_TYPE.USHORT_5_6_5:return c.GL_UNSIGNED_SHORT_5_6_5;default:throw Error("Unsupported Texture Type!");}};XML3D.extend(f.prototype,{updateFromTextureEntry:function(a){if(a.isLoading())this.loads();
else{this.set(a.getSamplerConfig());a=a.asGLTextureValue();if(!a)return this.failed();this.createOrUpdateTexture(a)}},needsScale:function(a,b){return(this.generateMipMap||this.wrapS!=WebGLRenderingContext.CLAMP_TO_EDGE||this.wrapT!=WebGLRenderingContext.CLAMP_TO_EDGE)&&(0!=(a&a-1)||0!=(b&b-1))},_bind:function(){var a=this.context.gl,b=this.unit=this.context.textureManager.bind(this.id,{dispose:this.textureUnitCallback});-2==b?XML3D.debug.logError("All available texture units are full."):(a.activeTexture(WebGLRenderingContext.TEXTURE0+
b),a.bindTexture(this.textureType,this.handle));return b},unbind:function(a){},destroy:function(){var a=this.context.gl;this.context.textureManager.dispose(this.id);a.deleteTexture(this.handle)},canBind:function(){return this.current==f.State.READY},createOrUpdateTexture:function(a){this.handle||(this.handle=this.context.gl.createTexture());this.updateTextureFromData(a)},updateTextureFromData:function(a){var b=this.context.gl;this._bind();b.texParameteri(this.textureType,b.TEXTURE_WRAP_S,this.wrapS);
b.texParameteri(this.textureType,b.TEXTURE_WRAP_T,this.wrapT);b.texParameteri(this.textureType,b.TEXTURE_MIN_FILTER,this.minFilter);b.texParameteri(this.textureType,b.TEXTURE_MAG_FILTER,this.magFilter);var c=g(a.texelType,b),d=h(a.texelFormat,b),e=a.width;this.width=e;var f=a.height;this.height=f;if(this.generateMipMap&&this.needsScale(e,f)){if(c===b.FLOAT)throw Error("Should generate MipMaps but texture data is float and not power of two in size!");var u=document.createElement("canvas");u.width=
k(e);u.height=k(f);var l=u.getContext("2d");if(a instanceof HTMLElement)l.drawImage(a,0,0,u.width,u.height);else{var w=document.createElement("canvas");w.width=e;w.height=f;var m=w.getContext("2d"),y=m.createImageData(e,f);y.data.set(a.data);m.putImageData(y,0,0);l.drawImage(w,0,0,u.width,u.height)}a=u}a instanceof HTMLElement?b.texImage2D(b.TEXTURE_2D,0,d,d,c,a):a.data instanceof Uint8ClampedArray?b.texImage2D(b.TEXTURE_2D,0,d,e,f,0,d,c,new Uint8Array(a.data.buffer)):b.texImage2D(b.TEXTURE_2D,0,
d,e,f,0,d,c,a.data);this.generateMipMap&&b.generateMipmap(this.textureType);this.created()},createTex2DFromData:function(a,b,c,d,e,f){var g=this.context.gl;f=f||{};var h=f.texels;h||(h=e==g.FLOAT?new Float32Array(b*c*4):new Uint8Array(b*c*4));this.width=b;this.height=c;this.handle=g.createTexture();this._bind();g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,
g.TEXTURE_MAG_FILTER,f.magFilter);f.isDepth?g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,null):h instanceof Uint8ClampedArray?g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,new Uint8Array(h.buffer)):g.texImage2D(g.TEXTURE_2D,0,a,b,c,0,d,e,h);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()},lostTextureUnit:function(){this.unit=-1}});l.create({target:f.prototype,initial:f.State.NONE,events:[{name:"created",from:"*",to:f.State.READY},{name:"failed",from:"*",to:f.State.ERROR},{name:"loads",from:"*",
to:f.State.LOADING}]});e=function(a){f.call(this,a,a.gl.TEXTURE_CUBE_MAP);var b=a.gl;this.textureType=a.gl.TEXTURE_CUBE_MAP;this.glSides=[b.TEXTURE_CUBE_MAP_POSITIVE_X,b.TEXTURE_CUBE_MAP_NEGATIVE_X,b.TEXTURE_CUBE_MAP_POSITIVE_Y,b.TEXTURE_CUBE_MAP_NEGATIVE_Y,b.TEXTURE_CUBE_MAP_POSITIVE_Z,b.TEXTURE_CUBE_MAP_NEGATIVE_Z]};XML3D.createClass(e,f,{updateTextureFromData:function(a){debug.log("updateTextureFromData not implemented for CubeMapping!")},createTex2DFromData:function(a,b,c,d,e,f){var g=this.context.gl;
f=f||{};var h=f.texels;h||(h=e==g.FLOAT?new Float32Array(b*c*4):new Uint8Array(b*c*4));this.width=b;this.height=c;this.handle=g.createTexture();this._bind();g.texParameteri(this.textureType,g.TEXTURE_WRAP_S,f.wrapS);g.texParameteri(this.textureType,g.TEXTURE_WRAP_T,f.wrapT);g.texParameteri(this.textureType,g.TEXTURE_MIN_FILTER,f.minFilter);g.texParameteri(this.textureType,g.TEXTURE_MAG_FILTER,f.magFilter);for(var k=0;k<this.glSides.length;++k)f.isDepth?g.texImage2D(this.glSides[k],0,a,b,c,0,d,e,null):
h instanceof Uint8ClampedArray?g.texImage2D(this.glSides[k],0,a,b,c,0,d,e,new Uint8Array(h.buffer)):g.texImage2D(this.glSides[k],0,a,b,c,0,d,e,h);f.generateMipmap&&g.generateMipmap(this.textureType);this.created()}});e.State={NONE:"none",LOADING:"loading",READY:"ready",ERROR:"error"};l.create({target:e.prototype,initial:e.State.NONE,events:[{name:"created",from:"*",to:e.State.READY},{name:"failed",from:"*",to:e.State.ERROR},{name:"loads",from:"*",to:e.State.LOADING}]});m.exports={GLTexture:f,GLCubeMap:e}},
{"../../../contrib/state-machine.js":27,"../../../xflow/interface/constants.js":149,"../../../xflow/interface/data.js":150,"./utils.js":92}],92:[function(e,m,l){e("../../../utils/array.js");m.exports={setUniform:function(d,b,a,c){switch(b.glType){case 35670:a&&void 0!==a.length?d.uniform1iv(b.location,Array.prototype.map.call(a,function(a){return a})):d.uniform1i(b.location,a||0);break;case 5124:case 35678:case 35680:a&&void 0!==a.length?d.uniform1iv(b.location,a):d.uniform1i(b.location,a||0);break;
case 35671:case 35667:d.uniform2iv(b.location,a);break;case 35672:case 35668:d.uniform3iv(b.location,a);break;case 35673:case 35669:d.uniform4iv(b.location,a);break;case 5126:null!=a.length?d.uniform1fv(b.location,a):d.uniform1f(b.location,a);break;case 35664:d.uniform2fv(b.location,a);break;case 35665:d.uniform3fv(b.location,a);break;case 35666:d.uniform4fv(b.location,a);break;case 35674:d.uniformMatrix2fv(b.location,c||!1,a);break;case 35675:d.uniformMatrix3fv(b.location,c||!1,a);break;case 35676:d.uniformMatrix4fv(b.location,
c||!1,a);break;default:XML3D.debug.logError("Unknown uniform type "+b.glType)}},getUniqueCounter:function(){var d=0;return function(){return d++}},checkError:function(d,b){var a=d.getError();if(a!==d.NO_ERROR){var c=""+a;switch(a){case 1280:c="1280 ( GL_INVALID_ENUM )";break;case 1281:c="1281 ( GL_INVALID_VALUE )";break;case 1282:c="1282 ( GL_INVALID_OPERATION )";break;case 1283:c="1283 ( GL_STACK_OVERFLOW )";break;case 1284:c="1284 ( GL_STACK_UNDERFLOW )";break;case 1285:c="1285 ( GL_OUT_OF_MEMORY )"}a=
"GL error "+c+" occured.";void 0!==b&&(a+=" "+b);XML3D.debug.trace(a)}},supported:function(){var d=document.createElement("canvas");try{return!(!window.WebGLRenderingContext||!d.getContext("experimental-webgl"))}catch(b){return!1}}}},{"../../../utils/array.js":140}],93:[function(e,m,l){function d(a,c){b.call(this,a,c);this.renderInterface={};this.lastPickObj=null;this.lastKnownDimensions={width:c.width,height:c.height};this.initialize()}var b=e("../renderer/canvas-handler.js"),a=e("../../utils/options.js"),
c=e("../../base/formathandler.js").xml3dFormatHandler;a.register("renderer-continuous",!1);XML3D.createClass(d,b);d.prototype.setRenderer=function(a){this.renderer=a};d.prototype.initialize=function(){this.configureCanvas();var b=this;this.tick=function(){if(b.renderer){XML3D.updateXflowObserver();XML3D.flushDOMChanges();if(b.canvasSizeChanged()||b.renderer.needsRedraw()||a.getValue("renderer-continuous"))b.dispatchUpdateEvent(),b.draw();window.requestAnimFrame(b.tick,30)}};var c=this._xml3dElement.getAttribute("contextmenu");
c&&"false"!=c||this._canvas.addEventListener("contextmenu",function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},!1)};d.prototype.configureCanvas=function(){var a=this._xml3dElement,b=this._canvas,c=a.parentNode,d=c.ownerDocument.createElement("div");d.style.display="none";c.insertBefore(d,a);d.appendChild(a);c.insertBefore(b,d);a=b.ownerDocument.defaultView.getComputedStyle(a);b.style.backgroundColor||(a=a.getPropertyValue("background-color"))&&"transparent"!=a&&
(b.style.backgroundColor=a);b.width=b.clientWidth;b.height=b.clientHeight;return b};d.prototype.getPickObjectByPoint=function(a,b){return this.renderer.getRenderObjectFromPickingBuffer(a,b)};d.prototype.getPickedObject=function(){return this.renderer.pickedObject?this.renderer.pickedObject.node:null};d.prototype.getWorldSpaceNormalByPoint=function(a,b){return this.renderer.getWorldSpaceNormalByPoint(a,b)};d.prototype.getWorldSpacePositionByPoint=function(a,b){return this.renderer.getWorldSpacePositionByPoint(a,
b)};d.prototype.canvasSizeChanged=function(){var a=this._canvas;return a.clientWidth!==this.lastKnownDimensions.width||a.clientHeight!==this.lastKnownDimensions.height?(this.lastKnownDimensions.width=a.width=a.clientWidth,this.lastKnownDimensions.height=a.height=a.clientHeight,this.renderer.handleResizeEvent(a.width,a.height),this.dispatchResizeEvent({width:a.width,height:a.height}),!0):!1};var f=window.performance||Date;d.prototype.draw=function(){XML3D.flushDOMChanges();try{var a=f.now(),b=this.renderer.renderToCanvas(),
d=f.now();c.getFactory("webgl",this.id).getAdapter(this._xml3dElement).onFrameDrawn();this.dispatchFrameDrawnEvent(a,d,b)}catch(e){XML3D.debug.logException(e)}};d.prototype.getMousePosition=function(a){var b=this._canvas.getBoundingClientRect();return{x:a.clientX-b.left,y:a.clientY-b.top}};m.exports=d},{"../../base/formathandler.js":22,"../../utils/options.js":145,"../renderer/canvas-handler.js":65}],94:[function(e,m,l){var d=e("../base/program.js"),b=e("../xflow/utils.js");e=function(a){this.program=
null;this.context=a;this.obsolete=!1;this.id="";this.uniformCollection={envBase:{},envOverride:null,sysBase:null};this.isTransparent=!1;this.source={vertex:"",fragment:""}};Object.defineProperties(e.prototype,{attributes:{writeable:!1,get:function(){return this.program?this.program.attributes:{}}},uniforms:{writeable:!1,get:function(){return this.program?this.program.uniforms:{}}},samplers:{writeable:!1,get:function(){return this.program?this.program.samplers:{}}}});XML3D.createClass(e,null,{equals:function(a){return this.source.vertex===
a.source.vertex&&this.source.fragment===a.source.fragment},hasTransparency:function(){return this.isTransparent},compile:function(){if(this.source.fragment&&this.source.vertex){var a=new d(this.context.gl,this.source);this.program=a;this.id=a.id}else XML3D.debug.logError("No source found for shader",this)},bind:function(){this.program.bind()},unbind:function(){this.program.unbind()},isValid:function(){return this.program.isValid()},updateUniformsFromComputeResult:function(a){a=a.getOutputMap();var c=
this.uniformCollection.envBase={};this.setDefaultUniforms(this.uniformCollection.envBase);for(var d in a)c[d]=b.getGLUniformValueFromXflowDataEntry(a[d],this.context);d=Object.keys(c);this.setUniformVariables(d,null,this.uniformCollection);this.isTransparent=this.getTransparencyFromInputData(a)},setUniformVariables:function(a,b,d){this.program.setUniformVariables(a,b,d)},setSystemUniformVariables:function(a,b){this.uniformCollection.sysBase=b;this.setUniformVariables(null,a,this.uniformCollection)},
changeUniformVariableOverride:function(a,b){var d=a?Object.keys(a):[];b&&d.push.apply(d,Object.keys(b));this.uniformCollection.envOverride=b;this.setUniformVariables(d,null,this.uniformCollection)}});m.exports=e},{"../base/program.js":89,"../xflow/utils.js":132}],95:[function(e,m,l){e("../scene/glscene.js");var d=e("../scene/gllights.js"),b=e("../materials/events.js");l=e("../../../contrib/EventDispatcher.js");var a=e("../../../xflow/interface/request.js").ComputeRequest,c=e("../../../xflow/interface/constants.js");
e=function(a,b){this.context=a;this.shaderClosures=[];this.updateLightValues=this.dataChanged=!1;this.request=null};XML3D.createClass(e,l,{setShaderInfo:null,updateRequest:function(b){this.request&&this.request.clear();this.request=new a(b,this.getRequestFields(),this.onShaderRequestChange.bind(this));this.setShaderRecompile()},onShaderInfoChanged:function(a){this.setShaderInfo(a);this.setShaderRecompile();this.context.requestRedraw("Shader script changed")},onShaderRequestChange:function(a,b){this.dataChanged=
!0;b==c.RESULT_STATE.CHANGED_STRUCTURE&&this.setShaderRecompile();this.context.requestRedraw("Shader data changed")},update:function(a,b){for(var c=this,d=this.shaderClosures.length;d--;)this.shaderClosures[d].obsolete&&this.shaderClosures.splice(d,1);if(this.shaderClosures.length){if(this.dataChanged){var e=this.getShaderDataResult();this.shaderClosures.forEach(function(a){c.updateClosureFromComputeResult(a,e)});this.dataChanged=!1}this.updateLightValues&&this.shaderClosures.forEach(function(b){c.updateClosureFromLightParameters(b,
a)})}},updateClosureFromComputeResult:function(a,b){b&&b.getOutputMap&&(a.bind(),a.updateUniformsFromComputeResult(b))},updateClosureFromLightParameters:function(a,b){a.bind();a.setSystemUniformVariables(d.ALL_PARAMETERS,b.systemUniforms)},updateSystemUniforms:function(a,b){this.shaderClosures.forEach(function(c){c.bind();c.setSystemUniformVariables(a,b.systemUniforms)})},createShaderClosure:function(){throw Error("AbstractComposer::createShaderClosure needs to be overridden");},createObjectDataRequest:function(a,
b){throw Error("AbstractComposer::createObjectDataRequest needs to be overridden");},distributeObjectShaderData:function(a,b,c){throw Error("AbstractComposer::distributeObjectShaderData needs to be overridden");},getShaderClosure:function(a,b){var c=this.createShaderClosure();try{c.createSources(a,this.getShaderDataResult(),b)}catch(d){throw Error("Shader: "+d.message);}for(var e=0;e<this.shaderClosures.length;e++)if(this.shaderClosures[e].equals(c))return this.shaderClosures[e].obsolete=!1,this.shaderClosures[e];
this.initializeShaderClosure(c,a);return c},initializeShaderClosure:function(a,c){a.compile();c.dispatchEvent({type:b.MATERIAL_INITIALIZED});this.updateClosureFromComputeResult(a,this.getShaderDataResult());this.updateClosureFromLightParameters(a,c);this.shaderClosures.push(a)},setShaderRecompile:function(){for(var a=0;a<this.shaderClosures.length;++a)this.shaderClosures[a].obsolete=!0;this.dispatchEvent({type:b.MATERIAL_STRUCTURE_CHANGED});this.updateLightValues=this.dataChanged=!0},getShaderDataResult:function(){return this.request?
this.request.getResult():null}});l=function(a){this.context=a};XML3D.createClass(l,e,{update:function(){},getShaderClosure:function(a,b){return this.context.programFactory.getFallbackProgram()},getShaderAttributes:function(){return{color:null,normal:null}},getRequestFields:function(){return["diffuseColor","useVertexColor"]},createObjectDataRequest:function(b,c){return new a(b,["position","color","normal","diffuseColor","useVertexColor"],c)},distributeObjectShaderData:function(a,b,c){a=a.getResult().getOutputMap();
var d=this.getRequestFields(),e;for(e in a)-1!=d.indexOf(e)?c(e,a[e]):b(e,a[e])}});m.exports={AbstractShaderComposer:e,DefaultComposer:l}},{"../../../contrib/EventDispatcher.js":24,"../../../xflow/interface/constants.js":149,"../../../xflow/interface/request.js":152,"../materials/events.js":96,"../scene/gllights.js":127,"../scene/glscene.js":128}],96:[function(e,m,l){m.exports={MATERIAL_STRUCTURE_CHANGED:"material_structure_changed",MATERIAL_INITIALIZED:"material_initialized"}},{}],97:[function(e,
m,l){function d(a,c){var d=f(a);["point","directional","spot"].forEach(function(a){var b=a+"LightOn";d["MAX_"+a.toUpperCase()+"LIGHTS"].staticValue=c[b]&&c[b].length});for(var e in c){var g=d[e];if(g&&g.staticSize){var h=c[e].length;if(h){var k=b(g);g.staticSize=h/k}else delete d[e]}}return d}function b(a){if("array"==a.type&&(a=a.elements,"object"==a.type))switch(a.kind){case "texture":case "float":break;case "float2":return 2;case "float3":return 3;case "float4":return 4;case "matrix4":return 16;
default:throw"Unknown array element kind:"+a.kind;}return 1}var a=e("./../abstractshaderclosure.js");e("./jsshadercomposer.js");var c=e("../../system/system-notifier.js"),f=e("./jssystemconfiguration.js"),k=e("../../../../xflow/interface/constants.js"),h=e("../../../../utils/options.js"),g={},q=function(a,b){var c={};switch(a){case k.DATA_TYPE.BOOL:c.type=Shade.TYPES.BOOLEAN;break;case k.DATA_TYPE.INT:c.type=Shade.TYPES.INT;break;case k.DATA_TYPE.FLOAT:c.type=Shade.TYPES.NUMBER;break;case k.DATA_TYPE.FLOAT2:c.type=
Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.FLOAT2;break;case k.DATA_TYPE.FLOAT3:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.FLOAT3;break;case k.DATA_TYPE.FLOAT4:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.FLOAT4;break;case k.DATA_TYPE.FLOAT3X3:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.MATRIX3;break;case k.DATA_TYPE.FLOAT4X4:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.MATRIX4;break;case k.DATA_TYPE.TEXTURE:c.type=Shade.TYPES.OBJECT;c.kind=Shade.OBJECT_KINDS.TEXTURE;
break;default:throw Error("Unknown Xflow DataType: "+a);}c.source=b;return c};e=function(b,c,d){a.call(this,b);this.sourceTemplate=c;this.extractedParams=d;this.uniformSetter=function(){};this.uniformConverter=[]};XML3D.createClass(e,a,{createSources:function(a,b,e){var f=e.getResult(),k=d(this.context,a.systemUniforms),l={};b=b&&b.getOutputMap();for(var v=f&&f.outputNames,w=0;w<this.extractedParams.length;++w){var m=this.extractedParams[w];v&&-1!=v.indexOf(m)?l[m]=q(f.getOutputType(m),f.isOutputUniform(m)?
Shade.SOURCES.UNIFORM:Shade.SOURCES.VERTEX):b&&b[m]&&(l[m]=q(b[m].type,Shade.SOURCES.UNIFORM))}k={"this":{type:"object",kind:"any",info:k},"global.shade":[{extra:{type:"object",kind:"any",global:!0,info:l}}]};XML3D.debug.logDebug("CONTEXT:",k);b={propagateConstants:!0,validate:!0,sanitize:!0,transformSpaces:h.getValue("shadejs-transformSpaces"),extractUniformExpressions:h.getValue("shadejs-extractUniformExpressions")};v={useStatic:!0,uniformExpressions:b.uniformExpressions};w=a.deferred?"xml3d-glsl-deferred":
"xml3d-glsl-forward";l=w+";"+JSON.stringify(b)+";"+JSON.stringify(l)+";"+this.sourceTemplate;if(!(m=g[l]))try{var y=new Shade.WorkingSet;y.parse(this.sourceTemplate,{loc:!0});y.analyze(k,w,b);var E=y.getProcessingData("spaceInfo"),C=y.compileFragmentShader(v),m={source:C.source,uniformSetter:C.uniformSetter,spaceInfo:E};m.hasTransparentShaderClosure=y.getProcessingData("isTransparent");this.uniformSetter=C.uniformSetter;this.source={fragment:C.source,vertex:this.createVertexShader(e,f,E)};a.deferred&&
(m.signatures=y.getProcessingData("colorClosureSignatures"));h.getValue("shadejs-cache")&&(g[l]=m)}catch(A){throw c.sendEvent("shadejs",{shadejsType:"error",event:A,code:this.sourceTemplate}),a="Shade.js Compile Error:\n"+A.message+"\n------------\nShader Source:\n------------\n"+XML3D.debug.formatSourceCode(this.sourceTemplate),Error(a);}this.source={fragment:m.source,vertex:this.createVertexShader(e,f,m.spaceInfo)};this.hasTransparentShaderClosure=m.hasTransparentShaderClosure;this.uniformSetter=
m.uniformSetter;a.deferred&&a.colorClosureSignatures.push.apply(a.colorClosureSignatures,m.signatures);XML3D.debug.logDebug(this.source.vertex);XML3D.debug.logDebug(this.source.fragment);c.sendEvent("shadejs",{shadejsType:"success",vertexShader:this.source.vertex,fragmentShader:this.source.fragment});return!0},createVertexShader:function(a,b,c){var d=a.getConfig();b=b.outputNames;for(var e=0;e<b.length;++e){var f=d,g=b[e],h=c;if(h&&h[g])for(var q=h[g].length;q--;){var l=h[g][q],m=("_env_"+l.name).replace(/_+/g,
"_"),C=null;switch(l.space){case Shade.SPACE_VECTOR_TYPES.OBJECT:break;case Shade.SPACE_VECTOR_TYPES.VIEW_POINT:f.addInputParameter(k.DATA_TYPE.FLOAT4X4,"modelViewMatrix",!0);C=m+" = ( modelViewMatrix * vec4(#I{"+g+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.VIEW_NORMAL:f.addInputParameter(k.DATA_TYPE.FLOAT3X3,"modelViewMatrixN",!0);C=m+" = normalize( modelViewMatrixN * #I{"+g+"} );";break;case Shade.SPACE_VECTOR_TYPES.WORLD_POINT:f.addInputParameter(k.DATA_TYPE.FLOAT4X4,"modelMatrix",!0);
C=m+" = ( modelMatrix * vec4(#I{"+g+"}, 1.0) ).xyz;";break;case Shade.SPACE_VECTOR_TYPES.WORLD_NORMAL:f.addInputParameter(k.DATA_TYPE.FLOAT3X3,"modelMatrixN",!0);C=m+" = normalize( modelMatrixN * #I{"+g+"} );";break;default:throw Error("Can't handle Space Type: "+l.space);}f.channelAttribute(g,m,C)}else h=("_env_"+g).replace(/_+/g,"_"),f.channelAttribute(g,h,null)}d.addInputParameter(k.DATA_TYPE.FLOAT4X4,"modelViewProjectionMatrix",!0);d.addCodeFragment("gl_Position = modelViewProjectionMatrix * vec4(#I{position}, 1.0);");
return a.getVertexShader().getGLSLCode()},setUniformVariables:function(a,b,c){this.uniformSetter(a,b,c,this.program.setUniformVariable.bind(this.program))},getTransparencyFromInputData:function(a){return this.hasTransparentShaderClosure},setDefaultUniforms:function(){}});m.exports=e},{"../../../../utils/options.js":145,"../../../../xflow/interface/constants.js":149,"../../system/system-notifier.js":131,"./../abstractshaderclosure.js":94,"./jsshadercomposer.js":98,"./jssystemconfiguration.js":99}],
98:[function(e,m,l){var d=e("./../abstractshadercomposer.js").AbstractShaderComposer,b=e("./jsshaderclosure.js"),a=e("../../../../xflow/processing/vs-connect.js").VSConfig,c=e("../../../../xflow/interface/request.js").VertexShaderRequest,f=e("../../../../xflow/interface/constants.js");e=function(a,b){d.call(this,a,b);if(!window.Shade)throw Error("shade.js library not found");this.context=a;this.sourceTemplate=b.model.script;this.extractedParams=[];this.request=null;this.setShaderInfo(b)};e.convertSysName=
function(a){return a};XML3D.createClass(e,d,{setShaderInfo:function(a){try{var b=Shade.parse(this.sourceTemplate,{loc:!0});this.extractedParams=Shade.extractParameters(b,{implementation:"xml3d-glsl-forward"}).shaderParameters}catch(c){this.extractedParams=[]}-1==this.extractedParams.indexOf("position")&&this.extractedParams.push("position");this.extractedParams.length&&this.updateRequest(a.dataNode)},getRequestFields:function(){return this.extractedParams},getShaderAttributes:function(){return{color:null,
normal:null,texcoord:null}},createShaderClosure:function(){return new b(this.context,this.sourceTemplate,this.extractedParams)},createObjectDataRequest:function(b,d){var e=new a,q=this.extractedParams.slice();e.addAttribute(f.DATA_TYPE.FLOAT3,"position",!0);for(var r=0;r<q.length;++r){var n=q[r];if("position"!=n){var p=b.getOutputChannelInfo(n);p&&e.addAttribute(p.type,n,!0)}}return new c(b,e,d)},distributeObjectShaderData:function(a,b,c){a=a.getVertexShader();var d=a.inputNames,e,f,p;for(e=0;e<d.length;++e)f=
d[e],p=a.getInputData(f),a.isInputUniform(f)?c(f,p):b(f,p);b=a.outputNames;for(e=0;e<b.length;++e)f=b[e],a.isOutputFragmentUniform(f)&&c(a.getOutputSourceName(f),a.getUniformOutputData(f))}});m.exports=e},{"../../../../xflow/interface/constants.js":149,"../../../../xflow/interface/request.js":152,"../../../../xflow/processing/vs-connect.js":199,"./../abstractshadercomposer.js":95,"./jsshaderclosure.js":97}],99:[function(e,m,l){var d=e("../../base/context.js"),b=null,a={coords:{type:"object",kind:"float3",
source:"uniform"},cameraPosition:{type:"object",kind:"float3",source:"uniform"},viewMatrix:{type:"object",kind:"matrix4",source:"uniform"},viewInverseMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelViewProjectionMatrix:{type:"object",kind:"matrix4",source:"uniform"},modelMatrixN:{type:"object",kind:"matrix3",source:"uniform"},modelViewMatrixN:{type:"object",kind:"matrix3",
source:"uniform"},MAX_POINTLIGHTS:{type:"int",source:"constant",staticValue:5},pointLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightAttenuation:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},pointLightCastShadow:{type:"array",
elements:{type:"boolean"},staticSize:5,source:"uniform"},pointLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},pointLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},pointLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightProjection:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},pointLightNearFar:{type:"array",elements:{type:"object",
kind:"float2"},staticSize:5,source:"uniform"},MAX_DIRECTIONALLIGHTS:{type:"int",source:"constant",staticValue:5},directionalLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},directionalLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},directionalLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,
source:"uniform"},directionalLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},directionalLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},directionalLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},MAX_SPOTLIGHTS:{type:"int",source:"constant",staticValue:5},spotLightOn:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightAttenuation:{type:"array",
elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightIntensity:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightPosition:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightDirection:{type:"array",elements:{type:"object",kind:"float3"},staticSize:5,source:"uniform"},spotLightCosFalloffAngle:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCosSoftFalloffAngle:{type:"array",
elements:{type:"number"},staticSize:5,source:"uniform"},spotLightCastShadow:{type:"array",elements:{type:"boolean"},staticSize:5,source:"uniform"},spotLightShadowBias:{type:"array",elements:{type:"number"},staticSize:5,source:"uniform"},spotLightShadowMap:{type:"array",elements:{type:"object",kind:"texture"},staticSize:5,source:"uniform"},spotLightMatrix:{type:"array",elements:{type:"object",kind:"matrix4"},staticSize:5,source:"uniform"},ssaoMap:{type:"object",kind:"texture",source:"uniform"},environment:{type:"object",
kind:"texture",source:"uniform"}};m.exports=function(c){b||(c.getExtensionByName(d.EXTENSIONS.STANDARD_DERIVATES)&&(a.fwidth={type:Shade.TYPES.FUNCTION},a.dx={type:Shade.TYPES.FUNCTION},a.dy={type:Shade.TYPES.FUNCTION}),b=a);return b}},{"../../base/context.js":86}],100:[function(e,m,l){var d=e("./js/jsshadercomposer.js"),b=e("./urn/urnshadercomposer.js"),a=e("./abstractshadercomposer.js").DefaultComposer;e=function(b){this.context=b;this.composers={};this.defaultComposer=new a(b);this.lightValuesDirty=
!0};XML3D.extend(e.prototype,{createComposerFromMaterialConfiguration:function(a){if(!a)return this.defaultComposer;var e=this.composers[a.id];if(!e){try{var k=a.model.type;switch(k){case "urn":e=new b(this.context,a);break;case "text/javascript":case "application/javascript":case "text/shade-javascript":e=new d(this.context,a);break;default:XML3D.debug.logError("Can not create shader of type:",k,a.model)}}catch(h){XML3D.debug.logError("No shader could be created for '"+a.name+"':",h.message),e=this.defaultComposer}e&&
(this.composers[a.id]=e,this.context.getStatistics().materials++);return e||this.defaultComposer}return e},getTemplateById:function(a){return this.composers[a]},update:function(a){for(var b in this.composers)this.composers[b].update(a,{updateLightValues:this.lightValuesDirty});this.lightValuesDirty=!1},setLightStructureDirty:function(){this.setShaderRecompile()},setShaderRecompile:function(){for(var a in this.composers)this.composers[a].setShaderRecompile()},updateSystemUniforms:function(a,b){for(var d in this.composers)this.composers[d].updateSystemUniforms(a,
b)},setLightValueChanged:function(){for(var a in this.composers)this.composers[a].updateLightValues=!0}});m.exports=e},{"./abstractshadercomposer.js":95,"./js/jsshadercomposer.js":98,"./urn/urnshadercomposer.js":109}],101:[function(e,m,l){function d(a){var b={};["spot","point","directional"].forEach(function(c){var d=a.filter(function(a){return a.light.model.id==c});b[c+"LightShadowMap"]=d.map(function(a){return a.slot})});return b}var b=e("../../renderer/scene/constants.js").EVENT_TYPE,a=e("../base/rendertarget"),
c=e("../render-passes/light-pass"),f=e("../render-passes/pointlight-pass");e=function(a,c){this.context=a;c.addEventListener(b.LIGHT_STRUCTURE_CHANGED,this.onLightStructureChanged.bind(this));c.addEventListener(b.LIGHT_VALUE_CHANGED,this.onLightValueChanged.bind(this));c.addEventListener(b.SCENE_SHAPE_CHANGED,this.onSceneShapeChanged.bind(this));this.shadowMapInfos=[];this.dirty=!0};XML3D.extend(e.prototype,{onLightStructureChanged:function(b){b=b.light;var d=this.shadowMapInfos;if(b.removed)a:for(var e=
0;e<d.length;e++){if(d[e].light===b){d.splice(index,1);break a}}else if(b.model.getParameter("castShadow")[0]){var e=b.scene.context,q=2*Math.max(e.canvasTarget.width,e.canvasTarget.height),q={width:q,height:q,colorFormat:e.gl.RGBA,depthFormat:e.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0};"point"==b.model.id?(q=new a.GLCubeMapRenderTarget(e,q),q=new f({context:e},q,b)):(q=new a.GLRenderTarget(e,q),q=new c({context:e},q,b));q.init(e);q.output.bind();e=e.textureManager.getEntry(q.output.colorTarget.handle.id);
e.fixed=!0;q.output.unbind();d.push({light:b,pass:q,slot:e.slot});this.requestRendering("light added")}},onLightValueChanged:function(){this.requestRendering("light value changed")},onSceneShapeChanged:function(){this.requestRendering("scene shape changed")},requestRendering:function(a){this.dirty=!0},updateForRendering:function(){if(this.dirty){for(var a=this.shadowMapInfos,b=0;b<a.length;b++)a[b].pass.renderScene();this.dirty=!1}},fillGlobalParameters:function(a){var b=d(this.shadowMapInfos);XML3D.extend(a,
b)}});m.exports=e},{"../../renderer/scene/constants.js":72,"../base/rendertarget":90,"../render-passes/light-pass":115,"../render-passes/pointlight-pass":119}],102:[function(e,m,l){XML3D.shaders.register("diffuse",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n}",
fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\n#endif\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  #if MAX_POINTLIGHTS > 0\n    for (int i=0; i<MAX_POINTLIGHTS; i++) {\n      if (!pointLightOn[i])\n         continue;\n      vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n      vec3 L = lPosition.xyz - fragVertexPosition;\n      float dist = length(L);\n      L = normalize(L);\n      float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n      vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n      color = color + atten*Idiff;\n    }\n  #endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n      if (!directionalLightOn[i])\n         continue;\n    vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n    vec3 L =  normalize(-lDirection.xyz);\n    vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    color = color + Idiff;\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n      if (!spotLightOn[i])\n         continue;\n    vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n    vec3 L = lPosition.xyz - fragVertexPosition;\n    float dist = length(L);\n    L = normalize(L);\n    float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n    vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n    vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n    vec3 D = normalize(lDirection.xyz);\n    float angle = dot(L, D);\n    if(angle > spotLightCosFalloffAngle[i]) {\n       float softness = 1.0;\n       if (angle < spotLightCosSoftFalloffAngle[i])\n           softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n       color += atten * softness * Idiff;\n    }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(d,b,a){["point","directional","spot"].forEach(function(a){var e=b.getModelCount(a);d.push("MAX_"+a.toUpperCase()+"LIGHTS "+e)});d.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"));d.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in a?"1":"0"))},hasTransparency:function(d){return d.transparency&&.001<d.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],transparency:0,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null},
attributes:{normal:{required:!0},texcoord:null,color:null}})},{}],103:[function(e,m,l){XML3D.shaders.register("matte",{vertex:"attribute vec3 position;\nattribute vec3 color;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   fragVertexColor = color;\n   gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"uniform vec3 diffuseColor;\nuniform bool useVertexColor;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n    vec3 color = diffuseColor;\n    if (useVertexColor)\n       color *=  fragVertexColor;\n    gl_FragColor = vec4(color, 1.0);\n}",
uniforms:{diffuseColor:[1,1,1],useVertexColor:!1},attributes:{color:null,normal:null}});XML3D.shaders.register("flat",XML3D.shaders.getScript("matte"))},{}],104:[function(e,m,l){XML3D.shaders.register("phong",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nvoid main(void) {\n    vec3 pos = position;\n    vec3 norm = normal;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragNormal = normalize(modelViewMatrixN * norm);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\n    fragWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;\n#endif\n}",
fragment:"uniform float ambientIntensity;\nuniform vec3 diffuseColor;\nuniform vec3 emissiveColor;\nuniform float shininess;\nuniform vec3 specularColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec3 coords;\n#if HAS_EMISSIVETEXTURE\nuniform sampler2D emissiveTexture;\n#endif\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\n#if HAS_SPECULARTEXTURE\nuniform sampler2D specularTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\n#if (HAS_POINTLIGHT_SHADOWMAPS || HAS_DIRECTIONALLIGHT_SHADOWMAPS || HAS_SPOTLIGHT_SHADOWMAPS)\nvarying vec3 fragWorldPosition;\nfloat unpackDepth( const in vec4 rgba_depth ) {\n  const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n  float depth = dot( rgba_depth, bit_shift );\n  return depth;\n}\n#endif\n#if MAX_POINTLIGHTS > 0\nuniform vec3 pointLightAttenuation[MAX_POINTLIGHTS];\nuniform vec3 pointLightPosition[MAX_POINTLIGHTS];\nuniform vec3 pointLightIntensity[MAX_POINTLIGHTS];\nuniform bool pointLightOn[MAX_POINTLIGHTS];\nuniform bool pointLightCastShadow[MAX_POINTLIGHTS];\n#if HAS_POINTLIGHT_SHADOWMAPS\nuniform samplerCube pointLightShadowMap[MAX_POINTLIGHTS];\nuniform float pointLightShadowBias[MAX_POINTLIGHTS];\nuniform vec2 pointLightNearFar[MAX_POINTLIGHTS];\nfloat vecToDepth(vec3 vec, float n, float f){\nvec3 absVec = abs(vec);float maxComp = max(absVec.x, max(absVec.y, absVec.z));\nfloat res = (f+n)/(f-n)-(2.0*f*n)/(f-n)/maxComp;\nreturn res*0.5+0.5;\n}\n#endif\n#endif\n#if MAX_SPOTLIGHTS > 0\nuniform vec3 spotLightAttenuation[MAX_SPOTLIGHTS];\nuniform vec3 spotLightPosition[MAX_SPOTLIGHTS];\nuniform vec3 spotLightIntensity[MAX_SPOTLIGHTS];\nuniform bool spotLightOn[MAX_SPOTLIGHTS];\nuniform vec3 spotLightDirection[MAX_SPOTLIGHTS];\nuniform float spotLightCosFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightCosSoftFalloffAngle[MAX_SPOTLIGHTS];\nuniform float spotLightSoftness[MAX_SPOTLIGHTS];\nuniform bool spotLightCastShadow[MAX_SPOTLIGHTS];\n#if HAS_SPOTLIGHT_SHADOWMAPS\nuniform mat4 spotLightMatrix[ MAX_SPOTLIGHTS ];\nuniform sampler2D spotLightShadowMap[MAX_SPOTLIGHTS];\nuniform float spotLightShadowBias[MAX_SPOTLIGHTS];\n#endif\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\nuniform vec3 directionalLightDirection[MAX_DIRECTIONALLIGHTS];\nuniform vec3 directionalLightIntensity[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightOn[MAX_DIRECTIONALLIGHTS];\nuniform bool directionalLightCastShadow[MAX_DIRECTIONALLIGHTS];\n#if HAS_DIRECTIONALLIGHT_SHADOWMAPS\nuniform mat4 directionalLightMatrix[MAX_DIRECTIONALLIGHTS];\nuniform sampler2D directionalLightShadowMap[MAX_DIRECTIONALLIGHTS];\nuniform float directionalLightShadowBias[MAX_DIRECTIONALLIGHTS];\n#endif\n#endif\nuniform sampler2D ssaoMap;\nvoid main(void) {\n#if MAX_POINTLIGHTS > 0 && HAS_POINTLIGHT_SHADOWMAPS\n    vec3 pointLightShadowMapDirection[MAX_POINTLIGHTS];\n    for(int i = 0; i < MAX_POINTLIGHTS; i++) {\n       pointLightShadowMapDirection[i] = fragWorldPosition - pointLightPosition[i];\n    }\n#endif\n#if MAX_SPOTLIGHTS > 0 && HAS_SPOTLIGHT_SHADOWMAPS\n    vec4 spotLightShadowMapCoord[MAX_SPOTLIGHTS];\n    for(int i = 0; i < MAX_SPOTLIGHTS; i++) {\n      spotLightShadowMapCoord[i] = spotLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0 && HAS_DIRECTIONALLIGHT_SHADOWMAPS\n    vec4 directionalLightShadowMapCoord[MAX_DIRECTIONALLIGHTS];\n    for(int i = 0; i < MAX_DIRECTIONALLIGHTS; i++) {\n      directionalLightShadowMapCoord[i] = directionalLightMatrix[i] * vec4(fragWorldPosition, 1.0);\n    }\n#endif\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec4 texDiffuse = texture2D(diffuseTexture, fragTexCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  #if HAS_EMISSIVETEXTURE\n    vec3 color = emissiveColor * texture2D(emissiveTexture, fragTexCoord).rgb + (ambientIntensity * objDiffuse);\n  #else\n    vec3 color = emissiveColor + (ambientIntensity * objDiffuse);\n  #endif\n  vec3 objSpecular = specularColor;\n  #if HAS_SPECULARTEXTURE\n    objSpecular = objSpecular * texture2D(specularTexture, fragTexCoord).rgb;\n  #endif\n  #if HAS_SSAOMAP\n\t float ssao = 1.0 - texture2D(ssaoMap, gl_FragCoord.xy / coords.xy).r;\n  #endif\n  float shadowInfluence = 0.0;\n#if MAX_POINTLIGHTS > 0\n  for (int i = 0; i < MAX_POINTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(pointLightOn[i]){\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       if(pointLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           float lsDepth = vecToDepth(pointLightShadowMapDirection[i], pointLightNearFar[i].x, pointLightNearFar[i].y );\n\t\t    float depth = unpackDepth( textureCube(pointLightShadowMap[i], pointLightShadowMapDirection[i])) +  pointLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (pointLightAttenuation[i].x + pointLightAttenuation[i].y * dist + pointLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = pointLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = pointLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + (atten*shadowInfluence*(Idiff + Ispec));\n   #if HAS_POINTLIGHT_SHADOWMAPS\n       }\n   #endif\n     }\n  }\n#endif\n#if MAX_SPOTLIGHTS > 0\n  for (int i=0; i<MAX_SPOTLIGHTS; i++) {\n    shadowInfluence = 1.0;\n    if(spotLightOn[i]) {\n  #if HAS_SPOTLIGHT_SHADOWMAPS\n       if(spotLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = spotLightShadowMapCoord[i];\n\t\t\tvec3 perspectiveDivPos = lspos.xyz / lspos.w * 0.5 + 0.5;\n\t\t\tfloat lsDepth = perspectiveDivPos.z;\n\t\t\tvec2 lightuv = perspectiveDivPos.xy;\n\t\t\tfloat depth = unpackDepth(texture2D(spotLightShadowMap[i], lightuv)) + spotLightShadowBias[i];\n           if(lsDepth < depth)\n               shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n  #endif\n       vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n       vec3 L = lPosition.xyz - fragVertexPosition;\n       float dist = length(L);\n       L = normalize(L);\n       vec3 R = normalize(reflect(L,fragNormal));\n       float atten = 1.0 / (spotLightAttenuation[i].x + spotLightAttenuation[i].y * dist + spotLightAttenuation[i].z * dist * dist);\n       vec3 Idiff = spotLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n\t    Idiff *= ssao;\n   #endif\n       vec3 Ispec = spotLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       vec4 lDirection = viewMatrix * vec4(-spotLightDirection[i], 0.0);\n       vec3 D = normalize(lDirection.xyz);\n       float angle = dot(L, D);\n       if(angle > spotLightCosFalloffAngle[i]) {\n           float softness = 1.0;\n           if (angle < spotLightCosSoftFalloffAngle[i])\n               softness = (angle - spotLightCosFalloffAngle[i]) /  (spotLightCosSoftFalloffAngle[i] -  spotLightCosFalloffAngle[i]);\n           color += atten*softness*shadowInfluence*(Idiff + Ispec);\n       }\n   #if HAS_SPOTLIGHT_SHADOWMAPS\n       }\n   #endif\n   } \n  }\n#endif\n#if MAX_DIRECTIONALLIGHTS > 0\n  for (int i=0; i<MAX_DIRECTIONALLIGHTS; i++) {\n   shadowInfluence = 1.0;\n   if(directionalLightOn[i]){\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       if(directionalLightCastShadow[i]){\n           shadowInfluence = 0.0;\n           vec4 lspos = directionalLightShadowMapCoord[i];\n           vec3 orthogonalDivPos = lspos.xyz / lspos.w *0.5 + 0.5;\n           float lsDepth = orthogonalDivPos.z;\n           vec2 lightuv = orthogonalDivPos.xy;\n               float depth = unpackDepth(texture2D(directionalLightShadowMap[i], lightuv))+directionalLightShadowBias[i];\n               if(lsDepth < depth) shadowInfluence = 1.0;\n       }\n       if(shadowInfluence > 0.0){\n   #endif\n       vec4 lDirection = viewMatrix * vec4(directionalLightDirection[i], 0.0);\n       vec3 L =  normalize(-lDirection.xyz);\n       vec3 R = normalize(reflect(L,fragNormal));\n       vec3 Idiff = directionalLightIntensity[i] * objDiffuse * max(dot(fragNormal,L),0.0);\n   #if HAS_SSAOMAP\n       Idiff *= ssao;\n   #endif\n       vec3 Ispec = directionalLightIntensity[i] * objSpecular * pow(max(dot(R,fragEyeVector),0.0), shininess*128.0);\n       color = color + shadowInfluence*((Idiff + Ispec));\n   #if HAS_DIRECTIONALLIGHT_SHADOWMAPS\n       }\n   #endif\n   }\n  }\n#endif\n  gl_FragColor = vec4(color, alpha);\n}",
addDirectives:function(d,b,a){["point","directional","spot"].forEach(function(a){var e=b.getModelCount(a),k=!1;e&&(k=Array.prototype.some.call(b.getModelEntry(a).parameters.castShadow,function(a){return a}));d.push("MAX_"+a.toUpperCase()+"LIGHTS "+e);d.push("HAS_"+a.toUpperCase()+"LIGHT_SHADOWMAPS "+(k?1:0))});d.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"));d.push("HAS_SPECULARTEXTURE "+("specularTexture"in a?"1":"0"));d.push("HAS_EMISSIVETEXTURE "+("emissiveTexture"in a?"1":"0"));d.push("HAS_SSAOMAP "+
(XML3D.options.getValue("renderer-ssao")?"1":"0"))},hasTransparency:function(d){return d.transparency&&.001<d.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],emissiveColor:[0,0,0],specularColor:[0,0,0],transparency:0,shininess:.2,ambientIntensity:0,useVertexColor:!1},samplers:{diffuseTexture:null,emissiveTexture:null,specularTexture:null,directionalLightShadowMap:null,spotLightShadowMap:null,pointLightShadowMap:null,ssaoMap:null},attributes:{normal:{required:!0},texcoord:null,color:null}})},
{}],105:[function(e,m,l){XML3D.shaders.register("point",{vertex:"attribute vec3 position;\nattribute vec3 color;\nattribute vec2 texcoord;\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 modelViewMatrixN;\nuniform vec3 eyePosition;\nuniform vec3 coords;\nuniform float pointSize;\nvoid main(void) {\n    vec3 pos = position;\n    gl_Position = modelViewProjectionMatrix * vec4(pos, 1.0);\n    fragVertexPosition = (modelViewMatrix * vec4(pos, 1.0)).xyz;\n    fragEyeVector = normalize(fragVertexPosition);\n    fragTexCoord = texcoord;\n    fragVertexColor = color;\n    vec4 pos2 = vec4(fragVertexPosition, 1.0); pos2.x += pointSize;\n    gl_PointSize = distance( gl_Position.xy, (projectionMatrix * pos2).xy ) * coords.x / gl_Position.w;\n}",
fragment:"uniform vec3 diffuseColor;\nuniform float transparency;\nuniform mat4 viewMatrix;\nuniform bool useVertexColor;\nuniform vec2 texCoordOffset;\nuniform vec2 texCoordSize;\n#if HAS_DIFFUSETEXTURE\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec3 fragNormal;\nvarying vec3 fragVertexPosition;\nvarying vec3 fragEyeVector;\nvarying vec2 fragTexCoord;\nvarying vec3 fragVertexColor;\nvoid main(void) {\n  float alpha =  max(0.0, 1.0 - transparency);\n  vec3 objDiffuse = diffuseColor;\n  if(useVertexColor)\n    objDiffuse *= fragVertexColor;\n  #if HAS_DIFFUSETEXTURE\n    vec2 texCoord = fragTexCoord + texCoordOffset + gl_PointCoord*texCoordSize;\n    texCoord.y = 1.0 - texCoord.y;\n    vec4 texDiffuse = texture2D(diffuseTexture, texCoord);\n    alpha *= texDiffuse.a;\n    objDiffuse *= texDiffuse.rgb;\n  #endif\n  if (alpha < 0.05) discard;\n  gl_FragColor = vec4(objDiffuse, alpha);\n}",
addDirectives:function(d,b,a){d.push("HAS_DIFFUSETEXTURE "+("diffuseTexture"in a?"1":"0"))},hasTransparency:function(d){return d.transparency&&.001<d.transparency.getValue()[0]},uniforms:{diffuseColor:[1,1,1],texCoordOffset:[0,0],texCoordSize:[1,1],transparency:0,useVertexColor:!1,pointSize:1},samplers:{diffuseTexture:null},attributes:{texcoord:null,color:null}})},{}],106:[function(e,m,l){e=function(){this.uniforms={};this.samplers={};this.attributes={};this.vertex=this.fragment=this.name=""};e.prototype.addDirectives=
function(){};e.prototype.hasTransparency=function(){return!1};m.exports=e},{}],107:[function(e,m,l){var d={};m.exports={register:function(b,a){d[b]=a;a.name=b},getScript:function(b){return d[b]}}},{}],108:[function(e,m,l){var d=e("./../abstractshaderclosure.js"),b=e("../../system/system-notifier.js");e=function(a,b){d.call(this,a);this.descriptor=b};XML3D.createClass(e,d);XML3D.extend(e.prototype,{setDefaultUniforms:function(a){XML3D.extend(a,this.descriptor.uniforms)},createSources:function(a,c,
d){var e=d&&d.getResult();d=[];var h={};c&&XML3D.extend(h,c.getOutputMap());e&&XML3D.extend(h,e.getOutputMap());for(var g in this.descriptor.attributes)if((c=this.descriptor.attributes[g])&&c.required&&!h[g])throw Error("Mesh is missing '"+g+"' attribute.");this.descriptor.addDirectives(d,a.lights||{},h);this.source={fragment:this.addDirectivesToSource(d,this.descriptor.fragment),vertex:this.addDirectivesToSource(d,this.descriptor.vertex)};b.sendEvent("urnshader",{urnshaderType:"code",vertexShader:this.source.vertex,
fragmentShader:this.source.fragment});return!0},addDirectivesToSource:function(a,b){var d="";a.forEach(function(a){d+="#define "+a+"\n"});return d+"\n"+b},getTransparencyFromInputData:function(a){return this.descriptor.hasTransparency(a)}});m.exports=e},{"../../system/system-notifier.js":131,"./../abstractshaderclosure.js":94}],109:[function(e,m,l){var d=e("../abstractshadercomposer.js").AbstractShaderComposer,b=e("./urnshaderclosure.js"),a=e("./shader-descriptor.js"),c=e("../../../../xflow/interface/request.js").ComputeRequest,
f=e("../../shader/shader-utils.js").addFragmentShaderHeader;e("./diffuse.js");e("./phong.js");e("./matte.js");e("./point.js");e("./utility.js");e=function(a,b){d.call(this,a,b);this.descriptor=null;this.setMaterialConfiguration(b)};XML3D.createClass(e,d,{setMaterialConfiguration:function(a){this.setShaderScript(a.model.urn);this.descriptor&&(a.dataNode&&this.updateRequest(a.dataNode),this.descriptor.fragment=f(this.descriptor.fragment))},setShaderScript:function(b){if(b)if("urn"!=b.scheme)XML3D.debug.logError("Shader script reference should start with an URN: ",
this.adapter.node);else{var c;c=b.path;c=c.substring(c.lastIndexOf(":")+1);c=XML3D.shaders.getScript(c);if(!c)throw Error("Unknown URN: "+b);this.descriptor=new a;XML3D.extend(this.descriptor,c)}else XML3D.debug.logError("Shader has no script attached: ",this.adapter.node)},getRequestFields:function(){return Object.keys(this.descriptor.uniforms).concat(Object.keys(this.descriptor.samplers))},getShaderAttributes:function(){return this.descriptor.attributes},createShaderClosure:function(){return new b(this.context,
this.descriptor)},createObjectDataRequest:function(a,b){var d=["position"];d.push.apply(d,Object.keys(this.descriptor.attributes));d.push.apply(d,Object.keys(this.descriptor.uniforms));d.push.apply(d,Object.keys(this.descriptor.samplers));return new c(a,d,b)},distributeObjectShaderData:function(a,b,c){a=a.getResult().getOutputMap();for(var d in a)"position"==d||void 0!==this.descriptor.attributes[d]?b(d,a[d]):void 0===this.descriptor.uniforms[d]&&void 0===this.descriptor.samplers[d]||c(d,a[d])}});
m.exports=e},{"../../../../xflow/interface/request.js":152,"../../shader/shader-utils.js":130,"../abstractshadercomposer.js":95,"./diffuse.js":102,"./matte.js":103,"./phong.js":104,"./point.js":105,"./shader-descriptor.js":106,"./urnshaderclosure.js":108,"./utility.js":110}],110:[function(e,m,l){XML3D.shaders.register("pickobjectid",{vertex:"attribute vec3 position;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",
fragment:"uniform vec3 id;\nvoid main(void) {\n    gl_FragColor = vec4(id, 0.0);\n}",uniforms:{}});XML3D.shaders.register("pickedposition",{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nuniform vec3 bbox[2];\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    vec3 diff = bbox[1] - bbox[0];\n    worldCoord = worldCoord - bbox[0];\n    worldCoord = worldCoord / diff;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",
fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});XML3D.shaders.register("pickedNormals",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelViewMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = normalize(modelViewMatrixN * normal);\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n    gl_FragColor = vec4((fragNormal+1.0)/2.0 * (254.0 / 255.0), 1.0);\n}",
uniforms:{}});XML3D.shaders.register("light-depth",{vertex:"attribute vec3 position;\nvarying vec4 worldPosition;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvoid main(void) {\n   worldPosition = modelMatrix * vec4(position, 1.0);\n   gl_Position   = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec4 worldPosition;\nuniform mat4 viewMatrix;\nvec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main(void) {\n    gl_FragColor = pack_depth( gl_FragCoord.z );\n}",
uniforms:{}});XML3D.shaders.register("render-normal",{vertex:"attribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewProjectionMatrix;\nuniform mat3 modelMatrixN;\nvarying vec3 fragNormal;\nvoid main(void) {\n    fragNormal = modelMatrixN * normal;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 fragNormal;\nvoid main(void) {\n   gl_FragColor = vec4((normalize(fragNormal) + 1.0) / 2.0, 1.0);\n}",uniforms:{}});XML3D.shaders.register("render-position",
{vertex:"attribute vec3 position;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewProjectionMatrix;\nvarying vec3 worldCoord;\nvoid main(void) {\n    worldCoord = (modelMatrix * vec4(position, 1.0)).xyz;\n    gl_Position = modelViewProjectionMatrix * vec4(position, 1.0);\n}",fragment:"varying vec3 worldCoord;\nvoid main(void) {\n    gl_FragColor = vec4(worldCoord, 1.0);\n}",uniforms:{}});XML3D.shaders.register("boxblur",{vertex:"attribute vec3 position;\nvoid main(void) {\n   gl_Position = vec4(position, 1.0);\n}",
fragment:"uniform sampler2D sInTexture;\nuniform vec2 canvasSize;\nuniform vec2 blurOffset;\nconst float blurSize = 1.0/512.0;\nvoid main(void) {\n   vec2 texcoord = (gl_FragCoord.xy / canvasSize.xy);\n   vec4 sum = vec4(0.0);\n   float blurSizeY = blurOffset.y / canvasSize.y;\n   float blurSizeX = blurOffset.x / canvasSize.x;\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y - blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 2.0*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x, texcoord.y + 1.5*blurSizeY));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 1.5*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x - blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 2.0*blurSizeX, texcoord.y));\n   sum += texture2D(sInTexture, vec2(texcoord.x + 1.5*blurSizeX, texcoord.y));\n   gl_FragColor = sum / 12.0;\n}",
uniforms:{canvasSize:[512,512],blurOffset:[1,1]},samplers:{sInTexture:null}});XML3D.shaders.register("ssao",{vertex:"attribute vec2 position;\nvoid main(void) {\n    gl_Position = vec4(position, 0.0, 1.0);\n}",fragment:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec2 canvasSize;\nuniform sampler2D sPositionTex;\nuniform sampler2D sNormalTex;\nuniform sampler2D sRandomNormals;\nuniform vec2 uRandomTexSize;\nuniform float uSampleRadius;\nuniform float uScale;\nuniform float uBias;\nuniform float uIntensity;\nuniform vec2 uConstVectors[4];\nuniform mat4 viewMatrix;\nvec3 getPosition(vec2 uv) {\nreturn texture2D(sPositionTex, uv).xyz;\n}\nfloat calcAmbientOcclusion(vec2 screenUV, vec2 uvOffset, vec3 origin, vec3 cnorm) {\n   vec3 diff = getPosition(screenUV + uvOffset) - origin;\n   vec3 v = normalize(diff);\n   float dist = length(diff) * uScale;\n   return max(0.0, dot(cnorm, v) - uBias) * (1.0/(1.0 + dist)) * uIntensity;\n}\nvoid main(void) {\n   vec2 screenUV = gl_FragCoord.xy / canvasSize.xy;\n   vec2 rand = normalize(texture2D(sRandomNormals, gl_FragCoord.xy / uRandomTexSize).xy * 2.0 - 1.0 );\n   vec3 norm = normalize(texture2D(sNormalTex, screenUV).xyz * 2.0 - 1.0 );\n   vec3 origin = getPosition(screenUV);\n   float radius = uSampleRadius / (viewMatrix * vec4(origin, 1.0)).z;\n   float ao = 0.0;\n   const int iterations = 4;\n   for (int i = 0; i < iterations; ++i) {\n       vec2 coord1 = reflect(uConstVectors[i], rand) * radius;\n       vec2 coord2 = vec2(coord1.x*0.707 - coord1.y*0.707, coord1.x*0.707 + coord1.y*0.707);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.25, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2*0.5, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord1*0.75, origin, norm);\n       ao += calcAmbientOcclusion(screenUV, coord2, origin, norm);\n   }\n   ao /= (float(iterations) * 4.0);\n   gl_FragColor = vec4(ao, ao, ao, 1.0);\n}",
uniforms:{canvasSize:[512,512],uConstVectors:[1,0,-1,0,0,1,0,-1],uRandomTexSize:[64,64],uSampleRadius:.9,uScale:.9,uBias:.2,uIntensity:1},samplers:{sPositionTex:null,sNormalTex:null,sRandomNormals:null},attributes:{}})},{}],111:[function(e,m,l){var d=window.WebGLRenderingContext,b=e("./render-trees/forward.js");e=function(a,b){this.context=a;this.scene=b;this.options={pickingEnabled:!0,mouseMovePickingEnabled:!0,glBlendFuncSeparate:[d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA]};
this.renderPipeline=null};XML3D.extend(e.prototype,{getRenderPipeline:function(){return this.renderPipeline=this.renderPipeline||new b(this.context)},setRenderPipeline:function(a){this.renderPipeline=a;this.context.requestRedraw("Pipeline changed")},getRenderOptions:function(){return this.options}});m.exports=e},{"./render-trees/forward.js":124}],112:[function(e,m,l){e=function(d,b,a){this.renderInterface=d;this.output=b;a=a||{};this.inputs=a.inputs||{};this.id=a.id||"";this.prePasses=[];this.postPasses=
[];this.processed=!1};XML3D.extend(e.prototype,{addPrePass:function(d){-1===this.prePasses.indexOf(d)&&(this.prePasses.push(d),d.postPasses.push(this))},removePrePass:function(d){var b=this.prePasses.indexOf(d);-1!==b&&(this.prePasses.splice(b,1),d.postPasses.splice(d.postPasses.indexOf(this),1))},clearPrePasses:function(){for(var d=this.prePasses.length;d--;)this.removePrePass(this.prePasses[d])},setProcessed:function(d){if(this.processed&&!d)for(var b=this.postPasses.length;b--;)this.postPasses[b].setProcessed(!1);
this.processed=d},renderTree:function(d){if(!this.processed){this.processed=!0;for(var b=this.prePasses.length;b--;)this.prePasses[b].renderTree(d);this.render(d)}},readPixelDataFromBuffer:function(){var d=new Uint8Array(8);return function(b,a,c){var e=this.renderInterface.context.gl,k=c.getScale();b*=k;a*=k;c.bind();try{return e.readPixels(b,a,1,1,e.RGBA,e.UNSIGNED_BYTE,d),c.unbind(),d}catch(h){return XML3D.debug.logException(h),c.unbind(),null}}}()});m.exports=e},{}],113:[function(e,m,l){var d=
e("./base.js"),b=e("../base/fullscreenquad.js");e=function(a,c,e){d.call(this,a,c,e);this._program=this.renderInterface.context.programFactory.getProgramByName("boxblur");this._screenQuad=new b(this.renderInterface.context);this._uniformsDirty=!0};XML3D.createClass(e,d);XML3D.extend(e.prototype,{render:function(){return function(){var a=this.renderInterface.context.gl,b=this.output;b.bind();a.clear(a.COLOR_BUFFER_BIT);a.disable(a.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();
this._screenQuad.draw(this._program);this._program.unbind();b.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a={},b=["canvasSize","sInTexture","blurOffset"];return function(){if(this._uniformsDirty){var d=this._program,e=this.output;a.canvasSize=[e.width,e.height];a.sInTexture=[this.inputs.buffer.colorTarget.handle];a.blurOffset=[1,1];d.setSystemUniformVariables(b,a)}}}()});m.exports=e},{"../base/fullscreenquad.js":87,"./base.js":112}],114:[function(e,m,l){var d=e("./scene-pass.js"),b=
e("../../renderer/tools/objectsorter.js");e=function(a,c,e){d.call(this,a,c,e);this.sorter=new b;this.lastRenderStats={}};XML3D.createClass(e,d);XML3D.extend(e.prototype,{render:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e="viewMatrix viewInverseMatrix projectionMatrix cameraPosition coords ssaoMap width".split(" ");return function(h){var g=this.renderInterface.context.gl,q={objects:0,primitives:0},r=this.output,n=h.systemUniforms,p=r.getWidth(),
t=r.getHeight(),l=p/t;r.bind();this.setGLStates();g.viewport(0,0,p,t);h.updateReadyObjectsFromActiveView(l);h.getActiveView().getWorldToViewMatrix(a);h.getActiveView().getViewToWorldMatrix(b);h.getActiveView().getProjectionMatrix(d,l);g=this.sorter.sortScene(h,a);n.viewMatrix=a;n.viewInverseMatrix=b;n.projectionMatrix=d;n.cameraPosition=h.getActiveView().getWorldSpacePosition();n.coords=[r.width,r.height,1];this.inputs.ssaoMap&&(n.ssaoMap=[this.inputs.ssaoMap.colorTarget.handle]);for(var u in g.opaque)this.renderObjectsToActiveBuffer(g.opaque[u],
h,r,n,e,{transparent:!1,stats:q});for(u=0;u<g.transparent.length;u++)this.renderObjectsToActiveBuffer([g.transparent[u]],h,r,n,e,{transparent:!0,stats:q});h.lights.changed=!1;r.unbind();this.lastRenderStats.count=q}}(),getRenderStats:function(){return this.lastRenderStats}});m.exports=e},{"../../renderer/tools/objectsorter.js":84,"./scene-pass.js":120}],115:[function(e,m,l){var d=e("./scene-pass.js"),b=e("../../renderer/tools/objectsorter.js");e=function(a,b,e,k){d.call(this,a,b,k);this.light=e;this.program=
null};XML3D.createClass(e,d,{init:function(a){this.sorter=new b;this.program=a.programFactory.getProgramByName("light-depth")},renderScene:function(){this.render(this.light.scene)},render:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),d=["viewMatrix","projectionMatrix"];return function(e){var h=this.renderInterface.context.gl,g=this.output,q=g.getWidth(),r=g.getHeight(),n=q/r,p=this.light.getFrustum(n),t=this.program;g.bind();h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT);h.viewport(0,
0,q,r);h.enable(h.DEPTH_TEST);h={objects:0,primitives:0};this.light.model.getLightViewMatrix(a);p.getProjectionMatrix(b,n);e.updateReadyObjectsFromMatrices(a,b);n=this.sorter.sortScene(e);p={};p.viewMatrix=a;p.projectionMatrix=b;for(var l in n.opaque)this.renderObjectsToActiveBuffer(n.opaque[l],e,g,p,d,{transparent:!1,stats:h,program:t});g.unbind();return{count:h}}}()});m.exports=e},{"../../renderer/tools/objectsorter.js":84,"./scene-pass.js":120}],116:[function(e,m,l){var d=e("./base.js");e=function(b,
a,c){d.call(this,b,a,c)};XML3D.createClass(e,d,{render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c=XML3D.math.mat3.create(),d={envBase:{},envOverride:null,sysBase:{}},e=["modelViewProjectionMatrix","modelViewMatrixN"];return function(h,g,q){var r=this.renderInterface.context.gl,n=this.output;n.bind();r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT);r.enable(r.DEPTH_TEST);r.disable(r.CULL_FACE);r.disable(r.BLEND);g&&q&&(h.updateModelViewMatrix(g),h.updateModelViewProjectionMatrix(q));
h.getModelViewProjectionMatrix(b);h.getWorldMatrix(a);XML3D.math.mat3.normalFromMat4(c,a)||XML3D.math.mat3.identity(c);g=this.renderInterface.context.programFactory.getPickingNormalProgram();g.bind();d.sysBase.modelViewProjectionMatrix=b;d.sysBase.modelViewMatrixN=c;g.setUniformVariables(null,e,d);h.mesh.draw(g);g.unbind();n.unbind()}}(),readNormalFromPickingBuffer:function(){var b=XML3D.math.vec3.create(),a=XML3D.math.vec3.fromValues(1,1,1);return function(c,d){var e=this.readPixelDataFromBuffer(c,
d,this.output);if(!e)return null;b[0]=e[0]/254;b[1]=e[1]/254;b[2]=e[2]/254;return XML3D.math.vec3.subtract(XML3D.math.vec3.create(),XML3D.math.vec3.scale(XML3D.math.vec3.create(),b,2),a)}}()});m.exports=e},{"./base.js":112}],117:[function(e,m,l){var d=e("./base.js");e=function(b,a,c){d.call(this,b,a,c)};XML3D.createClass(e,d);XML3D.extend(e.prototype,{render:function(){var b=XML3D.math.mat4.create(),a={envBase:{},envOverride:null,sysBase:{}},c=["id","modelViewProjectionMatrix"];return function(d,
e,h){var g=this.renderInterface.context.gl,q=this.output;q.bind();g.enable(g.DEPTH_TEST);g.disable(g.CULL_FACE);g.disable(g.BLEND);g.viewport(0,0,q.getWidth(),q.getHeight());g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);g=this.renderInterface.context.programFactory.getPickingObjectIdProgram();g.bind();for(var r=0,n=d.length;r<n;r++){var p=d[r],t=p.mesh;if(p.isVisible()){e&&h&&(p.updateModelViewMatrix(e),p.updateModelViewProjectionMatrix(h));p.getModelViewProjectionMatrix(b);var p=r+1,l=p&255,p=p>>
8,u=p&255,p=p>>8;a.sysBase.id=[(p&255)/255,u/255,l/255];a.sysBase.modelViewProjectionMatrix=b;g.setUniformVariables(null,c,a);t.draw(g)}}g.unbind();q.unbind()}}(),getRenderObjectFromPickingBuffer:function(b,a,c){a=this.readPixelDataFromBuffer(b,a,this.output);if(!a)return null;b=null;a=65536*a[0]+256*a[1]+a[2];0<a&&(b=c[a-1]);return b}});m.exports=e},{"./base.js":112}],118:[function(e,m,l){var d=e("./base.js");e=function(b,a,c){d.call(this,b,a,c);this.objectBoundingBox=XML3D.math.bbox.create()};XML3D.createClass(e,
d,{render:function(){var b=XML3D.math.mat4.create(),a=XML3D.math.mat4.create(),c={envBase:{},envOverride:null,sysBase:{}},d=["bbox","modelMatrix","modelViewProjectionMatrix"];return function(e,h,g){var q=this.renderInterface.context.gl,r=this.output;r.bind();q.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT|q.STENCIL_BUFFER_BIT);q.enable(q.DEPTH_TEST);q.disable(q.CULL_FACE);q.disable(q.BLEND);h&&g&&(e.updateModelViewMatrix(h),e.updateModelViewProjectionMatrix(g));e.getWorldMatrix(b);e.getObjectSpaceBoundingBox(this.objectBoundingBox);
XML3D.math.bbox.transform(this.objectBoundingBox,b,this.objectBoundingBox);h=this.renderInterface.context.programFactory.getPickingPositionProgram();h.bind();e.getModelViewProjectionMatrix(a);c.sysBase.bbox=this.objectBoundingBox;c.sysBase.modelMatrix=b;c.sysBase.modelViewProjectionMatrix=a;h.setUniformVariables(null,d,c);e.mesh.draw(h);h.unbind();r.unbind()}}(),readPositionFromPickingBuffer:function(){var b=XML3D.math.vec3.create();return function(a,c){var d=this.readPixelDataFromBuffer(a,c,this.output);
return d?(b[0]=d[0]/255,b[1]=d[1]/255,b[2]=d[2]/255,d=XML3D.math.bbox.size(XML3D.math.vec3.create(),this.objectBoundingBox),d=XML3D.math.vec3.mul(d,b,d),XML3D.math.vec3.add(d,this.objectBoundingBox,d),d):null}}()});m.exports=e},{"./base.js":112}],119:[function(e,m,l){var d=e("./scene-pass.js"),b=e("../../renderer/tools/objectsorter.js");e=function(a,b,e,k){d.call(this,a,b,k);this.light=e;this.program=null};XML3D.createClass(e,d,{init:function(a){this.sorter=new b;this.program=a.programFactory.getProgramByName("light-depth")},
renderScene:function(){this.render(this.light.scene)},render:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),d=["viewMatrix","projectionMatrix"];return function(e){for(var h=this.renderInterface.context.gl,g=this.output,q=g.getWidth(),r=g.getHeight(),n=q/r,p=this.light.getFrustum(n),t=this.program,l=0;l<g.glSides.length;l++){var u=XML3D.math.mat4.create();XML3D.math.mat4.identity(u);0==l?(u[0]=0,u[1]=0,u[2]=-1,u[4]=0,u[5]=-1,u[6]=0,u[8]=-1,u[9]=0,u[10]=0):1==l?(u[0]=0,u[1]=0,
u[2]=1,u[4]=0,u[5]=-1,u[6]=0,u[8]=1,u[9]=0,u[10]=0):2==l?(u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=0,u[6]=-1,u[8]=0,u[9]=1,u[10]=0):3==l?(u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=0,u[6]=1,u[8]=0,u[9]=-1,u[10]=0):4==l?(u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=-1,u[6]=0,u[8]=0,u[9]=0,u[10]=-1):5==l&&(u[0]=-1,u[1]=0,u[2]=0,u[4]=0,u[5]=-1,u[6]=0,u[8]=0,u[9]=0,u[10]=1);g.bind(l);h.clear(h.DEPTH_BUFFER_BIT|h.COLOR_BUFFER_BIT);h.viewport(0,0,q,r);h.enable(h.DEPTH_TEST);var m={objects:0,primitives:0};this.light.model.getLightViewMatrix(a);
XML3D.math.mat4.mul(a,u,a);p.getProjectionMatrix(b,n);e.updateReadyObjectsFromMatrices(a,b);var u=this.sorter.sortScene(e),w={};w.viewMatrix=a;w.projectionMatrix=b;for(var z in u.opaque)this.renderObjectsToActiveBuffer(u.opaque[z],e,g,w,d,{transparent:!1,stats:m,program:t});g.unbind()}return{count:m}}}()});m.exports=e},{"../../renderer/tools/objectsorter.js":84,"./scene-pass.js":120}],120:[function(e,m,l){function d(a){return"cw"==a.toLowerCase()?function(a){a.frontFace(a.CW)}:function(a){a.frontFace(a.CCW)}}
function b(a){switch(a.toLowerCase()){case "back":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.BACK)};case "front":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT)};case "both":return function(a){a.enable(a.CULL_FACE);a.cullFace(a.FRONT_AND_BACK)};default:return function(a){a.disable(a.CULL_FACE)}}}var a=e("./base.js"),c=e("../../../utils/options.js");c.register("renderer-faceculling","none");c.register("renderer-frontface","ccw");e=function(e,k,h){a.call(this,e,k,h);this.setFaceCulling=
b(c.getValue("renderer-faceculling"));this.setFrontFace=d(c.getValue("renderer-frontface"));var g=this;c.addObserver("renderer-faceculling",function(a,c){g.setFaceCulling=b(c)});c.addObserver("renderer-frontface",function(a,b){g.setFrontFace=d(b)})};XML3D.createClass(e,a,{setGLStates:function(){var a=this.renderInterface.context.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);this.setFaceCulling(a);this.setFrontFace(a);a.enable(a.DEPTH_TEST)},renderObjectsToActiveBuffer:function(){var a=
XML3D.math.mat4.create(),b=XML3D.math.mat3.create(),c=XML3D.math.mat4.create(),d=XML3D.math.mat4.create(),e=XML3D.math.mat3.create(),r=["modelMatrix","modelMatrixN","modelViewMatrix","modelViewProjectionMatrix","modelViewMatrixN"];return function(n,p,t,l,u,m){t=p=0;var w=m.stats||{},z=!0===m.transparent||!1,y=this.renderInterface.context.gl;m=m.program||n[0].getProgram();if(0==n.length)return w;z&&(y.enable(y.BLEND),y.blendFuncSeparate(y.SRC_ALPHA,y.ONE_MINUS_SRC_ALPHA,y.ONE,y.ONE_MINUS_SRC_ALPHA));
m.bind();m.setSystemUniformVariables(u,l);u=null;for(var E=0,C=n.length;E<C;E++){var A=n[E];if(A.isVisible()){var B=A.mesh;XML3D.debug.assert(B,"We need a mesh at this point.");A.getWorldMatrix(a);l.modelMatrix=a;A.getModelMatrixN(b);l.modelMatrixN=b;A.getModelViewMatrix(c);l.modelViewMatrix=c;A.getModelViewProjectionMatrix(d);l.modelViewProjectionMatrix=d;A.getModelViewMatrixN(e);l.modelViewMatrixN=e;m.setSystemUniformVariables(r,l);m.changeUniformVariableOverride(u,B.uniformOverride);u=B.uniformOverride;
t+=B.draw(m);p++;z&&y.disable(y.BLEND)}}m.changeUniformVariableOverride(u,null);m.unbind();w.objects+=p;w.primitives+=t;return w}}()});m.exports=e},{"../../../utils/options.js":145,"./base.js":112}],121:[function(e,m,l){var d=e("./base.js"),b=e("./vertexattribute-pass.js"),a=e("../base/rendertarget.js").GLRenderTarget,c=e("../base/fullscreenquad.js"),f=e("../../../utils/options.js");e={"renderer-ssao-scale":{defaultValue:1},"renderer-ssao-intensity":{defaultValue:5},"renderer-ssao-bias":{defaultValue:.2},
"renderer-ssao-radius":{defaultValue:1}};for(var k in e)f.register(k,e[k].defaultValue);k=function(a,b,e){d.call(this,a,b,e);a=this.renderInterface.context;this._program=a.programFactory.getProgramByName("ssao");this.randomVectorTexture=this.createRandomVectorTexture(a);this.loadRandomVectorImage();this._screenQuad=new c(a);this._uniformsDirty=!0};XML3D.createClass(k,d);XML3D.extend(k.prototype,{createRandomVectorTexture:function(a){var b=a.gl;a=a.createTexture();a.createTex2DFromData(b.RGBA,64,64,
b.RGBA,b.UNSIGNED_BYTE,{wrapS:b.REPEAT,wrapT:b.REPEAT,minFilter:b.LINEAR,magFilter:b.LINEAR});a.isTexture=!0;return a},loadRandomVectorImage:function(){var a=new Image;a.src="data:image/png;base64,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";
var b=this.renderInterface.context.gl,c=this.randomVectorTexture.handle;a.onload=function(){b.bindTexture(b.TEXTURE_2D,c);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a)}},createVertexAttributePass:function(c){var d=this.renderInterface.context,d=new a(d,{width:d.canvasTarget.width,height:d.canvasTarget.height,colorFormat:d.gl.RGBA,colorType:d.gl.FLOAT,depthFormat:d.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new b(this.renderInterface,d,{programName:c})},
render:function(){var a=XML3D.math.mat4.create(),b=["viewMatrix"];return function(c){var d=this.renderInterface.context.gl,e=this.output;e.bind();d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);d.viewport(0,0,e.getWidth(),e.getHeight());d.disable(d.DEPTH_TEST);this._program.bind();this._setNonVolatileShaderUniforms();d={};c.getActiveView().getWorldToViewMatrix(a);d.viewMatrix=a;this._program.setSystemUniformVariables(b,d);this._screenQuad.draw(this._program);this._program.unbind();e.unbind()}}(),_setNonVolatileShaderUniforms:function(){var a=
"canvasSize sPositionTex sNormalTex sRandomNormals uRandomTexSize uScale uBias uIntensity uSampleRadius uConstVectors".split(" ");return function(){if(this._uniformsDirty){var b={},c=this._program;c.bind();var d=this.output;b.canvasSize=[d.width,d.height];b.sPositionTex=[this.inputs.positionBuffer.colorTarget.handle];b.sNormalTex=[this.inputs.normalBuffer.colorTarget.handle];b.sRandomNormals=[this.randomVectorTexture];b.uRandomTexSize=[64,64];b.uScale=f.getValue("renderer-ssao-scale");b.uBias=f.getValue("renderer-ssao-bias");
b.uIntensity=f.getValue("renderer-ssao-intensity");b.uSampleRadius=f.getValue("renderer-ssao-radius");b.uConstVectors=[1,0,-1,0,0,1,0,-1];c.setSystemUniformVariables(a,b);c.unbind()}}}()});m.exports=k},{"../../../utils/options.js":145,"../base/fullscreenquad.js":87,"../base/rendertarget.js":90,"./base.js":112,"./vertexattribute-pass.js":122}],122:[function(e,m,l){var d=e("./scene-pass.js");e=function(b,a,c){d.call(this,b,a,c);this._program=this.renderInterface.context.programFactory.getProgramByName(c.programName)};
XML3D.createClass(e,d);XML3D.extend(e.prototype,{render:function(b){var a=this.renderInterface.context.gl,c=this.output,d=c.getWidth(),e=c.getHeight(),d=d/e;c.bind();a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.viewport(0,0,c.getWidth(),c.getHeight());a.enable(a.DEPTH_TEST);b.updateReadyObjectsFromActiveView(d);this.renderObjectsToActiveBuffer(b.ready,b,c,b.systemUniforms,[],{transparent:!1,program:this._program});c.unbind()}});m.exports=e},{"./scene-pass.js":120}],123:[function(e,m,l){e=function(d){this.mainRenderPass=
null;this.renderInterface=d};XML3D.extend(e.prototype,{render:function(d){this.mainRenderPass.renderTree(d)}});m.exports=e},{}],124:[function(e,m,l){var d=e("./base.js"),b=e("../base/rendertarget.js").GLRenderTarget;e("../base/rendertarget.js");var a=e("../render-passes/forward.js"),c=e("../render-passes/boxblur.js");e("../render-passes/light-pass.js");e("../render-passes/pointlight-pass.js");var f=e("../render-passes/vertexattribute-pass.js"),k=e("../render-passes/ssao-pass.js");e("../../renderer/scene/constants.js");
e("../materials/events.js");e=function(a,b){d.call(this,a);this._enableSSAO=b;this.mainPass=null;this.createMainPass()};XML3D.createClass(e,d);XML3D.extend(e.prototype,{createMainPass:function(){var b=this.renderInterface.context.canvasTarget;if(this._enableSSAO){var c=this.createVertexAttributePass("render-position"),d=this.createVertexAttributePass("render-normal"),e=this.createSSAOPass(c.output,d.output);e.addPrePass(c);e.addPrePass(d);var f=this.createBlurPass(e.output);f.addPrePass(e);this._blurPass=
f;this._ssaoPass=e;this._positionPass=c;this._normalPass=d;this.mainPass=new a(this.renderInterface,b,{inputs:{ssaoMap:f.output}});this.mainPass.addPrePass(f)}else this.mainPass=new a(this.renderInterface,b);this.mainRenderPass=this.mainPass},createVertexAttributePass:function(a){var c=this.renderInterface.context,c=new b(c,{width:c.canvasTarget.width,height:c.canvasTarget.height,colorFormat:c.gl.RGBA,colorType:c.gl.FLOAT,depthFormat:c.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});
return new f(this.renderInterface,c,{programName:a})},createSSAOPass:function(a,c){var d=this.renderInterface.context,d=new b(d,{width:d.canvasTarget.width,height:d.canvasTarget.height,colorFormat:d.gl.RGBA,depthFormat:d.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});return new k(this.renderInterface,d,{inputs:{positionBuffer:a,normalBuffer:c}})},createBlurPass:function(a){var d=this.renderInterface.context,d=new b(d,{width:a.width,height:a.height,colorFormat:d.gl.RGBA,depthFormat:d.gl.DEPTH_COMPONENT16,
stencilFormat:null,depthAsRenderbuffer:!0});return new c(this.renderInterface,d,{inputs:{buffer:a}})},render:function(a){this._enableSSAO&&(this._positionPass.setProcessed(!1),this._normalPass.setProcessed(!1),this._ssaoPass.setProcessed(!1),this._blurPass.setProcessed(!1));this.mainRenderPass.setProcessed(!1);d.prototype.render.call(this,a)},getRenderStats:function(){return this.mainPass.getRenderStats()}});m.exports=e},{"../../renderer/scene/constants.js":72,"../base/rendertarget.js":90,"../materials/events.js":96,
"../render-passes/boxblur.js":113,"../render-passes/forward.js":114,"../render-passes/light-pass.js":115,"../render-passes/pointlight-pass.js":119,"../render-passes/ssao-pass.js":121,"../render-passes/vertexattribute-pass.js":122,"./base.js":123}],125:[function(e,m,l){var d=e("./base/context.js"),b=e("./scene/glscene.js"),a=e("./base/rendertarget.js").GLScaledRenderTarget,c=e("../renderer/tools/datachangelistener.js"),f=e("./render-interface.js"),k=e("./render-passes/pick-object.js"),h=e("./render-passes/pick-position.js"),
g=e("./render-passes/pick-normal.js"),q=e("./render-trees/forward.js"),r=e("../../contrib/glu.js"),n=e("../../utils/options.js"),p=e("../../base/formathandler.js").xml3dFormatHandler;e={"renderer-ssao":{defaultValue:!1,recompileOnChange:!0}};for(var t in e)n.register(t,e[t].defaultValue);var x=function(a,b){return a.height-b-1};t=function(a,e){this._canvasHandler=e;var f=this._canvasHandler.getCanvas();this.width=f.clientWidth;this.height=f.clientHeight;this.context=new d(f,this._canvasHandler.id);
this.scene=new b(this.context);f=p.getFactory("webgl",this._canvasHandler.id);f.setScene(this.scene);f.setRenderer(this);f.getAdapter(a).traverse(function(){});this.scene.rootNode.setVisible(!0);this.pickedObject=null;this.needsPickingDraw=this.needsDraw=!0;this.context.requestRedraw=this.requestRedraw.bind(this);this.rayCamera=this.scene.createRenderView();this.initGL();this.changeListener=new c(this);this.renderInterface=this.createRenderInterface();this.createDefaultPipelines();n.addObserver(this.onFlagsChange.bind(this))};
t.prototype.generateRay=function(){};XML3D.extend(t.prototype,{initGL:function(){var a=this.context.gl;a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(0);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.frontFace(a.CCW);a.cullFace(a.BACK);a.disable(a.CULL_FACE);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.disable(a.BLEND);a.viewport(0,0,this.width,this.height);a.pixelStorei(a.PACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_ALIGNMENT,1);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
!0);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL)},handleResizeEvent:function(a,b){this.width=a;this.height=b;this.context.handleResizeEvent(a,b);this.createDefaultPipelines();this.scene.handleResizeEvent(a,b);this.needsDraw=this.needsPickingDraw=!0},createDefaultPipelines:function(){var b=new q(this.renderInterface,n.getValue("renderer-ssao"));this.renderInterface.setRenderPipeline(b);b=new a(this.context,512,{width:this.context.canvasTarget.width,
height:this.context.canvasTarget.height,colorFormat:this.context.gl.RGBA,depthFormat:this.context.gl.DEPTH_COMPONENT16,stencilFormat:null,depthAsRenderbuffer:!0});this.pickObjectPass=new k(this.renderInterface,b);this.pickPositionPass=new h(this.renderInterface,b);this.pickNormalPass=new g(this.renderInterface,b)},createRenderInterface:function(){return new f(this.context,this.scene)},requestRedraw:function(a){XML3D.debug.logDebug("Request redraw because:",a);this.needsPickingDraw=this.needsDraw=
!0},getWorldSpaceNormalByPoint:function(a,b,c){c=c||this.pickedObject;if(!c)return null;b=x(this._canvasHandler.getCanvas(),b);this.pickNormalPass.render(c);this.needsPickingDraw=!0;return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByPoint:function(a,b,c){c=c||this.pickedObject;if(!c)return null;b=x(this._canvasHandler.getCanvas(),b);this.pickPositionPass.render(c);this.needsPickingDraw=!0;return this.pickPositionPass.readPositionFromPickingBuffer(a,b)},getRenderObjectByRay:function(a,
b,c){a=this.scene.findRayIntersections(a);this.pickObjectPass.render(a,b,c);b=Math.floor(this.pickObjectPass.output.getWidth()/2/this.pickObjectPass.output.getScale());c=Math.floor(this.pickObjectPass.output.getHeight()/2/this.pickObjectPass.output.getScale());return this.pickObjectPass.getRenderObjectFromPickingBuffer(b,c,a)},getWorldSpaceNormalByRay:function(a,b,c,d){if(!b)return null;this.pickNormalPass.render(b,c,d);a=Math.floor(this.pickNormalPass.output.getWidth()/2/this.pickNormalPass.output.getScale());
b=Math.floor(this.pickNormalPass.output.getHeight()/2/this.pickNormalPass.output.getScale());return this.pickNormalPass.readNormalFromPickingBuffer(a,b)},getWorldSpacePositionByRay:function(a,b,c,d){if(!b)return null;this.pickPositionPass.render(b,c,d);a=Math.floor(this.pickPositionPass.output.getWidth()/2/this.pickPositionPass.output.getScale());b=Math.floor(this.pickPositionPass.output.getHeight()/2/this.pickPositionPass.output.getScale());return this.pickPositionPass.readPositionFromPickingBuffer(a,
b)},calculateMatricesForRay:function(a,b,c){this.rayCamera.updatePosition(a.origin._data);this.rayCamera.updateOrientation(this.calculateOrientationForRayDirection(a));this.rayCamera.getWorldToViewMatrix(b);a=this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight();this.rayCamera.getProjectionMatrix(c,a)},calculateOrientationForRayDirection:function(){var a=XML3D.math.vec3.create(),b=XML3D.math.vec3.create(),c=XML3D.math.vec3.create(),d=XML3D.math.vec3.create(),e=XML3D.math.quat.create(),
f=XML3D.math.mat4.create();return function(g){XML3D.math.vec3.set(d,0,1,0);XML3D.math.vec3.cross(a,g.direction._data,d);XML3D.math.vec3.length(a)||XML3D.math.vec3.set(a,1,0,0);XML3D.math.vec3.cross(b,a,g.direction._data);XML3D.math.vec3.negate(c,g.direction._data);XML3D.math.quat.setFromBasis(a,b,c,e);XML3D.math.mat4.fromRotationTranslation(f,e,[0,0,0]);return f}}(),needsRedraw:function(){return this.needsDraw},renderToCanvas:function(){this.needsDraw=!1;this.prepareRendering();this.renderInterface.getRenderPipeline().render(this.scene);
var a=this.renderInterface.getRenderPipeline().getRenderStats();XML3D.debug.logDebug("Rendered to Canvas");return a},getRenderObjectFromPickingBuffer:function(a,b){b=x(this._canvasHandler.getCanvas(),b);this.needsPickingDraw&&(this.needsPickingDraw=!1,this.prepareRendering(),this.scene.updateReadyObjectsFromActiveView(this.pickObjectPass.output.getWidth()/this.pickObjectPass.output.getHeight()),this.pickObjectPass.render(this.scene.ready),XML3D.debug.logDebug("Rendered Picking Buffer"));return this.pickedObject=
this.pickObjectPass.getRenderObjectFromPickingBuffer(a,b,this.scene.ready)},prepareRendering:function(){this.scene.update()},generateRay:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create();return function(c,d){var e=x(this._canvasHandler.getCanvas(),d),f=[0,0];f[2]=this.width;f[3]=this.height;var g=this.scene.getActiveView();g.getWorldToViewMatrix(a);g.getProjectionMatrix(b,f[2]/f[3]);var g=new window.XML3DRay,h=[],k=[];if(!1===r.unProject(c,e,0,a,b,f,h)||!1===r.unProject(c,e,1,a,
b,f,k))return g;XML3D.math.mat4.invert(a,a);e=new window.XML3DVec3(a[12],a[13],a[14]);g.origin.set(e);g.direction.set(k[0]-h[0],k[1]-h[1],k[2]-h[2]);g.direction.set(g.direction.normalize());return g}}(),dispose:function(){this.scene.clear()},getRenderInterface:function(){return this.renderInterface},onFlagsChange:function(a){"renderer-ssao"==a&&(this.scene.shaderFactory.setShaderRecompile(),this.createDefaultPipelines())}});m.exports=t},{"../../base/formathandler.js":22,"../../contrib/glu.js":25,
"../../utils/options.js":145,"../renderer/tools/datachangelistener.js":82,"./base/context.js":86,"./base/rendertarget.js":90,"./render-interface.js":111,"./render-passes/pick-normal.js":116,"./render-passes/pick-object.js":117,"./render-passes/pick-position.js":118,"./render-trees/forward.js":124,"./scene/glscene.js":128}],126:[function(e,m,l){var d=e("../xflow/xflow-mesh.js");e=function(){};XML3D.extend(e.prototype,{createDrawable:function(b,a){XML3D.debug.logDebug("DrawableFactory::createDrawable",
b);try{var c=new d(a,b.getDataNode(),b.getType(),{boundingBoxChanged:b.setObjectSpaceBoundingBox.bind(b)});b.mesh=c.getMesh();return c}catch(e){return XML3D.debug.logError(e,b.node),null}}});m.exports=e},{"../xflow/xflow-mesh.js":133}],127:[function(e,m,l){e="pointLightPosition pointLightAttenuation pointLightIntensity pointLightOn pointLightCastShadow pointLightMatrix pointLightShadowBias pointLightNearFar pointLightShadowMap".split(" ").concat("directionalLightDirection directionalLightIntensity directionalLightOn directionalLightCastShadow directionalLightMatrix directionalLightShadowBias directionalLightShadowMap".split(" ")).concat("spotLightAttenuation spotLightPosition spotLightIntensity spotLightDirection spotLightOn spotLightSoftness spotLightCosFalloffAngle spotLightCosSoftFalloffAngle spotLightCastShadow spotLightMatrix spotLightShadowBias spotLightShadowMap".split(" "));
m.exports={ALL_PARAMETERS:e}},{}],128:[function(e,m,l){function d(a,b){var c=a.indexOf(b);return-1!=c?(a.splice(c,1),!0):!1}var b=e("./../../renderer/scene/scene.js"),a=e("./drawable-factory.js"),c=e("./../../renderer/scene/constants.js"),f=e("./../../renderer/tools/frustum.js").FrustumTest,k=e("../materials/shadercomposerfactory.js"),h=e("../../../utils/options.js"),g=e("../materials/shadowmap-service"),q={"shadejs-extractUniformExpressions":{defaultValue:!1,recompileOnChange:!0},"shadejs-transformSpaces":{defaultValue:!0,
recompileOnChange:!0},"renderer-frustumCulling":{defaultValue:!0,recompileOnChange:!1},"shadejs-cache":{defaultValue:!0,recompileOnChange:!1}},r;for(r in q)h.register(r,q[r].defaultValue);e=function(c){b.call(this);this.context=c;this.shaderFactory=new k(c);this.drawableFactory=new a;this.shadowMapService=new g(c,this);this.ready=[];this.queue=[];this.lightsNeedUpdate=!0;this.systemUniforms={};this.deferred=window.XML3D_DEFERRED||!1;this.colorClosureSignatures=[];this.doFrustumCulling=!!h.getValue("renderer-frustumCulling");
this.addListeners()};XML3D.createClass(e,b);XML3D.extend(e.prototype,{remove:function(a){d(this.queue,a);d(this.ready,a)},clear:function(){this.ready=[];this.queue=[]},moveFromQueueToReady:function(a){d(this.queue,a)&&this.ready.push(a)},moveFromReadyToQueue:function(a){d(this.ready,a)&&this.queue.push(a)},update:function(){this.lightsNeedUpdate&&(this.lightsNeedUpdate=!1,this.updateLightParameters(),this.lights.lightValueChanged());this.updateObjectsForRendering();this.shadowMapService.updateForRendering();
this.updateShaders()},updateLightParameters:function(){var a=this.systemUniforms;this.lights.fillGlobalParameters(a);this.shadowMapService.fillGlobalParameters(a);var b=a.spotLightFalloffAngle,c=a.spotLightSoftness;if(b){for(var d=[],e=[],f=0;f<b.length;f++)e[f]=Math.cos(b[f]),d[f]=Math.cos(b[f]*(1-c[f]));a.spotLightCosFalloffAngle=e;a.spotLightCosSoftFalloffAngle=d}},updateSystemUniforms:function(a){this.shaderFactory.updateSystemUniforms(a,this)},updateShaders:function(){this.shaderFactory.update(this)},
updateObjectsForRendering:function(){this.forEach(function(a){a.updateForRendering()})},forEach:function(a,b){this.queue.slice().forEach(a,b);this.ready.slice().forEach(a,b)},updateReadyObjectsFromActiveView:function(){var a=XML3D.math.mat4.create(),b=XML3D.math.mat4.create(),c=XML3D.math.mat4.create(),d=XML3D.math.bbox.create(),e=new f;return function(f){var g=this.getActiveView(),h=this.ready;g.getWorldToViewMatrix(a);h.forEach(function(b){b.updateModelViewMatrix(a);b.updateModelMatrixN();b.updateModelViewMatrixN()});
this.updateBoundingBox();g.getProjectionMatrix(c,f);g.getViewToWorldMatrix(b);f=g.getFrustum();e.set(f,b);f=0;for(g=h.length;f<g;f++){var k=h[f];k.updateModelViewProjectionMatrix(c);k.getWorldSpaceBoundingBox(d);k.inFrustum=this.doFrustumCulling?e.isBoxVisible(d):!0}}}(),updateReadyObjectsFromMatrices:function(a,b){for(var c=this.ready,d=0,e=c.length;d<e;d++){var f=c[d];f.updateModelViewMatrix(a);f.updateModelMatrixN();f.updateModelViewProjectionMatrix(b)}},addListeners:function(){this.addEventListener(c.EVENT_TYPE.SCENE_STRUCTURE_CHANGED,
function(a){void 0!==a.newChild?this.addChildEvent(a.newChild):void 0!==a.removedChild&&this.removeChildEvent(a.removedChild)});this.addEventListener(c.EVENT_TYPE.VIEW_CHANGED,function(){this.context.requestRedraw("Active view changed.")});this.addEventListener(c.EVENT_TYPE.LIGHT_STRUCTURE_CHANGED,function(){this.lightsNeedUpdate=!0;this.shaderFactory.setLightStructureDirty();this.context.requestRedraw("Light structure changed.")});this.addEventListener(c.EVENT_TYPE.LIGHT_VALUE_CHANGED,function(a){this.lightsNeedUpdate=
!0;this.shaderFactory.setLightValueChanged();this.lights.lightValueChanged(a.light);this.context.requestRedraw("Light value changed.")});this.addEventListener(c.EVENT_TYPE.SCENE_SHAPE_CHANGED,function(a){this.lightsNeedUpdate=!0});h.addObserver(this.onFlagsChange.bind(this))},addChildEvent:function(a){a.type==c.NODE_TYPE.OBJECT&&(this.queue.push(a),this.context.requestRedraw("Object was added to scene."))},removeChildEvent:function(a){a.type==c.NODE_TYPE.OBJECT&&(this.remove(a),a.dispose(),this.context.requestRedraw("Object was removed from scene."))},
handleResizeEvent:function(){this.getActiveView().setProjectionDirty()},createDrawable:function(a){return this.drawableFactory.createDrawable(a,this.context)},requestRedraw:function(a){return this.context.requestRedraw(a)},onFlagsChange:function(a,b){q[a]&&q[a].recompileOnChange&&this.shaderFactory.setShaderRecompile();"renderer-frustumCulling"==a&&(this.doFrustumCulling=!!b)}});m.exports=e},{"../../../utils/options.js":145,"../materials/shadercomposerfactory.js":100,"../materials/shadowmap-service":101,
"./../../renderer/scene/constants.js":72,"./../../renderer/scene/scene.js":81,"./../../renderer/tools/frustum.js":83,"./drawable-factory.js":126}],129:[function(e,m,l){var d=e("./shader-utils.js"),b=e("../materials/urn/shader-descriptor.js"),a=e("../materials/urn/urnshaderclosure.js");e=function(a){this.context=a;this.programs={fallback:null,picking:{id:null,normal:null,position:null}}};XML3D.extend(e.prototype,{getProgramByName:function(c){var e=XML3D.shaders.getScript(c);if(!e||!e.vertex)return XML3D.debug.logError("Unknown shader: ",
c),null;c=new b;XML3D.extend(c,e);c.fragment=d.addFragmentShaderHeader(c.fragment);e=new a(this.context,c);e.createSources({},null,null);e.compile();return e},getFallbackProgram:function(){if(!this.programs.fallback){var c=new b;XML3D.extend(c,XML3D.shaders.getScript("matte"));c.fragment=d.addFragmentShaderHeader(c.fragment);c=new a(this.context,c);c.uniformCollection.envBase.diffuseColor=[1,0,0];c.createSources({},null,null);c.compile();this.programs.fallback=c;this.programs.fallback.bind();this.programs.fallback.setUniformVariables(["diffuseColor"],
null,{envBase:{diffuseColor:[1,0,0]}});this.programs.fallback.unbind()}return this.programs.fallback},getPickingObjectIdProgram:function(){var a=this.programs.picking;a.id||(a.id=this.getProgramByName("pickobjectid"));return a.id},getPickingPositionProgram:function(){var a=this.programs.picking;a.position||(a.position=this.getProgramByName("pickedposition"));return a.position},getPickingNormalProgram:function(){var a=this.programs.picking;a.normal||(a.normal=this.getProgramByName("pickedNormals"));
return a.normal}});m.exports=e},{"../materials/urn/shader-descriptor.js":106,"../materials/urn/urnshaderclosure.js":108,"./shader-utils.js":130}],130:[function(e,m,l){m.exports={addFragmentShaderHeader:function(d){return"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif // GL_FRAGMENT_PRECISION_HIGH\n\n"+d}}},{}],131:[function(e,m,l){m.exports={node:null,setNode:function(d){this.node=d},sendEvent:function(d,b){if(this.node){var a=document.createEvent("CustomEvent");
b.systemtype=d;a.initCustomEvent("xml3dsystem",!0,!0,b);this.node.dispatchEvent(a)}}}},{}],132:[function(e,m,l){var d=e("../base/context.js"),b=e("../../../xflow/interface/constants.js");m.exports={getGLUniformValueFromXflowDataEntry:function(a,c){var d;if(!a)return null;if(a.type==b.DATA_TYPE.TEXTURE){d=c.getXflowEntryWebGlData(a);var e=d.texture||c.createTexture();d.changed&&e.updateFromTextureEntry(a);d.texture=e;d.changed=0;d=[e]}else if(a.type==b.DATA_TYPE.BOOL){d=a.getValue();for(var e=[d.length],
h=0;h<d.length;h++)e[h]=d[h];d=e}else d=a.getValue();return d},getGLBufferFromXflowDataEntry:function(a,c,e){var k=c.getXflowEntryWebGlData(a),h=k.buffer,g=c.gl;if(k.changed&&e){for(var q=a.getValue(),r=1E8,n=0,p=q.length;p--;)r=Math.min(r,q[p]),n=Math.max(n,q[p]);k.maxIndex=n;k.minIndex=r}switch(k.changed){case b.DATA_ENTRY_STATE.CHANGED_VALUE:if(e){a=a.getValue();switch(h.glType){case g.UNSIGNED_BYTE:a=new Uint8Array(a);break;case g.UNSIGNED_SHORT:a=new Uint16Array(a);break;case g.UNSIGNED_INT:break;
default:return XML3D.debug.logError("Unknown GL type for element buffer: ",h.glType),null}g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,h);g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,a)}else g.bindBuffer(g.ARRAY_BUFFER,h),g.bufferSubData(g.ARRAY_BUFFER,0,a.getValue());break;case b.DATA_ENTRY_STATE.CHANGED_NEW:case b.DATA_ENTRY_STATE.CHANGED_SIZE:case b.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:e?(h=a.getValue(),r=k.maxIndex,g=c.gl,e=h,q=g.UNSIGNED_INT,256>r?(q=g.UNSIGNED_BYTE,e=new Uint8Array(h)):65536>r?(q=g.UNSIGNED_SHORT,
e=new Uint16Array(h)):c.extensions[d.EXTENSIONS.UINT32_INDICES]||(XML3D.debug.logError("Trying to use index data with indices larger than 65535, but this is not supported on your platform. Indexing errors will occur."),q=g.UNSIGNED_SHORT,e=new Uint16Array(h)),c=g.createBuffer(),g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,c),g.bufferData(g.ELEMENT_ARRAY_BUFFER,e,g.STATIC_DRAW),c.bytesPerElement=e.BYTES_PER_ELEMENT,c.length=h.length,c.glType=q):(h=a.getValue(),g=c.gl,c=g.createBuffer(),g.bindBuffer(g.ARRAY_BUFFER,
c),g.bufferData(g.ARRAY_BUFFER,h,g.STATIC_DRAW),c.length=h.length,g=window.WebGLRenderingContext,c.glType=h instanceof Int8Array?g.BYTE:h instanceof Uint8Array?g.UNSIGNED_BYTE:h instanceof Int16Array?g.SHORT:h instanceof Uint16Array?g.UNSIGNED_SHORT:h instanceof Int32Array?g.INT:h instanceof Uint32Array?g.UNSIGNED_INT:g.FLOAT),h=c,h.tupleSize=a.getTupleSize(),k.buffer=h}k.changed=0;return h},calculateBoundingBox:function(a,b){var d=new XML3D.math.bbox.create,e;if(!a||3>a.length)return d;if(b)for(e=
3*b[0],d[0]=a[e],d[1]=a[e+1],d[2]=a[e+2],d[3]=a[e],d[4]=a[e+1],d[5]=a[e+2],e=1;e<b.length;e++){var h=3*b[e],g=a[h],q=a[h+1],h=a[h+2];g<d[0]&&(d[0]=g);q<d[1]&&(d[1]=q);h<d[2]&&(d[2]=h);g>d[3]&&(d[3]=g);q>d[4]&&(d[4]=q);h>d[5]&&(d[5]=h)}else for(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[0],d[4]=a[1],d[5]=a[2],e=3;e<a.length;e+=3)a[e]<d[0]&&(d[0]=a[e]),a[e+1]<d[1]&&(d[1]=a[e+1]),a[e+2]<d[2]&&(d[2]=a[e+2]),a[e]>d[3]&&(d[3]=a[e]),a[e+1]>d[4]&&(d[4]=a[e+1]),a[e+2]>d[5]&&(d[5]=a[e+2]);return d}}},{"../../../xflow/interface/constants.js":149,
"../base/context.js":86}],133:[function(e,m,l){var d=e("../../renderer/scene/drawableclosure.js"),b=e("../base/mesh.js"),a=e("./utils.js"),c=e("../../renderer/scene/constants.js").EVENT_TYPE,f=e("../materials/events.js"),k=e("../../../xflow/interface/constants.js"),h=e("../../../xflow/interface/request.js").ComputeRequest,g=d.READY_STATE,q={};q[WebGLRenderingContext.TRIANGLES]={attributeData:{position:k.DATA_TYPE.FLOAT3},typeData:{index:k.DATA_TYPE.INT,solid:k.DATA_TYPE.BOOL,vertexCount:k.DATA_TYPE.INT},
bboxFix:{boundingBox:k.DATA_TYPE.FLOAT3},bboxCompute:{position:k.DATA_TYPE.FLOAT3}};q[WebGLRenderingContext.LINE_STRIP]=q[WebGLRenderingContext.TRIANGLES];q[WebGLRenderingContext.LINES]=q[WebGLRenderingContext.TRIANGLES];q[WebGLRenderingContext.POINTS]=q[WebGLRenderingContext.TRIANGLES];q[WebGLRenderingContext.TRIANGLE_STRIP]=q[WebGLRenderingContext.TRIANGLES];e=function(a,c,e,f){d.call(this,a,d.TYPES.MESH);f=f||{};this.mesh=new b(a,e);this.dataNode=c;this.typeRequest=this.shaderClosure=this.shaderComposer=
null;this.typeDataValid=!0;this.objectShaderRequest=null;this.changeState=1;this.boundingBoxChanged=f.boundingBoxChanged||function(){};this.initialize()};XML3D.createClass(e,d,{initialize:function(){this.typeDataChanged(this.typeRequest,k.RESULT_STATE.CHANGED_STRUCTURE);this.shaderChanged()},setShaderComposer:function(a){this.bindedShaderChanged||(this.bindedShaderChanged=this.shaderChanged.bind(this));this.shaderComposer&&this.shaderComposer.removeEventListener(f.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);
(this.shaderComposer=a)&&this.shaderComposer.addEventListener(f.MATERIAL_STRUCTURE_CHANGED,this.bindedShaderChanged);this.changeState|=32},update:function(a){if(0!==this.changeState){XML3D.debug.logDebug("Update mesh closure",this.changeState);var b=!!this.shaderClosure&&this.typeDataValid,d=null,e=!1;try{this.changeState&33&&this.mesh.clear(),this.changeState&3&&this.updateTypeData(),e=!0,this.changeState&35&&this.updateIndexBuffer(),this.changeState&33?(this.updateObjectShaderRequest(),this.updateShaderClosure(a),
this.updateObjectShaderData()):this.changeState&5&&this.updateObjectShaderData(),this.dataNode.isSubtreeLoading()&&(this.shaderClosure=null,this.typeDataValid=!1)}catch(f){d=f,e?this.shaderClosure=null:this.typeDataValid=!1}a=!!this.shaderClosure&&this.typeDataValid;b!=a&&this.dispatchEvent({type:c.DRAWABLE_STATE_CHANGED,newState:a?g.COMPLETE:g.INCOMPLETE,oldState:b?g.COMPLETE:g.INCOMPLETE});this.changeState=0;if(d)throw d;}},calculateBoundingBox:function(){var b=XML3D.math.bbox.create();return function(){var c=
this.typeRequest.getResult(),d=c.getOutputData("boundingBox");d?this.boundingBoxChanged(a.calculateBoundingBox(d.getValue(),null)):(d=c.getOutputData("position"))?(c=c.getOutputData("index"),this.boundingBoxChanged(a.calculateBoundingBox(d.getValue(),c?c.getValue():null))):this.boundingBoxChanged(b)}}(),typeDataChanged:function(a,b){this.changeState|=b==k.RESULT_STATE.CHANGED_STRUCTURE?1:2;this.dispatchEvent({type:c.SCENE_SHAPE_CHANGED});this.context.requestRedraw("Mesh Type Data Change");XML3D.debug.logDebug("XflowMesh: Type data changed",
a,b,this.changeState)},getMesh:function(){return this.mesh},getMeshType:function(){return this.mesh.glType},updateObjectShaderRequest:function(){this.objectShaderRequest&&this.objectShaderRequest.clear();this.objectShaderRequest=null;this.dataNode.isSubtreeLoading()||(this.objectShaderRequest=this.shaderComposer.createObjectDataRequest(this.dataNode,this.shaderInputDataChanged.bind(this)))},updateShaderClosure:function(a){this.shaderClosure=null;if(!this.dataNode.isSubtreeLoading()&&!this.dataNode.getOutputChannelInfo("position"))throw Error("Mesh does not have 'position' attribute.");
this.dataNode.isSubtreeLoading()||this.objectShaderRequest.getResult().loading||(this.shaderClosure=this.shaderComposer.getShaderClosure(a,this.objectShaderRequest))},updateIndexBuffer:function(){var a=this.typeRequest.getResult().getOutputData("index");a&&a.getValue()&&this.handleBuffer("index",a,!0)},updateObjectShaderData:function(){if(this.shaderClosure&&(this.bindedHandleBuffer||(this.bindedHandleBuffer=this.handleBuffer.bind(this)),this.bindedHandleUniform||(this.bindedHandleUniform=this.handleUniform.bind(this)),
this.shaderComposer.distributeObjectShaderData(this.objectShaderRequest,this.bindedHandleBuffer,this.bindedHandleUniform),!this.mesh.isReadyToRender()))throw Error("Mesh has empty vertex attributes.");},updateTypeData:function(){if(this.typeDataValid||this.changeState&1){this.updateTypeRequest();this.calculateBoundingBox();var a=this.typeRequest.getResult().getOutputData("vertexCount");this.mesh.setVertexCount(a&&a.getValue()?a.getValue():null);this.typeDataValid=!0}},handleBuffer:function(b,c,d){d=
d||!1;var e=this.mesh;if("position"==b&&!c)throw Error("'position' attribute of mesh is empty.");if(c)if(c.type==k.DATA_TYPE.TEXTURE)XML3D.debug.logError("Texture as mesh parameter is not yet supported");else{var f=a.getGLBufferFromXflowDataEntry(c,this.context,"index"==b);d?this.updateIndexRange(c):this.mesh.checkBufferCompatible(b,c);e.setBuffer(b,f)}else this.mesh.removeBuffer(b)},updateIndexRange:function(a){a=this.context.getXflowEntryWebGlData(a);this.mesh.setIndexRange(a.minIndex,a.maxIndex)},
handleUniform:function(b,c){var d=a.getGLUniformValueFromXflowDataEntry(c,this.context);this.mesh.setUniformOverride(b,d)},updateTypeRequest:function(){var a=q[this.getMeshType()];a?(a=this.getTypeRequestNames(a),this.typeRequest&&this.typeRequest.filter==a||(this.typeRequest&&this.typeRequest.clear(),this.typeRequest=new h(this.dataNode,a,this.typeDataChanged.bind(this)))):(XML3D.debug.logError("Unsupported Mesh request: ",this.mesh,this.getMeshType()),this.typeDataValid=!1)},getTypeRequestNames:function(a){var b=
[];b.push.apply(b,Object.keys(a.typeData));b.push.apply(b,Object.keys(a.bboxFix));this.checkXflowTypes(this.dataNode,a.bboxFix)||(this.checkXflowTypes(this.dataNode,a.bboxCompute)||(this.typeDataValid=!1),b.push.apply(b,Object.keys(a.bboxCompute)));return b},checkXflowTypes:function(a,b){for(var c in b){var d=a.getOutputChannelInfo(c);if(!d||d.type!=b[c])return!1}return!0},shaderInputDataChanged:function(a,b){this.changeState|=b!=k.RESULT_STATE.CHANGED_DATA_VALUE?1:4;this.dispatchEvent({type:c.SCENE_SHAPE_CHANGED});
this.context.requestRedraw("Mesh Attribute Data Changed");XML3D.debug.logDebug("XflowMesh: Attribute data changed",a,b,this.changeState)},shaderChanged:function(){this.changeState|=32},getProgram:function(){return this.shaderClosure}});m.exports=e},{"../../../xflow/interface/constants.js":149,"../../../xflow/interface/request.js":152,"../../renderer/scene/constants.js":72,"../../renderer/scene/drawableclosure.js":73,"../base/mesh.js":88,"../materials/events.js":96,"./utils.js":132}],134:[function(e,
m,l){e=function(d,b,a){var c=this,e=function(){c._callback&&c._callback(c)};this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,e);this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,e);d&&d.min?(this._min.set(d.min),this._max.set(d.max)):(d&&this._min.set(d),b&&this._max.set(b));this._callback="function"==typeof a?a:0};Object.defineProperty(e.prototype,"min",{get:function(){return this._min},set:function(){throw Error("XML3DBox::min is readonly.");
},configurable:!1,enumerable:!1});Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(){throw Error("XML3DBox::max is readonly.");},configurable:!1,enumerable:!1});e.prototype.size=function(){var d=this._max.subtract(this._min);0>d.x&&(d.x=0);0>d.y&&(d.y=0);0>d.z&&(d.z=0);return d};e.prototype.center=function(){return this._min.add(this._max).scale(.5)};e.prototype.makeEmpty=function(){this._min=new window.XML3DVec3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);
this._max=new window.XML3DVec3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);this._callback&&this._callback(this)};e.prototype.isEmpty=function(){return this._min.x>this._max.x||this._min.y>this._max.y||this._min.z>this._max.z};e.prototype.toString=function(){return"[object XML3DBox]"};e.prototype.set=function(d){this._min.set(d.min);this._max.set(d.max);this._callback&&this._callback(this)};e.prototype.extend=function(d){if(d){var b;if(d.constructor===window.XML3DBox)b=d.min,d=d.max;else if(d.constructor===
window.XML3DVec3)b=d;else return;b.x<this._min.x&&(this._min.x=b.x);b.y<this._min.y&&(this._min.y=b.y);b.z<this._min.z&&(this._min.z=b.z);d.x>this._max.x&&(this._max.x=d.x);d.y>this._max.y&&(this._max.y=d.y);d.z>this._max.z&&(this._max.z=d.z)}};m.exports=e},{}],135:[function(e,m,l){function d(a){switch(a){case b.DATA_TYPE.FLOAT:return k.FLOAT;case b.DATA_TYPE.FLOAT2:return k.FLOAT2;case b.DATA_TYPE.FLOAT3:return k.FLOAT3;case b.DATA_TYPE.FLOAT4:return k.FLOAT4;case b.DATA_TYPE.FLOAT4X4:return k.FLOAT4X4;
case b.DATA_TYPE.INT:return k.INT;case b.DATA_TYPE.INT4:return k.INT4;case b.DATA_TYPE.BOOL:return k.BOOL;case b.DATA_TYPE.TEXTURE:return k.TEXTURE;case b.DATA_TYPE.BYTE:return k.BYTE;case b.DATA_TYPE.UBYTE:return k.UBYTE;default:throw Error("WHAT IS THIS I DON'T EVEN...");}}var b=e("../xflow/interface/constants.js"),a=e("../base/resourcemanager.js").Resource,c=[];e=function(a){this.callback=a;this.observed=[]};e.prototype.observe=function(b,d){if(!b)throw Error("The node to observe is null.");if(!b._configured)throw Error("Note to observe is not   (yet). Make sure to pass an XML3D node and to execute this function after XML3D has been configured e.g. inside a DOMContentLoaded listener.");
var e=a.getAdapter(b,"data");if(!e)throw Error("Can't observe node. XML3DataObserver can only observe data containers such as <data>, <mesh> or <shader>");0==this.observed.length&&c.push(this);var f={node:b,changed:!1,request:null},k=d&&d.names;"String"===Object.prototype.toString.call(k).slice(8,-1)&&(k=[k]);f.request=e.getComputeRequest(k,function(a,b){f.changed=!0});f.request.getResult();this.observed.push(f)};e.prototype.disconnect=function(){for(var a=0;a<this.observed.length;++a)this.observed[a].request.clear();
this.observed=[];for(a=c.length;a--;)c[a]==this&&c.splice(a,1)};XML3D.updateXflowObserver=function(){for(var a=0;a<c.length;++a){for(var b=c[a],d=[],e=0;e<b.observed.length;++e){var l=b.observed[e];if(l.changed){l.changed=!1;var p=l.request.getResult(),p=new k(p);d.push(new f(l.node,p))}}0<d.length&&b.callback&&b.callback(d,b)}};var f=function(a,b){this.target=a;this.result=b},k=function(a){this._entries={};for(var b=0;b<a.outputNames.length;++b){var c=a.outputNames[b],e=a.getOutputData(c),f=e&&e.getValue();
null!==f&&(e=d(e.type),this._entries[c]={type:e,value:f})}};k.prototype.getValue=function(a){return this._entries[a]?this._entries[a].value:null};k.prototype.getType=function(a){return this._entries[a]?this._entries[a].type:null};k.prototype.getNames=function(){var a=[],b;for(b in this._entries)a.push(b);return a};k.FLOAT=0;k.FLOAT2=1;k.FLOAT3=2;k.FLOAT4=3;k.FLOAT4X4=4;k.INT=10;k.INT4=11;k.BOOL=20;k.TEXTURE=30;k.BYTE=40;k.UBYTE=50;l=function(a,b,c,e,f,k){this.type=d(a);this.origin=b;this.originalName=
c;this.seqLength=e;this.seqMinKey=f;this.seqMaxKey=k};l.ORIGIN_CHILD=1;l.ORIGIN_COMPUTE=2;l.ORIGIN_PROTO=3;m.exports={XML3DDataChannelInfo:l,XML3DDataResult:k,XML3DDataObserver:e}},{"../base/resourcemanager.js":23,"../xflow/interface/constants.js":149}],136:[function(e,m,l){function d(a){return{get:function(){return this._data[a]},set:function(b){this._data[a]=b;this._callback&&this._callback(this)},configurable:!1,enumerable:!1}}var b=function(a,b,d,e,h,g,q,r,l,p,t,m,u,v,w,z,y){"number"==typeof a&&
16<=arguments.length?(this.set(a,b,d,e,h,g,q,r,l,p,t,m,u,v,w,z),this._callback="function"==typeof y?y:0):"object"==typeof a&&1==arguments.length?this.set(a):(this._data=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._callback="function"==typeof a?a:0)};e=b.prototype;Object.defineProperty(e,"m11",d(0));Object.defineProperty(e,"m12",d(1));Object.defineProperty(e,"m13",d(2));Object.defineProperty(e,"m14",d(3));Object.defineProperty(e,"m21",d(4));Object.defineProperty(e,"m22",d(5));Object.defineProperty(e,
"m23",d(6));Object.defineProperty(e,"m24",d(7));Object.defineProperty(e,"m31",d(8));Object.defineProperty(e,"m32",d(9));Object.defineProperty(e,"m33",d(10));Object.defineProperty(e,"m34",d(11));Object.defineProperty(e,"m41",d(12));Object.defineProperty(e,"m42",d(13));Object.defineProperty(e,"m43",d(14));Object.defineProperty(e,"m44",d(15));e.set=function(a,b,d,e,h,g,q,r,l,p,t,m,u,v,w,z){"number"==typeof a&&16<=arguments.length?this._data=new Float32Array(arguments):a._data&&a._data.length&&16===a._data.length?
this._data=new Float32Array(a._data):a.length&&16<=a.length?this._data=new Float32Array(a):XML3D.debug.logError("XML3DMatrix.set(): invalid parameter(s). Expect XML3DMatrix, Float32Array or 16 numbers.")};e.toString=function(){return"[object XML3DMatrix]"};e.setMatrixValue=function(a){a=/^(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)$/.exec(a);if(!a)throw{code:DOMException.SYNTAX_ERR,message:"SYNTAX_ERR: DOM Exception 12"};
if(17!=a.length)throw{code:DOMException.SYNTAX_ERR,message:"Illegal number of elements: "+(a.length-1)+"expected: 16"};this._data=new Float32Array(a.slice(1));this._callback&&this._callback(this)};e.multiply=function(a){var c=new b;XML3D.math.mat4.multiply(c._data,this._data,a._data);return c};e.inverse=function(){var a=new b;a._data=XML3D.math.mat4.invert(a._data,this._data);if(null==a._data||isNaN(a._data[0]))throw Error("Trying to invert matrix that is not invertable.");return a};e.rotate=function(a,
c,d){var e=new b;if(void 0===c&&void 0===d)return XML3D.math.mat4.rotateZ(e._data,this._data,a),e;XML3D.math.mat4.rotateZ(e._data,this._data,d);XML3D.math.mat4.rotateY(e._data,e._data,c);XML3D.math.mat4.rotateX(e._data,e._data,a);return e};e.rotateAxisAngle=function(a,c,d,e){var h=new b;XML3D.math.mat4.rotate(h._data,this._data,e,[a,c,d]);return h};e.scale=function(a,c,d){var e=new b;d||(d=1);c||(c=a);XML3D.math.mat4.scale(e._data,this._data,[a,c,d]);return e};e.translate=function(a,c,d){var e=new b;
XML3D.math.mat4.translate(e._data,this._data,[a,c,d]);return e};m.exports=b},{}],137:[function(e,m,l){e=function(d,b,a){var c=this,e=function(){c._callback&&c._callback(c)};this._origin=new window.XML3DVec3(0,0,0,e);this._direction=new window.XML3DVec3(0,0,-1,e);d&&d.origin?this.set(d,b):(d&&this._origin.set(d),b&&this._direction.set(b));this._callback="function"==typeof a?a:0};l=e.prototype;Object.defineProperty(l,"origin",{get:function(){return this._origin},set:function(){throw Error("Can't set axis. XML3DRay::origin is readonly.");
},configurable:!1,enumerable:!1});Object.defineProperty(l,"direction",{get:function(){return this._direction},set:function(){throw Error("Can't set axis. XML3DRay::_direction is readonly.");},configurable:!1,enumerable:!1});l.set=function(d){this._origin.set(d.origin);this._direction.set(d.direction);this._callback&&this._callback(this)};l.toString=function(){return"[object XML3DRay]"};m.exports=e},{}],138:[function(e,m,l){var d=function(b,a,c){var d=this;this._data=new Float32Array(4);this._axis=
new window.XML3DVec3(0,0,1,function(){d._updateQuaternion();d._callback&&d._callback(d)});this._angle=0;this._updateQuaternion();void 0!==b&&null!==b&&this.set(b,a);this._callback="function"==typeof c?c:0};e=d.prototype;e.set=function(b,a){b.axis&&void 0!==b.angle?this.setAxisAngle(b.axis,b.angle):b.length&&4<=b.length?this._setQuaternion(b):b._data&&b._data.length&&3===b._data.length?this.setAxisAngle(b,a):XML3D.debug.logError("XML3DRotation.set(): invalid argument given. Expect XML3DRotation or Float32Array.")};
Object.defineProperty(e,"axis",{get:function(){return this._axis},set:function(){throw Error("Can't set axis. XML3DRotation::axis is readonly.");},configurable:!1,enumerable:!1});Object.defineProperty(e,"angle",{get:function(){return this._angle},set:function(b){this._angle=b;this._updateQuaternion();this._callback&&this._callback(this)},configurable:!1,enumerable:!1});e.toString=function(){return"[object XML3DRotation]"};e.setAxisAngle=function(b,a){if("object"!=typeof b||isNaN(a))throw Error("Illegal axis and/or angle values: ( axis="+
b+" angle="+a+" )");this._axis._data[0]=b._data[0];this._axis._data[1]=b._data[1];this._axis._data[2]=b._data[2];this._angle=a;this._updateQuaternion();this._callback&&this._callback(this)};e.setRotation=function(b,a){var c=b.normalize(),d=a.normalize(),e=c.cross(d);e.length()||(e=Math.abs(c._data[1])>=.9*Math.abs(c._data[0])&&Math.abs(c._data[2])>=.9*Math.abs(c._data[0])?new window.XML3DVec3(0,-c._data[2],c._data[1]):Math.abs(c._data[0])>=.9*Math.abs(c._data[1])&&Math.abs(c._data[2])>=.9*Math.abs(c._data[1])?
new window.XML3DVec3(-c._data[2],0,c._data[0]):new window.XML3DVec3(-c._data[1],c._data[0],0));this.setAxisAngle(e,Math.acos(c.dot(d)))};e._updateQuaternion=function(){var b=this._axis.length();1E-5<b?(b=Math.sin(this._angle/2)/b,this._data[0]=this._axis.x*b,this._data[1]=this._axis.y*b,this._data[2]=this._axis.z*b,this._data[3]=Math.cos(this._angle/2)):XML3D.math.quat.set(this._data,0,0,0,1)};e.setAxisAngleValue=function(b){var a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(b);if(!a)throw Error("Could not parse AxisAngle string: "+
b);this.setAxisAngle(new window.XML3DVec3(+a[1],+a[2],+a[3]),+a[4])};e.interpolate=function(b,a){var c=XML3D.math.quat.create(),e=new d;XML3D.math.quat.slerp(c,this._data,b._data,a);e._setQuaternion(c);return e};e.setQuaternion=function(b,a){this._setQuaternion([b.x,b.y,b.z,a])};e.toMatrix=function(){var b=XML3D.math.quat.copy(XML3D.math.quat.create(),this._data),a=new XML3DMatrix;XML3D.math.mat4.fromRotationTranslation(a._data,b,[0,0,0]);return a};e.rotateVec3=function(b){var a=new XML3DVec3;XML3D.math.vec3.transformQuat(a._data,
b._data,this._data);return a};e._setQuaternion=function(b){var a=Math.sqrt(1-b[3]*b[3]);.001>a||isNaN(a)?(this._axis._data[0]=0,this._axis._data[1]=0,this._axis._data[2]=1,this._angle=0):(a=1/a,this._axis._data[0]=b[0]*a,this._axis._data[1]=b[1]*a,this._axis._data[2]=b[2]*a,this._angle=2*Math.acos(b[3]));this._data=XML3D.math.quat.copy(XML3D.math.quat.create(),b);this._callback&&this._callback(this)};e.multiply=function(b){var a=new d,c=XML3D.math.quat.create();XML3D.math.quat.multiply(c,this._data,
b._data);a._setQuaternion(c);return a};e.normalize=function(b){b=this._axis.normalize();return new d(b,this._angle)};e.getQuaternion=function(){return XML3D.math.quat.copy(XML3D.math.quat.create(),this._data)};e.setFromBasis=function(b,a,c){var d=XML3D.math.quat.create();XML3D.math.quat.setFromBasis(b._data,a._data,c._data,d);this._setQuaternion(d)};m.exports=d},{}],139:[function(e,m,l){function d(a){return{get:function(){return this._data[a]},set:function(b){this._data[a]=b;this._callback&&this._callback(this)},
configurable:!1,enumerable:!1}}var b=function(a,b,d,e){this._data=new Float32Array(3);void 0!==a&&null!==a&&this.set(a,b,d);this._callback="function"==typeof e?e:0};e=b.prototype;e.set=function(a,b,d){a.length&&3<=a.length?(this._data[0]=a[0],this._data[1]=a[1],this._data[2]=a[2]):a._data&&a._data.length&&3===a._data.length?(this._data[0]=a._data[0],this._data[1]=a._data[1],this._data[2]=a._data[2]):3==arguments.length&&(this._data[0]=a,this._data[1]=b,this._data[2]=d);this._callback&&this._callback(this)};
Object.defineProperty(e,"x",d(0));Object.defineProperty(e,"y",d(1));Object.defineProperty(e,"z",d(2));e.toString=function(){return"[object XML3DVec3]"};e.add=function(a){return a._data?new b(this._data[0]+a._data[0],this._data[1]+a._data[1],this._data[2]+a._data[2]):new b(this._data[0]+a.x,this._data[1]+a.y,this._data[2]+a.z)};e.subtract=function(a){return a._data?new b(this._data[0]-a._data[0],this._data[1]-a._data[1],this._data[2]-a._data[2]):new b(this._data[0]-a.x,this._data[1]-a.y,this._data[2]-
a.z)};e.length=function(){return Math.sqrt(this._data[0]*this._data[0]+this._data[1]*this._data[1]+this._data[2]*this._data[2])};e.setVec3Value=function(a){a=/^\s*(\S+)\s+(\S+)\s+(\S+)\s*$/.exec(a);if(!a)throw Error("Wrong format for XML3DVec3::setVec3Value");this._data[0]=+a[1];this._data[1]=+a[2];this._data[2]=+a[3];this._callback&&this._callback(this)};e.multiply=function(a){return a._data?new b(this._data[0]*a._data[0],this._data[1]*a._data[1],this._data[2]*a._data[2]):new b(this._data[0]*a.x,
this._data[1]*a.y,this._data[2]*a.z)};e.scale=function(a){return new b(this._data[0]*a,this._data[1]*a,this._data[2]*a)};e.cross=function(a){return a._data?new b(this._data[1]*a._data[2]-this._data[2]*a._data[1],this._data[2]*a._data[0]-this._data[0]*a._data[2],this._data[0]*a._data[1]-this._data[1]*a._data[0]):new b(this._data[1]*a.z-this._data[2]*a.y,this._data[2]*a.x-this._data[0]*a.z,this._data[0]*a.y-this._data[1]*a.x)};e.negate=function(){return new b(-this._data[0],-this._data[1],-this._data[2])};
e.dot=function(a){return this._data[0]*a.x+this._data[1]*a.y+this._data[2]*a.z};e.normalize=function(){var a=this.length();if(a)a=1/a;else throw Error();return new b(this._data[0]*a,this._data[1]*a,this._data[2]*a)};m.exports=b},{}],140:[function(e,m,l){Array.forEach||(Array.forEach=function(d,b,a){for(var c=d.length,e=0;e<c;e++)e in d&&b.call(a,d[e],e,d)});Array.map||(Array.map=function(d,b,a){for(var c=d.length,e=[],k=0;k<c;k++)k in d&&(e[k]=b.call(a,d[k],k,d));return e});Array.filter||(Array.filter=
function(d,b,a){for(var c=d.length,e=[],k=0;k<c;k++)if(k in d){var h=d[k];b.call(a,h,k,d)&&e.push(h)}return e});Array.erase||(Array.erase=function(d,b){for(var a=!1,c=-1;-1!=(c=d.indexOf(b));)d.splice(c,1),a=!0;return a});Array.set||(Array.set=function(d,b,a){for(var c=0;c<a.length;c++)d[b+c]=a[c]});Array.isArray||(Array.isArray=function(d){return"[object Array]"==Object.prototype.toString.call(d)})},{}],141:[function(e,m,l){var d=e("./cssMatrix.js"),b={TRANSFORM_PROPERTY:null,init:function(){"transform"in
document.body.style?b.TRANSFORM_PROPERTY="transform":"WebkitTransform"in document.body.style?b.TRANSFORM_PROPERTY="-webkit-transform":"MozTransform"in document.body.style?b.TRANSFORM_PROPERTY="-moz-transform":XML3D.debug.logWarning("No supported transform css property found")},getInlinePropertyValue:function(a,b){var d=a.getAttribute("style");return d&&(d=(new RegExp(b+"s*:([^;]+)","i")).exec(d))?d[1].trim():null},getPropertyValue:function(a,b){var d=this.getInlinePropertyValue(a,b);return d?d:window.getComputedStyle(a).getPropertyValue(b)},
getCSSMatrix:function(a){if(!b.TRANSFORM_PROPERTY||!d)return null;var c=null;"transform"!=b.TRANSFORM_PROPERTY&&(c=b.getInlinePropertyValue(a,"transform"));c||(c=b.getPropertyValue(a,b.TRANSFORM_PROPERTY));if(!c||"none"==c)return null;a=null;try{a=new d(c)}catch(e){XML3D.debug.logError("Error parsing transform property: "+c)}return a},convertCssToMat4:function(a,b){var d=b||XML3D.math.mat4.create();d[0]=a.m11;d[1]=a.m12;d[2]=a.m13;d[3]=a.m14;d[4]=a.m21;d[5]=a.m22;d[6]=a.m23;d[7]=a.m24;d[8]=a.m31;
d[9]=a.m32;d[10]=a.m33;d[11]=a.m34;d[12]=a.m41;d[13]=a.m42;d[14]=a.m43;d[15]=a.m44;return d}};m.exports=b},{"./cssMatrix.js":142}],142:[function(e,m,l){var d=function(b){this.m11=this.m22=this.m33=this.m44=1;this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0;"string"==typeof b&&this.setMatrixValue(b)};d.displayName="FirminCSSMatrix";d.degreesToRadians=function(b){return b*Math.PI/180};d.determinant2x2=function(b,a,c,d){return b*d-a*c};d.determinant3x3=
function(b,a,c,e,k,h,g,q,r){var l=d.determinant2x2;return b*l(k,h,q,r)-e*l(a,c,q,r)+g*l(a,c,k,h)};d.determinant4x4=function(b){var a=d.determinant3x3,c=b.m21,e=b.m31,k=b.m41,h=b.m12,g=b.m22,l=b.m32,r=b.m42,n=b.m13,p=b.m23,t=b.m33,m=b.m43,u=b.m14,v=b.m24,w=b.m34,z=b.m44;return b.m11*a(g,p,v,l,t,w,r,m,z)-c*a(h,n,u,l,t,w,r,m,z)+e*a(h,n,u,g,p,v,r,m,z)-k*a(h,n,u,g,p,v,l,t,w)};d.toMatrixString=function(b){var a=/(\w+)\(([^\)]+)\)/i,c=b.match(/(\w+)\([^\)]+\)/ig),e=c&&c.every(function(a){return/^matrix/.test(a)});
if(!c||e)return b;var k=function(a){return a.value},h={matrix:function(a,b){var c=new d(b.unparsed);return a.multiply(c)},matrix3d:function(a,b){var c=new d(b.unparsed);return a.multiply(c)},perspective:function(a,b){var c=new d;c.m34-=1/b.value[0].value;return a.multiply(c)},rotate:function(a,b){return a.rotate.apply(a,b.value.map(k))},rotate3d:function(a,b){return a.rotateAxisAngle.apply(a,b.value.map(k))},rotateX:function(a,b){return a.rotate.apply(a,[b.value[0].value,0,0])},rotateY:function(a,
b){return a.rotate.apply(a,[0,b.value[0].value,0])},rotateZ:function(a,b){return a.rotate.apply(a,[0,0,b.value[0].value])},scale:function(a,b){return a.scale.apply(a,b.value.map(k))},scale3d:function(a,b){return a.scale.apply(a,b.value.map(k))},scaleX:function(a,b){return a.scale.apply(a,b.value.map(k))},scaleY:function(a,b){return a.scale.apply(a,[0,b.value[0].value,0])},scaleZ:function(a,b){return a.scale.apply(a,[0,0,b.value[0].value])},skew:function(a,b){var c=new d("skewX("+b.value[0].unparsed+
")"),c="matrix(1.00000, "+(new d("skewY("+b.value[1].unparsed+")")).b+", "+c.c+", 1.000000, 0.000000, 0.000000)",c=new d(c);return a.multiply(c)},skewX:function(a,b){return a.skewX.apply(a,[b.value[0].value])},skewY:function(a,b){return a.skewY.apply(a,[b.value[0].value])},translate:function(a,b){return a.translate.apply(a,b.value.map(k))},translate3d:function(a,b){return a.translate.apply(a,b.value.map(k))},translateX:function(a,b){return a.translate.apply(a,[b.value[0].value,0,0])},translateY:function(a,
b){return a.translate.apply(a,[0,b.value[0].value,0])},translateZ:function(a,b){return a.translate.apply(a,[0,0,b.value[0].value])}};b=c.map(function(b){var c=b.match(a).slice(1);return{key:c[0],value:c[1].split(/, ?/).map(function(a){var b=a.match(/([-\+]?[0-9]+[\.0-9]*)(deg|rad|grad|px|%)*/)||[];return{value:parseFloat(b[1]),units:b[2],unparsed:a}}),unparsed:b}});c=new d;return b.reduce(function(a,b){b.value=b.value.map(function(a){"rad"==a.units?(a.value*=180/Math.PI,a.units="deg"):"grad"==a.units&&
(a.value/=400/360,a.units="deg");return a});return(0,h[b.key])(a,b)||a},c).toString()};[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(b){var a=b[0];Object.defineProperty(d.prototype,b[1],{set:function(b){this[a]=b},get:function(){return this[a]},enumerable:!0,configurable:!0})});d.prototype.isAffine=function(){return 0===this.m13&&0===this.m14&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m32&&1===this.m33&&0===this.m34&&0===this.m43&&1===this.m44};
d.prototype.multiply=function(b){if(!b)return null;var a=new d;a.m11=b.m11*this.m11+b.m12*this.m21+b.m13*this.m31+b.m14*this.m41;a.m12=b.m11*this.m12+b.m12*this.m22+b.m13*this.m32+b.m14*this.m42;a.m13=b.m11*this.m13+b.m12*this.m23+b.m13*this.m33+b.m14*this.m43;a.m14=b.m11*this.m14+b.m12*this.m24+b.m13*this.m34+b.m14*this.m44;a.m21=b.m21*this.m11+b.m22*this.m21+b.m23*this.m31+b.m24*this.m41;a.m22=b.m21*this.m12+b.m22*this.m22+b.m23*this.m32+b.m24*this.m42;a.m23=b.m21*this.m13+b.m22*this.m23+b.m23*
this.m33+b.m24*this.m43;a.m24=b.m21*this.m14+b.m22*this.m24+b.m23*this.m34+b.m24*this.m44;a.m31=b.m31*this.m11+b.m32*this.m21+b.m33*this.m31+b.m34*this.m41;a.m32=b.m31*this.m12+b.m32*this.m22+b.m33*this.m32+b.m34*this.m42;a.m33=b.m31*this.m13+b.m32*this.m23+b.m33*this.m33+b.m34*this.m43;a.m34=b.m31*this.m14+b.m32*this.m24+b.m33*this.m34+b.m34*this.m44;a.m41=b.m41*this.m11+b.m42*this.m21+b.m43*this.m31+b.m44*this.m41;a.m42=b.m41*this.m12+b.m42*this.m22+b.m43*this.m32+b.m44*this.m42;a.m43=b.m41*this.m13+
b.m42*this.m23+b.m43*this.m33+b.m44*this.m43;a.m44=b.m41*this.m14+b.m42*this.m24+b.m43*this.m34+b.m44*this.m44;return a};d.prototype.isIdentityOrTranslation=function(){return 1===this.m11&&0===this.m12&&0===this.m13&&0===this.m14&&0===this.m21&&1===this.m22&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m31&&1===this.m33&&0===this.m34&&1===this.m44};d.prototype.adjoint=function(){var b=new d,a=d.determinant3x3,c=this.m11,e=this.m12,k=this.m13,h=this.m14,g=this.m21,l=this.m22,r=this.m23,n=this.m24,
p=this.m31,t=this.m32,m=this.m33,u=this.m34,v=this.m41,w=this.m42,z=this.m43,y=this.m44;b.m11=a(l,t,w,r,m,z,n,u,y);b.m21=-a(g,p,v,r,m,z,n,u,y);b.m31=a(g,p,v,l,t,w,n,u,y);b.m41=-a(g,p,v,l,t,w,r,m,z);b.m12=-a(e,t,w,k,m,z,h,u,y);b.m22=a(c,p,v,k,m,z,h,u,y);b.m32=-a(c,p,v,e,t,w,h,u,y);b.m42=a(c,p,v,e,t,w,k,m,z);b.m13=a(e,l,w,k,r,z,h,n,y);b.m23=-a(c,g,v,k,r,z,h,n,y);b.m33=a(c,g,v,e,l,w,h,n,y);b.m43=-a(c,g,v,e,l,w,k,r,z);b.m14=-a(e,l,t,k,r,m,h,n,u);b.m24=a(c,g,p,k,r,m,h,n,u);b.m34=-a(c,g,p,e,l,t,h,n,u);
b.m44=a(c,g,p,e,l,t,k,r,m);return b};d.prototype.inverse=function(){var b,a,c,e;if(this.isIdentityOrTranslation()){b=new d;if(0!==this.m41||0!==this.m42||0!==this.m43)b.m41=-this.m41,b.m42=-this.m42,b.m43=-this.m43;return b}a=this.adjoint();b=d.determinant4x4(this);if(1E-8>Math.abs(b))return null;for(c=1;5>c;c++)for(e=1;5>e;e++)a["m"+c+e]/=b;return a};d.prototype.rotate=function(b,a,c){var e=d.degreesToRadians;if("number"!=typeof b||isNaN(b))b=0;"number"==typeof a&&!isNaN(a)||"number"==typeof c&&
!isNaN(c)||(c=b,a=b=0);if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;b=e(b);a=e(a);c=e(c);var e=new d,k=new d,h=new d,g;c/=2;g=Math.sin(c);c=Math.cos(c);h.m11=h.m22=1-2*g*g;h.m12=h.m21=2*g*c;h.m21*=-1;a/=2;g=Math.sin(a);c=Math.cos(a);k.m11=k.m33=1-2*g*g;k.m13=k.m31=2*g*c;k.m13*=-1;b/=2;g=Math.sin(b);c=Math.cos(b);e.m22=e.m33=1-2*g*g;e.m23=e.m32=2*g*c;e.m32*=-1;return this.toString()===(new d).toString()?h.multiply(k).multiply(e):this.multiply(e).multiply(k).multiply(h)};
d.prototype.rotateAxisAngle=function(b,a,c,e){if("number"!=typeof b||isNaN(b))b=0;if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;if("number"!=typeof e||isNaN(e))e=0;0===b&&0===a&&0===c&&(c=1);var k=new d,h=Math.sqrt(b*b+a*a+c*c),g,l,r;e=(d.degreesToRadians(e)||0)/2;g=Math.cos(e);l=Math.sin(e);e=l*l;0===h?(a=b=0,c=1):1!==h&&(b/=h,a/=h,c/=h);1===b&&0===a&&0===c?(k.m22=k.m33=1-2*e,k.m23=k.m32=2*g*l,k.m32*=-1):0===b&&1===a&&0===c?(k.m11=k.m33=1-2*e,k.m13=k.m31=2*g*l,k.m13*=-1):
0===b&&0===a&&1===c?(k.m11=k.m22=1-2*e,k.m12=k.m21=2*g*l,k.m21*=-1):(h=l*g,g=b*b,l=a*a,r=c*c,k.m11=1-2*(l+r)*e,k.m12=2*(b*a*e+c*h),k.m13=2*(b*c*e-a*h),k.m21=2*(a*b*e-c*h),k.m22=1-2*(r+g)*e,k.m23=2*(a*c*e+b*h),k.m31=2*(c*b*e+a*h),k.m32=2*(c*a*e-b*h),k.m33=1-2*(g+l)*e);return this.multiply(k)};d.prototype.scale=function(b,a,c){var e=new d;if("number"!=typeof b||isNaN(b))b=1;if("number"!=typeof a||isNaN(a))a=b;if("number"!=typeof c||isNaN(c))c=1;e.m11=b;e.m22=a;e.m33=c;return this.multiply(e)};d.prototype.skewX=
function(b){b=d.degreesToRadians(b);var a=new d;a.c=Math.tan(b);return this.multiply(a)};d.prototype.skewY=function(b){b=d.degreesToRadians(b);var a=new d;a.b=Math.tan(b);return this.multiply(a)};d.prototype.translate=function(b,a,c){var e=new d;if("number"!=typeof b||isNaN(b))b=0;if("number"!=typeof a||isNaN(a))a=0;if("number"!=typeof c||isNaN(c))c=0;e.m41=b;e.m42=a;e.m43=c;return this.multiply(e)};d.prototype.setMatrixValue=function(b){b=d.toMatrixString(b.trim());var a=b.match(/^matrix(3d)?\(\s*(.+)\s*\)$/),
c,e,k,h,g;if(a)if(c=!!a[1],a=a[2].split(/\s*,\s*/),e=a.length,k=Array(e),c&&16!==e||!c&&6!==e)XML3D.debug.logError("Invalid CSS Matrix: ",b);else{for(h=0;h<e;h++)if(g=a[h],g.match(/^-?\d+(\.\d+)?$/))k[h]=parseFloat(g);else{XML3D.debug.logError("Invalid CSS Matrix: ",b);return}for(h=0;h<e;h++)this[c?"m"+(Math.floor(h/4)+1)+(h%4+1):String.fromCharCode(h+97)]=k[h]}};d.prototype.toString=function(){var b=this,a,c;this.isAffine()?(c="matrix(",a="abcdef".split("")):(c="matrix3d(",a="m11 m12 m13 m14 m21 m22 m23 m24 m31 m32 m33 m34 m41 m42 m43 m44".split(" "));
return c+a.map(function(a){return b[a].toFixed(6)}).join(", ")+")"};m.exports=d},{}],143:[function(e,m,l){var d=e("../contrib/stacktrace-0.4.js"),b=e("./options.js");(function(a){b.register("loglevel","warning");a.exports={ALL:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4,EXCEPTION:5,params:{},isSetup:!1,loglevel:4,loglevels:{all:0,debug:1,info:2,warning:3,error:4,exception:5},setup:function(){var a=XML3D.debug;a.isSetup||(a.isSetup=!0,a.loglevel=a.loglevels[b.getValue("loglevel")]||3,b.addObserver(function(b,
d){"loglevel"==b&&(a.loglevel=a.loglevels[d]||3)}));return!0},_setLogLevel:function(){},doLog:function(a,b){if(!(XML3D.debug.params.xml3d_nolog||a<XML3D.debug.loglevel)&&(b=Array.prototype.slice.call(b),window.console))switch(a){case XML3D.debug.INFO:window.console.info.apply(window.console,b);break;case XML3D.debug.WARNING:window.console.warn.apply(window.console,b);break;case XML3D.debug.ERROR:window.console.error.apply(window.console,b);break;case XML3D.debug.EXCEPTION:window.console.error(d({e:b[0],
guess:!0}).join("\n"));break;case XML3D.debug.DEBUG:window.console.debug.apply(window.console,b)}},logDebug:function(){XML3D.debug.doLog(XML3D.debug.DEBUG,arguments)},logInfo:function(){XML3D.debug.doLog(XML3D.debug.INFO,arguments)},logWarning:function(){XML3D.debug.doLog(XML3D.debug.WARNING,arguments)},logError:function(){XML3D.debug.doLog(XML3D.debug.ERROR,arguments)},logException:function(){XML3D.debug.doLog(XML3D.debug.EXCEPTION,arguments)},assert:function(a,b){if(!a){var d;try{d=XML3D.debug.assert.caller?
XML3D.debug.assert.caller.name:null}catch(e){d=null}d?XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed in "+d,b]):XML3D.debug.doLog(XML3D.debug.WARNING,["Assertion failed",b])}},trace:function(a,b){b=void 0!==b?b:XML3D.debug.ERROR;if(window.console.trace)a&&XML3D.debug.doLog(b,[a]),window.console.trace();else{var e=d();a&&e.splice(0,0,a);XML3D.debug.doLog(b,e)}},getNumberWithPadding:function(a,b){for(var d=""+a;d.length<b;)d=" "+d;return d},formatSourceCode:function(a){var b="";a=a.split("\n");
for(var d=0;d<a.length;++d)b+=this.getNumberWithPadding(d+1,3)+"  "+a[d]+"\n";return b}}})(m)},{"../contrib/stacktrace-0.4.js":26,"./options.js":145}],144:[function(e,m,l){window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d,b){window.setTimeout(d,1E3/b)}}();(function(d){d.callAdapterFunc=function(a,b){var d=[];if(!a||void 0===a._configured)return d;
var e=a._configured.adapters,h;for(h in e)for(var g in b){var l=e[h],r=l[g];r&&d.push(r.apply(l,b[g]))}return d};d.sendAdapterEvent=function(a,b){if(!a||void 0===a._configured)return!1;var d=a._configured.adapters,e;for(e in d)for(var h in b){var g=d[e][h];g&&g.apply(d[e],b[h])}return!0};d.dispatchCustomEvent=function(a,b,d,e,h){var g=document.createEvent("CustomEvent");g.initCustomEvent(b,d,e,h);return a.dispatchEvent(g)};d.dispatchEvent=function(a,b){var d=null;if(document.createEvent)return d=
document.createEvent("Events"),d.initEvent(b,!0,!0),a.dispatchEvent(d);if(document.createEventObject)return d=document.createEventObject(),a.fireEvent("on"+b,d)};var b=0;d.getOrCreateActiveView=function(a){var c=a.activeView;if(c){var d=window.XML3D.URIResolver.resolveLocal(c);if(!d)throw"XML3D Error: xml3d references view that is not defined: '"+c+"'.";return d}if(d=a.querySelector("view"))return d.id&&0<d.id.length&&(a.activeView="#"+d.id),d;XML3D.debug.logWarning("xml3d element has no view defined: creating one.");
c="xml3d.autocreatedview_"+b++;d=XML3D.createElement("view");d.setAttribute("id",c);a.appendChild(d);a.setAttribute("activeView","#"+c);return d}})(m.exports)},{}],145:[function(e,m,l){(function(d){var b=function(){this._options={};this._listeners={"*":[]}};b.prototype={register:function(a,b){if(this._options.hasOwnProperty(a))throw Error("Option already registered '"+a+"'");this._options[a]={currentValue:b,defaultValue:b}},resetValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+
a+"'");this._options[a].currentValue=this._options[a].defaultValue;this.notifyObservers(a,this._options[a].currentValue)},setValue:function(a,b){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");this._options[a].currentValue=b;this.notifyObservers(a,b)},getValue:function(a){if(!this._options.hasOwnProperty(a))throw Error("Invalid configuration key '"+a+"'");return this._options[a].currentValue},getKeys:function(){return Object.keys(this._options)},notifyObservers:function(a,
b){this._listeners.hasOwnProperty(a)&&this._listeners[a].forEach(function(d){d(a,b)});this._listeners["*"].forEach(function(d){d(a,b)})},addObserver:function(a,b){"function"==typeof a&&(b=a,a="*");if(!this._options.hasOwnProperty(a)&&"*"!==a)throw Error("Can't register to unknown option '"+a+"'");this._listeners.hasOwnProperty(a)||(this._listeners[a]=[]);this._listeners[a].push(b)},removeObserver:function(a){for(var b in this._listeners){var d=this._listeners[b],e=d.indexOf(a);-1!=e&&d.splice(e,1)}}};
b=new b;b.setOptionsFromQuery=function(){window.location.search.substr(1).split("&").forEach(function(a){a=a.split("=");try{var b=a[0].toLowerCase();if(0===b.indexOf("xml3d-")){var d=decodeURIComponent(a[1]);try{d=JSON.parse(d)}catch(e){}XML3D.options.setValue(b.substr(6),d)}}catch(h){XML3D.debug&&XML3D.debug.logError(h)}})};d.exports=b})(m)},{}],146:[function(e,m,l){(function(d){var b=function(a){a=a||"";if(0==a.indexOf("blob:")){var b=/^(?:([^:\/?\#]+):)?([^\#]*)(?:\#(.*))?/;a=a.match(b);this.valid=
null!=a;this.scheme=a[1]||null;this.query=this.path=this.authority=null;this.opaqueString=a[2]||null;this.fragment=a[3]||null}else b=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/,a=a.match(b),this.valid=null!=a,this.scheme=a[1]||null,this.authority=a[2]||null,this.path=a[3]||null,this.query=a[4]||null,this.opaqueString=null,this.fragment=a[5]||null};b.prototype.isLocal=function(){return"blob"!=this.scheme&&!this.authority&&!this.path};b.prototype.isAbsolute=function(){return null!=
this.scheme};b.prototype.getAbsoluteURI=function(a){if(!this.valid||this.isAbsolute())return this;a=new b(a);this.path?(0==this.path.indexOf("/")?a.path=this.path:a.path=a.path.substr(0,a.path.lastIndexOf("/")+1)+this.path,a.query=this.query):this.query&&(a.query=this.query);a.fragment=this.fragment;return a};b.prototype.hasSameOrigin=function(a){"string"==typeof a&&(a=new b(a));return"blob"==this.scheme||"data"==this.scheme?!0:this.scheme==a.scheme&&this.authority==a.authority};b.prototype.toString=
function(){var a="";if("blob"==this.scheme)return a="blob:"+this.opaqueString,this.fragment&&(a+="#"+this.fragment),a;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=this.path);this.query&&(a+="?"+this.query);this.fragment&&(a+="#"+this.fragment);return a};b.prototype.toStringWithoutFragment=function(){var a="";if("blob"==this.scheme)return a="blob:"+this.opaqueString;this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);this.path&&(a+=
this.path);this.query&&(a+="?"+this.query);return a};var a=function(){};a.resolveLocal=function(a,d){"string"==typeof a&&(a=new b(a));d=d||window.document;return"urn"==a.scheme||"blob"==a.scheme?null:!a.path&&a.fragment?d.getElementById(a.fragment):null};a.resolve=function(b,d){XML3D.debug.logWarning("You are using deprecated XML3D.URIResolver.resolve. Use XML3D.URIResolver.resolveLocal instead.");return a.resolveLocal(b,d)};d.URI=b;d.URIResolver=a;window.XML3D.URIResolver=a})(m.exports)},{}],147:[function(e,
m,l){(function(d,b){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}function c(b){var c;if(a(b)){for(c in B)if(B[c]===b)return c;XML3D.debug.logDebug("Got unknown OpenCL Error Code:",b)}return"UNKNOWN_ERROR"}function e(a){var b=null;return a.name&&"string"===typeof a.name&&B[a.name]?B[a.name]:a.message&&"string"===typeof a.message&&(b=a.message.match(/-?\d+/g),b instanceof Array)?parseInt(b[b.length-1],10):!1}function k(a,b){a&&"string"!==typeof a&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error name not type of String"),
a="");b&&"string"!==typeof b&&(XML3D.debug.logDebug("WebCL API: WebCLError: Error message not type of String"),b="");this.name=a||"WebCLError";this.message=b||"Generic WebCL error.";this.stack=Error().stack}function h(){return C=window.webcl&&webcl.getPlatforms}function g(){var a;A=!0;try{a=webcl.getPlatforms()}catch(b){A=!1}a&&0!==a.length||(A=!1);return A}function l(){return h()&&g()}function r(){0===z.length&&(z=webcl.getPlatforms());return z}function n(a,b){var d=[];if(!b)return XML3D.debug.logError("WebCL API: getPlatformDevicesByType(): platform was not defined."),
!1;a=a||"CPU";try{"CPU"===a?d=b.getDevices(webcl.DEVICE_TYPE_CPU):"GPU"===a?d=b.getDevices(webcl.DEVICE_TYPE_GPU):"ALL"===a&&(d=b.getDevices(webcl.DEVICE_TYPE_ALL))}catch(g){d=e(g);if(!d)throw g;if(d!==B.DEVICE_NOT_FOUND)throw new k(c(d),"Could not get devices.");return!1}return d}function p(a){var b=[],c,d;r();for(d=z.length;d--;)(c=n(a,z[d]))&&c.forEach(function(a){b.push(a)});return 0===b.length?!1:b}function t(a){try{var b=webcl.createContext(a)}catch(d){a=e(d);if(!a)throw d;throw new k(c(a),
"Failed to create a WebCL context.");}return b}function m(a,b){var d;b=b||E;if(!a)return XML3D.debug.logError("WebCL API: createProgram(): codeStr was not defined."),!1;if(!b)return XML3D.debug.logError("WebCL API: createProgram(): clCtx was not defined."),!1;try{d=b.createProgram(a)}catch(g){d=e(g);if(!d)throw g;throw new k(c(d),"Failed to create a WebCL program.");}return d}function u(a,b){b=b||y;if(!a)return XML3D.debug.logError("WebCL API: buildProgram(): program was not defined."),!1;try{a.build(b,
"")}catch(d){var g=e(d);if(!g)throw d;throw new k(c(g),a.getBuildInfo(b[0],WebCL.PROGRAM_BUILD_LOG));}return a}function v(a,b){var d;if(!a)return XML3D.debug.logError("WebCL API: createKernel(): program was not defined."),!1;if(!b)return XML3D.debug.logError("WebCL API: createKernel(): name was not defined."),!1;try{d=a.createKernel(b)}catch(g){d=e(g);if(!d)throw g;throw new k(c(d),"Failed to create a WebCL kernel.");}return d}function w(a,b){var d;b=b||E;if(!b)return XML3D.debug.logError("WebCL API: createCommandQueue: clCtx was not defined"),
!1;try{d=b.createCommandQueue(a||y[0],0)}catch(g){if(!e(g))throw g;throw new k(c(e(g)),"Could not create CommandQueue.");}return d}var z=[],y=[],E=null,C=!1,A=!1,B={SUCCESS:0,DEVICE_NOT_FOUND:-1,DEVICE_NOT_AVAILABLE:-2,COMPILER_NOT_AVAILABLE:-3,MEM_OBJECT_ALLOCATION_FAILURE:-4,OUT_OF_RESOURCES:-5,OUT_OF_HOST_MEMORY:-6,PROFILING_INFO_NOT_AVAILABLE:-7,MEM_COPY_OVERLAP:-8,IMAGE_FORMAT_MISMATCH:-9,IMAGE_FORMAT_NOT_SUPPORTED:-10,BUILD_PROGRAM_FAILURE:-11,MAP_FAILURE:-12,INVALID_VALUE:-30,INVALID_DEVICE_TYPE:-31,
INVALID_PLATFORM:-32,INVALID_DEVICE:-33,INVALID_CONTEXT:-34,INVALID_QUEUE_PROPERTIES:-35,INVALID_COMMAND_QUEUE:-36,INVALID_HOST_PTR:-37,INVALID_MEM_OBJECT:-38,INVALID_IMAGE_FORMAT_DESCRIPTOR:-39,INVALID_IMAGE_SIZE:-40,INVALID_SAMPLER:-41,INVALID_BINARY:-42,INVALID_BUILD_OPTIONS:-43,INVALID_PROGRAM:-44,INVALID_PROGRAM_EXECUTABLE:-45,INVALID_KERNEL_NAME:-46,INVALID_KERNEL_DEFINITION:-47,INVALID_KERNEL:-48,INVALID_ARG_INDEX:-49,INVALID_ARG_VALUE:-50,INVALID_ARG_SIZE:-51,INVALID_KERNEL_ARGS:-52,INVALID_WORK_DIMENSION:-53,
INVALID_WORK_GROUP_SIZE:-54,INVALID_WORK_ITEM_SIZE:-55,INVALID_GLOBAL_OFFSET:-56,INVALID_EVENT_WAIT_LIST:-57,INVALID_EVENT:-58,INVALID_OPERATION:-59,INVALID_GL_OBJECT:-60,INVALID_BUFFER_SIZE:-61,INVALID_MIP_LEVEL:-62,INVALID_GLOBAL_WORK_SIZE:-63};Object.freeze(B);k.prototype=Object.create(Error.prototype);k.prototype.constructor=k;var D=function(a,b){var d={};return{register:function(c,e){if(d.hasOwnProperty(c))return XML3D.debug.logWarning("WebCL API: kernels.register(): Kernel with a same name is already defined."),
!1;if("string"!==typeof c)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel name was not defined or was not type of String."),!1;if("string"!==typeof e)return XML3D.debug.logError("WebCL API: kernels.register(): Kernel code was not defined or was not type of String."),!1;var f,g;f=m(e,a);u(f,b);f&&(g=v(f,c));return g?(d[c]=g,!0):!1},unRegister:function(a){if(d.hasOwnProperty(a)){try{d[a].release()}catch(b){a=e(b);if(!a)throw b;throw new k(c(a),"Could not release kernel resources.");
}delete d[a];return!0}return!1},getKernel:function(a){return"string"!==typeof a?!1:d.hasOwnProperty(a)?d[a]:!1},setArgs:function(){var a=Array.prototype.slice.call(arguments),b,d;if(2>a.length)return XML3D.debug.logWarning("WebCL API: setArgs(): No kernel arguments were defined."),!1;b=a[0];a=a.slice(1);if(!b)return XML3D.debug.logWarning("WebCL API: setArgs(): WebCL kernel was not defined."),!1;d=b.getInfo(webcl.KERNEL_NUM_ARGS);if(a.length>d)XML3D.debug.logWarning("WebCL: setArgs: Input args amount > kernel program args amount! Ignoring extra arguments.");
else if(a.length<d)return XML3D.debug.logError("WebCL: setArgs: Not enough arguments were given to WebCL kernel."),!1;XML3D.debug.logDebug("Args for kernel:",b.getInfo(webcl.KERNEL_FUNCTION_NAME));try{for(;d--;)XML3D.debug.logDebug("Arg:",d,a[d]),b.setArg(d,a[d])}catch(g){b=e(g);if(!b)throw g;throw new k(c(b),"Could not set kernel arguments.");}return!0}}};d.webcl={init:function(a){if(!h())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. WebCL namespace is not available."),
!1;if(!g())return XML3D.debug.logWarning("WebCL API: Unfortunately your system does not support WebCL. OpenCL drivers are not working properly."),!1;r();y=p(a||"CPU");E=t(y);return!0},createContext:t,createProgram:m,buildProgram:u,createKernel:v,createCommandQueue:w,createBuffer:function(b,d,g){g=g||E;if(!b)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size was not defined."),!1;if(!a(b)||0>b)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer size must be a positive number."),
!1;if(!d)return XML3D.debug.logError("WebCL API: createBuffer(): Buffer type was not defined."),!1;if(!g)return XML3D.debug.logError("WebCL API: createBuffer(): clCtx was not defined."),!1;try{if("r"===d)return g.createBuffer(webcl.MEM_READ_ONLY,b);if("w"===d)return g.createBuffer(webcl.MEM_WRITE_ONLY,b);if("rw"===d)return g.createBuffer(webcl.MEM_READ_WRITE,b);XML3D.debug.logError("WebCL API: createBuffer(): Unknown buffer type:",d);return!1}catch(h){b=e(h);if(!b)throw h;throw new k(c(b),"Could not create a WebCL buffer.");
}},getDefaultContext:function(){return E},getPlatforms:r,getDevicesByType:p,getContextDevices:function(a){var b=[];if(!a)return XML3D.debug.logError("WebCL API: getContextDevices(): clCtx was not defined."),!1;try{b=a.getInfo(webcl.CONTEXT_DEVICES)}catch(d){if(a=e(d))throw new k(c(a),"Could not get devices.");throw d;}return 0===b.length?!1:b},getDevicePlatform:function(a){var b;if(!a)return XML3D.debug.logError("WebCL API: getDevicePlatform(): device was not defined."),!1;try{b=a.getInfo(webcl.DEVICE_PLATFORM)}catch(d){a=
e(d);if(!a)throw d;throw new k(c(a),"Could not get the platform of the device.");}return b},kernels:new D,KernelManager:D,hasWebCLNamespace:h,hasOpenCLDrivers:g,isAvailable:l,WebCLError:k,getCLErrorName:c};(function(a){if(!l())return!1;var b=r();if(!b||0>=b.length)return!1;try{var c=p("GPU")||p("CPU");if(!c)return!1;var d=t(c),e=w(c[0],d);a.cl={API:webcl,kernelManager:new D(d,c),platforms:b,devices:c,ctx:d,cmdQueue:e};XML3D.debug.logDebug("Successfully initialized WebCL platform.");return!0}catch(f){return!1}})(d.webcl);
window.XML3D.webcl=d.webcl})(m.exports)},{}],148:[function(e,m,l){var d=e("assert"),b=[],a=[],c=[];m.exports={registerErrorCallback:function(a){b.push(a)},notifyError:function(a,c){if(0<b.length){var d;for(d=0;d<b.length;++d)b[d](a,c)}},createClass:function(a,b,c){c=c||{};if(b){var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.superclass=b.prototype}for(var e in c)a.prototype[e]=c[e];return a},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},
_queueResultCallback:function(b,e){d(void 0!==e);var h;-1==(h=a.indexOf(b))&&(h=a.length,a.push(b));var g=c[h];if(!g||g<e)c[h]=e},_flushResultCallbacks:function(){if(a.length){var b;for(b=0;b<a.length;++b)a[b]._onPostponedResultChanged(c[b]);a=[];c=[]}}}},{assert:11}],149:[function(e,m,l){var d={EPSILON:1E-6,DATA_TYPE:{UNKNOWN:0,FLOAT:1,FLOAT2:2,FLOAT3:3,FLOAT4:4,FLOAT3X3:5,FLOAT4X4:10,INT:20,INT4:21,BOOL:30,TEXTURE:40,BYTE:50,UBYTE:60,fromString:function(b){if(b&&b.toUpperCase)return this[b.toUpperCase()]}}};
d.DATA_TYPE_MAP={"float":d.DATA_TYPE.FLOAT,float2:d.DATA_TYPE.FLOAT2,float3:d.DATA_TYPE.FLOAT3,float4:d.DATA_TYPE.FLOAT4,float3x3:d.DATA_TYPE.FLOAT3X3,float4x4:d.DATA_TYPE.FLOAT4X4,"int":d.DATA_TYPE.INT,int4:d.DATA_TYPE.INT4,bool:d.DATA_TYPE.BOOL,texture:d.DATA_TYPE.TEXTURE,"byte":d.DATA_TYPE.BYTE,ubyte:d.DATA_TYPE.UBYTE};d.TEXTURE_TYPE={UNKNOWN:0,FLOAT:1,UBYTE:60,USHORT_5_6_5:70,USHORT_4_4_4_4:71,USHORT_5_5_5_1:72};d.TEXTURE_FORMAT={UNKNOWN:0,ALPHA:100,RGB:101,RGBA:102,LUMINANCE:103,LUMINANCE_ALPHA:104};
d.DATA_TYPE_TUPLE_SIZE={};d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT]=1;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT2]=2;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT3]=3;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT4]=4;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT3X3]=9;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.FLOAT4X4]=16;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.INT]=1;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.INT4]=4;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.BOOL]=1;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.TEXTURE]=1;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.BYTE]=
1;d.DATA_TYPE_TUPLE_SIZE[d.DATA_TYPE.UBYTE]=1;d.TYPED_ARRAY_MAP={};d.TYPED_ARRAY_MAP[d.DATA_TYPE.FLOAT]=Float32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.FLOAT2]=Float32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.FLOAT3]=Float32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.FLOAT4]=Float32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.FLOAT4X4]=Float32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.INT]=Int32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.INT4]=Int32Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.BOOL]=Int8Array;d.TYPED_ARRAY_MAP[d.DATA_TYPE.BYTE]=Int8Array;
d.TYPED_ARRAY_MAP[d.DATA_TYPE.UBYTE]=Uint8Array;d.TYPED_ARRAY_MAP[d.TEXTURE_TYPE.USHORT_4_4_4_4]=Uint16Array;d.TYPED_ARRAY_MAP[d.TEXTURE_TYPE.USHORT_5_6_5]=Uint16Array;d.TYPED_ARRAY_MAP[d.TEXTURE_TYPE.USHORT_5_5_5_1]=Uint16Array;d.TEXTURE_FORMAT_TUPLE_SIZE={};d.TEXTURE_FORMAT_TUPLE_SIZE[d.TEXTURE_FORMAT.ALPHA]=1;d.TEXTURE_FORMAT_TUPLE_SIZE[d.TEXTURE_FORMAT.RGB]=3;d.TEXTURE_FORMAT_TUPLE_SIZE[d.TEXTURE_FORMAT.RGBA]=4;d.TEXTURE_FORMAT_TUPLE_SIZE[d.TEXTURE_FORMAT.LUMINANCE]=1;d.TEXTURE_FORMAT_TUPLE_SIZE[d.TEXTURE_FORMAT.LUMINANCE_ALPHA]=
2;d.getTypeName=function(b){for(var a in d.DATA_TYPE_MAP)if(d.DATA_TYPE_MAP[a]===b)return a};d.TEX_FILTER_TYPE={NEAREST:9728,LINEAR:9729,MIPMAP_NEAREST:9984,MIPMAP_LINEAR:9985};d.TEX_WRAP_TYPE={CLAMP:33071,REPEAT:10497};d.TEX_TYPE={TEXTURE_2D:3553};d.SHADER_CONSTANT_KEY={WORLD_TRANSFORM:1,VIEW_TRANSFORM:2,SCREEN_TRANSFORM:3,WORLD_TRANSFORM_NORMAL:4,VIEW_TRANSFORM_NORMAL:5,SCREEN_TRANSFORM_NORMAL:6,OBJECT_ID:7};d.VS_ATTRIB_TRANSFORM={NONE:0,VIEW_POINT:1,WORLD_POINT:2,VIEW_NORMAL:3,WORLD_NORMAL:4};
d.DATA_FILTER_TYPE={NONE:0,RENAME:1,KEEP:2,REMOVE:3};d.DATA_ENTRY_STATE={CHANGED_VALUE:1,CHANGED_NEW:2,LOAD_START:3,LOAD_END:4,CHANGED_SIZE:5,CHANGED_REMOVED:6,CHANGED_SIZE_TYPE:7};d.RESULT_TYPE={COMPUTE:0,VS:1};d.RESULT_STATE={NONE:0,CHANGED_DATA_VALUE:1,CHANGED_DATA_SIZE:2,CHANGED_STRUCTURE:3,IMAGE_LOAD_START:4,IMAGE_LOAD_END:5};d.SEQUENCE={NO_ACCESS:0,PREV_BUFFER:1,NEXT_BUFFER:2,LINEAR_WEIGHT:3};d.ITERATION_TYPE={NULL:0,ONE:1,MANY:2};d.EXTRACT={NO_EXTRAC:0,TEX_WIDTH:1,TEX_HEIGHT:2};d.ORIGIN={CHILD:1,
COMPUTE:2,PROTO:3};d.PLATFORM={JAVASCRIPT:0,GLSL:1,CL:2,ASYNC:3};d.PROCESS_STATE={MODIFIED:0,LOADING:1,INVALID:3,UNPROCESSED:4,PROCESSED:5};m.exports=d},{}],150:[function(e,m,l){function d(a,b,d,e){"object"===typeof a?(a.nodeName&&("video"===a.nodeName.toLowerCase()&&"undefined"===typeof a.complete&&Object.defineProperties(a,{width:{get:function(){return this.videoWidth}},height:{get:function(){return this.videoHeight}},complete:{get:function(){return!(0==this.readyState||0>=this.videoWidth||0>=this.videoHeight)}}}),
a.texelFormat=c.TEXTURE_FORMAT.RGBA,a.texelType=c.TEXTURE_TYPE.UBYTE),this._source=a):(d=d||c.TEXTURE_FORMAT.RGBA,e=e||c.TEXTURE_TYPE.UBYTE,this._source={width:a,height:b,texelFormat:d,texelType:e,data:new c.TYPED_ARRAY_MAP[e](a*b*c.TEXTURE_FORMAT_TUPLE_SIZE[d])})}function b(a,b){var c;for(c=0;c<q._listeners.length;++c)q._listeners[c](a,b);for(c=0;c<a._listeners.length;++c)a._listeners[c](a,b)}var a=e("../base.js"),c=e("./constants.js");e("../../utils/array.js");var f=function(){this.generateMipMap=
this.colorB=this.colorG=this.colorR=this.textureType=this.wrapU=this.wrapT=this.wrapS=this.mipFilter=this.magFilter=this.minFilter=0};f.prototype.setDefaults=function(){this.magFilter=this.minFilter=c.TEX_FILTER_TYPE.LINEAR;this.mipFilter=c.TEX_FILTER_TYPE.NEAREST;this.wrapU=this.wrapT=this.wrapS=c.TEX_WRAP_TYPE.CLAMP;this.textureType=c.TEX_TYPE.TEXTURE_2D;this.generateMipMap=this.colorB=this.colorG=this.colorR=0};f.prototype.set=function(a){this.minFilter=a.minFilter;this.magFilter=a.magFilter;this.mipFilter=
a.mipFilter;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.wrapU=a.wrapU;this.textureType=a.textureType;this.colorR=a.colorR;this.colorG=a.colorG;this.colorB=a.colorB;this.generateMipMap=a.generateMipMap};var k=function(a){this._type=a;this._listeners=[];this.userData={}};Object.defineProperty(k.prototype,"type",{set:function(){throw Error("type is read-only");},get:function(){return this._type}});k.prototype.addListener=function(a){this._listeners.push(a)};k.prototype.removeListener=function(a){Array.erase(this._listeners,
a)};k.prototype._notifyChanged=function(){b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE)};e=function(a,d){k.call(this,a);this._value=d;b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(e,k);e.prototype.setValue=function(b){this._setValue(b);a._flushResultCallbacks()};e.prototype._setValue=function(a){var d=this._value?this._value.length:0,e=a?a.length:0,f=this.getTupleSize(),d=(d>=2*f?2:d>=f?1:0)!=(e>=2*f?2:e>=f?1:0)?c.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:d!=e?c.DATA_ENTRY_STATE.CHANGED_SIZE:c.DATA_ENTRY_STATE.CHANGED_VALUE;
this._value=a;b(this,d)};e.prototype.getValue=function(){return this._value};e.prototype.getLength=function(){return this._value?this._value.length:0};e.prototype.getTupleSize=function(){return c.DATA_TYPE_TUPLE_SIZE[this._type]};e.prototype.getIterateCount=function(){return this.getLength()/this.getTupleSize()};e.prototype.isEmpty=function(){return!this._value||!this.getLength()};var h,g;c.toImageData=function(a){if(a instanceof ImageData)return a;if(!a.data)throw Error("no data property");if(!a.width)throw Error("no width property");
if(!a.height)throw Error("no height property");g||(h=document.createElement("canvas"),g=h.getContext("2d"));for(var b=g.createImageData(a.width,a.height),c=0;c<a.data.length;++c){var d=a.data[c];255<d&&(d=255);0>d&&(d=0);b.data[c]=d}return b};Object.defineProperties(d.prototype,{imageData:{get:function(){if(this._source instanceof HTMLElement){var a=document.createElement("canvas");a.width=this._source.width;a.height=this._source.height;a=a.getContext("2d");a.drawImage(this._source,0,0);a=a.getImageData(0,
0,this._source.width,this._source.height);a.texelFormat=this._source.texelFormat;a.texelType=this._source.texelType;this._source=a}return this._source}},glTextureData:{get:function(){return this._source}},complete:{get:function(){return"undefined"===typeof this._source.complete?!0:this._source.complete}},width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?this._source.texelFormat:
c.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:c.TEXTURE_TYPE.UNKNOWN}}});TextureEntry=function(a){k.call(this,c.DATA_TYPE.TEXTURE);this._samplerConfig=new f;this._loading=!1;this.setImage(a);b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(TextureEntry,k);Object.defineProperties(TextureEntry.prototype,{width:{get:function(){return this._source?this._source.width:-1}},height:{get:function(){return this._source?this._source.height:-1}},texelFormat:{get:function(){return this._source?
this._source.texelFormat:c.TEXTURE_FORMAT.UNKNOWN}},texelType:{get:function(){return this._source?this._source.texelType:c.TEXTURE_TYPE.UNKNOWN}}});TextureEntry.prototype.isLoading=function(){return this._source?!this._source.complete:!1};TextureEntry.prototype._createImage=function(a,b,c,e,g){this._source&&this.width==a&&this.height==b&&this.format==c&&this.type==e?this._notifyChanged():(a=new d(a,b,c,e),g||(g=new f,g.setDefaults()),this._samplerConfig.set(g),this._setImage(a));return this._source};
TextureEntry.prototype.setImage=function(b,c){this._setImage(b,c);a._flushResultCallbacks()};TextureEntry.prototype._setImage=function(a,b){a?a instanceof d?this._setSource(a,b):this._setSource(new d(a),b):this._setSource(null,b)};TextureEntry.prototype._setSource=function(a,d){var e=this.isLoading();this._source=a;var f=this.isLoading();!d||f||e?f?(this._loading=!0,b(this,c.DATA_ENTRY_STATE.LOAD_START)):this._loading?(this._loading=!1,b(this,c.DATA_ENTRY_STATE.LOAD_END)):b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE):
(b(this,c.DATA_ENTRY_STATE.LOAD_START),b(this,c.DATA_ENTRY_STATE.LOAD_END))};TextureEntry.prototype.asGLTextureValue=function(){return this._source&&this._source.glTextureData};TextureEntry.prototype.getValue=function(){return!this._source||this.isLoading()?null:this._source.imageData};TextureEntry.prototype.getSamplerConfig=function(){return this._samplerConfig};TextureEntry.prototype.getLength=function(){return 1};TextureEntry.prototype.isEmpty=function(){return!1};TextureEntry.prototype.getIterateCount=
function(){return 1};l=function(a){k.call(this,c.DATA_TYPE.TEXTURE);this._samplerConfig=new f;this._imageData=null;this._texelFormat=c.TEXTURE_FORMAT.RGBA;this._texelType=c.TEXTURE_TYPE.UBYTE;this._updateImageData(a);b(this,c.DATA_ENTRY_STATE.CHANGED_NEW)};a.createClass(l,k);Object.defineProperties(l.prototype,{width:{get:function(){return this._imageData?this._imageData.width:-1}},height:{get:function(){return this._imageData?this._imageData.height:-1}},texelFormat:{get:function(){return this._texelFormat}},
texelType:{get:function(){return this._texelType}}});l.prototype.isLoading=function(){return!this._imageData};l.prototype._updateImageData=function(a){this._texelFormat=c.TEXTURE_FORMAT.RGBA;this._texelType=c.TEXTURE_TYPE.UBYTE;this._imageData=a};l.prototype._createImage=function(a,b,d,e,g){if(!this._imageData||this.getWidth()!=a||this.getHeight()!=b||this._format!=d||this._type!=e){if(!a||!b)throw Error("Width or height is not specified");this._texelFormat=d;this._texelType=e;g||(g=new f,g.setDefaults());
this._samplerConfig.set(g);d={width:a,height:b,data:null};d.data=e==c.TEXTURE_TYPE.FLOAT?new Float32Array(a*b*4):Uint8Array==Uint8ClampedArray?new Int16Array(a*b*4):new Uint8ClampedArray(a*b*4);this._imageData=d}this._notifyChanged()};l.prototype.setImageData=function(d){this._updateImageData(d);b(this,c.DATA_ENTRY_STATE.CHANGED_VALUE);a._flushResultCallbacks()};l.prototype.getWidth=function(){return this._imageData&&this._imageData.width||0};l.prototype.getHeight=function(){return this._imageData&&
this._imageData.height||0};l.prototype.getValue=function(){return this._imageData};l.prototype.getSamplerConfig=function(){return this._samplerConfig};l.prototype.getLength=function(){return 1};l.prototype.isEmpty=function(){return!1};l.prototype.getIterateCount=function(){return 1};var q={_listeners:[],addListener:function(a){this._listeners.push(a)},removeListener:function(a){Array.erase(this._listeners,a)}};m.exports={DataEntry:k,BufferEntry:e,TextureEntry:TextureEntry,ImageDataTextureEntry:l,
SamplerConfig:f,DataChangeNotifier:q}},{"../../utils/array.js":140,"../base.js":148,"./constants.js":149}],151:[function(e,m,l){function d(a,b){if(a._filterMapping&&!a._filterMapping.isEmpty())return a;if(!a._computeOperator){if(a._sourceNode&&0==a._children.length)return d(a._sourceNode);if(1==a._children.length&&a._children[0]instanceof p)return d(a._children[0])}var c=a._channelNode.getChildDataIndex(b);return-1!=c&&void 0!=c?a._sourceNode?d(a._sourceNode):d(a._children[c]):a}function b(a){var c=
a._loading?a._loadLevel:Infinity,d;for(d=0;c&&d<a._children.length;++d){var e=a._children[d];e instanceof p?c=Math.min(c,Math.max(e._loadLevel,e._progressLevel)):e._data&&e._data.isLoading&&e._data.isLoading()&&(c=Math.min(c,1))}c&&a._sourceNode&&(c=Math.min(c,Math.max(a._sourceNode._loadLevel,a._sourceNode._progressLevel)));c&&a._dataflowNode&&(c=Math.min(c,Math.max(a._dataflowNode._loadLevel,a._dataflowNode._progressLevel)));d=a._progressLevel;a._progressLevel=c;if(d!=a._progressLevel)for(a._callLoadListeners(a._progressLevel,
d),d=0;d<a._parents.length;++d)b(a._parents[d])}function a(a,b){for(var c=0;c<a._parents.length;++c)a._parents[c].notify(b,a)}function c(a,b,c){a[b]&&a[b]._removeOwner(a);a[b]=c;a[b]&&a[b]._addOwner(a)}function f(a,b,c){var d=a[b];d&&Array.erase(d._parents,a);(a[b]=c)&&c._parents.push(a)}var k=e("./constants.js"),h=e("./../processing/mapping.js");e("../../utils/array.js");var g=e("../base.js"),q=e("../processing/channel-node.js").ChannelNode,r=e("../utils/utils.js");e=function(){this._parents=[]};
l=function(){this._parents=[];this._name="";this._key=0;this._paramName=this._data=null;this._paramGlobal=!1;this._dataListener=this.onDataChange.bind(this)};g.createClass(l,e);l.prototype.onDataChange=function(b,c){var d;switch(c){case k.DATA_ENTRY_STATE.CHANGED_VALUE:d=k.RESULT_STATE.CHANGED_DATA_VALUE;break;case k.DATA_ENTRY_STATE.LOAD_START:d=k.RESULT_STATE.IMAGE_LOAD_START;break;case k.DATA_ENTRY_STATE.LOAD_END:d=k.RESULT_STATE.IMAGE_LOAD_END;break;case k.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE:d=
k.RESULT_STATE.CHANGED_STRUCTURE;break;case k.DATA_ENTRY_STATE.CHANGED_SIZE:d=k.RESULT_STATE.CHANGED_DATA_SIZE;break;default:d=k.RESULT_STATE.CHANGED_DATA_SIZE}a(this,d)};Object.defineProperty(l.prototype,"name",{set:function(b){this._name=b;a(this,k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._name}});Object.defineProperty(l.prototype,"key",{set:function(b){this._key=b;a(this,k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._key}});
Object.defineProperty(l.prototype,"paramName",{set:function(b){this._paramName=b;a(this,k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._paramName}});Object.defineProperty(l.prototype,"paramGlobal",{set:function(b){this._paramGlobal=b;a(this,k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._paramGlobal}});Object.defineProperty(l.prototype,"data",{set:function(b){var c=!1;this._data&&(c=this._data._loading,this._data.removeListener(this._dataListener));
(this._data=b)&&this._data.addListener(this._dataListener);c!=this._data._loading&&a(this,this._data._loading?k.RESULT_STATE.IMAGE_LOAD_START:k.RESULT_STATE.IMAGE_LOAD_END);g._flushResultCallbacks()},get:function(){return this._data}});l.prototype._getParamNames=function(){return this._paramGlobal?null:this._paramName};l.prototype._getGlobalParamNames=function(){return this._paramGlobal?this._paramName:null};var n=0,p=function(a){this._parents=[];this._loading=!1;this._loadLevel=0;this._progressLevel=
Infinity;this.id=++n;this._isProtoNode=a;this._children=[];this._userData=this._sourceNode=null;this._filterType=k.DATA_FILTER_TYPE.NONE;this._filterMapping=null;this._computeOperator="";this._computeUsesDataflow=!1;this._dataflowNode=this._computeOutputMapping=this._computeInputMapping=null;this._channelNode=new q(this);this._substitutionNodes={};this._platform=this._globalParamNames=this._paramNames=null;this._listeners=[];this._loadListeners=[]};g.createClass(p,e);Object.defineProperty(p.prototype,
"sourceNode",{set:function(a){f(this,"_sourceNode",a);b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._sourceNode}});Object.defineProperty(p.prototype,"dataflowNode",{set:function(a){if(a&&!this._computeUsesDataflow)throw Error("Cannot set dataflowNode when compute doesn't use dataflow.");f(this,"_dataflowNode",a);b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._dataflowNode}});
Object.defineProperty(p.prototype,"userData",{set:function(a){this._userData=a},get:function(){return this._userData}});p.prototype.setLoading=function(a){if(this._loading!=a){this._loading=a;this._channelNode.setStructureOutOfSync();this._channelNode.loading=a;for(var c in this._substitutionNodes){var d=this._substitutionNodes[c];d.setStructureOutOfSync();d.loading=a}b(this);g._flushResultCallbacks()}};p.prototype.isSubtreeLoading=function(){return 0==this._progressLevel};p.prototype.getProgressLevel=
function(){return this._progressLevel};Object.defineProperty(p.prototype,"filterType",{set:function(a){this._filterType=a;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._filterType}});Object.defineProperty(p.prototype,"filterMapping",{set:function(a){c(this,"_filterMapping",a);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._filterMapping}});Object.defineProperty(p.prototype,"computeOperator",
{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!1;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?null:this._computeOperator}});Object.defineProperty(p.prototype,"computeDataflowUrl",{set:function(a){this._computeOperator=a;this._computeUsesDataflow=!0;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._computeUsesDataflow?this._computeOperator:null}});Object.defineProperty(p.prototype,
"computeInputMapping",{set:function(a){c(this,"_computeInputMapping",a);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._computeInputMapping}});Object.defineProperty(p.prototype,"computeOutputMapping",{set:function(a){c(this,"_computeOutputMapping",a);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()},get:function(){return this._computeOutputMapping}});p.prototype.isProtoNode=function(){return this._isProtoNode};p.prototype.appendChild=
function(a){this._children.push(a);a._parents.push(this);b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()};p.prototype.removeChild=function(a){Array.erase(this._children,a);Array.erase(a._parents,this);b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()};p.prototype.insertBefore=function(a,c){var d=this._children.indexOf(c);-1==d?this._children.push(a):this._children.splice(d,0,a);a._parents.push(this);b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);
g._flushResultCallbacks()};p.prototype.clearChildren=function(){for(var a=0;a<this._children.length;++a)Array.erase(this._children[a]._parents,this);this._children=[];b(this);this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()};p.prototype.detachFromParents=function(){for(var a=0;a<this._parents.length;++a){var b=this._parents[a];b._sourceNode==this?b.sourceNode=null:b._dataflowNode==this?b.dataflowNode=null:b.removeChild(this)}this._children=[]};p.prototype.setPlatform=function(a){"string"===
typeof a?"cl"===a?this._platform=k.PLATFORM.CL:"gl"===a?this._platform=k.PLATFORM.GLSL:"js"===a&&(this._platform=k.PLATFORM.JAVASCRIPT):!isNaN(parseFloat(a))&&isFinite(a)?this._platform=a:this._platform=null;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()};var t=/^([A-Za-z\s]*)\(([^()]+)\)$/;p.prototype.setFilter=function(a){a=a||"";var b=k.DATA_FILTER_TYPE.RENAME,d=null;if(a){var e=a.trim().match(t);if(e){a=e[1].trim();switch(a){case "keep":b=k.DATA_FILTER_TYPE.KEEP;break;
case "remove":b=k.DATA_FILTER_TYPE.REMOVE;break;case "rename":b=k.DATA_FILTER_TYPE.RENAME;break;default:g.notifyError("Unknown filter type:"+a,this)}d=h.Mapping.parse(e[2],this)}else g.notifyError("Could not parse filter '"+a+"'",this)}d||(d=new h.OrderMapping);c(this,"_filterMapping",d);this._filterType=b;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);g._flushResultCallbacks()};var x=/^(([^=]+)\=)?([^'(]+('[^']+')?[^'(]+)(\(([^()]*)?\))?$/,u=/^\(([^()]*)\)$/,v=/^dataflow\['([^']+)'\]$/;p.prototype.setCompute=
function(a){a=a||"";var b="",d=null,e=null,f=a.trim().match(x);if(f){a=f[2]?f[2].trim():"";var b=f[3].trim(),l=f[6]?f[6].trim():"";if(f=a.match(u))a=f[1];l&&(d=h.Mapping.parse(l,this));a&&(e=h.Mapping.parse(a,this));(f=b.match(v))?(this._computeUsesDataflow=!0,b=f[1]):this._computeUsesDataflow=!1;this._dataflowNode=null}else a&&g.notifyError("Error parsing Compute value '"+a+"'",this);c(this,"_computeInputMapping",d);c(this,"_computeOutputMapping",e);this._computeOperator=b;this.notify(k.RESULT_STATE.CHANGED_STRUCTURE);
g._flushResultCallbacks()};p.prototype.notify=function(c,d){switch(c){case k.RESULT_STATE.CHANGED_STRUCTURE:this._globalParamNames=this._paramNames=null;this._channelNode.setStructureOutOfSync();for(var e in this._substitutionNodes)this._substitutionNodes[e].clear();this._substitutionNodes={};a(this,c);break;case k.RESULT_STATE.IMAGE_LOAD_START:case k.RESULT_STATE.IMAGE_LOAD_END:b(this);d&&this._channelNode.notifyDataChange(d,c);break;case k.RESULT_STATE.CHANGED_DATA_VALUE:case k.RESULT_STATE.CHANGED_DATA_SIZE:d&&
this._channelNode.notifyDataChange(d,c)}for(e=0;e<this._listeners.length;++e)this._listeners[e](c)};p.prototype.addListener=function(a){this._listeners.push(a)};p.prototype.removeListener=function(a){Array.erase(this._listeners,a)};p.prototype.addLoadListener=function(a){this._loadListeners.push(a)};p.prototype.removeLoadListener=function(a){Array.erase(this._loadListeners,a)};p.prototype._callLoadListeners=function(a,b){for(var c=this._loadListeners.length,d=0;d<c;++d)this._loadListeners[d](this,
a,b)};p.prototype.getOutputNames=function(){return d(this)._channelNode.getOutputNames()};p.prototype.getOutputChannelInfo=function(a){return d(this)._channelNode.getOutputChannelInfo(a)};p.prototype.getParamNames=function(){return this._getParamNames()};p.prototype._getResult=function(a,b){return d(this,b)._channelNode.getResult(a,b)};p.prototype._getForwardNode=function(a){return d(this,a)};p.prototype._getParamNames=function(){if(!this._paramNames)if(this._paramNames=[],this._sourceNode)r.nameset.add(this._paramNames,
this._sourceNode._getParamNames());else for(var a=0;a<this._children.length;++a)r.nameset.add(this._paramNames,this._children[a]._getParamNames());return this._paramNames};p.prototype._getGlobalParamNames=function(){if(!this._globalParamNames)if(this._globalParamNames=[],this._dataflowNode&&r.nameset.add(this._globalParamNames,this._dataflowNode._getGlobalParamNames()),this._sourceNode)r.nameset.add(this._globalParamNames,this._sourceNode._getGlobalParamNames());else for(var a=0;a<this._children.length;++a)r.nameset.add(this._globalParamNames,
this._children[a]._getGlobalParamNames());return this._globalParamNames};p.prototype._getOrCreateChannelNode=function(a){if(a){var b=a.getKey(this);this._substitutionNodes[b]?this._substitutionNodes[b].increaseRef():this._substitutionNodes[b]=new q(this,a);return this._substitutionNodes[b]}return this._channelNode};p.prototype._removeSubstitutionNode=function(a){a=a.substitution.getKey(this);this._substitutionNodes[a]&&this._substitutionNodes[a].decreaseRef()&&delete this._substitutionNodes[a]};m.exports=
{InputNode:l,DataNode:p,getComputeDataflowUrl:function(a){return(a=(a||"").trim().match(x))&&(a=a[3].trim().match(v))?a[1]:null}}},{"../../utils/array.js":140,"../base.js":148,"../processing/channel-node.js":192,"../utils/utils.js":200,"./../processing/mapping.js":196,"./constants.js":149}],152:[function(e,m,l){function d(a,b){a._result&&a._result._removeRequest(a);(a._result=b)&&b._addRequest(a);return b}function b(a,b,c){a=a._getForwardNode(c);c=a.id+"|"+b.getKey();var d;(d=q[c])?h[d.id]++:(d=new f(!1),
d.appendChild(a),d.computeOperator=b.getOperator(),d.computeInputMapping=null,d.computeOutputMapping=null,q[c]=d,h[d.id]=1,g[d.id]=c);return d}var a=e("../base.js"),c=e("./constants.js"),f=e("./graph.js").DataNode,k=function(a,b,c){this._dataNode=a;this._filter=b?b.slice().sort():null;this._listener=c;this._result=null;this._dataNodeListener=this._onDataNodeChange.bind(this);this._dataNode.addListener(this._dataNodeListener)};Object.defineProperty(k.prototype,"dataNode",{set:function(){throw Error("dataNode is readonly");
},get:function(){return this._dataNode}});Object.defineProperty(k.prototype,"filter",{set:function(){throw Error("filter is read-only");},get:function(){return this._filter}});k.prototype.clear=function(){this._listener=null;this._result&&this._result._removeRequest(this);this._dataNode.removeListener(this._dataNodeListener)};k.prototype._onPostponedResultChanged=function(a){this._listener&&this._listener(this,a)};k.prototype._onDataNodeChange=function(b){a._queueResultCallback(this,b)};e=function(a,
b,c){k.call(this,a,b,c)};a.createClass(e,k);e.prototype.getResult=function(){return d(this,this._dataNode._getResult(c.RESULT_TYPE.COMPUTE,this._filter))};e.prototype._onResultChanged=function(a){this._onDataNodeChange(a)};var h={},g={},q={};l=function(a,c,d){var e=c.getFilter();if(0==e.length)throw Error("vsConfig requires at least one attribute entry.");k.call(this,a,e,d);this._vsConfig=c;this._vsConnectNode=b(a,c)};a.createClass(l,k);l.prototype.getConfig=function(){return this._vsConfig};l.prototype.getResult=
function(){return d(this,this._vsConnectNode._getResult(c.RESULT_TYPE.VS,this._filter))};l.prototype._onDataNodeChange=function(a){if(a==c.RESULT_STATE.CHANGED_STRUCTURE){var d=b(this._dataNode,this._vsConfig,this._filter);if(d!=this._vsConnectNode){var e=this._vsConnectNode;h[e.id]--;h[e.id]||(q[g[e.id]]=null,e.clearChildren());this._vsConnectNode=d}}k.prototype._onDataNodeChange.call(this,a)};l.prototype.getVertexShader=function(){this.getResult();this._vertexShader||(this._vertexShader=this._result.getVertexShader(this._vsConfig));
return this._vertexShader};l.prototype._onResultChanged=function(a){this._onDataNodeChange(a)};m.exports={ComputeRequest:e,VertexShaderRequest:l}},{"../base.js":148,"./constants.js":149,"./graph.js":151}],153:[function(e,m,l){function d(a,b,c,d,e,f){this.program=a;this.cl=a.cl;this.name=b;this.type=d||null;this.isInput=!!f;this.hasMemObject=this.needsMemObject=!1;this.clFunctionParam=this.arg=this.memObjectSize=this.byteSize=null;this.xflowType=c;this.helperMap=null;this.helpers=[];this.entryValue=
e||null;this.val=null;this.prepareParam();this.initHelperParams();this.initKernelArg();this.updateValue(this.entryValue)}function b(a,b,c,e,f,g){var h=f?f.getValue():null;f=b?c.kernelParamMap.inputs:c.kernelParamMap.outputs;f[g]?f[g].updateValue(h):(f[g]=new d(c,a.name,a.type,null,h,b),e.push(f[g].clFunctionParam),f[g].helpers.forEach(function(a){e.push(a.clFunctionParam)}))}function a(a){var b=a.cl,d=b.kernelManager,e=b.cmdQueue,f={inputs:[],outputs:[]},g=c(a.kernelParamMap,f),h=k(a.kernelParamMap.inputs[0]),
l=a.kernelProgram;return function(){var a,b,c,k,q=f.inputs,r=f.outputs;if(!l)return!1;k=g.map(function(a){return a.arg});d.setArgs.apply(null,[l].concat(k));try{b=q.length;for(a=0;a<b;a++)c=q[a],e.enqueueWriteBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);e.enqueueNDRangeKernel(l,h[1].length,[],h[1],h[0]);b=r.length;for(a=0;a<b;a++)c=r[a],e.enqueueReadBuffer(c.arg,!1,0,c.memObjectSize,c.val,[]);e.finish()}catch(n){return!1}return!0}}function c(a,b){var c=a.inputs,d=[];a.outputs.forEach(function(a){f(a,
d,b.outputs)});c.forEach(function(a){f(a,d,b.inputs)});return d}function f(a,b,c){b.push(a);a.hasMemObject&&(c.push(a),a.helpers.forEach(function(a){b.push(a)}))}function k(a){var b;b=a.entryValue;if(a.xflowType===h.DATA_TYPE.TEXTURE)a=[16,4],b=[Math.ceil(b.width/a[0])*a[0],Math.ceil(b.height/a[1])*a[1]];else{var c=1;switch(a.xflowType){case h.DATA_TYPE.INT4:case h.DATA_TYPE.FLOAT4:c=4;break;case h.DATA_TYPE.FLOAT3:c=3;break;case h.DATA_TYPE.FLOAT4X4:c=16}a=[16];b=[Math.ceil(b.length/(a[0]*c))*a[0]]}return[a,
b]}var h=e("../interface/constants.js");e=function(a){if(this.cl=XML3D.webcl.cl)this.list=a,this.entry=a.entries[0],this.operator=this.entry.operator,this.kernelParamMap={inputs:[],outputs:[]},this.kernelFunctionParams=[],this.mainProgram=this.kernelProgram=this.kernelCode=null};var g={type:"uint",params:["width","height"]},q={type:"uint",params:["length"]};d.prototype={prepareParam:function(){var a,b=h.DATA_TYPE,c=[],d="",e="";if(!this.type){switch(this.xflowType){case b.TEXTURE:a=g;this.type="uchar4*";
d="__global";this.needsMemObject=!0;break;case b.INT:this.type="int";break;case b.INT4:a=q;this.type="int4*";d="__global";this.needsMemObject=!0;break;case b.FLOAT:this.type="float";break;case b.FLOAT2:a=q;this.type="float2*";d="__global";this.needsMemObject=!0;break;case b.FLOAT3:a=q;this.type="float*";d="__global";this.needsMemObject=!0;break;case b.FLOAT4:a=q;this.type="float4*";d="__global";this.needsMemObject=!0;break;case b.FLOAT4X4:a=q;this.type="float16*";d="__global";this.needsMemObject=
!0;break;default:return}this.helperMap=a}d&&c.push(d);this.isInput&&(e="const");e&&c.push(e);c.push(this.type);c.push(this.name);this.clFunctionParam=c.join(" ")},initHelperParams:function(){var a,b=this,c=this.helperMap;c&&this.isInput&&c.params.forEach(function(e){var f=b.name+"_"+e;if("width"===e)a=b.entryValue.width;else if("height"===e)a=b.entryValue.height;else if("length"===e)switch(a=b.entryValue.length,b.xflowType){case h.DATA_TYPE.FLOAT2:a/=2;break;case h.DATA_TYPE.FLOAT3:a/=3;break;case h.DATA_TYPE.FLOAT4:case h.DATA_TYPE.INT4:a/=
4;break;case h.DATA_TYPE.FLOAT4X4:a/=16}b.helpers.push(new d(b.program,f,null,c.type,new Uint32Array([a])))})},initKernelArg:function(){this.needsMemObject?this.allocateMemObject():this.arg=this.entryValue},allocateMemObject:function(){var a=this.cl.API,b=this.cl.ctx,c=this.type,d=parseInt(c.substring(c.length-2,c.length-1),10),c=this.isInput?"r":"w",e=this.entryValue;this.hasMemObject&&this.arg.release();this.byteSize=isNaN(d)?1:d;if(this.xflowType===h.DATA_TYPE.TEXTURE)d*=e.width*e.height,this.byteSize=
4;else switch(this.xflowType){case h.DATA_TYPE.INT4:d=e.length*Int32Array.BYTES_PER_ELEMENT;break;case h.DATA_TYPE.FLOAT2:case h.DATA_TYPE.FLOAT3:case h.DATA_TYPE.FLOAT4:case h.DATA_TYPE.FLOAT4x4:d=e.length*Float32Array.BYTES_PER_ELEMENT;break;default:d=4*e.length}a=a.createBuffer(d,c,b);this.memObjectSize=d;this.arg=a;this.hasMemObject=!0;this.needsMemObject=!1},updateValue:function(a){this.hasMemObject?(this.val=void 0===a.data?a:a.data,this.entryValue=a,this.checkEntrySize()):this.arg=this.entryValue=
a},updateHelpers:function(){var a=this;this.helpers.forEach(function(b){var c=b.name;-1!==c.indexOf("width")?b.updateValue(new Uint32Array([a.entryValue.width])):-1!==c.indexOf("height")?b.updateValue(new Uint32Array([a.entryValue.height])):-1!==c.indexOf("length")&&(c=a.entryValue.length,a.xflowType===h.DATA_TYPE.FLOAT4||a.xflowType===h.DATA_TYPE.INT4?c/=4:a.xflowType===h.DATA_TYPE.FLOAT4X4&&(c/=16),b.updateValue(new Uint32Array([c])))})},checkEntrySize:function(){var a=this.entryValue;this.memObjectSize!==
(this.xflowType===h.DATA_TYPE.TEXTURE?a.width*a.height*this.byteSize:this.xflowType===h.DATA_TYPE.FLOAT2||this.xflowType===h.DATA_TYPE.FLOAT3||this.xflowType===h.DATA_TYPE.FLOAT4||this.xflowType===h.DATA_TYPE.FLOAT4X4?a.length*Float32Array.BYTES_PER_ELEMENT:this.xflowType===h.DATA_TYPE.INT4?a.length*Int32Array.BYTES_PER_ELEMENT:a.length*this.byteSize)&&(this.allocateMemObject(),this.updateHelpers(),this.program.mainProgram=null)}};e.prototype.run=function(c){var d=this.list,e,f,g=c.operatorData[0],
h=d.entries[0],k=h.operator.mapping;g.iterFlag={};for(f=0;f<k.length;++f)e=h.isTransferInput(f)||d.isInputIterate(h.getDirectInputIndex(f)),g.iterFlag[f]=e;g.iterateCount=d.getIterateCount(c);if(this.operator.evaluate&&this.operator.evaluate instanceof Array){d=this.entry;e=this.kernelFunctionParams;k=this.operator.outputs;for(h=e.length=0;h<k.length;++h)f=k[h],g=c.outputs[d.getOutputIndex(h)].dataEntry,b(f,!!f.source,this,e,g,h);k=d.operator.mapping;for(h=0;h<k.length;++h)f=k[h],g=c.getDataEntry(d.getDirectInputIndex(h)),
b(f,!!f.source,this,e,g,h);if(null===this.kernelCode)a:if(c=this.cl.kernelManager,e=this.operator.evaluate,d=this.kernelName=this.operator.name.split("xflow.")[1],e){f=[];f.push("__kernel void");f.push(d+"(");f.push(this.kernelFunctionParams.join(", "));f.push(")");(f=f.join(" "))?(f+="{\n",g=[],h=this.kernelParamMap.inputs[0],"uchar4*"===h.type?(g.push("int x = get_global_id(0);"),g.push("int y = get_global_id(1);"),g.push("if (x >= "+h.name+"_width || y >= "+h.name+"_height) return;"),g.push("int "+
h.name+"_i = y * "+h.name+"_width + x;")):(g.push("int "+h.name+"_i = get_global_id(0);"),g.push("if ("+h.name+"_i >= "+h.name+"_length) return;")),(g=g.join("\n"))?(f=f+g+e.join("\n"),e=f+="\n}"):e=!1):e=!1;e=this.kernelCode=e;try{c.register(d,e)}catch(l){break a}this.kernelProgram=c.getKernel(this.kernelName)}null===this.mainProgram&&(this.mainProgram=a(this));this.mainProgram()}};m.exports=e},{"../interface/constants.js":149}],154:[function(e,m,l){Xflow.registerOperator("xflow.add",{outputs:[{type:"float3",
name:"result"}],params:[{type:"float3",source:"value1"},{type:"float3",source:"value2"}],evaluate:function(d,b,a,c){throw Error("Not used!");},evaluate_core:function(d,b,a){d[0]=b[0]+a[0];d[1]=b[1]+a[1];d[2]=b[2]+a[2]}})},{}],155:[function(e,m,l){Xflow.registerOperator("xflow.bufferSelect",{outputs:[{type:"float3",name:"result",noAlloc:!0}],params:[{type:"float3",source:"trueOption",array:!0},{type:"float3",source:"falseOption",array:!0},{type:"bool",source:"value",array:!0}],evaluate:function(d,
b,a,c){d.assign=c[0]?a:b;return!0}})},{}],156:[function(e,m,l){Xflow.registerOperator("xflow.clampImage",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"ImageData"}],params:[{type:"texture",source:"image"},{type:"float",source:"min"},{type:"float",source:"max"}],evaluate:function(d,b,a,c){var e=b.data;d=d.data;a=a[0];c=c[0];b=b.data.length;for(var k=0;k<b;k++){var h=e[k];h<a&&(h=a);h>c&&(h=c);d[k]=h}return!0}})},{}],157:[function(e,m,l){(function(){function d(b,a,c,d){var e=Math.round(Math.sqrt(c.length)),
h=Math.floor(e/2),g=b.data,l=b.width;b=b.height;var r=a.data;d=d?1:0;for(var n=0;n<b;n++)for(var p=0;p<l;p++){for(var t=n,m=p,u=4*(n*l+p),v=0,w=0,z=0,y=0,E=0;E<e;E++)for(var C=0;C<e;C++){var A=t+E-h,B=m+C-h;0<=A&&A<b&&0<=B&&B<l&&(A=4*(A*l+B),B=c[E*e+C],v+=g[A]*B,w+=g[A+1]*B,z+=g[A+2]*B,y+=g[A+3]*B)}r[u]=v;r[u+1]=w;r[u+2]=z;r[u+3]=y+d*(255-y)}return a}Xflow.registerOperator("xflow.convoluteImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",
source:"kernel"}],evaluate:function(b,a,c){d(a,b,c,!0);return!0}});Xflow.registerOperator("xflow.convoluteImageToFloat",{outputs:[{type:"texture",name:"result",sizeof:"image",formatType:"float32"}],params:[{type:"texture",source:"image"},{type:"float",source:"kernel"}],evaluate:function(b,a,c){d(a,b,c,!0);return!0}})})()},{}],158:[function(e,m,l){Xflow.registerOperator("xflow.createIGIndex",{outputs:[{type:"float2",name:"texcoord",customAlloc:!0}],params:[{type:"int",source:"vertexCount",optional:!1},
{type:"texture",source:"positionTex",optional:!1}],alloc:function(d,b,a){d.texcoord=a.width*a.height},evaluate:function(d,b,a,c){b=.5/a.width;c=.5/a.height;for(var e=0,k=0,h=a.height;k<h;k++)for(var g=0,l=a.width;g<l;g++)d[e++]=g/l+b,d[e++]=1-(k/h+c);return!0}})},{}],159:[function(e,m,l){Xflow.registerOperator("xflow.createTransform",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",
optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(d,b,a,c,e,k,h){for(var g=0;g<h.iterateCount;g++)XML3D.math.mat4.makeTransformXflow(b?b.subarray(h.iterFlag[0]?3*g:0):null,a?a.subarray(h.iterFlag[1]?4*g:0):null,c?c.subarray(h.iterFlag[2]?3*g:0):null,e?e.subarray(h.iterFlag[3]?3*g:0):null,k?k.subarray(h.iterFlag[4]?4*g:0):null,d.subarray(16*g));return!0}})},{}],160:[function(e,m,l){Xflow.registerOperator("xflow.createTransformInv",
{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float3",source:"translation",optional:!0},{type:"float4",source:"rotation",optional:!0},{type:"float3",source:"scale",optional:!0},{type:"float3",source:"center",optional:!0},{type:"float4",source:"scaleOrientation",optional:!0}],evaluate:function(d,b,a,c,e,k,h){for(var g=0;g<h.iterateCount;g++)XML3D.math.mat4.makeTransformInvXflow(b?b.subarray(h.iterFlag[0]?3*g:0):null,a?a.subarray(h.iterFlag[1]?4*g:0):null,c?c.subarray(h.iterFlag[2]?3*g:
0):null,e?e.subarray(h.iterFlag[3]?3*g:0):null,k?k.subarray(h.iterFlag[4]?4*g:0):null,d.subarray(16*g))}})},{}],161:[function(e,m,l){(function(){var d=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[-1,-1,-1],[1,-1,-1],[-1,-1,1],[1,-1,1],[1,-1,-1],[1,1,-1],[1,-1,1],[1,1,1],[-1,1,-1],[1,1,-1],[-1,1,1],[1,1,1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],b=[[0,0,-1],[0,0,-1],[0,0,-1],[0,0,-1],[-1,0,0],[-1,0,0],[-1,0,0],[-1,0,0],[0,-1,0],[0,-1,0],[0,-1,0],[0,-1,0],[1,0,0],[1,
0,0],[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],a=[[0,1,2,1,2,3],[4,5,6,5,6,7],[8,9,10,9,10,11],[12,13,14,13,14,15],[16,17,18,17,18,19],[20,21,22,21,22,23]];Xflow.registerOperator("xflow.debug.createSkinCubes",{outputs:[{type:"int",name:"index",customAlloc:!0},{type:"float3",name:"position",customAlloc:!0},{type:"float3",name:"normal",customAlloc:!0},{type:"int4",name:"boneIndices",customAlloc:!0},{type:"float4",name:"boneWeights",customAlloc:!0}],params:[{type:"float4x4",
source:"bindTransforms",array:!0},{type:"float",source:"size",array:!0,optional:!0}],alloc:function(a,b){var d=b.length/16;a.position=24*d;a.normal=24*d;a.boneIndices=24*d;a.boneWeights=24*d;a.index=36*d},evaluate:function(c,e,k,h,g,l,r){var n=l.length/16;r=(r&&r[0]||1)/2;for(var p=XML3D.math.vec3.create(),t=XML3D.math.vec3.create(),m=0;m<n;++m)for(var u=0;6>u;++u){for(var v=0;4>v;v++){var w=4*u+v,z=24*m+w;XML3D.math.vec3.copy(p,d[w]);XML3D.math.vec3.scale(p,p,r);XML3D.math.mat4.multiplyOffsetVec3(l,
16*m,p,0);XML3D.math.vec3.copy(t,b[w]);XML3D.math.mat4.multiplyOffsetDirection(l,16*m,t,0);e[3*z+0]=p[0];e[3*z+1]=p[1];e[3*z+2]=p[2];k[3*z+0]=t[0];k[3*z+1]=t[1];k[3*z+2]=t[2];h[4*z+0]=m;h[4*z+1]=h[4*z+2]=h[4*z+3]=0;g[4*z+0]=1;g[4*z+1]=g[4*z+2]=g[4*z+3]=0}w=36*m+6*u;for(v=0;6>v;++v)c[w+v]=24*m+a[u][v]}}})})()},{}],162:[function(e,m,l){Xflow.registerOperator("xflow.flipNormal",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(d,b,a){for(var c=0;c<3*a.iterateCount;c++)d[c]=
-b[c]}})},{}],163:[function(e,m,l){Xflow.registerOperator("xflow.flipVerticalImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(d,b){for(var a=b.width,c=b.height,e=d.data,k=b.data,h=0;h<c;++h)for(var g=0;g<a;++g){var l=h*a,r=4*(l+g),l=4*(l+(a-1-g));e[l]=k[r];e[l+1]=k[r+1];e[l+2]=k[r+2];e[l+3]=k[r+3]}return!0}})},{}],164:[function(e,m,l){Xflow.registerOperator("xflow.forwardKinematics",{outputs:[{type:"float4x4",name:"result",
customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(d,b,a){b=Math.min(b.length,a.length/16);d.result=b},evaluate:function(d,b,a,c){c=d.length/16;for(var e=[],k=0;k<c;){if(!e[k]){var h=b[k];if(0<=h)if(e[h])XML3D.math.mat4.multiplyOffset(d,16*k,a,16*k,d,16*h);else{for(;0<=b[h]&&!e[b[h]];)h=b[h];if(0<=b[h])XML3D.math.mat4.multiplyOffset(d,16*h,a,16*h,d,16*b[h]);else for(var g=0;16>g;g++)d[16*h+g]=a[16*h+g];e[h]=!0;continue}else for(g=
0;16>g;g++)d[16*k+g]=a[16*k+g];e[k]=!0}k++}}})},{}],165:[function(e,m,l){Xflow.registerOperator("xflow.forwardKinematicsInv",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"parent",array:!0},{type:"float4x4",source:"xform",array:!0}],alloc:function(d,b,a){b=Math.min(b.length,a.length/16);d.result=b},evaluate:function(d,b,a,c){c=a.length/16;for(var e=[],k=0;k<c;){if(!e[k]){var h=b[k];if(0<=h)if(e[h])XML3D.math.mat4.multiplyOffset(d,16*k,d,16*h,a,16*k);else{for(;0<=
b[h]&&!e[b[h]];)h=b[h];if(0<=b[h])XML3D.math.mat4.multiplyOffset(d,16*h,d,16*b[h],a,16*h);else for(var g=0;16>g;g++)d[16*h+g]=a[16*h+g];e[h]=!0;continue}else for(g=0;16>g;g++)d[16*k+g]=a[16*k+g];e[k]=!0}k++}}})},{}],166:[function(e,m,l){Xflow.registerOperator("xflow.funMirrorImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(d,b,a){var c=d.width,e=d.height;a=a[0];b=b.data;d=d.data;for(var k=0;k<e;++k)for(var h=
0;h<c;++h){var g=h/c,l=k/e,g=2*g-1,r=2*l-1,l=Math.sqrt(g*g+r*r),r=Math.atan2(r,g),l=Math.pow(l,1/1.8)*a,g=l*Math.cos(r),r=l*Math.sin(r),g=g/2+.5,l=r/2+.5,g=Math.round(g*c),g=4*(Math.round(l*e)*c+g),l=b[g],r=b[g+1],n=b[g+2],p=b[g+3],g=4*(k*c+h);d[g]=l;d[g+1]=r;d[g+2]=n;d[g+3]=p}return!0}})},{}],167:[function(e,m,l){function d(b,a,c,d){for(var e=0;e<c.length;++e)for(var h=c[e]*d,g=d;g--;)b[e*d+g]=a[h+g]}Xflow.registerOperator("xflow.get",{outputs:[{type:"float",name:"result"}],params:[{type:"float",
source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float2",name:"result"}],params:[{type:"float2",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,2)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,4)}});Xflow.registerOperator("xflow.get",
{outputs:[{type:"float4",name:"result"}],params:[{type:"float4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,4)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,16)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"int",name:"result"}],params:[{type:"int",source:"value",array:!0},{type:"int",source:"index"}],
evaluate:function(b,a,c,e){d(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"bool",name:"result"}],params:[{type:"bool",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"byte",name:"result"}],params:[{type:"byte",source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,1)}});Xflow.registerOperator("xflow.get",{outputs:[{type:"ubyte",name:"result"}],params:[{type:"ubyte",
source:"value",array:!0},{type:"int",source:"index"}],evaluate:function(b,a,c,e){d(b,a,c,1)}})},{}],168:[function(e,m,l){Xflow.registerOperator("xflow.grayscaleImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(d,b){for(var a=b.data,c=d.data,e=0;e<a.length;e+=4){var k=a[e+3];c[e]=c[e+1]=c[e+2]=.2126*a[e]+.7152*a[e+1]+.0722*a[e+2];c[e+3]=k}return!0}})},{}],169:[function(e,m,l){e("./add.js");e("./bufferSelect.js");e("./clampImage.js");
e("./convoluteImage.js");e("./createIGIndex.js");e("./createTransform.js");e("./createTransformInv.js");e("./debug.js");e("./flipNormal.js");e("./flipVerticalImage.js");e("./forwardKinematics.js");e("./forwardKinematicsInv.js");e("./funMirrorImage.js");e("./get.js");e("./grayscaleImage.js");e("./lerp3seq.js");e("./magnitudeImage.js");e("./merge3.js");e("./morph3.js");e("./mul4x4.js");e("./noiseImage.js");e("./normalize3.js");e("./popartImage.js");e("./rgbePNGtoFloat.js");e("./selectBool.js");e("./selectTransform.js");
e("./sepiaImage.js");e("./skinDirection.js");e("./skinPosition.js");e("./slerpseq.js");e("./sobelImage.js");e("./sub3.js")},{"./add.js":154,"./bufferSelect.js":155,"./clampImage.js":156,"./convoluteImage.js":157,"./createIGIndex.js":158,"./createTransform.js":159,"./createTransformInv.js":160,"./debug.js":161,"./flipNormal.js":162,"./flipVerticalImage.js":163,"./forwardKinematics.js":164,"./forwardKinematicsInv.js":165,"./funMirrorImage.js":166,"./get.js":167,"./grayscaleImage.js":168,"./lerp3seq.js":170,
"./magnitudeImage.js":171,"./merge3.js":172,"./morph3.js":173,"./mul4x4.js":174,"./noiseImage.js":175,"./normalize3.js":176,"./popartImage.js":177,"./rgbePNGtoFloat.js":178,"./selectBool.js":179,"./selectTransform.js":180,"./sepiaImage.js":181,"./skinDirection.js":182,"./skinPosition.js":183,"./slerpseq.js":184,"./sobelImage.js":185,"./sub3.js":186}],170:[function(e,m,l){var d=e("../../utils/utils").binarySearch;e=e("../../interface/constants.js");Xflow.registerOperator("xflow.lerpSeq",{outputs:[{type:"float3",
name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:e.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:e.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:e.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_core:function(b,a,c,d){var e=1-d[0];b[0]=e*a[0]+d[0]*c[0];b[1]=e*a[1]+d[0]*c[1];b[2]=e*a[2]+d[0]*c[2]}});Xflow.registerOperator("xflow.lerpSeqAsync",
{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:e.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:e.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:e.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate_async:function(b,a,c,d,e,h){for(var g=e.iterateCount,l,r,n;g--;){l=3*(e.iterFlag[0]?g:0);r=3*(e.iterFlag[1]?g:0);n=e.iterFlag[2]?
g:0;var p=1-d[n];b[3*g]=p*a[l]+d[n]*c[r];b[3*g+1]=p*a[l+1]+d[n]*c[r+1];b[3*g+2]=p*a[l+2]+d[n]*c[r+2]}window.setTimeout(h,200)}});Xflow.registerOperator("xflow.lerpKeys",{outputs:[{type:"float3",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float3",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(b,a,c,d){b.result=3},evaluate:function(b,a,c,e){var k=Math.min(a.length,Math.floor(c.length/3)),h=d(a,e[0],k);0>h||h==k-1?(h=Math.max(0,h),b[0]=c[3*h],b[1]=c[3*
h+1],b[2]=c[3*h+2]):(a=(e[0]-a[h])/(a[h+1]-a[h]),e=1-a,b[0]=e*c[3*h]+a*c[3*h+3],b[1]=e*c[3*h+1]+a*c[3*h+4],b[2]=e*c[3*h+2]+a*c[3*h+5])}})},{"../../interface/constants.js":149,"../../utils/utils":200}],171:[function(e,m,l){Xflow.registerOperator("xflow.magnitudeImage",{outputs:[{type:"texture",name:"result",sizeof:"image1"}],params:[{type:"texture",source:"image1"},{type:"texture",source:"image2"}],evaluate:function(d,b,a){b=b.data;a=a.data;d=d.data;for(var c=b.length,e=0;e<c;e+=1){var k=b[e],h=a[e];
d[e]=Math.sqrt(k*k+h*h)}return!0}})},{}],172:[function(e,m,l){Xflow.registerOperator("xflow.merge3",{outputs:[{name:"result",tupleSize:"16"}],params:["value1","value2","value3"],evaluate:function(d,b,a){if(!(d&&b&&a))throw"Xflow::morph3: Not all parameters are set";var c=d.length+b.length+a.length;this.tmp&&this.tmp.length==c||(this.tmp=new Float32Array(c));this.tmp.set(d);this.tmp.set(b,d.length);this.tmp.set(a,d.length+b.length);this.result.result=this.tmp;return!0}});Xflow.registerOperator("xflow.merge8",
{outputs:[{name:"result",tupleSize:"16"}],params:"value1 value2 value3 value4 value5 value6 value7 value8".split(" "),evaluate:function(d,b,a,c,e,k,h,g){if(!(d&&b&&a&&c&&e&&k&&h&&g))throw"Xflow::morph3: Not all parameters are set";var l=d.length+b.length+a.length+c.length+e.length+k.length+h.length+g.length;this.tmp&&this.tmp.length==l||(this.tmp=new Float32Array(l));l=0;this.tmp.set(d,l);this.tmp.set(b,l+=d.length);this.tmp.set(a,l+=b.length);this.tmp.set(c,l+=a.length);this.tmp.set(e,l+=c.length);
this.tmp.set(k,l+=e.length);this.tmp.set(h,l+=k.length);this.tmp.set(g,l+h.length);this.result.result=this.tmp;return!0}})},{}],173:[function(e,m,l){Xflow.registerOperator("xflow.morph",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"},{type:"float3",source:"valueAdd"},{type:"float",source:"weight"}],evaluate:function(d,b,a,c,e){for(var k=0;k<e.iterateCount;k++){var h=c[e.iterFlag[2]?k:0];d[3*k]=b[e.iterFlag[0]?3*k:0]+h*a[e.iterFlag[1]?3*k:0];d[3*k+1]=b[e.iterFlag[0]?
3*k+1:1]+h*a[e.iterFlag[1]?3*k+1:1];d[3*k+2]=b[e.iterFlag[0]?3*k+2:2]+h*a[e.iterFlag[1]?3*k+2:2]}return!0},evaluate_core:function(d,b,a,c){d[0]=b[0]+c[0]*a[0];d[1]=b[1]+c[0]*a[1];d[2]=b[2]+c[0]*a[2]}})},{}],174:[function(e,m,l){Xflow.registerOperator("xflow.mul",{outputs:[{type:"float4x4",name:"result"}],params:[{type:"float4x4",source:"value1"},{type:"float4x4",source:"value2"}],evaluate:function(d,b,a,c){for(var e=0;e<c.iterateCount;e++)XML3D.math.mat4.multiplyOffset(d,16*e,b,c.iterFlag[0]?16*e:
0,a,c.iterFlag[1]?16*e:0)}})},{}],175:[function(e,m,l){Xflow.registerOperator("xflow.noiseImage",{outputs:[{type:"texture",name:"image",customAlloc:!0}],params:[{type:"int",source:"width"},{type:"int",source:"height"},{type:"float2",source:"scale"},{type:"float",source:"minFreq"},{type:"float",source:"maxFreq"}],alloc:function(d,b,a,c,e,k){c=new Xflow.SamplerConfig;c.setDefaults();d.image={imageFormat:{width:b[0],height:a[0]},samplerConfig:c}},evaluate:function(d,b,a,c,e,k){b=b[0];a=a[0];e=e[0];k=
k[0];d=d.data;for(var h=this.noise=this.noise||new SimplexNoise,g=0!=e&&0!=k&&e<k,l=0;l<a;++l)for(var r=l/a*c[1],n=1/b,p=0;p<b;++p){var t=p*n*c[0],m;if(g){m=k;for(var u=r,v=0,w=e;w<m;w*=2)v+=Math.abs(h.noise(t*w,u*w))/w;m=v}else m=h.noise(t,r);t=4*(p*b+l);d[t]=Math.floor(255*m);d[t+1]=Math.floor(255*m);d[t+2]=Math.floor(255*m);d[t+3]=255}return!0}})},{}],176:[function(e,m,l){Xflow.registerOperator("xflow.normalize",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value"}],evaluate:function(d,
b,a){for(var c=0;c<a.iterateCount;c++){var e=3*c,k=b[e],h=b[e+1],g=b[e+2],l=1/Math.sqrt(k*k+h*h+g*g);d[e]=k*l;d[e+1]=h*l;d[e+2]=g*l}}})},{}],177:[function(e,m,l){Xflow.registerOperator("xflow.popartImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"},{type:"float",source:"time"}],evaluate:function(d,b,a){b=b.data;d=d.data;for(a=0;a<b.length;a+=4){var c=b[a]/255*.3+b[a+1]/255*.59+b[a+2]/255*.11,c=.3>c?0:.6>c?.5:1;.5==c?(d[a]=204,d[a+1]=0):1==c?(d[a]=
229.5,d[a+1]=229.5):(d[a]=0,d[a+1]=0);d[a+2]=0;d[a+3]=b[a+3]}return!0}})},{}],178:[function(e,m,l){var d=e("../../interface/data.js").SamplerConfig,b=e("../../interface/constants.js");Xflow.registerOperator("xflow.rgbePNGtoFloat",{outputs:[{type:"texture",name:"result",customAlloc:!0}],params:[{type:"texture",source:"image"}],alloc:function(a,c){var e=new d;e.setDefaults();e.minFilter=b.TEX_FILTER_TYPE.NEAREST;e.magFilter=b.TEX_FILTER_TYPE.NEAREST;a.result={imageFormat:{width:c.width,height:c.height,
texelType:b.TEXTURE_TYPE.FLOAT,texelFormat:b.TEXTURE_FORMAT.RGB},samplerConfig:e}},evaluate:function(a,b){for(var d=0;d<b.data.length;d+=4){var e=b.data.subarray(d,d+4),h=0,g=e[3];0<g&&(h=Math.pow(2,g-136));g=new Float32Array(3);g[0]=e[0]*h;g[1]=e[1]*h;g[2]=e[2]*h;a.data.set(g,d/4*3)}return!0}})},{"../../interface/constants.js":149,"../../interface/data.js":150}],179:[function(e,m,l){Xflow.registerOperator("xflow.selectBool",{outputs:[{type:"bool",name:"result",customAlloc:!0}],params:[{type:"int",
source:"index"},{type:"bool",source:"value"}],alloc:function(d,b,a){d.result=1},evaluate:function(d,b,a){b=b[0];d[0]=b<a.length?a[b]:!1}})},{}],180:[function(e,m,l){Xflow.registerOperator("xflow.selectTransform",{outputs:[{type:"float4x4",name:"result",customAlloc:!0}],params:[{type:"int",source:"index"},{type:"float4x4",source:"transform"}],alloc:function(d,b,a){d.result=1},evaluate:function(d,b,a){b=16*b[0];b<a.length&&b+15<a.length?(d[0]=a[b+0],d[1]=a[b+1],d[2]=a[b+2],d[3]=a[b+3],d[4]=a[b+4],d[5]=
a[b+5],d[6]=a[b+6],d[7]=a[b+7],d[8]=a[b+8],d[9]=a[b+9],d[10]=a[b+10],d[11]=a[b+11],d[12]=a[b+12],d[13]=a[b+13],d[14]=a[b+14],d[15]=a[b+15]):(d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=0,d[13]=0,d[14]=0,d[15]=1)}})},{}],181:[function(e,m,l){Xflow.registerOperator("xflow.sepiaImage",{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(d,b){for(var a=b.data,c=d.data,e=0,k=0,h=0,g=0;g<a.length;g+=
4)e=.393*a[g]+.769*a[g+1]+.189*a[g+2],k=.349*a[g]+.686*a[g+1]+.168*a[g+2],h=.272*a[g]+.534*a[g+1]+.131*a[g+2],255<e&&(e=255),255<k&&(k=255),255<h&&(h=255),0>e&&(e=0),0>k&&(k=0),0>h&&(h=0),c[g]=e,c[g+1]=k,c[g+2]=h,c[g+3]=255;return!0}})},{}],182:[function(e,m,l){Xflow.registerOperator("xflow.skinDirection",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"dir"},{type:"int4",source:"boneIdx"},{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(d,
b,a,c,e,k){for(var h=XML3D.math.vec3,g=XML3D.math.mat4,l=h.create(),r=h.create(),n=0;n<k.iterateCount;++n){for(var p=3*n,t=l[0]=l[1]=l[2]=0;4>t;t++){var m=c[k.iterFlag[2]?4*n+t:t];m&&(g.multiplyOffsetDirection(e,16*a[k.iterFlag[1]?4*n+t:t],b,p,r),h.scale(r,r,m),h.add(l,l,r))}h.normalize(l,l);d[p]=l[0];d[p+1]=l[1];d[p+2]=l[2]}}})},{}],183:[function(e,m,l){Xflow.registerOperator("xflow.skinPosition",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"pos"},{type:"int4",source:"boneIdx"},
{type:"float4",source:"boneWeight"},{type:"float4x4",source:"boneXform",array:!0}],evaluate:function(d,b,a,c,e,k){for(var h=XML3D.math.vec3,g=XML3D.math.mat4,l=h.create(),r=h.create(),n=0;n<k.iterateCount;++n){for(var p=3*n,t=l[0]=l[1]=l[2]=0;4>t;t++){var m=c[k.iterFlag[2]?4*n+t:t];m&&(g.multiplyOffsetVec3(e,16*a[k.iterFlag[1]?4*n+t:t],b,p,r),h.scale(r,r,m),h.add(l,l,r))}d[p]=l[0];d[p+1]=l[1];d[p+2]=l[2]}}})},{}],184:[function(e,m,l){var d=e("../../utils/utils").binarySearch;e=e("../../interface/constants.js");
Xflow.registerOperator("xflow.slerpSeq",{outputs:[{type:"float4",name:"result"}],params:[{type:"float4",source:"sequence"},{type:"float",source:"key"}],mapping:[{name:"value1",source:"sequence",sequence:e.SEQUENCE.PREV_BUFFER,keySource:"key"},{name:"value2",source:"sequence",sequence:e.SEQUENCE.NEXT_BUFFER,keySource:"key"},{name:"weight",source:"sequence",sequence:e.SEQUENCE.LINEAR_WEIGHT,keySource:"key"}],evaluate:function(b,a,c,d,e){for(var h=0;h<e.iterateCount;++h)XML3D.math.quat.slerpOffset(a,
e.iterFlag[0]?4*h:0,c,e.iterFlag[1]?4*h:0,d[0],b,4*h,!0)}});Xflow.registerOperator("xflow.slerpKeys",{outputs:[{type:"float4",name:"result"}],params:[{type:"float",source:"keys",array:!0},{type:"float4",source:"values",array:!0},{type:"float",source:"key"}],alloc:function(b,a,c,d){b.result=4},evaluate:function(b,a,c,e){var k=Math.min(a.length,Math.floor(c.length/4)),h=d(a,e[0],k);0>h||h==k-1?(h=Math.max(0,h),b[0]=c[4*h],b[1]=c[4*h+1],b[2]=c[4*h+2],b[3]=c[4*h+3]):XML3D.math.quat.slerpOffset(c,4*h,
c,4*(h+1),(e[0]-a[h])/(a[h+1]-a[h]),b,0,!0)}})},{"../../interface/constants.js":149,"../../utils/utils":200}],185:[function(e,m,l){function d(a,b,d,e){var g=new Float32Array(4);switch(arguments.length){case 0:g[0]=0;g[1]=0;g[2]=0;g[3]=0;break;case 1:g[0]=a;g[1]=a;g[2]=a;g[3]=a;break;case 2:g[0]=a;g[1]=b;g[2]=0;g[3]=0;break;case 3:g[0]=a;g[1]=b;g[2]=d;g[3]=0;break;default:g[0]=a,g[1]=b,g[2]=d,g[3]=e}return g}function b(a,b){return Math.sqrt(a*a+b*b)}function a(a,b,d,e){d=4*(e*b.width+d);b=b.data;a[0]=
b[d]/255;a[1]=b[d+1]/255;a[2]=b[d+2]/255;a[3]=b[d+3]/255;return a}(function(){Xflow.Filters={};var a=null,b=null;Xflow.Filters.createImageData=function(d,e){a||(a=document.createElement("canvas"));b||(b=a.getContext("2d"));return b.createImageData(d,e)};Xflow.Filters.createImageDataFloat32=function(a,b){return{width:a,height:b,data:new Float32Array(a*b*4)}};Xflow.Filters.grayscale=function(a,b,c){c=a.data;b=b.data;for(var d=0;d<c.length;d+=4){var e=c[d+3];b[d]=b[d+1]=b[d+2]=.2126*c[d]+.7152*c[d+1]+
.0722*c[d+2];b[d+3]=e}return a};Xflow.Filters.convolute=function(a,b,c,d){var e=Math.round(Math.sqrt(c.length)),f=Math.floor(e/2),l=a.data,t=a.width;a=a.height;var m=b.data;d=d?1:0;for(var u=0;u<a;u++)for(var v=0;v<t;v++){for(var w=u,z=v,y=4*(u*t+v),E=0,C=0,A=0,B=0,D=0;D<e;D++)for(var H=0;H<e;H++){var F=w+D-f,G=z+H-f;0<=F&&F<a&&0<=G&&G<t&&(F=4*(F*t+G),G=c[D*e+H],E+=l[F]*G,C+=l[F+1]*G,A+=l[F+2]*G,B+=l[F+3]*G)}m[y]=E;m[y+1]=C;m[y+2]=A;m[y+3]=B+d*(255-B)}return b}})();Xflow.registerOperator("xflow.sobelImage",
{outputs:[{type:"texture",name:"result",sizeof:"image"}],params:[{type:"texture",source:"image"}],evaluate:function(c,e){for(var k=e.width,h=e.height,g=d(0),l=d(0),m=d(),m=d(),n=d(),p=d(),t=d(),x=d(),u=d(),v=d(),w=d(),z=d(),y=d(),E=0;E<h;++E)for(var C=0;C<k;++C)if(1<=C&&C<k-1&&1<=E&&E<h-1){a(m,e,C-1,E-1);a(n,e,C,E-1);a(p,e,C+1,E-1);a(t,e,C-1,E);a(x,e,C,E);a(u,e,C+1,E);a(v,e,C-1,E+1);a(w,e,C,E+1);a(z,e,C+1,E+1);g[0]=m[0]+2*n[0]+p[0]-v[0]-2*w[0]-z[0];g[1]=m[1]+2*n[1]+p[1]-v[1]-2*w[1]-z[1];g[2]=m[2]+
2*n[2]+p[2]-v[2]-2*w[2]-z[2];l[0]=m[0]-p[0]+2*t[0]-2*u[0]+v[0]-z[0];l[1]=m[1]-p[1]+2*t[1]-2*u[1]+v[1]-z[1];l[2]=m[2]-p[2]+2*t[2]-2*u[2]+v[2]-z[2];var A=y,B=g,D=l;A[0]=b(B[0],D[0]);A[1]=b(B[1],D[1]);A[2]=b(B[2],D[2]);A[3]=b(B[3],D[3]);y[0]/=2;y[1]/=2;y[2]/=2;y[3]=1;A=y;B=4*(E*c.width+C);D=c.data;D[B]=255*A[0];D[B+1]=255*A[1];D[B+2]=255*A[2];D[B+3]=255*A[3]}return!0}})},{}],186:[function(e,m,l){Xflow.registerOperator("xflow.sub",{outputs:[{type:"float3",name:"result"}],params:[{type:"float3",source:"value1"},
{type:"float3",source:"value2"}],evaluate:function(d,b,a,c){throw"Not used!";},evaluate_core:function(d,b,a){d[0]=b[0]-a[0];d[1]=b[1]-a[1];d[2]=b[2]-a[2]}})},{}],187:[function(e,m,l){e=function(d){this.index=0;this.operator=d;this.inputInfo=[];this.outputInfo=[]};e.prototype.isTransferInput=function(d){return void 0!==this.inputInfo[d].operatorIndex};e.prototype.getTransferInputOperatorIndex=function(d){return this.inputInfo[d].operatorIndex};e.prototype.getTransferInputOutputIndex=function(d){return this.inputInfo[d].outputIndex};
e.prototype.getTransferInputId=function(d){d=this.inputInfo[d];return d.operatorIndex+"_"+d.outputIndex};e.prototype.getTransferOutputId=function(d){return this.index+"_"+d};e.prototype.getInputMappingName=function(d){return this.inputInfo[d].mappedName};e.prototype.getDirectInputIndex=function(d){return this.inputInfo[d].inputIndex};e.prototype.getOutputIndex=function(d){return this.outputInfo[d].finalOut||this.outputInfo[d].lost||0};e.prototype.isFinalOutput=function(d){return this.outputInfo[d]&&
void 0!==this.outputInfo[d].finalOut};e.prototype.isTransferOutput=function(d){return this.outputInfo[d]&&this.outputInfo[d].transfer};e.prototype.isLostOutput=function(d){return this.outputInfo[d]&&void 0!==this.outputInfo[d].lost};e.prototype.setTransferInput=function(d,b,a){this.inputInfo[d]={operatorIndex:b,outputIndex:a}};e.prototype.setDirectInput=function(d,b,a){this.inputInfo[d]={inputIndex:b,mappedName:a}};e.prototype.setFinalOutput=function(d,b){this.outputInfo[d]={finalOut:b}};e.prototype.setTransferOutput=
function(d){this.outputInfo[d]={transfer:!0}};e.prototype.setLostOutput=function(d,b){this.outputInfo[d]={lost:b}};e.prototype.getKey=function(){for(var d=this.operator.name+"*O",b=0;b<this.outputInfo.length;++b)var a=this.outputInfo[b],d=d+("*"+(a.transfer?"_":a.finalOut||a.lost+"?"));d+=NaN;for(b=0;b<this.inputInfo.length;++b)a=this.inputInfo[b],d+="*"+(a.inputIndex?a.inputInfo:a.operatorIndex+">"+a.outputIndex);return d};m.exports=e},{}],188:[function(e,m,l){var d=e("../interface/constants.js");
e("../base.js");e=function(a){this.platform=a;this.entries=[];this.inputInfo={}};e.prototype.addEntry=function(a){a.index=this.entries.length;this.entries.push(a)};e.prototype.getKey=function(){for(var a=[],b=0;b<this.entries.length;++b)a.push(this.entries[b].getKey());a=this.platform+">"+a.join("!")+"|";for(b in this.inputInfo)a+=b+">"+(this.inputInfo[b].iterate||0)+"x"+(this.inputInfo[b].size||0);return a};e.prototype.setInputIterateType=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].iterate=
b};e.prototype.setInputSize=function(a,b){this.inputInfo[a]||(this.inputInfo[a]={});this.inputInfo[a].size=b};e.prototype.isInputIterate=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==d.ITERATION_TYPE.MANY};e.prototype.isInputUniform=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==d.ITERATION_TYPE.ONE};e.prototype.isInputNull=function(a){return this.inputInfo[a]&&this.inputInfo[a].iterate==d.ITERATION_TYPE.NULL};e.prototype.getInputIterateType=function(a){return this.inputInfo[a]&&
this.inputInfo[a].iterate};e.prototype.getInputSize=function(a){return this.inputInfo[a]&&this.inputInfo[a].size||0};e.prototype.getIterateCount=function(a){for(var b=-1,d=0;d<a.inputs.length;++d)if(this.isInputIterate(d)){var e=a.getDataEntry(d);e&&e.getIterateCount&&(e=e.getIterateCount(),b=0>b?e:Math.min(e,b))}return 0>b?1:b};var b={};e.prototype.allocateOutput=function(a,c){for(var e=0;e<this.entries.length;++e){var k=this.entries[e],h=k.operator,g=a.operatorData[e],l=this.getIterateCount(a);
if(h.alloc){for(var m=[b],n=m,p=k,t=a,x=p.operator.mapping,u=0;u<x.length;++u){var v=t.getDataEntry(p.getDirectInputIndex(u));n.push(v?v.getValue():null)}m.push(l);h.alloc.apply(g,m)}for(g=0;g<h.outputs.length;++g)if(n=h.outputs[g],m=a.outputs[k.getOutputIndex(g)],m=c?m.asyncDataEntry:m.dataEntry,!n.noAlloc)if(m.type==d.DATA_TYPE.TEXTURE)if(n.customAlloc)n=b[n.name],p=n.imageFormat.width,t=n.imageFormat.height,x=n.imageFormat.texelType,u=n.imageFormat.texelFormat,n=n.samplerConfig,m._createImage(p,
t,u,x,n);else if(n.sizeof){v=null;for(p=0;p<h.mapping.length;++p)if(h.mapping[p].source==n.sizeof){v=a.getDataEntry(k.getDirectInputIndex(p));break}if(v)p=Math.max(v.width,1),t=Math.max(v.height,1),u=n.texelFormat||v.texelFormat,x=n.texelType||v.texelType,n=n.samplerConfig||v.getSamplerConfig(),m._createImage(p,t,u,x,n);else throw Error("Unknown texture input parameter '"+n.sizeof+"' in operator '"+h.name+"'");}else throw Error("Cannot create texture. Use customAlloc or sizeof parameter attribute");
else if(n=(n.customAlloc?b[n.name]:l)*m.getTupleSize(),m._value&&m._value.length==n)m._notifyChanged();else switch(m.type){case d.DATA_TYPE.FLOAT:case d.DATA_TYPE.FLOAT2:case d.DATA_TYPE.FLOAT3:case d.DATA_TYPE.FLOAT4:case d.DATA_TYPE.FLOAT4X4:m._setValue(new Float32Array(n));break;case d.DATA_TYPE.INT:case d.DATA_TYPE.INT4:case d.DATA_TYPE.BOOL:m._setValue(new Int32Array(n));break;default:XML3D.debug.logWarning("Could not allocate output buffer of TYPE: "+m.type)}}};m.exports=e},{"../base.js":148,
"../interface/constants.js":149}],189:[function(e,m,l){function d(a){for(var d={},e=0;e<a.outputs.length;++e)a.outputs[e].type=b.DATA_TYPE_MAP[a.outputs[e].type];for(e=0;e<a.params.length;++e)a.params[e].type=b.DATA_TYPE_MAP[a.params[e].type],d[a.params[e].source]=e;a.mapping||(a.mapping=a.params);for(e=0;e<a.mapping.length;++e){var h=a.mapping[e],g=d[h.source];h.paramIdx=g;g=a.params[g].type;h.sequence&&(h.keyParamIdx=d[h.keySource]);h.sequence==b.SEQUENCE.LINEAR_WEIGHT&&(g=b.DATA_TYPE.FLOAT);h.internalType=
g;h.name=h.name||h.source}a.platform=a.platform||b.PLATFORM.JAVASCRIPT}e("../base.js");var b=e("../interface/constants.js"),a={};m.exports={registerOperator:function(c,e){var k,h;d(e);a[c]||(a[c]={});h=e.platform||b.PLATFORM.JAVASCRIPT;k=a[c];c?e?(e.name=c,k[h]||(k[h]=[]),k[h].push(e)):XML3D.logWarning("Xflow.registerOperator: Operator data undefined."):XML3D.logWarning("Xflow.registerOperator: Operator name undefined.")},initAnonymousOperator:function(a,b){d(b);b.name=a;return b},isOperatorAsync:function(a){return!!a.evaluate_async},
getOperators:function(c,d){d=d||b.PLATFORM.JAVASCRIPT;return c&&!a[c]||!a[c][d]||0==a[c][d].length?null:a[c][d]}}},{"../base.js":148,"../interface/constants.js":149}],190:[function(e,m,l){function d(a,b,c,d){var e=f(a,b,!0);e.push(c);e.push(function(){k(a,b,e,!0);d()});a.operator.evaluate_async.apply(c,e)}function b(b,d){var e="function (",g=a(b.evaluate_core),e=e+(g.args.join(",")+",__xflowMax) {\n"),e=e+"    var __xflowI = __xflowMax\n    while(__xflowI--){\n",f=g.body,f=c(f,g.args,b,d);return eval("("+
(e+(f+"\n  }\n}"))+")")}function a(a){var b={},c=a.toString().match(t);if(!c)return h.notifyError("Xflow Internal: Could not parse function: "+a),null;b.args=c[2].split(",");for(var d in b.args)b.args[d]=b.args[d].trim();b.body=c[3];return b}function c(a,b,c,d){for(var e="",f=0,h=a.indexOf("[",f);-1!=h;){var k=a.substr(f).match(x)[1],l=b.indexOf(k),k=!1,p=0;-1!=l&&(l<c.outputs.length?(k=!0,p=g.DATA_TYPE_TUPLE_SIZE[[c.outputs[l].type]]):(l-=c.outputs.length,k=d.iterFlag[l],p=g.DATA_TYPE_TUPLE_SIZE[c.mapping[l].internalType]));
e+=a.substring(f,h)+"[";k&&(e+=p+"*__xflowI + ");f=h+1;h=a.indexOf("[",f)}return e+=a.substring(f)}function f(a,b,c){for(var d=[],e=a.operator.outputs,g=0;g<e.length;++g)if(e[g].noAlloc)d.push({assign:null});else{var f=b.outputs[a.getOutputIndex(g)],f=c?f.asyncDataEntry:f.dataEntry;d.push(f?f.getValue():null)}c=a.operator.mapping;for(e=0;e<c.length;++e)g=b.getDataEntry(a.getDirectInputIndex(e)),d.push(g?g.getValue():null);return d}function k(a,b,c,d){for(var e=a.operator.outputs,f=0;f<e.length;++f){var h=
b.outputs[a.getOutputIndex(f)];if(e[f].noAlloc){var k=d?h.asyncDataEntry:h.dataEntry;k.type==g.DATA_TYPE.TEXTURE?k._setImage(c[f].assign):k._setValue(c[f].assign)}d&&h.swapAsync()}}var h=e("../base.js"),g=e("../interface/constants.js"),q=e("./vs-program.js"),r=e("./cl-program.js");e=function(){this.inputs=[];this.outputs=[];this.operatorData=[]};e.prototype.getChannel=function(a){return this.inputs[a].channel};e.prototype.getDataEntry=function(a){a=this.inputs[a];var b=a.channel;if(!b)return null;
var c=0;a.sequenceKeySourceChannel&&(c=(c=a.sequenceKeySourceChannel.getDataEntry())&&c._value?c._value[0]:0);return b.getDataEntry(a.sequenceAccessType,c)};l=function(){this.channel=null;this.arrayAccess=!1;this.sequenceAccessType=g.SEQUENCE.NO_ACCESS;this.sequenceKeySourceChannel=null};l.prototype.getKey=function(){return(this.channel?this.channel.id:"NULL")+";"+this.arrayAccess+";"+this.sequenceAccessType+";"+(this.sequenceKeySourceChannel?this.sequenceKeySourceChannel.id:"")};var n={},p=function(a){this.list=
a;this.entry=a.entries[0];this.operator=this.entry.operator;this._inlineLoop=null};p.prototype.run=function(a,c){var e=this.list,g=a.operatorData[0],h=e.entries[0],l=h.operator.mapping;g.iterFlag={};for(var p=0;p<l.length;++p){var t=h.isTransferInput(p)||e.isInputIterate(h.getDirectInputIndex(p));g.iterFlag[p]=t}g.iterateCount=e.getIterateCount(a);g.customData||(g.customData={});c?d(this.entry,a,g,c):this.operator.evaluate_core?(e=f(this.entry,a),e.push(g.iterateCount),this._inlineLoop||(this._inlineLoop=
b(this.operator,g)),this._inlineLoop.apply(g,e)):(e=this.entry,h=f(e,a),h.push(g),e.operator.evaluate.apply(g,h),k(e,a,h,!1))};var t=/function\s*([^(]*)\(([^)]*)\)\s*\{([\s\S]*)\}/,x=/([a-zA-Z_$][\w$]*)(\[)/;m.exports={createProgram:function(a){var b;if(0===a.entries.length)return null;b=a.entries[0].operator;var c=a.getKey();n[c]||(a.platform===g.PLATFORM.GLSL?n[c]=new q(a):b.platform===g.PLATFORM.CL?n[c]=new r(a):b.platform===g.PLATFORM.JAVASCRIPT&&1===a.entries.length?n[c]=new p(a):h.notifyError("Could not create program from operatorList"));
return n[c]},ProgramData:e,ProgramInputConnection:l}},{"../base.js":148,"../interface/constants.js":149,"./cl-program.js":153,"./vs-program.js":191}],191:[function(e,m,l){function d(a,c,d,e,f){for(var k,l=c.operator;-1!=(k=a.indexOf("#I{"));){var m=a.indexOf("}",k),u;a:{u=a.substring(k+3,m);for(var v=0;v<l.mapping.length;++v)if(l.mapping[v].name==u){u=v;break a}throw Error("Invalid input name '"+u+"' inside of code fragment");}u=c.isTransferInput(u)?d[c.getTransferInputId(u)]:e[c.getDirectInputIndex(u)];
a=a.substring(0,k)+u+a.substring(m+1)}for(;-1!=(k=a.indexOf("#O{"));){m=a.indexOf("}",k);a:{e=a.substring(k+3,m);for(u=0;u<l.outputs.length;++u)if(l.outputs[u].name==e){e=u;break a}e=void 0}u=d[c.getTransferOutputId(e)];a=a.substring(0,k)+u+a.substring(m+1)}for(c=[];-1!=(k=a.indexOf("#L{"));)m=a.indexOf("}",k),d=a.substring(k+3,m),c[d]||(c[d]=b(d,f)),u=c[d],a=a.substring(0,k)+u+a.substring(m+1);for(;-1!=(k=a.indexOf("#G{"));)m=a.indexOf("}",k),u=a.substring(k+3,m),a=a.substring(0,k)+u+a.substring(m+
1);return a}function b(a,b){for(var c=a,d=1;-1!=b.indexOf(c);)c=a+"_"+ ++d;f.nameset.add(b,c);return c}function a(a){switch(a){case c.DATA_TYPE.BOOL:return"bool";case c.DATA_TYPE.BYTE:return"uint";case c.DATA_TYPE.FLOAT:return"float";case c.DATA_TYPE.FLOAT2:return"vec2";case c.DATA_TYPE.FLOAT3:return"vec3";case c.DATA_TYPE.FLOAT4:return"vec4";case c.DATA_TYPE.FLOAT3X3:return"mat3";case c.DATA_TYPE.FLOAT4X4:return"mat4";case c.DATA_TYPE.INT:return"int";case c.DATA_TYPE.INT4:return"ivec4"}throw Error("Type not supported for GLSL "+
c.getTypeName(a));}e("../base.js");var c=e("../interface/constants.js"),f=e("../utils/utils.js"),k=e("../processing/vs-connect.js").VertexShader;e=function(a){this.list=a;this._outputInfo={};a=this.list;for(var b=a.entries,b=b[b.length-1],d=b.operator,e=0;e<d.params.length;++e){var f=d.params[e],k=f.source,l=e,m=b.getDirectInputIndex(l);this._outputInfo[k]={type:f.type};b.isTransferInput(l)||a.isInputIterate(m)?this._outputInfo[k].iteration=c.ITERATION_TYPE.MANY:a.isInputUniform(m)?this._outputInfo[k].iteration=
c.ITERATION_TYPE.ONE:this._outputInfo[k].iteration=c.ITERATION_TYPE.NULL}};e.prototype.getOutputNames=function(){return Object.keys(this._outputInfo)};e.prototype.getOutputType=function(a){return this._outputInfo[a].type};e.prototype.isOutputUniform=function(a){return this._outputInfo[a].iteration==c.ITERATION_TYPE.ONE};e.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==c.ITERATION_TYPE.NULL};e.prototype.createVertexShader=function(e,g){var l=new k(e),m=this.list,n=m.entries,
p=[],t={},x={},u=n[n.length-1],v=[],w=u.operator;if(!g)throw Error("Could not find vsConfig! Attempt to create vertex shader programm without VS operator?");f.nameset.add(p,g.getBlockedNames());var z;z="// OUTPUT\n";for(var y in g._addOutput){var E=g._addOutput[y];z+="varying "+a(E.type)+" "+y+";\n";f.nameset.add(p,y)}var C=0;for(y in g._attributes){for(var E=g._attributes[y],A=u.getDirectInputIndex(C),B=0;B<E.channeling.length;++B){var D=E.channeling[B],H={type:E.type,iteration:0,index:0,sourceName:y},
F=D.outputName;D.code||u.isTransferInput(C)||m.isInputIterate(A)?(v[C]=!0,H.iteration=c.ITERATION_TYPE.MANY,z+="varying "+a(w.outputs[C].type)+" "+F+";\n",f.nameset.add(p,F),x[u.getTransferOutputId(B)]=F):m.isInputUniform(A)?(H.iteration=c.ITERATION_TYPE.ONE,H.index=A):H.iteration=c.ITERATION_TYPE.NULL;f.nameset.add(l._outputNames,F);l._outputInfo[F]=H}C++}z+="\n// INPUT\n";for(y in g._addInput)E=g._addInput[y],z+=(E.uniform?"uniform ":"attribute ")+a(E.type)+" "+y+";\n",f.nameset.add(p,y);for(B=
0;B<n.length;++B)for(E=n[B],D=E.operator,F=0;F<D.mapping.length;++F)!(B<n.length-1||v[F])||E.isTransferInput(F)||t[E.getDirectInputIndex(F)]||(w=D.mapping[F],y=b(w.name,p),C=E.getDirectInputIndex(F),A=!m.isInputIterate(C),l._inputInfo[y]={index:C,uniform:A},f.nameset.add(l._inputNames,y),t[C]=y,z+=(A?"uniform ":"attribute ")+a(w.internalType)+" "+y,w.array&&(z+="["+m.getInputSize(C)+"]"),z+=";\n");z+="\n// CODE\n";z+="void main(void){\n";for(B=0;B<n.length;++B){E=n[B];D=E.operator;for(F=0;F<D.outputs.length;++F)E.isFinalOutput(F)||
(y=b(D.outputs[F].name,p),x[E.getTransferOutputId(F)]=y,z+="\t"+a(D.outputs[F].type)+" "+y+";\n");m=d(D.evaluate_glsl,E,x,t,p);z+=m+"\n"}n=0;m="";for(y in g._attributes){E=g._attributes[y];for(B=0;B<E.channeling.length;++B)D=E.channeling[B],F=D.outputName,l._outputInfo[F].iteration==c.ITERATION_TYPE.MANY&&(m=D.code?m+("\t"+D.code+"\n"):m+("\t"+F+" = #I{"+y+"};\n"));n++}for(B=0;B<g._codeFragments.length;++B)m+="\t"+g._codeFragments[B]+"\n";z+=d(m,u,x,t,p)+"\n";z+="}\n";l._glslCode=z;return l};m.exports=
e},{"../base.js":148,"../interface/constants.js":149,"../processing/vs-connect.js":199,"../utils/utils.js":200}],192:[function(e,m,l){function d(a,b,d,e){var g,f;e&&(g=[],f=[]);for(var h=0;h<a.params.length;++h){var k=a.params[h],l=k.source,m=b?b.getScriptInputName(h,l):l,n;e&&(n="For "+(h+1)+". argument '"+l+"': ",g.push(c.getTypeName(k.type)+" "+l+(k.optional?" [optional]":"")));if(m){l=d.getChannel(m);if(!l&&!k.optional)if(e)f.push(n+"DataEntry '"+m+"' does not exist");else return!1;if(l&&l.getType()!=
k.type)if(e)f.push(n+"DataEntry '"+m+"' has wrong type '"+c.getTypeName(l.getType())+"'");else return!1}}e&&e.push(a.name+"("+g.join(", ")+")\n\t * "+f.join("\n\t * "));return!0}function b(a,b,c,d){var e=c.getChannel(d);a.addChannel(b,e,c.getChildDataIndex(d))}var a=e("../base.js"),c=e("../interface/constants.js");l=e("./channel.js");var f=e("./process-node.js").RequestNode,k=e("./process-node.js").ProcessNode,h=e("./data-slot.js"),g=e("../operator/operator.js"),q=l.ChannelMap;e=function(a,b){this.owner=
a;this.platform=c.PLATFORM.JAVASCRIPT;this.substitution=b;this.loading=!1;this.inputSlots={};this.inputChannels=new q;this.computedChannels=new q;this.outputChannels=new q;this.processNode=this.dataflowChannelNode=this.operator=null;this.requestNodes={};this.useCount=1;this.outOfSync=!0};e.prototype.synchronize=function(){if(this.outOfSync){var e;e=this.owner;this.owner._computeOperator&&(this.platform=e=null!==e._platform?e._platform:c.PLATFORM.JAVASCRIPT);e=this.owner;this.loading=e.isSubtreeLoading();
this.substitution&&e._channelNode.synchronize();if(e._sourceNode)e._sourceNode._getOrCreateChannelNode(this.substitution).synchronize();else for(var f=0;f<e._children.length;++f)e._children[f]._getOrCreateChannelNode&&e._children[f]._getOrCreateChannelNode(this.substitution).synchronize();e=this.owner;if(e._sourceNode)this.inputChannels.merge(e._sourceNode._getOrCreateChannelNode(this.substitution).outputChannels,0);else{e=e._children;for(f=0;f<e.length;++f)e[f]._getOrCreateChannelNode&&this.inputChannels.merge(e[f]._getOrCreateChannelNode(this.substitution).outputChannels,
f);for(f=0;f<e.length;++f)if(!e[f]._getOrCreateChannelNode){var l=e[f],m=l._name+";"+l._key;if(this.substitution)l._paramName&&this.substitution.hasChannel(l._paramName)?this.inputChannels.addChannel(l._name,this.substitution.getChannel(l._paramName)):this.inputChannels.addDataEntry(l._name,this.owner._channelNode.inputSlots[m]);else{var q=new h(l._data,l._key);this.inputSlots[m]=q;this.inputChannels.addDataEntry(l._name,q)}}}f=this.owner;this.computedChannels.merge(this.inputChannels);e=this.dataflowChannelNode;
if(f._computeUsesDataflow&&f._dataflowNode){this.operator=null;var w=this.owner,f=new n(w._dataflowNode,this);this.dataflowChannelNode=w._dataflowNode._getOrCreateChannelNode(f);w=this.owner;if(this.dataflowChannelNode)for(f=this.dataflowChannelNode,f.synchronize(),l=f.outputChannels.getNames(),m=0;m<l.length;++m){var z=q=l[m];w._computeOutputMapping&&(z=w._computeOutputMapping.getScriptOutputName(m,q));z&&this.computedChannels.addChannel(z,f.outputChannels.getChannel(q))}}else if(!f._computeUsesDataflow&&
f._computeOperator){this.dataflowChannelNode=null;l=this.owner;if(this.loading)this.operator=null;else if("string"==typeof l._computeOperator){f=l._computeOperator;m=null;if(f){a:{f=l._computeOperator;l=l._computeInputMapping;m=this.inputChannels;(q=g.getOperators(f,this.platform)||g.getOperators(f,c.PLATFORM.JAVASCRIPT))||a.notifyError("No operator with name '"+f+"' found",this.owner);for(z=q.length;z--;)if(d(q[z],l,m)){m=q[z];break a}r.length=0;for(z=q.length;z--;)d(q[z],l,m,r);f="No operator '"+
f+"' with matching type signature found:\n\n"+r.join("\n");a.notifyError(f,this.owner);m=null}m&&(this.platform=m.platform)}this.operator=m}else this.operator=l._computeOperator;f=this.owner;if(this.operator)for(w in l=this.processNode=new k(this),m=0,l.outputDataSlots)q=w,f._computeOutputMapping&&(q=f._computeOutputMapping.getScriptOutputName(m,w)),q&&this.computedChannels.addOutputDataSlot(q,l.outputDataSlots[w],l),m++}e&&e!=this.dataflowChannelNode&&e.owner._removeSubstitutionNode(e);w=this.owner;
w._filterMapping?w._filterMapping.applyFilterOnChannelMap(this.outputChannels,this.computedChannels,w._filterType,b):this.outputChannels.merge(this.computedChannels);this.outOfSync=!1}};e.prototype.clear=function(){this.useCount=0;this.inputChannels.clear();this.outputChannels.clear();return!0};e.prototype.increaseRef=function(){this.useCount++};e.prototype.decreaseRef=function(){this.useCount--;return 0==this.useCount?(this.clear(),!0):!1};e.prototype.getOutputNames=function(){this.synchronize();
return this.outputChannels.getNames()};e.prototype.getChildDataIndex=function(a){this.synchronize();return this.outputChannels.getChildDataIndexForFilter(a)};e.prototype.setStructureOutOfSync=function(){if(!this.outOfSync){this.outOfSync=!0;this.inputChannels.clear();this.computedChannels.clear();this.outputChannels.clear();this.processNode&&this.processNode.clear();for(var a in this.requestNodes)this.requestNodes[a].setStructureOutOfSync()}};e.prototype.notifyDataChange=function(a,b){var c=a._name+
";"+a._key;this.inputSlots[c]&&this.inputSlots[c].setDataEntry(a._data,b)};e.prototype.getResult=function(a,b){this.synchronize();var c=b?b.join(";"):"[null]";this.requestNodes[c]||(this.requestNodes[c]=new f(this,b));return this.requestNodes[c].getResult(a)};e.prototype.getOutputChannelInfo=function(a){this.synchronize();var b=this.outputChannels.getChannel(a);if(!b)return null;var d={type:b.getType(),seqLength:b.getSequenceLength(),seqMinKey:b.getSequenceMinKey(),seqMaxKey:b.getSequenceMaxKey(),
origin:0,originalName:""};a=this.owner._filterMapping?this.owner._filterMapping.getRenameSrcName(a):a;b=b.getDataEntry();if(this.dataflowChannelNode){var e=this.inputChannels.getChannel(a);if(!e||b!=e.getDataEntry())return d.origin=c.ORIGIN.PROTO,d.originalName=a,d}if(this.operator&&(e=this.inputChannels.getChannel(a),!e||b!=e.getDataEntry()))return d.origin=c.ORIGIN.COMPUTE,d.originalName=this.owner._computeOutputMapping.getScriptOutputNameInv(a,this.operator.outputs),d;d.origin=c.ORIGIN.CHILD;d.originalName=
a;return d};var r=[],n=function(a,b){this.map={};for(var c=b.owner,d=a._getGlobalParamNames(),e=0;e<d.length;++e)this.map[d[e]]=b.inputChannels.getChannel(d[e]);d=a._getParamNames();for(e=0;e<d.length;++e){var g=d[e],f=g;c._computeInputMapping&&(f=c._computeInputMapping.getScriptInputName(e,g));this.map[g]=b.inputChannels.getChannel(f)}};n.prototype.hasChannel=function(a){return!!this.map[a]};n.prototype.getChannel=function(a){return this.map[a]};n.prototype.getKey=function(a){for(var b="",c=a._getGlobalParamNames(),
d=0;d<c.length;++d)var e=this.map[c[d]],b=b+((e&&e.id||"-")+"!");a=a._getParamNames();for(d=0;d<a.length;++d)e=this.map[a[d]],b+=(e&&e.id||"-")+".";return b};m.exports={ChannelNode:e,Substitution:n}},{"../base.js":148,"../interface/constants.js":149,"../operator/operator.js":189,"./channel.js":193,"./data-slot.js":194,"./process-node.js":197}],193:[function(e,m,l){function d(a,b){a.map[b]||(a.map[b]={channel:null,childDataIndex:void 0})}function b(b,c,e,f){d(b,c);var h=b.map[c].channel;if(!h||!h.willMergeWithDataSlot(e))return e=
new k(b,e),b.map[c].channel=e,b.map[c].childDataIndex=f,e;h=a(b,h);h.addDataSlot(e);b.map[c].channel=h;b.map[c].childDataIndex=-1;return h}function a(a,b){if(b.map!=a){var c=new k(a);c.addChannelEntries(b);c.creatorProcessNode=b.creatorProcessNode;return c}return b}e("../base.js");var c=e("../interface/constants.js"),f=e("../interface/data.js").BufferEntry;e=function(){this.map={}};e.prototype.getNames=function(){return Object.keys(this.map)};e.prototype.getChannel=function(a){return this.map[a]?
this.map[a].channel:null};e.prototype.getChildDataIndex=function(a){return this.map[a]?this.map[a].childDataIndex:void 0};e.prototype.getChildDataIndexForFilter=function(a){var b;a=a||this.getNames();for(var c=0;c<a.length;++c){var d=this.getChildDataIndex(a[c]);void 0!=d&&(b=void 0!=b&&b!=d?-1:d)}return b};e.prototype.merge=function(a,b){for(var c in a.map){var d=void 0==b?a.getChildDataIndex(c):b;this.addChannel(c,a.getChannel(c),d)}};e.prototype.addChannel=function(b,c,e){if(c){void 0==e&&(e=-1);
d(this,b);var f=this.map[b].channel;f&&f.willMergeWithChannel(c)?(f=a(this,f),f.addChannelEntries(c),this.map[b].channel=f,this.map[b].childDataIndex=-1):(this.map[b].channel=c,this.map[b].childDataIndex=e)}};e.prototype.addDataEntry=function(a,c){b(this,a,c,-1)};e.prototype.addOutputDataSlot=function(a,c,d){b(this,a,c,-1).creatorProcessNode=d};e.prototype.clear=function(){for(var a in this.map){var b=this.map[a];b&&b.map==this&&b.clear()}this.map={}};var k=function(a,b){this.entries=[];this.map=
a;this.id=++h;this.listeners=[];this.creatorProcessNode=null;b&&this.addDataSlot(b)};k.prototype.addDataSlot=function(a){a.addChannel(this);for(var b=0;b<this.entries.length;++b){var d=this.entries[b];if(d.key>=a.key-c.EPSILON){Math.abs(d.key-a.key)<=c.EPSILON?(d.removeChannel(this),this.entries.splice(b,1,a)):this.entries.splice(b,0,a);break}}this.entries.push(a)};k.prototype.getSequenceLength=function(){return this.entries.length};k.prototype.getSequenceMinKey=function(){return this.entries[0].key};
k.prototype.getSequenceMaxKey=function(){return this.entries[this.entries.length-1].key};k.prototype.getType=function(){return 0==this.entries.length?c.DATA_TYPE.UNKNOWN:this.entries[0].dataEntry._type};k.prototype.addChannelEntries=function(a){for(var b=0;b<a.entries.length;++b)this.addDataSlot(a.entries[b]);a.creatorProcessNode&&(this.creatorProcessNode=a.creatorProcessNode)};k.prototype.getDataEntry=function(a,b){if(0==this.entries.length)return null;if(!a)return this.entries[0].dataEntry;for(var d=
0,e=this.entries.length;d<e&&this.entries[d].key<b;)++d;if(a==c.SEQUENCE.PREV_BUFFER)return this.entries[d?d-1:0].dataEntry;if(a==c.SEQUENCE.NEXT_BUFFER)return this.entries[d<e?d:e-1].dataEntry;if(a==c.SEQUENCE.LINEAR_WEIGHT){var h=this.entries[d?d-1:0].key,d=this.entries[d<e?d:e-1].key,e=new Float32Array(1);e[0]=d==h?0:(b-h)/(d-h);return new f(c.DATA_TYPE.FLOAT,e)}return null};k.prototype.willMergeWithChannel=function(a){if(this.entries.length!=a.entries.length)return!0;if(this.getType()!=a.getType())return!1;
for(var b=0;b<this.entries.length;b++)if(Math.abs(this.entries[b].key-a.entries[b].key)>c.EPSILON)return!0;return!1};k.prototype.willMergeWithDataSlot=function(a){return 1<this.entries.length?!0:this.getType()!=a.dataEntry._type?!1:Math.abs(this.entries[0].key-a.key)>c.EPSILON};k.prototype.notifyOnChange=function(a){for(var b=0;b<this.listeners.length;b++)this.listeners[b].onXflowChannelChange(this,a)};k.prototype.addListener=function(a){this.listeners.push(a)};k.prototype.removeListener=function(a){a=
this.listeners.indexOf(a);-1!=a&&this.listeners.splice(a,1)};k.prototype.clear=function(){for(var a=0;a<this.entries.length;++a)this.entries[a].removeChannel(this)};var h=0;m.exports={Channel:k,ChannelMap:e}},{"../base.js":148,"../interface/constants.js":149,"../interface/data.js":150}],194:[function(e,m,l){e("../base.js");var d=e("../interface/constants.js");e=function(b,a){this.key=a||0;this.dataEntry=b;this.asyncDataEntry=null;this.parentChannels=[]};e.prototype.addChannel=function(b){this.parentChannels.push(b)};
e.prototype.removeChannel=function(b){b=this.parentChannels.indexOf(b);-1!=b&&this.parentChannels.splice(b,1)};e.prototype.swapAsync=function(){var b=this.dataEntry;this.dataEntry=this.asyncDataEntry;this.asyncDataEntry=b};e.prototype.setDataEntry=function(b,a){this.dataEntry=b;this.notifyOnChange(a==d.RESULT_STATE.CHANGED_DATA_VALUE?d.DATA_ENTRY_STATE.CHANGED_VALUE:d.DATA_ENTRY_STATE.CHANGED_SIZE)};e.prototype.notifyOnChange=function(b){for(var a=0;a<this.parentChannels.length;++a)this.parentChannels[a].notifyOnChange(b)};
m.exports=e},{"../base.js":148,"../interface/constants.js":149}],195:[function(e,m,l){function d(c,e,f,g){if(-1==c.blockedNodes.indexOf(e)){if(e.operator){var k;(k=g)||(k=e.operator,k=!((f==h.PLATFORM.ASYNC||!r.isOperatorAsync(k))&&(!c.firstOperator||f==h.PLATFORM.GLSL&&c.firstOperator.evaluate_glsl&&k.evaluate_glsl)));if(k){b(c,e);return}c.firstOperator||(c.firstOperator=e.operator);k=e.operator.mapping;for(var l=0;l<k.length;++l)k[l].sequence?(a(c,e,k[l].source),a(c,e,k[l].keySource)):k[l].array&&
a(c,e,k[l].source)}for(l=0;l<e.children.length;++l)d(c,e.children[l],f,g)}}function b(a,c){if(-1==a.blockedNodes.indexOf(c)){a.blockedNodes.push(c);for(var d=0;d<c.children.length;++d)b(a,c.children[d])}}function a(a,c,d){(c=c.inputChannels[d])&&c.creatorProcessNode&&b(a,c.creatorProcessNode)}function c(a,b,d){if(-1==a.doneNodes.indexOf(d))if(a.doneNodes.push(d),-1!=a.blockedNodes.indexOf(d))b.subNodes.push(d);else{for(var e=0;e<d.children.length;++e)c(a,b,d.children[e]);d.operator&&a.constructionOrder.push(d)}}
function f(a){for(var b=a.programData.inputs,c=0;c<a.programData.inputs.length;++c){var d=a.programData.getDataEntry(c);(d=d?d.getIterateCount?d.getIterateCount():1:0)?!b[c].arrayAccess&&1<d?a.operatorList.setInputIterateType(c,h.ITERATION_TYPE.MANY):a.operatorList.setInputIterateType(c,h.ITERATION_TYPE.ONE):a.operatorList.setInputIterateType(c,h.ITERATION_TYPE.NULL);b[c].arrayAccess&&a.platform==h.PLATFORM.GLSL&&a.operatorList.setInputSize(c,d)}}function k(a){for(var b=0;b<a.subNodes.length;++b)a.subNodes[b].process()}
e("../base.js");var h=e("../interface/constants.js"),g=e("../operator/operator-list.js"),q=e("../utils/utils.js"),r=e("../operator/operator.js"),n=e("../operator/operator-entry.js"),p=e("../operator/program.js");e=function(a,b){this.platform=b;this.mergedNodes=[];this.mergedOutputNodes=[];this.subNodes=[];this.unprocessedDataNames=[];this.operatorList=new g(b);this.programData=new p.ProgramData;this.program=null;var e={blockedNodes:[],doneNodes:[],constructionOrder:[],inputSlots:{},finalOutput:null,
firstOperator:null};e.finalOutput={};for(var f=a.filter||a.owner.outputChannels.getNames(),h=0;h<f.length;++h){var k=f[h],l=a.owner.outputChannels.getChannel(k);l&&l.creatorProcessNode&&(e.finalOutput[k]=l.getDataEntry())}q.nameset.add(this.unprocessedDataNames,f);d(e,a,this.platform,!1);c(e,this,a);for(f=0;f<e.constructionOrder.length;++f){for(var h=e.constructionOrder[f],l=k=new n(h.operator),m=e,r=h,A=r.operator.mapping,B=0;B<A.length;++B){var D=r.inputChannels[A[B].source],H;if(D&&D.creatorProcessNode&&
-1!=(H=this.mergedNodes.indexOf(D.creatorProcessNode))){a:{for(var F=D.creatorProcessNode,G=F.operator.outputs,I=0;I<G.length;++I)if(D.getDataEntry()==F.outputDataSlots[G[I].name].dataEntry){D=I;break a}D=null}l.setTransferInput(B,H,D);F=this.operatorList.entries[H];F.isFinalOutput(D)||F.setTransferOutput(D)}else{F=A[B].source;r.owner.owner._computeInputMapping&&(F=r.owner.owner._computeInputMapping.getScriptInputName(A[B].paramIdx,A[B].source));G=new p.ProgramInputConnection;G.channel=D;G.arrayAccess=
A[B].array||!1;G.sequenceAccessType=A[B].sequence||0;G.sequenceAccessType&&(G.sequenceKeySourceChannel=r.inputChannels[A[B].keySource]);var I=G.getKey(),K=m.inputSlots[I];D&&void 0!=K||(K=this.programData.inputs.length,m.inputSlots[I]=K,this.programData.inputs.push(G));l.setDirectInput(B,K,F)}}l=k;m=e;r=h;A=r.operator.outputs;B=!0;for(D=0;D<A.length;++D){F=r.outputDataSlots[A[D].name];a:if(m.finalOutput){G=void 0;for(G in m.finalOutput)if(m.finalOutput[G]==F.dataEntry)break a;G=!1}else G=!0;G?(I=
this.programData.outputs.length,this.programData.outputs.push(F),l.setFinalOutput(D,I),!0!==G&&q.nameset.remove(this.unprocessedDataNames,G)):B=!1}l=B;this.programData.operatorData.push({});this.operatorList.addEntry(k);this.mergedNodes.push(h);(l||f==e.constructionOrder.length-1)&&this.mergedOutputNodes.push(h)}for(H=0;H<e.constructionOrder.length;++H)for(f=e.constructionOrder[H],h=this.operatorList.entries[H],k=f.operator.outputs,l=0;l<k.length;++l)h.isFinalOutput(l)||h.isTransferOutput(l)||(m=
this.programData.outputs.length,this.programData.outputs.push(f.outputDataSlots[k[l].name]),h.setLostOutput(l,m))};e.prototype.isProcessed=function(){for(var a=this.mergedOutputNodes.length;a--;)if(this.mergedOutputNodes[a].status!=h.PROCESS_STATE.PROCESSED)return!1;return!0};e.prototype.run=function(a){k(this);f(this);if(this.program=p.createProgram(this.operatorList))this.operatorList.allocateOutput(this.programData,!!a),this.program.run(this.programData,a);if(this.platform!=h.PLATFORM.ASYNC)for(a=
this.mergedOutputNodes.length;a--;)this.mergedOutputNodes[a].status=h.PROCESS_STATE.PROCESSED};e.prototype.getVertexShader=function(){k(this);f(this);return this.program=p.createProgram(this.operatorList)};m.exports=e},{"../base.js":148,"../interface/constants.js":149,"../operator/operator-entry.js":187,"../operator/operator-list.js":188,"../operator/operator.js":189,"../operator/program.js":190,"../utils/utils.js":200}],196:[function(e,m,l){function d(c){for(var d=0;d<c._owners.length;++d)c._owners[d].notify(a.RESULT_STATE.CHANGED_STRUCTURE);
b._flushResultCallbacks()}var b=e("../base.js"),a=e("./../interface/constants.js"),c=/^([^:,{}]+)(,[^:{},]+)*$/,f=/^\{(([^:,{}]+:[^:{},]+)(,[^:{},]+:[^:},]+)*)}$/;e=function(){this._owners=[]};e.parse=function(a,d){a=a.trim();var e=a.trim().match(c);if(e)return k.parse(a,d);if(e=a.trim().match(f))return h.parse(e[1],d);b.notifyError("Cannot parse name mapping '"+a+"'",d);return null};e.prototype._addOwner=function(a){-1==this._owners.indexOf(a)&&this._owners.push(a)};e.prototype._removeOwner=function(a){a=
this._owners.indexOf(a);-1!=a&&this._owners.splice(a,-1)};var k=function(){this._owners=[];this._names=[]};b.createClass(k,e);k.parse=function(a,b){for(var c=new k(b),d=a.split(","),e=0;e<d.length;e++)c._names.push(d[e].trim());return c};Object.defineProperty(k.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._names.length}});k.prototype.getName=function(a){return this._names[a]};k.prototype.clear=function(){this._names=[];d(this)};k.prototype.setName=
function(a,b){this._names[a]=b;d(this)};k.prototype.removeName=function(a){this._names.splice(a);d(this)};k.prototype.isEmpty=function(){return 0==this._names.length};k.prototype.applyFilterOnChannelMap=function(b,c,d,e){var f;if(d==a.DATA_FILTER_TYPE.KEEP)for(f=0;f<this._names.length;++f)d=this._names[f],c.map[d]&&e(b,d,c,d);else for(f in c.map){var h=this._names.indexOf(f);(d==a.DATA_FILTER_TYPE.RENAME||d==a.DATA_FILTER_TYPE.REMOVE&&-1==h)&&e(b,f,c,f)}};k.prototype.getScriptInputName=function(a){return this._names[a]?
this._names[a]:null};k.prototype.getScriptOutputName=function(a){return this._names[a]?this._names[a]:null};k.prototype.getScriptOutputNameInv=function(a,b){var c=this._names.indexOf(a);return-1==c?null:b[c].name};k.prototype.getRenameSrcName=function(a){return a};var h=function(){this._owners=[];this._destNames=[];this._srcNames=[]};b.createClass(h,e);h.parse=function(a,b){for(var c=new h(b),d=a.split(","),e=0;e<d.length;e++){var f=d[e].split(":"),k=f[0].trim(),f=f[1].trim();c.setNamePair(k,f)}return c};
Object.defineProperty(h.prototype,"length",{set:function(){throw Error("length is read-only");},get:function(){return this._srcNames.length}});h.prototype.getDestName=function(a){return this._destNames[a]};h.prototype.getSrcName=function(a){return this._srcNames[a]};h.prototype.getSrcNameFromDestName=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};h.prototype.getDestNameFromSrcName=function(a){a=this._srcNames.indexOf(a);return-1==a?null:this._destNames[a]};h.prototype.clear=
function(){this._srcNames=[];this._destNames=[];d(this)};h.prototype.setNamePair=function(a,b){var c=this._destNames.indexOf(a);-1!=c&&(this._destNames.splice(c,1),this._srcNames.splice(c,1));this._destNames.push(a);this._srcNames.push(b);d(this)};h.prototype.removeNamePair=function(a){a=this._destNames.indexOf(a);-1!=a&&(this._destNames.splice(a,1),this._srcNames.splice(a,1));d(this)};h.prototype.isEmpty=function(){return 0==this._destNames.length};h.prototype.applyFilterOnChannelMap=function(b,
c,d,e){var f;if(d==a.DATA_FILTER_TYPE.REMOVE)for(f in c.map)-1==this._srcNames.indexOf(f)&&e(b,f,c,f);else{if(d==a.DATA_FILTER_TYPE.RENAME)for(f in c.map)-1==this._srcNames.indexOf(f)&&e(b,f,c,f);for(f in this._destNames)e(b,this._destNames[f],c,this._srcNames[f])}};h.prototype.getRenameSrcName=function(a){return this.getSrcNameFromDestName(a)||a};h.prototype.getScriptInputName=function(a,b){return this.getSrcNameFromDestName(b)};h.prototype.getScriptOutputName=function(a,b){return this.getDestNameFromSrcName(b)};
h.prototype.getScriptOutputNameInv=function(a){a=this._destNames.indexOf(a);return-1==a?null:this._srcNames[a]};m.exports={NameMapping:h,OrderMapping:k,Mapping:e}},{"../base.js":148,"./../interface/constants.js":149}],197:[function(e,m,l){function d(a,b,c){var d,e;for(e in c)(d=c[e])&&d.creatorProcessNode&&(f.set.add(a,d.creatorProcessNode),f.set.add(b,d.creatorProcessNode.descendants));f.set.remove(a,b);f.set.add(b,a)}function b(a,b){a.executers[b]||(a.executers[b]=new k(a,b));return a.executers[b]}
var a=e("../base.js"),c=e("../interface/constants.js"),f=e("../utils/utils.js"),k=e("./executor.js"),h=e("./result.js"),g=e("../operator/operator.js");l=e("../interface/data.js");var q=e("../processing/data-slot.js"),r=l.BufferEntry,n=l.TextureEntry,p=l.ImageDataTextureEntry;e=function(a){this.owner=a;this.operator=a.operator;this.inputChannels={};this.outputDataSlots={};this.status=c.PROCESS_STATE.MODIFIED;this.asyncProcessState=3;this.children=[];this.descendants=[];this._bindedAsyncCallback=null;
this.executers=[];for(var b=this.operator,e=a.owner._computeInputMapping,f=0;f<b.params.length;++f){var h=b.params[f].source,k=e?e.getScriptInputName(f,h):h;k&&((k=a.inputChannels.getChannel(k))&&k.addListener(this),this.inputChannels[h]=k)}d(this.children,this.descendants,this.inputChannels);a=this.operator;var b=this.outputDataSlots,e=g.isOperatorAsync(a),l;for(l in a.outputs){var f=a.outputs[l],m,k=f.type;k!=c.DATA_TYPE.TEXTURE?(h=new r(k,null),e&&(m=new r(k,null))):(h=window.document?new n(null):
new p(null),e&&(m=window.document?new n(null):new p(null)));b[f.name]=new q(h,0);e&&(b[f.name].asyncDataEntry=m)}g.isOperatorAsync(this.operator)&&(this._bindedAsyncCallback=this.receiveAsyncProcessing.bind(this))};e.prototype.onXflowChannelChange=function(a,b){if(g.isOperatorAsync(this.operator)){if(this.status==c.PROCESS_STATE.LOADING||3!=this.asyncProcessState)this.status=c.PROCESS_STATE.MODIFIED,this.updateState()}else this.status=b==c.DATA_ENTRY_STATE.CHANGED_VALUE&&this.status>c.PROCESS_STATE.UNPROCESSED?
c.PROCESS_STATE.UNPROCESSED:c.PROCESS_STATE.MODIFIED,this.notifyOutputChanged(b)};e.prototype.startAsyncProcessing=function(){0==this.asyncProcessState||3==this.asyncProcessState?(this.asyncProcessState=1,b(this,c.PLATFORM.ASYNC).run(this._bindedAsyncCallback)):this.asyncProcessState=2};e.prototype.receiveAsyncProcessing=function(){this.status=c.PROCESS_STATE.PROCESSED;this.notifyOutputChanged(c.DATA_ENTRY_STATE.CHANGED_SIZE_TYPE);2==this.asyncProcessState?(this.asyncProcessState=0,this.status=c.PROCESS_STATE.MODIFIED,
this.updateState()):this.asyncProcessState=0;a._flushResultCallbacks()};e.prototype.notifyOutputChanged=function(a){for(var b in this.outputDataSlots)this.outputDataSlots[b].notifyOnChange(a)};e.prototype.clear=function(){for(var a in this.inputChannels)this.inputChannels[a]&&this.inputChannels[a].removeListener(this)};e.prototype.updateState=function(){if(this.status==c.PROCESS_STATE.MODIFIED)if(this.status=c.PROCESS_STATE.UNPROCESSED,XML3D.debug.assert(!this.owner.loading,"This should never happen"),
this.owner.loading)this.status=c.PROCESS_STATE.LOADING;else{for(var b=0;b<this.children.length;++b)this.status=Math.min(this.status,this.children[b].updateState());if(b=this.status>c.PROCESS_STATE.LOADING)a:{var b=this.operator,d=this.inputChannels,e;for(e in b.params){var f=d[b.params[e].source];if(f&&(f=f.getDataEntry())&&f.isLoading&&f.isLoading()){b=!0;break a}}b=!1}b&&(this.status=c.PROCESS_STATE.LOADING);if(e=this.status>c.PROCESS_STATE.INVALID){var h;a:{e=this.operator;b=this.owner.owner._computeInputMapping;
d=this.inputChannels;f=this.owner.owner;for(h in e.params){var k=e.params[h],l=b?b.getScriptInputName(h,k.source):k.source;if(!k.optional&&!l){a.notifyError("Xflow: operator "+e.name+": Missing input argument for "+k.source,f);h=!1;break a}if(l){var m=d[k.source];if(!m){if(!b)continue;a.notifyError("Xflow: operator "+e.name+": Input of name '"+l+"' not found. Used for parameter "+k.source,f);h=!1;break a}l=m.getDataEntry();if(!(m.creatorProcessNode||k.optional||l&&!l.isEmpty())){a.notifyError("Xflow: operator "+
e.name+": Input for "+k.source+" contains no data.",f);h=!1;break a}if(l&&l.type!=k.type){a.notifyError("Xflow: operator "+e.name+": Input for "+k.source+" has wrong type. Expected: "+c.getTypeName(k.type)+", but got: "+c.getTypeName(l.type),f);h=!1;break a}}}h=!0}e=!h}e&&(this.status=c.PROCESS_STATE.INVALID);this.status==c.PROCESS_STATE.UNPROCESSED&&g.isOperatorAsync(this.operator)&&(this.status=3==this.asyncProcessState?c.PROCESS_STATE.LOADING:c.PROCESS_STATE.PROCESSED,this.startAsyncProcessing())}return this.status};
e.prototype.process=function(){this.status==c.PROCESS_STATE.UNPROCESSED&&(b(this,this.owner.platform).run(),this.status=c.PROCESS_STATE.PROCESSED)};l=function(a,b){this.owner=a;this.filter=b;this.results={};this.status=c.PROCESS_STATE.MODIFIED;this.channels={};this.children=[];this.executers=[];this.outOfSync=!0};l.prototype.synchronize=function(){if(this.outOfSync){this.outOfSync=!1;var a=this.owner,b=this.filter;b||(b=a.outputChannels.getNames());for(var c=0;c<b.length;++c){var e=b[c],f=a.outputChannels.getChannel(e);
f&&(this.channels[e]=f,f.addListener(this))}d(this.children,[],this.channels)}};l.prototype.updateState=function(){this.synchronize();if(this.status==c.PROCESS_STATE.MODIFIED)if(this.status=c.PROCESS_STATE.UNPROCESSED,this.owner.loading)this.status=c.PROCESS_STATE.LOADING;else for(var a=0;a<this.children.length;++a)this.status=Math.min(this.status,this.children[a].updateState());return this.status};l.prototype.getResult=function(a){this.updateState();if(this.status==c.PROCESS_STATE.UNPROCESSED){if(a==
c.RESULT_TYPE.COMPUTE){var d=b(this,this.owner.platform);d.isProcessed()||d.run()}this.status=c.PROCESS_STATE.PROCESSED}d=null;if(a==c.RESULT_TYPE.COMPUTE){this.results[c.RESULT_TYPE.COMPUTE]||(this.results[c.RESULT_TYPE.COMPUTE]=new h.ComputeResult);a=this.results[c.RESULT_TYPE.COMPUTE];a._dataEntries={};a._outputNames=[];for(var e in this.channels)d=this.channels[e].getDataEntry(),a._dataEntries[e]=d&&!d.isEmpty()?d:null,a._outputNames.push(e);d=a}else a==c.RESULT_TYPE.VS&&(e=b(this,c.PLATFORM.GLSL),
this.results[c.RESULT_TYPE.VS]||(this.results[c.RESULT_TYPE.VS]=new h.VSDataResult),a=this.results[c.RESULT_TYPE.VS],d=e.getVertexShader(),a._program=d,a._programData=e.programData,d=a);d.loading=this.status==c.PROCESS_STATE.LOADING;return d};l.prototype.setStructureOutOfSync=function(){this.outOfSync=!0;this.status=c.PROCESS_STATE.MODIFIED;for(var a in this.results)this.results[a]._notifyChanged(c.RESULT_STATE.CHANGED_STRUCTURE);for(var b in this.channels)this.channels[b].removeListener(this);this.channels=
[];this.children=[];this.executers=[]};l.prototype.onXflowChannelChange=function(a,b){a.creatorProcessNode&&(this.status=c.PROCESS_STATE.MODIFIED);var d=b==c.DATA_ENTRY_STATE.CHANGED_VALUE?c.RESULT_STATE.CHANGED_DATA_VALUE:c.RESULT_STATE.CHANGED_DATA_SIZE,e;for(e in this.results)this.results[e]._notifyChanged(d)};m.exports={RequestNode:l,ProcessNode:e}},{"../base.js":148,"../interface/constants.js":149,"../interface/data.js":150,"../operator/operator.js":189,"../processing/data-slot.js":194,"../utils/utils.js":200,
"./executor.js":195,"./result.js":198}],198:[function(e,m,l){l=e("../base.js");e("../../utils/array.js");var d=l._queueResultCallback,b=function(){this.valid=this.loading=!1;this._listeners=[];this._requests=[]};b.prototype.addListener=function(a){this._listeners.push(a)};b.prototype.removeListener=function(a){Array.erase(this._listeners,a)};b.prototype._addRequest=function(a){this._requests.push(a)};b.prototype._removeRequest=function(a){Array.erase(this._requests,a)};b.prototype._notifyChanged=
function(a){this.valid=!1;for(var b=0;b<this._requests.length;++b)this._requests[b]._onResultChanged(a);d(this,a)};b.prototype._onPostponedResultChanged=function(a){for(var b=0;b<this._listeners.length;++b)this._listeners[b](this,a)};e=function(){b.call(this);this._outputNames=[];this._dataEntries={}};l.createClass(e,b);Object.defineProperty(e.prototype,"outputNames",{set:function(a){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});e.prototype.getOutputData=function(a){return this._dataEntries[a]};
e.prototype.getOutputMap=function(){return this._dataEntries};var a=function(){b.call(this);this._programData=this._program=null};l.createClass(a,b);Object.defineProperty(a.prototype,"outputNames",{set:function(a){throw Error("shaderOutputNames is readonly");},get:function(){return this._program.getOutputNames()}});a.prototype.isOutputUniform=function(a){return this._program.isOutputUniform(a)};a.prototype.isOutputNull=function(a){return this._program.isOutputNull(a)};a.prototype.getOutputType=function(a){return this._program.getOutputType(a)};
a.prototype.getVertexShader=function(a){return this._program.createVertexShader(this._programData,a)};m.exports={ComputeResult:e,VSDataResult:a}},{"../../utils/array.js":140,"../base.js":148}],199:[function(e,m,l){e("../base.js");var d=e("./../interface/constants.js"),b=e("../operator/operator.js").initAnonymousOperator,a={};a[d.SHADER_CONSTANT_KEY.OBJECT_ID]="objectID";a[d.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM]="screenTransform";a[d.SHADER_CONSTANT_KEY.SCREEN_TRANSFORM_NORMAL]="screenTransformNormal";
a[d.SHADER_CONSTANT_KEY.VIEW_TRANSFORM]="viewTransform";a[d.SHADER_CONSTANT_KEY.VIEW_TRANSFORM_NORMAL]="viewTransformNormal";a[d.SHADER_CONSTANT_KEY.WORLD_TRANSFORM]="worldTransform";a[d.SHADER_CONSTANT_KEY.WORLD_TRANSFORM_NORMAL]="worldTransformNormal";e=function(){this._attributes={};this._blockedNames=[];this._addInput={};this._addOutput={};this._codeFragments=[];this._outputChanneling={}};e.prototype.addAttribute=function(a,b,c){if(this._attributes[b]){if(this._attributes[b].type!=a)throw Error("Tries to add two attributes with different types of name '"+
b+'"');this._attributes[b].optional=this._attributes[b].optional&&c}else this._attributes[b]={type:a,optional:c,channeling:[]}};e.prototype.channelAttribute=function(a,b,c){this._attributes[a].channeling.push({outputName:b,code:c})};e.prototype.addInputParameter=function(a,b,c){this._addInput[b]||(this._addInput[b]={type:a,uniform:c},this._blockedNames.push(b))};e.prototype.addOutputParameter=function(a,b){this._addOutput[b]||(this._addOutput[b]={type:a},this._blockedNames.push(b))};e.prototype.addCodeFragment=
function(a){this._codeFragments.push(a)};e.prototype.addBlockedName=function(a){this._blockedNames.push(a)};e.prototype.getBlockedNames=function(){return this._blockedNames};e.prototype.getFilter=function(){return Object.keys(this._attributes)};e.prototype.getKey=function(){var a="",b;for(b in this._attributes)var c=this._attributes[b],a=a+(";"+c.type+","+b+","+c.optional);return a};var c={};e.prototype.getOperator=function(){var a=this.getKey();if(c[a])return c[a];var e=[],h=[],g="VSConnect",g;for(g in this._attributes){var l=
this._attributes[g],m=d.getTypeName(l.type);e.push({type:m,name:g});h.push({type:m,source:g,optional:l.optional});g+="T"+m+"N"+g+"O"+l.optional+"."}e=b(g,{outputs:e,params:h,evaluate_glsl:"\t// VS Connector\n"});return c[a]=e};l=function(a){this._programData=a;this._glslCode=null;this._inputNames=[];this._outputNames=[];this._inputInfo={};this._outputInfo={}};Object.defineProperty(l.prototype,"inputNames",{set:function(a){throw Error("inputNames is readonly");},get:function(){return this._inputNames}});
Object.defineProperty(l.prototype,"outputNames",{set:function(a){throw Error("outputNames is readonly");},get:function(){return this._outputNames}});l.prototype.isInputUniform=function(a){return this._inputInfo[a].uniform};l.prototype.getInputData=function(a){return this._programData.getDataEntry(this._inputInfo[a].index)};l.prototype.isOutputNull=function(a){return this._outputInfo[a].iteration==d.ITERATION_TYPE.NULL};l.prototype.isOutputFragmentUniform=function(a){return this._outputInfo[a].iteration==
d.ITERATION_TYPE.ONE};l.prototype.getUniformOutputData=function(a){return this._programData.getDataEntry(this._outputInfo[a].index)};l.prototype.getOutputType=function(a){return this._outputInfo[a].type};l.prototype.getOutputSourceName=function(a){return this._outputInfo[a].sourceName};l.prototype.getGLSLCode=function(){return this._glslCode};m.exports={shaderConstant:a,setShaderConstant:function(b,c){a[b]=c},VSConfig:e,VertexShader:l}},{"../base.js":148,"../operator/operator.js":189,"./../interface/constants.js":149}],
200:[function(e,m,l){e("../../utils/array.js");m.exports={set:{add:function(d,b){if(Array.isArray(b))for(var a=0;a<b.length;++a)-1==d.indexOf(b[a])&&d.push(b[a]);else-1==d.indexOf(b)&&d.push(b)},remove:function(d,b){var a;if(Array.isArray(b))for(var c=0;c<b.length;++c)-1!=(a=d.indexOf(b[c]))&&d.splice(a,1);else-1!=(a=d.indexOf(b))&&d.splice(a,1)},intersection:function(d,b,a){for(var c=b.length,e=0;e<c;++e)-1!=a.indexOf(b[e])&&d.push(b[e])},isIntersecting:function(d,b){for(var a=d.length;a--;)if(-1!=
b.indexOf(d[a]))return!0;return!1},isSubset:function(d,b){for(var a=d.length;a--;)if(-1==b.indexOf(d[a]))return!1;return!0}},nameset:{add:function(d,b){if(b)if("string"==typeof b)-1==d.indexOf(b)&&d.push(b);else for(var a=0;a<b.length;++a)-1==d.indexOf(b[a])&&d.push(b[a])},remove:function(d,b){if(b)if("string"==typeof b){var a=d.indexOf(b);-1!=a&&d.splice(a,1)}else for(var c=0;c<b.length;++c)a=d.indexOf(b[c]),-1!=a&&d.splice(a,1)},intersection:function(d,b){for(var a=d.length;a--;)-1==b.indexOf(d[a])&&
d.splice(a,1)}},binarySearch:function(d,b,a){var c=0;for(--a;c<=a;){var e=Math.floor((c+a)/2);if(d[e]==b)return e;d[e]<b?c=e+1:a=e-1}return a}}},{"../../utils/array.js":140}],201:[function(e,m,l){m.exports=e("./init.js")},{"./init.js":43}]},{},[201]);
